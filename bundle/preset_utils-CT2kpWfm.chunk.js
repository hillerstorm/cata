import{a0 as e,u as t,a6 as a,bU as i,ah as s,ba as o,T as n,a as l,v as r,bV as c,S as d,bT as m,a7 as h,bW as p,a3 as u,b as g,bX as f,n as w,q as y,bY as I,bZ as b,b_ as x,b$ as S,c0 as v,c1 as k,c2 as E,Y as P,a1 as C,c3 as N,a4 as _,c4 as T,br as R,X as D,c5 as G,w as O,ad as U,j as A,c6 as L,av as F,aw as M,ax as V,aE as W,aF as B,aG as z,aY as j,aZ as H,c7 as q,b3 as K,b4 as $,b8 as Y,M as J,d as Z,bc as Q,bd as X,be as ee,bn as te,bo as ae,bp as ie,bt as se,bu as oe,c8 as ne,bB as le,bC as re,bD as ce,bN as de,bO as me,bP as he,c9 as pe,ca as ue,cb as ge,cc as fe,cd as we,ce as ye,p as Ie,cf as be,i as xe,G as Se,cg as ve,ch as ke,ci as Ee,cj as Pe,ck as Ce,cl as Ne,cm as _e,cn as Te,co as Re,cp as De,cq as Ge,cr as Oe,cs as Ue,ct as Ae,cu as Le,cv as Fe,cw as Me,cx as Ve,c as We,cy as Be,U as ze,cz as je,cA as He,cB as qe,y as Ke,cC as $e,aC as Ye,A as Je,N as Ze,cD as Qe,cE as Xe,cF as et,cG as tt,cH as at,cI as it,cJ as st,b2 as ot,_ as nt,cK as lt,cL as rt,cM as ct,cN as dt,aI as mt,cO as ht,$ as pt,cP as ut,cQ as gt,z as ft,cR as wt,cS as yt,cT as It,cU as bt,cV as xt,cW as St,cX as vt,cY as kt,cZ as Et,c_ as Pt,c$ as Ct,d0 as Nt,d1 as _t,d2 as Tt,d3 as Rt,d4 as Dt,d5 as Gt,d6 as Ot,d7 as Ut,d8 as At,d9 as Lt,da as Ft,db as Mt,dc as Vt,dd as Wt,de as Bt,df as zt,dg as jt,dh as Ht,di as qt,dj as Kt,dk as $t,dl as Yt,dm as Jt,dn as Zt,dp as Qt,dq as Xt,dr as ea,ds as ta,dt as aa,du as ia,dv as sa,dw as oa,dx as na,dy as la,dz as ra,dA as ca,dB as da,dC as ma,dD as ha,dE as pa,dF as ua,dG as ga,dH as fa,dI as wa,dJ as ya,dK as Ia,dL as ba,dM as xa,dN as Sa,dO as va,dP as ka,dQ as Ea,dR as Pa,dS as Ca,dT as Na,dU as _a,dV as Ta,dW as Ra,dX as Da,dY as Ga,dZ as Oa,d_ as Ua,d$ as Aa,e0 as La,e1 as Fa,e2 as Ma,e3 as Va,e4 as Wa,e5 as Ba,e6 as za,e7 as ja,e8 as Ha,e9 as qa,ea as Ka,eb as $a,ec as Ya,ed as Ja,ee as Za,ef as Qa,eg as Xa,eh as ei,ei as ti,ej as ai,ek as ii,el as si,em as oi,en as ni,eo as li,ep as ri,eq as ci,er as di,es as mi,et as hi,eu as pi,ev as ui,ew as gi,ex as fi,ey as wi,ez as yi,eA as Ii,eB as bi,eC as xi,eD as Si,eE as vi,eF as ki,eG as Ei,eH as Pi,eI as Ci,eJ as Ni,aM as _i,eK as Ti,eL as Ri,eM as Di,eN as Gi,eO as Oi,eP as Ui,aN as Ai,aO as Li,eQ as Fi,eR as Mi,eS as Vi,eT as Wi,eU as Bi,eV as zi,eW as ji,eX as Hi,eY as qi,eZ as Ki,aR as $i,h as Yi,F as Ji,e_ as Zi,e$ as Qi,g as Xi,f as es,K as ts,f0 as as,f1 as is,am as ss,R as os,D as ns,m as ls,I as rs,C as cs,f2 as ds,f3 as ms,ac as hs,f4 as ps,f5 as us,Z as gs,f6 as fs,f7 as ws,f8 as ys,f9 as Is,fa as bs,fb as xs,fc as Ss,fd as vs,fe as ks,ff as Es,fg as Ps,P as Cs,fh as Ns,fi as _s,ae as Ts,fj as Rs,Q as Ds,a2 as Gs,W as Os,O as Us,fk as As,fl as Ls,fm as Fs,fn as Ms,fo as Vs,fp as Ws,fq as Bs,fr as zs,fs as js,ft as Hs,fu as qs,fv as Ks,fw as $s,fx as Ys,fy as Js,fz as Zs,fA as Qs,fB as Xs,fC as eo,fD as to,o as ao,an as io,fE as so,fF as oo,fG as no,fH as lo,fI as ro,fJ as co,fK as mo,fL as ho,by as po,b1 as uo,fM as go,fN as fo,fO as wo,fP as yo,fQ as Io,fR as bo,H as xo,fS as So,ao as vo,ap as ko,aT as Eo,fT as Po,ai as Co,fU as No,fV as _o,fW as To,fX as Ro,fY as Do,fZ as Go,f_ as Oo,f$ as Uo,g0 as Ao,g1 as Lo,g2 as Fo,g3 as Mo,g4 as Vo,g5 as Wo,g6 as Bo,g7 as zo,g8 as jo,g9 as Ho,ga as qo,V as Ko,gb as $o,J as Yo,E as Jo,aS as Zo,gc as Qo,gd as Xo,ge as en,gf as tn,gg as an,a5 as sn,gh as on,gi as nn,bS as ln,gj as rn,gk as cn}from"./detailed_results-22mxnnQ_.chunk.js";import{M as dn,t as mn,i as hn,T as pn,h as un,a as gn,b as fn}from"./index-BgswASio.chunk.js";const wn={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class yn extends e{constructor(e,i,s={disposeOnClose:!0}){super(e,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...wn,...s};const o=a(),n=a(),l=a(),r=a(),c=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(t("div",{className:`modal-dialog ${i} ${c} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:o},t("div",{className:"modal-content"},t("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:n},this.modalConfig.title&&t("h5",{className:"modal-title"},this.modalConfig.title),t("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},t("i",{className:"fas fa-times fa-2xl"}))),t("div",{className:"modal-body",ref:l}),this.modalConfig.footer&&t("div",{className:"modal-footer",ref:r})))),this.dialog=o.value,this.header=n.value,this.body=l.value,this.footer=r.value,this.modal=new dn(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),a=this.hideBSFn.bind(this),i=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",a),this.rootElem.addEventListener("hidden.bs.modal",i),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",a))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",i))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}const In={[i.ItemQualityJunk]:"text-junk",[i.ItemQualityCommon]:"text-common",[i.ItemQualityUncommon]:"text-uncommon",[i.ItemQualityRare]:"text-rare",[i.ItemQualityEpic]:"text-epic",[i.ItemQualityLegendary]:"text-legendary",[i.ItemQualityArtifact]:"text-artifact",[i.ItemQualityHeirloom]:"text-heirloom"};function bn(e,t){Object.values(In).forEach((t=>e.classList.remove(t))),t&&e.classList.add(In[t])}class xn extends s{constructor(e,t,a){super(e,"number-picker-root",t,a),this.float=a.float??!1,this.maxDecimalDigits=a.maxDecimalDigits??2,this.positive=a.positive??!1,this.showZeroes=a.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=o(Math.abs(Number(this.inputElem.value)),{minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(n.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?Number(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){0!==e||this.showZeroes?this.float?this.inputElem.value=o(e,{useGrouping:!1,minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=String(e):this.inputElem.value=""}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class Sn extends e{constructor(e,i,s,o,d){super(e,"character-stats-root"),this.stats=s,this.player=i,this.modifyDisplayStats=o,this.overwriteDisplayStats=d;const m=document.createElement("label");m.classList.add("character-stats-label"),m.textContent="Stats",this.rootElem.appendChild(m);const h=document.createElement("table");if(h.classList.add("character-stats-table"),this.rootElem.appendChild(h),this.valueElems=[],this.stats.forEach((e=>{const s=e.getShortName(i.getClass()),o=a(),n=t("tr",{className:"character-stats-table-row"},t("td",{className:"character-stats-table-label"},s,e.equalsStat(l.StatMasteryRating)&&t(r,null,t("br",null),c.get(this.player.getSpec()))),t("td",{ref:o,className:"character-stats-table-value"},e.hasRootStat()&&this.bonusStatsLink(e)));h.appendChild(n),this.valueElems.push(o.value)})),this.shouldShowMeleeCritCap(i)){const e=a(),i=t("tr",{className:"character-stats-table-row"},t("td",{className:"character-stats-table-label"},"Melee Crit Cap"),t("td",{ref:e,className:"character-stats-table-value"}));h.appendChild(i),this.meleeCritCapValueElem=e.value}else this.meleeCritCapValueElem=void 0;this.updateStats(i),n.onAny([i.currentStatsEmitter,i.sim.changeEmitter,i.talentsChangeEmitter]).on((()=>{this.updateStats(i)}))}updateStats(e){const i=e.getCurrentStats(),s=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{},o=d.fromProto(i.baseStats),n=d.fromProto(i.gearStats),r=d.fromProto(i.talentsStats),c=d.fromProto(i.buffsStats),g=d.fromProto(i.consumesStats),f=this.getDebuffStats(),w=e.getBonusStats();let y=o.add(s.base||new d),I=n.subtract(o).subtract(w).add(s.gear||new d),b=r.subtract(n).add(s.talents||new d),x=c.subtract(r).add(s.buffs||new d),S=g.subtract(c).add(s.consumes||new d),v=d.fromProto(i.finalStats).add(s.base||new d).add(s.gear||new d).add(s.talents||new d).add(s.buffs||new d).add(s.consumes||new d).add(s.final||new d).add(f);if(this.overwriteDisplayStats){const e=this.overwriteDisplayStats(this.player);e.stats&&e.stats.forEach(((t,a)=>{y=y.withStat(t,e.base.getStat(t)),I=I.withStat(t,e.gear.getStat(t)),b=b.withStat(t,e.talents.getStat(t)),x=x.withStat(t,e.buffs.getStat(t)),S=S.withStat(t,e.consumes.getStat(t)),v=v.withStat(t,e.final.getStat(t))}))}const k=this.player.getBaseMastery()+(i.finalStats?.stats[l.StatMasteryRating]||0)/m;if(this.stats.forEach(((e,i)=>{const s=e.hasRootStat()?w.getStat(e.getRootStat()):0;let o;o=0==s?"text-white":s>0?"text-success":"text-danger";const n=a(),r=t("div",{className:"stat-value-link-container"},t("button",{ref:n,className:u("stat-value-link",o)},`${this.statDisplayString(v,e,!0)} `),e.equalsStat(l.StatMasteryRating)&&t("a",{href:h.makeSpellUrl(p.get(this.player.getSpec())||0),className:u("stat-value-link-mastery",o),target:"_blank"},`${(k*this.player.getMasteryPerPointModifier()).toFixed(2)}%`)),c=n.value;this.valueElems[i].querySelector(".stat-value-link-container")?.remove(),this.valueElems[i].prepend(r);const d=t("div",null,t("div",{className:"character-stats-tooltip-row"},t("span",null,"Base:"),t("span",null,this.statDisplayString(y,e,!0))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Gear:"),t("span",null,this.statDisplayString(I,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Talents:"),t("span",null,this.statDisplayString(b,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Buffs:"),t("span",null,this.statDisplayString(x,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Consumes:"),t("span",null,this.statDisplayString(S,e))),0!=f.getUnitStat(e)&&t("div",{className:"character-stats-tooltip-row"},t("span",null,"Debuffs:"),t("span",null,this.statDisplayString(f,e))),0!==s&&t("div",{className:"character-stats-tooltip-row"},t("span",null,"Bonus:"),t("span",null,this.statDisplayString(w,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Total:"),t("span",null,this.statDisplayString(v,e,!0))));mn(c,{content:d})})),this.meleeCritCapValueElem){const a=e.getMeleeCritCapInfo(),i=t("button",{className:"stat-value-link"},this.meleeCritCapDisplayString(e,v)," "),s=a.playerCritCapDelta;0==s?i.classList.add("text-white"):s>0?i.classList.add("text-danger"):s<0&&i.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(i);const o=t("div",null,t("div",{className:"character-stats-tooltip-row"},t("span",null,"Glancing:"),t("span",null,`${a.glancing.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Suppression:"),t("span",null,`${a.suppression.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"To Hit Cap:"),t("span",null,`${a.remainingMeleeHitCap.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"To Exp Cap:"),t("span",null,`${a.remainingExpertiseCap.toFixed(2)}%`)),0!=a.specSpecificOffset&&t("div",{className:"character-stats-tooltip-row"},t("span",null,"Spec Offsets:"),t("span",null,`${a.specSpecificOffset.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Final Crit Cap:"),t("span",null,`${a.baseCritCap.toFixed(2)}%`)),t("hr",null),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Can Raise By:"),t("span",null,`${(a.remainingExpertiseCap+a.remainingMeleeHitCap).toFixed(2)}%`)));mn(i,{content:o})}}statDisplayString(e,t,a){const i=t.hasRootStat()?e.getStat(t.getRootStat()):null;let s=t.convertDefaultUnitsToPercent(e.getUnitStat(t));t.equalsStat(l.StatMasteryRating)&&a&&(s+=this.player.getBaseMastery());const o=null===i||0===i&&null!==s,n=o?"":String(Math.round(i)),r=t.equalsStat(l.StatMasteryRating)?" Points":"%",c=null===s?"":`${s.toFixed(2)}`+r;return n+(o||null===s?c:` (${c})`)}getDebuffStats(){let e=new d;const t=this.player.sim.raid.getDebuffs();return(t.criticalMass||t.shadowAndFlame)&&(e=e.addPseudoStat(g.PseudoStatSpellCritPercent,5)),e}bonusStatsLink(e){const i=e.getRootStat(),s=f(i),o=a(),n=a(),l=t("button",{ref:o,className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"}},t("i",{ref:n,className:"fas fa-plus-minus"}));return mn(n.value,{content:`Bonus ${s}`}),mn(o.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:e=>{const t=new xn(null,this.player,{id:`character-bonus-stat-${i}`,label:`Bonus ${s}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getStat(i),setValue:(t,a,s)=>{const o=a.getBonusStats().withStat(i,s);a.setBonusStats(t,o),e?.hide()}});e.setContent(t.rootElem)}}),l}shouldShowMeleeCritCap(e){return e.getPlayerSpec().isMeleeDpsSpec}meleeCritCapDisplayString(e,t){const a=e.getMeleeCritCap();if(0===a)return"Exact";return`${a>0?"Over by ":"Under by "} ${Math.abs(a).toFixed(2)}%`}}const vn=({children:e,buttonClassName:a,linkRef:i,...s})=>"href"in s&&s.href?t("a",{ref:i,href:s.href,target:"_blank",className:u(a)},e):t("button",{type:"button",ref:i,className:u(a)},e),kn=({ref:e,linkRef:a,iconRef:i,icon:s,className:o,children:n,...l})=>t("div",{ref:e,className:"sim-toolbar-item"},t(vn,{linkRef:a,className:u(o),...l},s&&t("i",{ref:i,className:s}),n)),En=t("ul",{className:"text-start ps-3 mb-0"});class Pn extends e{constructor(e){super(e,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const i=a(),s=a(),o=a(),n=a();this.rootElem.appendChild(t(r,null,t("div",{ref:i,className:"results-pending"},t("div",{className:"loader"})),t("div",{ref:s,className:"results-content"}),t("div",{ref:n,className:"button-zone text-center"}),t("div",{ref:o,className:"warning-zone text-center"}))),this.pendingElem=i.value,this.contentElem=s.value,this.warningElem=o.value,this.buttonElem=n.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink({parent:e,tooltip:i,classes:s,text:o,...n}){const l=a();return e.appendChild(t(kn,{linkRef:l,buttonClassName:s,...n},o)),i&&(this.warningsTooltip=mn(l.value,{appendTo:"parent",content:i,placement:"bottom",inlinePositioning:!0,plugins:[hn]})),l.value}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:En,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),a=this.warningsTooltip?.props.content?.cloneNode(!0)||t(r,null);a&&(a.innerHTML=""),a.appendChild(t(r,null,e?.map((e=>t("li",null,e))))),this.warningsLink.parentElement?.classList?.[e.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(a)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none",this.buttonElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:this.contentElem.replaceChildren(e),this.contentElem.style.display="block",this.pendingElem.style.display="none"}addAbortButton(e){this.buttonElem.replaceChildren(t("button",{className:"sim-abort-button",onclick:e},t("i",{className:"fa fa-times fa-lg me-1"}),"Stop")),this.buttonElem.style.display="block"}removeAbortButton(){this.buttonElem.replaceChildren(),this.buttonElem.style.display="none"}}class Cn extends e{constructor(e,t,a){super(e,"sim-tab"),this.rootElem.classList.add(a.identifier),this.simUI=t,this.config=a,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<button\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</button>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){const a=document.createElement("div");return a.classList.add("tab-panel-col",`${t}-${e}`),a}}class Nn{constructor(e){const{title:t,variant:a,autoShow:i=!0,canClose:s=!0,body:o,additionalClasses:n,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=n,this.title=t||"WowSims",this.variant=a||"info",this.body=o,this.canClose=s,this.element=this.template(),this.container.appendChild(this.element),this.instance=pn.getOrCreateInstance(this.element,{delay:3e3,...r}),i&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return t("div",{className:u("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},t("div",{className:"toast-header"},t("i",{className:u("d-block fas fa-2xl me-2",this.getVariantIcon())}),t("strong",{className:"me-auto"},this.title),this.canClose&&t("button",{className:"btn-close",attributes:{"aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},t("i",{className:u("fas fa-times fa-1xl",this.getVariantIcon())}))),t("div",{className:"toast-body"},this.body))}}class _n extends e{constructor(e,t,a){super(e,"content-block",a.rootElem),this.config=a,this.rootElem.classList.add(t),a.extraCssClasses&&this.rootElem.classList.add(...a.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),a.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const e=this.config.header.titleTag||"h6",i=a(),s=t("div",{className:"content-block-header"},t(e,{ref:i,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&s.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&mn(i.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(s),s}return null}buildBody(){const e=t("div",{className:"content-block-body"});return this.rootElem.appendChild(e),e}}const Tn=()=>t("p",{className:"mb-0"},"Want to help out by providing additional information? Contact us on our Discord!"),Rn=t("p",{className:"mb-0"},"Please select a random suffix"),Dn=t(r,null,t("p",null,"This item ",t("span",{className:"fw-bold"},"is")," implemented, but detailed proc behavior will be confirmed on PTR."),t(Tn,null)),Gn=t(r,null,"The equip/use effect on this item will not be implemented!"),On=new Map([...[68983,69149,77981,77209,78001,77976,77199,77996,78485,77196,78476].map((e=>[e,{[w.SpecUnknown]:Gn}])),...[78481,77188,78472,78484,77195,78475,72900,72898,72897,72901,72899].map((e=>[e,{[w.SpecUnknown]:Dn}]))]),Un=new Map([[2,"Not yet implemented"],[4,"Not yet implemented"]]),An=new Map([[928,null],[933,null],[935,null],[938,null],[1004,null],[1009,null],[1011,null],[1014,null],[1056,null],[1060,null],[1066,null],[1069,new Map([[2,"Not implemented"]])]]);let Ln=null;async function Fn(e){return(await(null==Ln&&(Ln=fetch("/cata/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(const a in e)t[parseInt(a)]=e[a];return t}))),Ln))[e.effectId]||e.name}function Mn(e){return e.effectId+"-"+e.type}class Vn extends e{constructor(e,t){super(null,"item-notice"),this.tooltip=null,this.rootElem.classList.add("d-inline"),this.itemId=t.itemId,this.player=e,this.additionalNoticeData=t.additionalNoticeData,this.hasNotice&&this.template&&this.rootElem.appendChild(this.template),this.addOnDisposeCallback((()=>{this.tooltip?.destroy(),this.rootElem?.remove()}))}get hasNotice(){return On.has(this.itemId)||!!this.additionalNoticeData}get noticeContent(){if(!this.hasNotice)return null;const e=On.get(this.itemId),a=e?.[w.SpecUnknown],i=e?.[this.player.getSpec()],s=[];return i?s.push(i?.cloneNode(!0)):a&&s.push(a?.cloneNode(!0)),this.additionalNoticeData&&s.push(this.additionalNoticeData.cloneNode(!0)),s.length?t(r,null,s.map((e=>e))):null}get template(){if(!this.hasNotice)return null;const e=this.noticeContent;if(!e)return null;const i=a(),s=t("button",{ref:i,className:"warning fa fa-exclamation-triangle fa-xl me-2"});return this.tooltip=mn(i.value,{content:e}),s}static registerSetBonusNotices(e){An.forEach(((a,i)=>{const s=a||Un,o=t(r,null,t("p",{className:"mb-1"}," This item set has the following warnings:"),t("ul",{className:"mb-0"},Array.from(s.keys()).map((e=>t("li",null,e.toFixed(0),"-piece: ",s.get(e))))));for(const t of e.getItemIdsForSet(i))On.set(t,{[w.SpecUnknown]:o})}))}}class Wn{constructor(e){this.tooltip=null,this.config=e,this.item=e.item,this.attachTooltip()}attachTooltip(){const e={trigger:"mouseenter",triggerTarget:this.config.tippyElement,interactive:!0,interactiveBorder:10,offset:[0,5],animation:!1,placement:"bottom",theme:"tooltip-quick-swap",content:()=>this.buildList(),onCreate:e=>{e.popper.addEventListener("click",(()=>e.hide()))},onShow:e=>{un({exclude:e})},...this.config.tippyConfig};this.tooltip=mn(this.config.tippyElement,e)}update(e){this.config={...this.config,...e},e.item&&(this.item=e.item),this.tooltip?.setContent(this.buildList())}buildList(){return Bn(this.config)}}const Bn=e=>{const i=e.getItems(e.item);return t(r,null,t("h3",{className:"tooltip-quick-swap__title h6 text-center"},e.title),i.length?t("ul",{className:"tooltip-quick-swap__list"},i.map((i=>{const s=a(),o=a(),n=a(),l=t("li",{className:"tooltip-quick-swap__list-item"},t("a",{ref:s,href:"javascript:void(0)",className:"tooltip-quick-swap__anchor d-flex align-items-center "+(i.active?" active":""),onclick:t=>{t?.preventDefault(),e.onItemClick(i.item)}},t("img",{ref:o,alt:i.item.name,className:"tooltip-quick-swap__icon gem-icon flex-shrink-0"}),t("span",{ref:n,className:"tooltip-quick-swap__label text-start"},i.item.name)));return n.value&&bn(n.value,i.item.quality),("spellId"in i.item?h.fromSpellId(i.item.spellId):h.fromItemId(i.item.id)).fill().then((e=>{e.setWowheadHref(s.value),o.value.src=e.iconUrl})),l}))):t("p",{className:"tooltip-quick-swap__empty"},e.emptyMessage),e.footerButton&&t("div",{className:"tooltip-quick-swap__footer d-flex justify-content-center"},t("button",{onclick:e.footerButton.onClick,className:"btn btn-sm btn-primary"},e.footerButton.label)))},zn={[y.ItemSlotHead]:"/cata/assets/item_slots/head.jpg",[y.ItemSlotNeck]:"/cata/assets/item_slots/neck.jpg",[y.ItemSlotShoulder]:"/cata/assets/item_slots/shoulders.jpg",[y.ItemSlotBack]:"/cata/assets/item_slots/shirt.jpg",[y.ItemSlotChest]:"/cata/assets/item_slots/chest.jpg",[y.ItemSlotWrist]:"/cata/assets/item_slots/wrists.jpg",[y.ItemSlotHands]:"/cata/assets/item_slots/hands.jpg",[y.ItemSlotWaist]:"/cata/assets/item_slots/waist.jpg",[y.ItemSlotLegs]:"/cata/assets/item_slots/legs.jpg",[y.ItemSlotFeet]:"/cata/assets/item_slots/feet.jpg",[y.ItemSlotFinger1]:"/cata/assets/item_slots/finger.jpg",[y.ItemSlotFinger2]:"/cata/assets/item_slots/finger.jpg",[y.ItemSlotTrinket1]:"/cata/assets/item_slots/trinket.jpg",[y.ItemSlotTrinket2]:"/cata/assets/item_slots/trinket.jpg",[y.ItemSlotMainHand]:"/cata/assets/item_slots/mainhand.jpg",[y.ItemSlotOffHand]:"/cata/assets/item_slots/offhand.jpg",[y.ItemSlotRanged]:"/cata/assets/item_slots/ranged.jpg"};function jn(e){return zn[e]}const Hn=()=>t("span",{className:"heroic-label"},"[H]"),qn=(e,i,s)=>{const o=a(),n=a(),l=t("a",{ref:n,className:"gem-socket-container",href:"javascript:void(0)",dataset:{socketIdx:s}},t("img",{ref:o,className:"gem-icon "+(i?"":"hide")}),t("img",{className:"socket-icon",src:I(e)}));return i&&h.fromItemId(i.id).fill().then((e=>{e.setWowheadHref(n.value),o.value.src=e.iconUrl})),l};class Kn extends e{constructor(e,t,a){super(e,"gear-picker-root");const i=document.createElement("div");i.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(i);const s=document.createElement("div");s.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(s);const o=[y.ItemSlotHead,y.ItemSlotNeck,y.ItemSlotShoulder,y.ItemSlotBack,y.ItemSlotChest,y.ItemSlotWrist,y.ItemSlotMainHand,y.ItemSlotOffHand,y.ItemSlotRanged].map((e=>new Yn(i,this,t,a,e))),n=[y.ItemSlotHands,y.ItemSlotWaist,y.ItemSlotLegs,y.ItemSlotFeet,y.ItemSlotFinger1,y.ItemSlotFinger2,y.ItemSlotTrinket1,y.ItemSlotTrinket2].map((e=>new Yn(s,this,t,a,e)));this.itemPickers=o.concat(n).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new Kf(t.rootElem,t,a,this,{id:"gear-picker-selector-modal"})}}class $n extends e{constructor(e,i,s){super(e,"item-picker-root",i),this.notice=null,this.socketsElem=[],this.player=s;const o=a(),n=a(),l=a(),c=a(),d=a(),m=a(),h=a();this.rootElem.appendChild(t(r,null,t("div",{className:"item-picker-icon-wrapper"},t("span",{className:"item-picker-ilvl",ref:c}),t("a",{ref:o,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),t("div",{ref:h,className:"item-picker-sockets-container"})),t("div",{className:"item-picker-labels-container"},t("div",{ref:n,className:"item-picker-name-row d-flex gap-1"},t("a",{ref:l,className:"item-picker-name-container",href:"javascript:void(0)",attributes:{role:"button"}})),t("a",{ref:d,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),t("a",{ref:m,className:"item-picker-reforge hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=o.value,this.nameContainerElem=n.value,this.nameElem=l.value,this.ilvlElem=c.value,this.reforgeElem=m.value,this.enchantElem=d.value,this.socketsContainerElem=h.value}clear(e){this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.notice?.dispose(),this.notice=null,this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.reforgeElem.classList.add("hide"),this.iconElem.style.backgroundImage=`url('${jn(e)}')`,this.enchantElem.replaceChildren(),this.reforgeElem.replaceChildren(),this.socketsContainerElem.replaceChildren(),this.nameElem.replaceChildren(),this.ilvlElem.replaceChildren(),this.socketsElem=[]}update(e){const a=t("span",{className:"item-picker-name"},e.item.name),i=!!e.hasRandomSuffixOptions(),s=!!e.randomSuffix;this.nameElem.replaceChildren(a),this.ilvlElem.textContent=e.item.ilvl.toString(),s&&(a.textContent+=" "+e.randomSuffix.name),e.item.heroic&&this.nameElem.appendChild(Hn()),this.notice=new Vn(this.player,{itemId:e.item.id,additionalNoticeData:i&&!s?Rn:void 0}),this.notice.hasNotice&&this.nameContainerElem.appendChild(this.notice.rootElem);const o=e.getReforgeData();if(o){const e=b.get(o.reforge?.fromStat),t=b.get(o.reforge?.toStat);this.reforgeElem.innerText=`Reforged ${Math.abs(o.fromAmount)} ${e} → ${o.toAmount} ${t}`,this.reforgeElem.classList.remove("hide")}else this.reforgeElem.innerText="",this.reforgeElem.classList.add("hide");bn(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant?(Fn(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=h.makeSpellUrl(e.enchant.spellId),h.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=h.makeItemUrl(e.enchant.itemId),h.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide"),e.allSocketColors().forEach(((t,a)=>{const i=qn(t,e.gems[a],a);if(a===e.numPossibleSockets-1&&[x.ItemTypeWrist,x.ItemTypeHands].includes(e.item.type)){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}this.socketsElem.push(i),this.socketsContainerElem.appendChild(i)}))}}class Yn extends e{constructor(e,t,a,i,s){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.quickSwapEnchantPopover=null,this.quickSwapGemPopover=[],this.gearPicker=t,this.simUI=a,this.player=i,this.slot=s,this.itemElem=new $n(e,this.rootElem,i),this.item=i.getEquippedItem(s),i.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(qf.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.reforgeElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(qf.Reforging)})),this.addQuickEnchantHelpers()})),i.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot),this._equippedItem&&(this._equippedItem!==this.quickSwapEnchantPopover?.item&&this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.addQuickGemHelpers())})),i.sim.filtersChangeEmitter.on((()=>{this._equippedItem&&(this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.quickSwapGemPopover.forEach((e=>e.update({item:this._equippedItem}))))})),i.sim.showQuickSwapChangeEmitter.on((()=>{this.quickSwapEnchantPopover?.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"](),this.quickSwapGemPopover.forEach((e=>e.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"]()))})),i.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(this.slot),this.quickSwapGemPopover=[],this.itemElem.nameElem.textContent=S.get(this.slot)??"",bn(this.itemElem.nameElem,null),e&&this.itemElem.update(e),this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}addQuickGemHelpers(){if(!this._equippedItem)return;const e=e=>this.openSelectorModal(`Gem${e+1}`);this.itemElem.socketsElem?.forEach((t=>{const a=Number(t.dataset.socketIdx)||0;t.addEventListener("click",(t=>{t.preventDefault(),e(0)}));const i=((e,t,a,i,s,o)=>new Wn({title:"Favorite gems",emptyMessage:"Add favorite gems.",tippyElement:t,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:a,getItems:t=>{const a=e.sim.getFilters().favoriteGems,i=t.curSocketColors(e.isBlacksmithing())[s];return e.getGems(i).filter((e=>a.includes(e.id))).sort(((e,t)=>e.color>t.color?1:-1)).map((e=>({item:e,active:t.gems[s]?.id===e.id})))},onItemClick:t=>{e.equipItem(n.nextEventID(),i,a.withGem(t,s))},footerButton:{label:"Open Gems",onClick:o}}))(this.player,t,this._equippedItem,this.slot,a,(()=>e(a)));this.player.sim.getShowQuickSwap()||i.tooltip?.disable(),this.quickSwapGemPopover.push(i)}))}addQuickEnchantHelpers(){if(!this._equippedItem)return;const e=()=>this.openSelectorModal(qf.Enchants);var t,a,i,s,o;this.itemElem.enchantElem.addEventListener("click",(t=>{t?.preventDefault(),e()})),this.quickSwapEnchantPopover=(t=this.player,a=this.itemElem.enchantElem,i=this._equippedItem,s=this.slot,o=e,new Wn({title:"Favorite Enchants",emptyMessage:"Add favorite Enchants",tippyElement:a,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:i,getItems:e=>{const a=t.sim.db.getEnchants(s),i=t.sim.getFilters().favoriteEnchants,o=i?.map((e=>{const[t,i]=e.split("-").map(Number);return a.find((e=>e.effectId===t&&e.type===i))})).filter((e=>!!e));return o.map((t=>({item:t,active:e.enchant?.effectId===t.effectId})))},onItemClick:e=>{t.equipItem(n.nextEventID(),s,i.withEnchant(e))},footerButton:{label:"Open Enchants",onClick:o}})),this.player.sim.getShowQuickSwap()||this.quickSwapEnchantPopover.tooltip?.disable()}}class Jn extends e{constructor(e,t,a,i,s,o){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=a,this.bulkSlot=s,this.index=o,this.item=i,this.itemElem=new $n(e,this.rootElem,t.player),this.abortController=new AbortController,this.signal=this.abortController.signal,this.isEditable()||(this.rootElem.classList.add("bulk-item-picker-equipped"),e.insertAdjacentElement("afterbegin",this.rootElem)),this.addActions(),this.simUI.sim.waitForInit().then((()=>this.setItem(i))),this.addOnDisposeCallback((()=>this.rootElem.remove()))}setItem(e){this.itemElem.clear(y.ItemSlotHead),this.itemElem.update(e),this.item=e,this.setupHandlers()}isEditable(){return this.index>=0}setupHandlers(){const e=v(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),a=this.item?.item?this.simUI.player.getAvailableReforgings(this.item.getWithRandomSuffixStats()):[],i=t=>{t.preventDefault(),this.isEditable()&&this.bulkUI.selectorModal.openTab(e,qf.Items,this.createGearData())},s=(t,a)=>{if(t.preventDefault(),!this.isEditable())return;let i=qf.Gem1;1===a&&(i=qf.Gem2),2===a&&(i=qf.Gem3),this.bulkUI.selectorModal.openTab(e,i,this.createGearData())};this.itemElem.iconElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.nameElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.enchantElem.addEventListener("click",(a=>{a.preventDefault(),this.isEditable()&&t.length&&this.bulkUI.selectorModal.openTab(e,qf.Enchants,this.createGearData())}),{signal:this.signal}),this.itemElem.reforgeElem.addEventListener("click",(t=>{t.preventDefault(),this.isEditable()&&a.length&&this.bulkUI.selectorModal.openTab(e,qf.Reforging,this.createGearData())}),{signal:this.signal}),this.itemElem.socketsElem.forEach(((e,t)=>{e.addEventListener("click",(e=>s(e,t)))}),{signal:this.signal})}createGearData(){const e=new n;return{equipItem:(t,a)=>{a&&(this.bulkUI.updateItem(this.index,a.asSpec()),e.emit(n.nextEventID()))},getEquippedItem:()=>this.item,changeEvent:e}}addActions(){const e=a(),i=a();this.itemElem.rootElem.appendChild(t("div",{className:"item-picker-actions-container"},t("button",{className:"btn btn-link item-picker-actions-btn",ref:e},t("i",{className:"fas fa-copy"})),this.isEditable()&&t("button",{className:"btn btn-link link-danger item-picker-actions-btn",ref:i},t("i",{className:"fas fa-times"}))));const s=e.value;mn(s,{content:"Make an editable copy of this item."});const o=()=>this.bulkUI.addItemToSlot(this.item.asSpec(),this.bulkSlot);if(s.addEventListener("click",o),this.addOnDisposeCallback((()=>s.removeEventListener("click",o))),i.value){const e=i.value;mn(e,{content:"Remove this item from the batch."});const t=()=>this.bulkUI.removeItemByIndex(this.index);e.addEventListener("click",t),this.addOnDisposeCallback((()=>e.removeEventListener("click",t)))}}}var Zn=(e=>(e[e.ItemSlotHead=0]="ItemSlotHead",e[e.ItemSlotNeck=1]="ItemSlotNeck",e[e.ItemSlotShoulder=2]="ItemSlotShoulder",e[e.ItemSlotBack=3]="ItemSlotBack",e[e.ItemSlotChest=4]="ItemSlotChest",e[e.ItemSlotWrist=5]="ItemSlotWrist",e[e.ItemSlotHands=6]="ItemSlotHands",e[e.ItemSlotWaist=7]="ItemSlotWaist",e[e.ItemSlotLegs=8]="ItemSlotLegs",e[e.ItemSlotFeet=9]="ItemSlotFeet",e[e.ItemSlotFinger=10]="ItemSlotFinger",e[e.ItemSlotTrinket=11]="ItemSlotTrinket",e[e.ItemSlotMainHand=12]="ItemSlotMainHand",e[e.ItemSlotOffHand=13]="ItemSlotOffHand",e[e.ItemSlotHandWeapon=14]="ItemSlotHandWeapon",e[e.ItemSlotRanged=15]="ItemSlotRanged",e))(Zn||{});const Qn=new Map([[0,"Head"],[1,"Neck"],[2,"Shoulders"],[3,"Back"],[4,"Chest"],[5,"Wrist"],[6,"Hands"],[7,"Waist"],[8,"Legs"],[9,"Feet"],[10,"Rings"],[11,"Trinkets"],[12,"Main Hand"],[13,"Off Hand"],[14,"Weapons"],[15,"Ranged"]]),Xn=new Map([[y.ItemSlotHead,0],[y.ItemSlotNeck,1],[y.ItemSlotShoulder,2],[y.ItemSlotBack,3],[y.ItemSlotChest,4],[y.ItemSlotWrist,5],[y.ItemSlotHands,6],[y.ItemSlotWaist,7],[y.ItemSlotLegs,8],[y.ItemSlotFeet,9],[y.ItemSlotFinger1,10],[y.ItemSlotFinger2,10],[y.ItemSlotTrinket1,11],[y.ItemSlotTrinket2,11],[y.ItemSlotMainHand,12],[y.ItemSlotOffHand,13],[y.ItemSlotRanged,15]]),el=(e,t)=>t&&[y.ItemSlotMainHand,y.ItemSlotOffHand].includes(e)?14:Xn.get(e);class tl extends _n{constructor(e,t,a,i){const s=Qn.get(i);super(e,"bulk-item-picker-group-root",{header:{title:s}}),this.pickers=new Map,this.rootElem.classList.add(`gear-group-${s.split(" ").join("-")}`),this.simUI=t,this.bulkUI=a,this.bulkSlot=i,this.addEmptyElement()}has(e){return!!this.pickers.get(e)}add(e,t){if(this.pickers.size||this.bodyElement.replaceChildren(),this.pickers.has(e)){this.pickers.get(e).dispose(),this.pickers.delete(e)}this.pickers.set(e,new Jn(this.bodyElement,this.simUI,this.bulkUI,t,this.bulkSlot,e))}update(e,t){const a=this.pickers.get(e);a?a.setItem(t):new Nn({variant:"error",body:"Failed to update item, please report this issue."})}remove(e){const t=this.pickers.get(e);t?(t.dispose(),this.pickers.delete(e),this.pickers.size||this.addEmptyElement()):new Nn({variant:"error",body:"Failed to remove item, please report this issue."})}addEmptyElement(){this.bodyElement.appendChild(t("span",null,"No items selected."))}}class al extends _n{constructor(e,i,s){super(e,"bulk-item-search-root",{header:{title:"Item Search"}}),this.filtersChangeEmitter=new n,this.allItems=[],this._searchString="",this.minIlvl=0,this.maxIlvl=0,this.simUI=i,this.bulkUI=s,this.abortController=new AbortController,this.signal=this.abortController.signal;const o=a(),l=a(),r=a(),c=a(),d=a();this.bodyElement.appendChild(t("div",{className:"bulk-gear-search-container",ref:o},t("div",{className:"d-flex flex-column"},t("label",{className:"form-label",htmlFor:"bulkGearSearch"},"Name"),t("div",{className:"input-group"},t("input",{id:"bulkGearSearch",className:"form-control",type:"text",placeholder:"Search...",ref:l}),t("button",{className:"btn btn-link cancel-bulk-gear-search-btn hide",ref:r,type:"button"},t("i",{className:"fas fa-times"}))),t("ul",{ref:c,className:"bulk-gear-search-results dropdown-menu no-hover"})),t("div",{className:"bulk-gear-search-ilvl-filters",ref:d}))),this.inputElem=l.value,this.cancelSearchElem=r.value,this.searchResultElem=c.value,mn(this.cancelSearchElem,{content:"Clear search"}),this.cancelSearchElem.addEventListener("click",(()=>{this.searchString=""})),new xn(d.value,this,{id:"bulkGearSearchMinIlvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.minIlvl,setValue:(e,t,a)=>{this.minIlvl=a,this.filtersChangeEmitter.emit(e)}}),d.value.appendChild(t("span",{className:"ilvl-filters-separator"},"-")),new xn(d.value,this,{id:"bulkGearSearchMaxIlvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.maxIlvl,setValue:(e,t,a)=>{this.maxIlvl=a,this.filtersChangeEmitter.emit(e)}}),this.simUI.sim.waitForInit().then((()=>{this.allItems=this.simUI.sim.db.getAllItems().filter((e=>k(e,this.simUI.player.getPlayerSpec(),void 0))).sort(((e,t)=>e.ilvl<t.ilvl?1:t.ilvl<e.ilvl?-1:0)),this.filtersChangeEmitter.on((()=>{this.performSearch()})),l.value.addEventListener("input",(()=>{this.searchString=l.value.value}))}))}get searchString(){return this._searchString}set searchString(e){this._searchString=e,this.inputElem.value=e,this.filtersChangeEmitter.emit(n.nextEventID())}performSearch(){if(!this.searchString.length)return this.cancelSearchElem.classList.add("hide"),void this.searchResultElem.classList.remove("show");const e=this.searchString.split(" "),i=t(r,null);let s=0;this.allItems.forEach((o=>{if(0!=this.maxIlvl&&this.maxIlvl<o.ilvl)return!1;if(0!=this.minIlvl&&this.minIlvl>o.ilvl)return!1;let n=!0;const l=o.name.toLowerCase(),c=o.setName.toLowerCase();if(e.forEach((e=>{const t=e.toLowerCase();return!(!l.includes(t)&&!c.includes(t))||(n=!1,!1)})),n&&s++,n&&s<=21){const e=a(),s=a(),n=a();i.appendChild(t("li",null,t("a",{className:"dropdown-item bulk-item-search-item",dataset:{itemId:o.id.toString()},ref:e,target:"_blank"},t("div",{className:"bulk-item-search-item-icon-wrapper"},t("span",{className:"item-picker-ilvl"},o.ilvl),t("div",{className:"bulk-item-search-item-icon",ref:s})),t("div",{className:"d-flex flex-column ps-2"},t("div",{className:"d-flex"},t("span",{ref:n},o.name),o.heroic&&Hn(),o.factionRestriction===E.HORDE_ONLY&&t("span",{className:"faction-horde"},"(H)"),o.factionRestriction===E.ALLIANCE_ONLY&&t("span",{className:"faction-alliance"},"(A)")),t("small",null,Qn.get(Xn.get(v(o)[0]))))))),h.fromItem(o).fill().then((t=>{t.setBackground(s.value),t.setWowheadHref(e.value)})),bn(n.value,o.quality),e.value.addEventListener("click",(e=>{e.preventDefault(),this.bulkUI.addItem(P.create({id:o.id})),new Nn({delay:1e3,variant:"success",body:t(r,null,t("strong",null,o.name)," was added to the batch.")})}),{signal:this.signal})}})),this.searchResultElem.replaceChildren(t(r,null,i,s>21&&t("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"Showing ",21," of ",s," total results."),0===s&&t("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"No results found."))),this.searchResultElem.classList.add("show"),this.cancelSearchElem.classList.remove("hide")}}class il extends e{constructor(e,i,s,o,l){super(e,"bulk-sim-result-root"),this.simUI=i,s.simTalents||this.rootElem.classList.add("bulk-sim-result-no-talents");const c=o.unitMetrics.dps.avg-l.unitMetrics.dps.avg,d=a(),m=a(),h=a();if(this.rootElem.appendChild(t(r,null,t("div",{className:"results-sim"},t("div",{className:"results-sim-dps damage-metrics"},t("span",{className:"topline-result-avg"},this.formatDps(o.unitMetrics.dps.avg)),t("div",{className:"results-reference"},t("span",{ref:m,className:u("results-reference-diff",c>=0?"positive":"negative")})))),t("div",{ref:h,className:"bulk-gear-combo"}),s.simTalents&&t("div",{className:"bulk-talent-loadout"},t("span",null,o.talentLoadout&&"object"==typeof o.talentLoadout?`Talents: ${o.talentLoadout.name}`:"Current Talents")),t("div",{className:"bulk-results-actions"},t("button",{ref:d,className:u("btn btn-primary bulk-equip-btn",!o.itemsAdded?.length&&"d-none")},"Equip")))),C(m.value,l.unitMetrics.dps.avg,o.unitMetrics.dps.avg,2,void 0,void 0,!0),o.itemsAdded?.length){d.value?.addEventListener("click",(()=>{o.itemsAdded.forEach((e=>{if(e.item){const t=i.sim.db.lookupItemSpec(e.item);i.player.equipItem(n.nextEventID(),e.slot,t),i.simHeader.activateTab("gear-tab")}})),new Nn({variant:"success",body:"Batch gear equipped!"})}));const e=t(r,null);for(const a of o.itemsAdded){const s=t("div",{className:"bulk-result-item"}),o=new $n(e,s,i.player);if(a.item&&0!=a.item.id){const e=i.sim.db.lookupItemSpec(a.item);o.update(e)}else o.clear(a.slot);e.appendChild(s)}h.value.appendChild(e)}else o.talentLoadout&&"object"==typeof o.talentLoadout||(m.value?.classList.add("hide"),h.value.appendChild(t("p",{className:"mb-0"},"Current Gear")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}}class sl extends yn{constructor(e,i,s,o,n){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.simUI=i,this.onSelect=o,this.onRemove=n,this.socketColor=s,this.ilist=null,window.scrollTo({top:0}),this.header.insertAdjacentElement("afterbegin",t("h6",{className:"selector-modal-title mb-3"},"Choose Default Gem"));const l=a();this.body.appendChild(t("div",{ref:l,className:"tab-content selector-modal-tab-content"})),this.contentElem=l.value}show(){if(!this.ilist){this.ilist=new Hf("bulk-tab-gem-selector",this.contentElem,this.simUI,y.ItemSlotHead,qf.Gem1,this.simUI.player,qf.Gem1,{equipItem:(e,t)=>{},getEquippedItem:()=>null,changeEvent:new n},this.simUI.player.getGems(this.socketColor).map((e=>({item:e,id:e.id,actionId:h.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,heroic:!1,baseEP:this.simUI.player.computeStatsEP(new d(e.stats)),ignoreEPFilter:!0,onEquip:N}))),this.socketColor,(e=>this.simUI.player.computeGemEP(e)),(()=>null),this.onRemove,this.onSelect),this.ilist.sizeRefresh();const e=()=>this.ilist?.applyFilters(),t=this.simUI.sim.phaseChangeEmitter.on(e),a=this.simUI.sim.filtersChangeEmitter.on(e);this.addOnDisposeCallback((()=>{t.dispose(),a.dispose(),this.ilist?.dispose()}))}this.open()}}var ol=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(ol||{});const nl=(()=>{const e=new Map;return e.set(0,"g"),e.set(1,"t"),e.set(2,"r"),e.set(3,"c"),e.set(4,"m"),e.set(5,"x"),e.set(6,"e"),e.set(7,"u"),e})();class ll extends yn{constructor(e,i){super(e,"importer",{title:i.title,footer:!0,disposeOnClose:!1}),this.allowFileUpload=i.allowFileUpload||!1;const s="upload-input-"+i.title.toLowerCase().replaceAll(" ","-"),o=a(),n=a(),l=a(),c=a();this.body.replaceChildren(t(r,null,t("div",{ref:o,className:"import-description"}),t("textarea",{ref:n,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(t(r,null,this.allowFileUpload&&t(r,null,t("label",{htmlFor:s,className:"importer-button btn btn-primary upload-button me-2"},t("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),t("input",{ref:c,type:"file",id:s,className:"importer-upload-input d-none",hidden:!0})),t("button",{ref:l,className:"importer-button btn btn-primary import-button"},t("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=o.value,this.textElem=n.value,this.allowFileUpload&&c.value&&c.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=l.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new Nn({variant:"error",body:`Import error: ${t?.message||t}`})}}))}}const rl=class extends ll{constructor(e,t,a){super(e,a),this.simUI=t}async finishIndividualImport(e,t,a,i,s,o,l){if(t!=e.player.getClass())throw new Error(`Wrong Class! Expected ${e.player.getPlayerClass().friendlyName} but found ${T.get(t)}!`);await R.loadLeftoversIfNecessary(i);const r=e.sim.db.lookupEquipmentSpec(i),c=i.items.map((e=>e.enchant)),d=r.asSpec().items.map((e=>e.enchant)),m=c.filter((e=>0!=e&&!d.includes(e))),h=i.items.map((e=>e.id)),p=r.asSpec().items.map((e=>e.id)),u=h.filter((e=>!p.includes(e))),g=n.nextEventID();n.freezeAllAndDo((()=>{e.player.setRace(g,a),e.player.setGear(g,r),s&&"--"!=s&&e.player.setTalentsString(g,s),o&&e.player.setGlyphs(g,o),l.length>0&&e.player.setProfessions(g,l)})),this.close(),0==u.length&&0==m.length?new Nn({variant:"success",body:"Import successful!"}):new Nn({variant:"info",body:"Import successful, but the following IDs were not found in the sim database:"+(0==u.length?"":"\n\nItems: "+u.join(", "))+(0==m.length?"":"\n\nEnchants: "+m.join(", "))})}};rl.DEFAULT_CATEGORIES=_(ol).filter((e=>e!=ol.UISettings)),rl.CATEGORY_PARAM="i";let cl=rl;class dl extends cl{constructor(e,a,i){super(e,a,{title:"Bag Item Import",allowFileUpload:!0}),this.bulkUI=i,this.descriptionElem.appendChild(t(r,null,t("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),t("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=D.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await R.loadLeftoversIfNecessary(t),a=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));a.length>0&&this.bulkUI.addItems(a)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}class ml extends e{constructor(e,i){const s=a();super(e,"copy-button",t("button",{className:`btn ${i.extraCssClasses?.join(" ")??""}`,ref:s},t("i",{className:"fas fa-copy me-1"}),i.text??"Copy to Clipboard")),this.config=i;const o=s.value;let n=!1;o.addEventListener("click",(()=>{if(n)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{n=!0,navigator.clipboard.writeText(e);const t=o.innerHTML;o.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{o.innerHTML=t,n=!1}),1500)}})),i.tooltip&&mn(o,{content:i.tooltip})}}const hl={id:0,name:"Empty",description:"",iconUrl:"https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg",quality:null,spellId:0};class pl extends e{constructor(e,t,a){super(e,"glyphs-picker-root"),this.primeGlyphPickers=[],this.majorGlyphPickers=[],this.minorGlyphPickers=[],this.glyphsConfig=a,this.player=t;const i=Object.keys(a.primeGlyphs).map((e=>Number(e))),s=Object.keys(a.majorGlyphs).map((e=>Number(e))),o=Object.keys(a.minorGlyphs).map((e=>Number(e))),n=new _n(this.rootElem,"prime-glyphs",{header:{title:"Prime Glyphs",extraCssClasses:["border-0"]}}),l=new _n(this.rootElem,"major-glyphs",{header:{title:"Major Glyphs",extraCssClasses:["border-0"]}}),r=new _n(this.rootElem,"minor-glyphs",{header:{title:"Minor Glyphs",extraCssClasses:["border-0"]}});this.selectorModal=new gl(this.rootElem.closest(".individual-sim-ui")),R.get().then((e=>{const a=i.map((t=>this.getGlyphData(t,e))),c=s.map((t=>this.getGlyphData(t,e))),d=o.map((t=>this.getGlyphData(t,e)));a.sort(((e,t)=>G(e.name,t.name))),c.sort(((e,t)=>G(e.name,t.name))),d.sort(((e,t)=>G(e.name,t.name))),this.primeGlyphPickers=["prime1","prime2","prime3"].map((e=>new ul(n.bodyElement,{label:"Prime",player:t,selectorModal:this.selectorModal,glyphOptions:a,glyphField:e}))),this.majorGlyphPickers=["major1","major2","major3"].map((e=>new ul(l.bodyElement,{label:"Major",player:t,selectorModal:this.selectorModal,glyphOptions:c,glyphField:e}))),this.minorGlyphPickers=["minor1","minor2","minor3"].map((e=>new ul(r.bodyElement,{label:"Minor",player:t,selectorModal:this.selectorModal,glyphOptions:d,glyphField:e})))}))}getGlyphData(e,t){const a=this.glyphsConfig.primeGlyphs[e]||this.glyphsConfig.majorGlyphs[e]||this.glyphsConfig.minorGlyphs[e];return{id:e,name:a.name,description:a.description,iconUrl:a.iconUrl,quality:i.ItemQualityCommon,spellId:t.glyphItemToSpellId(e)}}}class ul extends s{constructor(e,{player:i,selectorModal:s,glyphOptions:o,glyphField:n}){super(e,"glyph-picker-root",i,{id:`glyph-picker-glyph-${n}`,inline:!0,changedEvent:e=>e.glyphsChangeEmitter,getValue:e=>e.getGlyphs()[n],setValue:(e,t,a)=>{const i=t.getGlyphs();i[n]=a,t.setGlyphs(e,i)}}),this.rootElem.classList.add("item-picker-root"),this.player=i,this.glyphOptions=o,this.selectedGlyph=hl;const l=a(),r=a(),c=a();this.rootElem.appendChild(t("a",{ref:l,attributes:{role:"button"},className:"glyph-link"},t("img",{ref:r,className:"item-picker-icon"}),t("div",{className:"item-picker-labels-container"},t("span",{ref:c,className:"item-picker-name-container"})))),this.anchorElem=l.value,this.iconElem=r.value,this.nameElem=c.value,this.anchorElem.addEventListener("click",(e=>{e.preventDefault(),s.openTab(this,o)}),{signal:this.signal}),this.init()}getInputElem(){return this.iconElem}getInputValue(){return this.selectedGlyph?.id??0}setInputValue(e){this.selectedGlyph=this.glyphOptions.find((t=>t.id==e)),this.selectedGlyph?(this.selectedGlyph.spellId?(this.anchorElem.href=h.makeSpellUrl(this.selectedGlyph.spellId),h.makeSpellTooltipData(this.selectedGlyph.spellId).then((e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"}))):(this.anchorElem.href=h.makeItemUrl(this.selectedGlyph.id),h.makeItemTooltipData(this.selectedGlyph.id).then((e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"}))),this.iconElem.src=this.selectedGlyph.iconUrl,this.nameElem.textContent=this.selectedGlyph.name.replace(/Glyph of /,"")):this.clear()}clear(){this.anchorElem.removeAttribute("data-wowhead"),this.anchorElem.removeAttribute("href"),this.iconElem.src=hl.iconUrl,this.nameElem.textContent=hl.name}}class gl extends yn{constructor(e){super(e,"glyph-modal",{title:"Glyphs",disposeOnClose:!1}),this.listItems=[],this.glyphOptions=[],this.glyphPicker=null;const i=a(),s=a();this.body.appendChild(t(r,null,t("div",{className:"input-root"},t("input",{ref:s,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."})),t("ul",{ref:i,className:"selector-modal-list"}))),this.list=i.value,this.search=s.value,this.search.addEventListener("input",(()=>this.applyFilters()))}openTab(e,t){this.setData(e,t),this.applyFilters(),this.open()}setData(e,i){this.glyphPicker=e,this.list.innerHTML="",this.listItems=[],this.glyphOptions=[hl,...i];const s=this.glyphOptions.map(((e,i)=>{const s=a(),o=a(),l=a(),r=t("li",{className:"selector-modal-list-item",dataset:{idx:String(i)}},t("a",{ref:s,className:"selector-modal-list-item-link"},t("img",{ref:o,className:"selector-modal-list-item-icon"}),t("label",{ref:l,className:"selector-modal-list-item-name"},e.name),t("span",{className:"selector-modal-list-item-description"},e.description)));return s.value&&(e.spellId?s.value.href=h.makeSpellUrl(e.spellId):s.value.href=h.makeItemUrl(e.id),s.value.addEventListener("click",(t=>{t.preventDefault(),this.glyphPicker?.setValue(n.nextEventID(),e.id)}))),o.value&&(o.value.src=e.iconUrl),l.value&&bn(l.value,e.quality),r}));this.listItems=s,this.list.appendChild(t(r,null,this.listItems)),this.glyphPicker.player.glyphsChangeEmitter.on((()=>{this.applyFilters()}))}applyFilters(){if(!this.glyphPicker)return;const e=this.glyphPicker.selectedGlyph?.id??0;this.listItems.forEach((t=>{const a=parseInt(t.dataset.idx),i=this.glyphOptions[a];t.classList[i.id==e?"add":"remove"]("active")})),this.listItems.map((e=>{const t=parseInt(e.dataset.idx),a=this.glyphOptions[t];let i="remove";if(this.search.value.length>0){const e=this.search.value.toLowerCase().split(" "),t=a.name.toLowerCase();e.forEach((e=>{t.includes(e)||"remove"!==i||(i="add")}))}e.classList[i]("d-none")}))}}class fl extends s{constructor(e,i,s){super(e,"talents-picker-root",i,{...s}),this.modObject=i,this.config=s,this.mopTalents=s.playerClass===O.ClassMonk,this.pointsPerRow=this.mopTalents?1:s.pointsPerRow,this.numRows=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1,this.isHunterPet()?this.modObject.player.isSpec(w.SpecBeastMasteryHunter)?this.maxPoints=21:this.maxPoints=17:this.maxPoints=this.mopTalents?6:41;const o=()=>this.maxPoints-i.getTalentTreePoints().reduce(((e,t)=>e+t),0),n=a(),l=a(),r=a(),c=a(),d=a(),m=a();this.rootElem.appendChild(t("div",{className:"talents-picker-inner",ref:n},t("div",{className:"talents-picker-header"},t("div",{className:"d-flex"},t("label",null,"Points Remaining:",t("span",{ref:l},o()))),t("div",{className:"talents-picker-actions",ref:r})),t("div",{id:"talents-carousel",className:"carousel slide"},t("div",{className:"carousel-inner",ref:c}),t("button",{className:"carousel-control-prev",type:"button",ref:d},t("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),t("span",{className:"visually-hidden"},"Previous")),t("button",{className:"carousel-control-next",type:"button",ref:m},t("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),t("span",{className:"visually-hidden"},"Next"))))),n.value;const h=c.value,p=d.value,u=m.value;if(i.talentsChangeEmitter.on((()=>l.value.textContent=`${o()}`)),new ml(r.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>i.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.trees=this.config.trees.map(((e,t)=>{const a=document.createElement("div");return h.appendChild(a),a.classList.add("carousel-item"),1===t&&a.classList.add("active"),new wl(a,e,this,s.playerClass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1))))),!this.isHunterPet()){let e=0;const t=()=>{e>=1||(e+=1,h.style.transform=`translateX(${33.3*e}%)`,h.children[Math.abs(e-2)%3].classList.remove("active"),h.children[Math.abs(e-1)%3].classList.add("active"))},a=()=>{e<=-1||(e-=1,h.style.transform=`translateX(${33.3*e}%)`,h.children[Math.abs(e)%3].classList.remove("active"),h.children[Math.abs(e)+1].classList.add("active"))};p.addEventListener("click",t),u.addEventListener("click",a),this.isPlayer()&&new pl(this.rootElem,this.modObject,jl[this.modObject.getClass()])}this.init(),this.updatePlayerTrees()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,a)=>e.setTalentsString(t[a]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update())),this.updatePlayerTrees()}get numPoints(){return U(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}isPlayer(){return!!this.modObject?.playerClass}isHunterPet(){return!this.isPlayer()}updatePlayerTrees(){if(this.isPlayer()){if(this.mopTalents)return void this.trees[0].rootElem.classList.remove("disabled");const e=this.modObject.getPlayerSpec().specIndex;this.trees[e].numPoints<31?[0,1,2].forEach((t=>{[e].includes(t)?this.trees[t].rootElem.classList.remove("disabled"):(this.trees[t].rootElem.classList.add("disabled"),this.trees[t].resetPoints())})):this.enableSecondaryPlayerTrees()}}enableSecondaryPlayerTrees(){this.trees.forEach((e=>e.rootElem.classList.remove("disabled")))}}class wl extends e{constructor(e,a,i,s,o){super(e,"talent-tree-picker-root"),this.config=a,this.numPoints=0,this.picker=i,this.rootElem.appendChild(t(r,null,t("div",{className:"talent-tree-header"},t("img",{src:this.getTreeIcon(s,o),className:"talent-tree-icon"}),t("span",{className:"talent-tree-title"}),t("label",{className:"talent-tree-points"}),t("button",{className:"talent-tree-reset btn link-danger"},t("i",{className:"fa fa-times"}))),t("div",{className:"talent-tree-background"}),t("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${a.backgroundUrl}')`;const n=this.rootElem.querySelector(".talent-tree-main");n.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,n.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const l="3.5rem";n.style.height=`calc(${l} * ${this.picker.numRows})`,n.style.maxWidth=`calc(${l} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${l} * ${this.picker.numCols+2})`,this.talents=a.talents.map((e=>new Il(n,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const c=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const a of e.config.childLocations){const i=this.getTalent(a);i.parentReq=e.getChildReqArrow(a),c(i,t-2)}};for(const t of this.talents)0!=t.config.childLocations.length&&void 0===t.config.prereqLocation&&c(t,20);const d=this.rootElem.querySelector(".talent-tree-reset");mn(d,{content:"Reset talent points"}),d.addEventListener("click",(e=>this.resetPoints()))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.picker.maxPoints}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,a)=>t.setPoints(Number(e.charAt(a)),!1)))}resetPoints(){this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(n.nextEventID())}getTreeIcon(e,t){if(this.picker.isHunterPet()){return`https://wow.zamimg.com/images/wow/icons/medium/${["ability_druid_swipe.jpg","ability_hunter_pet_bear.jpg","ability_hunter_combatexperience.jpg"][t]}`}return Object.values(A.fromProto(e).specs)[t].getIcon("medium")}}class yl extends e{constructor(e,a,i){super(e,"talent-picker-req-arrow",document.createElement("div")),this.zIdx=0,this.parentLoc=a,this.childLoc=i,this.rootElem.style.gridRow=String(a.rowIdx+1),this.rootElem.style.gridColumn=String(a.colIdx+1);let s=Math.max(a.rowIdx,i.rowIdx)+1,o=Math.max(a.colIdx,i.colIdx)+1;a.rowIdx==i.rowIdx?(this.dir=a.colIdx<i.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(a.colIdx-i.colIdx)),o="left"==this.dir?o+1:o-1):a.colIdx==i.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(a.rowIdx-i.rowIdx)),s+=1):(this.dir=a.colIdx<i.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(a.colIdx-i.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(a.rowIdx-i.rowIdx)),s+=1,o="rightdown"==this.dir?o+1:o-1,this.rootElem.appendChild(t("div",null))),this.rootElem.style.gridRowEnd=String(s),this.rootElem.style.gridColumnEnd=String(o),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class Il extends e{constructor(e,t,a){super(e,"talent-picker-root",document.createElement("a")),this.config=t,this.tree=a,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.tree.picker.mopTalents||(this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay)),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(n.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null==this.longTouchTimer)return;clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;let t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(n.nextEventID())})),this.rootElem.addEventListener("mousedown",(e=>{L(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(n.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new yl(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(const t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){if(this.tree.picker.mopTalents)return!0;const t=this.getPoints();if(e>t){const a=e-t;if(this.tree.picker.numPoints+a>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const a=t-e,i=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>U(e.map((e=>e.getPoints())))));i[this.getRow()]-=a;const s=i.map(((e,t)=>U(i.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||s[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const a=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;if(this.tree.picker.mopTalents&&e>0){const e=this.tree.talents.find((e=>e.getRow()===this.getRow()&&e.getCol()!==this.getCol()&&e.getPoints()>0));if(e){const t=e.getPoints();t>0&&e.setPoints(t-1,!1)}}this.tree.numPoints+=e-a,this.rootElem.dataset.points=String(e),this.pointsDisplay&&(this.pointsDisplay.textContent=e+"/"+this.config.maxPoints),this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const i=this.getSpellIdForPoints(e);h.fromSpellId(i).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){let e;e=this.tree.picker.mopTalents?!this.tree.talents.find((e=>e.getRow()===this.getRow()&&e.getPoints()>0)):this.canSetPoints(this.getPoints()+1),e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function bl(e){return e.forEach((e=>{e.talents.forEach(((t,a)=>{if(t.childLocations=[],0!=a){const i=e.talents[a-1];if(t.location.rowIdx<i.location.rowIdx||t.location.rowIdx==i.location.rowIdx&&t.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let a=t.spellIds.length;a<t.maxPoints;a++)e++,t.spellIds.push(e)}}))})),e}const xl=bl([{name:"Blood",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/398.jpg",talents:[{fieldName:"butchery",fancyName:"Butchery",location:{rowIdx:0,colIdx:0},spellIds:[48979,49483],maxPoints:2},{fieldName:"bladeBarrier",fancyName:"Blade Barrier",location:{rowIdx:0,colIdx:1},spellIds:[49182,49500,49501],maxPoints:3},{fieldName:"bladedArmor",fancyName:"Bladed Armor",location:{rowIdx:0,colIdx:2},spellIds:[48978,49390,49391,49393],maxPoints:3},{fieldName:"improvedBloodTap",fancyName:"Improved Blood Tap",location:{rowIdx:1,colIdx:0},spellIds:[94553,94555],maxPoints:2},{fieldName:"scentOfBlood",fancyName:"Scent Of Blood",location:{rowIdx:1,colIdx:1},spellIds:[49004,49508,49509],maxPoints:3},{fieldName:"scarletFever",fancyName:"Scarlet Fever",location:{rowIdx:1,colIdx:2},spellIds:[81131,81132],maxPoints:2},{fieldName:"handOfDoom",fancyName:"Hand Of Doom",location:{rowIdx:1,colIdx:3},spellIds:[85793,85794],maxPoints:2},{fieldName:"bloodCakedBlade",fancyName:"Blood Caked Blade",location:{rowIdx:2,colIdx:0},spellIds:[49219,49627,49628],maxPoints:3},{fieldName:"boneShield",fancyName:"Bone Shield",location:{rowIdx:2,colIdx:1},spellIds:[49222],maxPoints:1},{fieldName:"toughness",fancyName:"Toughness",location:{rowIdx:2,colIdx:2},spellIds:[49042,49786,49787],maxPoints:3},{fieldName:"abominationsMight",fancyName:"Abominations Might",location:{rowIdx:2,colIdx:3},spellIds:[53137,53138],maxPoints:2},{fieldName:"sanguineFortitude",fancyName:"Sanguine Fortitude",location:{rowIdx:3,colIdx:0},spellIds:[81125,81127],maxPoints:2},{fieldName:"bloodParasite",fancyName:"Blood Parasite",location:{rowIdx:3,colIdx:1},spellIds:[49027,49542],maxPoints:2},{fieldName:"improvedBloodPresence",fancyName:"Improved Blood Presence",location:{rowIdx:3,colIdx:2},spellIds:[50365,50371],maxPoints:2},{fieldName:"willOfTheNecropolis",fancyName:"Will Of The Necropolis",location:{rowIdx:4,colIdx:0},spellIds:[52284,81163,81164],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"runeTap",fancyName:"Rune Tap",location:{rowIdx:4,colIdx:1},spellIds:[48982],maxPoints:1},{fieldName:"vampiricBlood",fancyName:"Vampiric Blood",location:{rowIdx:4,colIdx:2},spellIds:[55233],maxPoints:1},{fieldName:"improvedDeathStrike",fancyName:"Improved Death Strike",location:{rowIdx:5,colIdx:1},spellIds:[62905,62908,81138],maxPoints:3},{fieldName:"crimsonScourge",fancyName:"Crimson Scourge",location:{rowIdx:5,colIdx:2},spellIds:[81135,81136],maxPoints:2},{fieldName:"dancingRuneWeapon",fancyName:"Dancing Rune Weapon",location:{rowIdx:6,colIdx:1},spellIds:[49028],maxPoints:1}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/399.jpg",talents:[{fieldName:"runicPowerMastery",fancyName:"Runic Power Mastery",location:{rowIdx:0,colIdx:0},spellIds:[49455,50147,91145],maxPoints:3},{fieldName:"icyReach",fancyName:"Icy Reach",location:{rowIdx:0,colIdx:1},spellIds:[55061,55062],maxPoints:2},{fieldName:"nervesOfColdSteel",fancyName:"Nerves Of Cold Steel",location:{rowIdx:0,colIdx:2},spellIds:[49226,50137,50138],maxPoints:3},{fieldName:"annihilation",fancyName:"Annihilation",location:{rowIdx:1,colIdx:0},spellIds:[51468,51472,51473],maxPoints:3},{fieldName:"lichborne",fancyName:"Lichborne",location:{rowIdx:1,colIdx:1},spellIds:[49039],maxPoints:1},{fieldName:"onAPaleHorse",fancyName:"On A Pale Horse",location:{rowIdx:1,colIdx:2},spellIds:[51983,51986],maxPoints:2},{fieldName:"endlessWinter",fancyName:"Endless Winter",location:{rowIdx:1,colIdx:3},spellIds:[49137,49657],maxPoints:2},{fieldName:"mercilessCombat",fancyName:"Merciless Combat",location:{rowIdx:2,colIdx:0},spellIds:[49024,49538],maxPoints:2},{fieldName:"chillOfTheGrave",fancyName:"Chill Of The Grave",location:{rowIdx:2,colIdx:1},spellIds:[49149,50115],maxPoints:2},{fieldName:"killingMachine",fancyName:"Killing Machine",location:{rowIdx:2,colIdx:2},spellIds:[51123,51127,51128],maxPoints:3},{fieldName:"rime",fancyName:"Rime",location:{rowIdx:3,colIdx:0},spellIds:[49188,56822,59057],maxPoints:3},{fieldName:"pillarOfFrost",fancyName:"Pillar Of Frost",location:{rowIdx:3,colIdx:1},spellIds:[51271],maxPoints:1},{fieldName:"improvedIcyTalons",fancyName:"Improved Icy Talons",location:{rowIdx:3,colIdx:2},spellIds:[55610],maxPoints:1},{fieldName:"brittleBones",fancyName:"Brittle Bones",location:{rowIdx:3,colIdx:3},spellIds:[81327,81328],maxPoints:2},{fieldName:"chilblains",fancyName:"Chilblains",location:{rowIdx:4,colIdx:0},spellIds:[50040,50041],maxPoints:2},{fieldName:"hungeringCold",fancyName:"Hungering Cold",location:{rowIdx:4,colIdx:1},spellIds:[49203],maxPoints:1},{fieldName:"improvedFrostPresence",fancyName:"Improved Frost Presence",location:{rowIdx:4,colIdx:2},spellIds:[50384,50385],maxPoints:2},{fieldName:"threatOfThassarian",fancyName:"Threat Of Thassarian",location:{rowIdx:5,colIdx:0},spellIds:[65661,66191,66192],maxPoints:3},{fieldName:"mightOfTheFrozenWastes",fancyName:"Might Of The Frozen Wastes",location:{rowIdx:5,colIdx:2},spellIds:[81330,81332,81333],maxPoints:3},{fieldName:"howlingBlast",fancyName:"Howling Blast",location:{rowIdx:6,colIdx:1},spellIds:[49184],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Unholy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/400.jpg",talents:[{fieldName:"unholyCommand",fancyName:"Unholy Command",location:{rowIdx:0,colIdx:0},spellIds:[49588,49589],maxPoints:2},{fieldName:"virulence",fancyName:"Virulence",location:{rowIdx:0,colIdx:1},spellIds:[48962,49567,49568],maxPoints:3},{fieldName:"epidemic",fancyName:"Epidemic",location:{rowIdx:0,colIdx:2},spellIds:[49036,49562,81334],maxPoints:3},{fieldName:"desecration",fancyName:"Desecration",location:{rowIdx:1,colIdx:0},spellIds:[55666,55667],maxPoints:2},{fieldName:"resilientInfection",fancyName:"Resilient Infection",location:{rowIdx:1,colIdx:1},spellIds:[81338,81339],maxPoints:2},{fieldName:"morbidity",fancyName:"Morbidity",location:{rowIdx:1,colIdx:3},spellIds:[48963,49564,49565],maxPoints:3},{fieldName:"runicCorruption",fancyName:"Runic Corruption",location:{rowIdx:2,colIdx:0},spellIds:[51459,51462],maxPoints:2},{fieldName:"unholyFrenzy",fancyName:"Unholy Frenzy",location:{rowIdx:2,colIdx:1},spellIds:[49016],maxPoints:1},{fieldName:"contagion",fancyName:"Contagion",location:{rowIdx:2,colIdx:2},spellIds:[91316,91319],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"shadowInfusion",fancyName:"Shadow Infusion",location:{rowIdx:2,colIdx:3},spellIds:[48965,49571,49572],maxPoints:3},{fieldName:"deathsAdvance",fancyName:"Deaths Advance",location:{rowIdx:3,colIdx:0},spellIds:[96269,96270],maxPoints:2},{fieldName:"magicSuppression",fancyName:"Magic Suppression",location:{rowIdx:3,colIdx:1},spellIds:[49224,49610,49611],maxPoints:3},{fieldName:"rageOfRivendare",fancyName:"Rage Of Rivendare",location:{rowIdx:3,colIdx:2},spellIds:[51745,51746,91323],maxPoints:3},{fieldName:"unholyBlight",fancyName:"Unholy Blight",location:{rowIdx:4,colIdx:0},spellIds:[49194],maxPoints:1},{fieldName:"antiMagicZone",fancyName:"Anti Magic Zone",location:{rowIdx:4,colIdx:1},spellIds:[51052],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"improvedUnholyPresence",fancyName:"Improved Unholy Presence",location:{rowIdx:4,colIdx:2},spellIds:[50391,50392],maxPoints:2},{fieldName:"darkTransformation",fancyName:"Dark Transformation",location:{rowIdx:4,colIdx:3},spellIds:[63560],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:3}},{fieldName:"ebonPlaguebringer",fancyName:"Ebon Plaguebringer",location:{rowIdx:5,colIdx:1},spellIds:[51099,51160],maxPoints:2},{fieldName:"suddenDoom",fancyName:"Sudden Doom",location:{rowIdx:5,colIdx:2},spellIds:[49018,49529,49530],maxPoints:3},{fieldName:"summonGargoyle",fancyName:"Summon Gargoyle",location:{rowIdx:6,colIdx:1},spellIds:[49206],maxPoints:1}]}]),Sl={primeGlyphs:{[F.GlyphOfDeathAndDecay]:{name:"Glyph of Death and Decay",description:"Increases the duration of your Death and Decay spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathanddecay.jpg"},[F.GlyphOfDeathCoil]:{name:"Glyph of Death Coil",description:"Increases the damage or healing done by Death Coil by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[F.GlyphOfDeathStrike]:{name:"Glyph of Death Strike",description:"Increases your Death Strike's damage by 2% for every 5 Runic Power you currently have (up to a maximum of 40%). The Runic Power is not consumed by this effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg"},[F.GlyphOfFrostStrike]:{name:"Glyph of Frost Strike",description:"Reduces the cost of your Frost Strike by 8 Runic Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_empowerruneblade2.jpg"},[F.GlyphOfHeartStrike]:{name:"Glyph of Heart Strike",description:"Increases the damage of your Heart Strike ability by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_weapon_shortblade_40.jpg"},[F.GlyphOfHowlingBlast]:{name:"Glyph of Howling Blast",description:"Your Howling Blast ability now infects your targets with Frost Fever.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_arcticwinds.jpg"},[F.GlyphOfIcyTouch]:{name:"Glyph of Icy Touch",description:"Your Frost Fever disease deals 20% additional damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_icetouch.jpg"},[F.GlyphOfObliterate]:{name:"Glyph of Obliterate",description:"Increases the damage of your Obliterate ability by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_classicon.jpg"},[F.GlyphOfRaiseDead]:{name:"Glyph of Raise Dead",description:"Your Ghoul receives an additional 40% of your Strength and 40% of your Stamina.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg"},[F.GlyphOfRuneStrike]:{name:"Glyph of Rune Strike",description:"Increases the critical strike chance of your Rune Strike by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_darkconviction.jpg"},[F.GlyphOfScourgeStrike]:{name:"Glyph of Scourge Strike",description:"Increases the Shadow damage portion of your Scourge Strike by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_scourgestrike.jpg"}},majorGlyphs:{[M.GlyphOfAntiMagicShell]:{name:"Glyph of Anti-Magic Shell",description:"Increases the duration of your Anti-Magic Shell by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg"},[M.GlyphOfBloodBoil]:{name:"Glyph of Blood Boil",description:"Increases the radius of your Blood Boil ability by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodboil.jpg"},[M.GlyphOfBoneShield]:{name:"Glyph of Bone Shield",description:"Increases your movement speed by 15% while Bone Shield is active. This does not stack with other movement-speed increasing effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_boneshield.jpg"},[M.GlyphOfChainsOfIce]:{name:"Glyph of Chains of Ice",description:"Your Chains of Ice also causes 144 to 156 Frost damage, with additional damage depending on your attack power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[M.GlyphOfDancingRuneWeapon]:{name:"Glyph of Dancing Rune Weapon",description:"Increases your threat generation by 50% while your Dancing Rune Weapon is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_07.jpg"},[M.GlyphOfDarkSuccor]:{name:"Glyph of Dark Succor",description:"Your next Death Strike performed while in Frost or Unholy Presence, within 15 sec after killing an enemy that yields experience or honor, will restore at least 20% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg"},[M.GlyphOfDeathGrip]:{name:"Glyph of Death Grip",description:"Increases the range of your Death Grip ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg"},[M.GlyphOfHungeringCold]:{name:"Glyph of Hungering Cold",description:"Your Hungering Cold ability no longer costs runic power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_staff_15.jpg"},[M.GlyphOfPestilence]:{name:"Glyph of Pestilence",description:"Increases the radius of your Pestilence effect by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg"},[M.GlyphOfPillarOfFrost]:{name:"Glyph of Pillar of Frost",description:"Empowers your Pillar of Frost, making you immune to all effects that cause loss of control of your character, but also freezing you in place while the ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_pillaroffrost.jpg"},[M.GlyphOfRuneTap]:{name:"Glyph of Rune Tap",description:"Your Rune Tap also heals your party for 5% of their maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_runetap.jpg"},[M.GlyphOfStrangulate]:{name:"Glyph of Strangulate",description:"Increases the Silence duration of your Strangulate ability by 2 sec when used on a target who is casting a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulleech_3.jpg"},[M.GlyphOfVampiricBlood]:{name:"Glyph of Vampiric Blood",description:"Increases the bonus healing received while your Vampiric Blood is active by an additional 15%, but your Vampiric Blood no longer grants you health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"}},minorGlyphs:{[V.GlyphOfBloodTap]:{name:"Glyph of Blood Tap",description:"Your Blood Tap no longer causes damage to you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodtap.jpg"},[V.GlyphOfDeathGate]:{name:"Glyph of Death Gate",description:"Reduces the cast time of your Death Gate spell by 60%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_teleportundercity.jpg"},[V.GlyphOfDeathSEmbrace]:{name:"Glyph of Death's Embrace",description:"Your Death Coil refunds 20 Runic Power when used to heal an allied minion.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[V.GlyphOfHornOfWinter]:{name:"Glyph of Horn of Winter",description:"Increases the duration of your Horn of Winter ability by 1 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_02.jpg"},[V.GlyphOfPathOfFrost]:{name:"Glyph of Path of Frost",description:"Your Path of Frost ability allows you to fall from a greater distance without suffering damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_pathoffrost.jpg"},[V.GlyphOfResilientGrip]:{name:"Glyph of Resilient Grip",description:"When your Death Grip ability fails because its target is immune, its cooldown is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg"}}},vl=bl([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/752.jpg",talents:[{fieldName:"naturesGrace",fancyName:"Natures Grace",location:{rowIdx:0,colIdx:0},spellIds:[16880,61345,61346],maxPoints:3},{fieldName:"starlightWrath",fancyName:"Starlight Wrath",location:{rowIdx:0,colIdx:1},spellIds:[16814,16815,16816],maxPoints:3},{fieldName:"naturesMajesty",fancyName:"Natures Majesty",location:{rowIdx:0,colIdx:2},spellIds:[35363,35364],maxPoints:2},{fieldName:"genesis",fancyName:"Genesis",location:{rowIdx:1,colIdx:0},spellIds:[57810,57811,57812],maxPoints:3},{fieldName:"moonglow",fancyName:"Moonglow",location:{rowIdx:1,colIdx:1},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"balanceOfPower",fancyName:"Balance Of Power",location:{rowIdx:1,colIdx:2},spellIds:[33592,33596],maxPoints:2},{fieldName:"euphoria",fancyName:"Euphoria",location:{rowIdx:2,colIdx:0},spellIds:[81061,81062],maxPoints:2},{fieldName:"moonkinForm",fancyName:"Moonkin Form",location:{rowIdx:2,colIdx:1},spellIds:[24858],maxPoints:1},{fieldName:"typhoon",fancyName:"Typhoon",location:{rowIdx:2,colIdx:2},spellIds:[50516],maxPoints:1},{fieldName:"shootingStars",fancyName:"Shooting Stars",location:{rowIdx:2,colIdx:3},spellIds:[93398,93399],maxPoints:2},{fieldName:"owlkinFrenzy",fancyName:"Owlkin Frenzy",location:{rowIdx:3,colIdx:1},spellIds:[48389,48392,48393],maxPoints:3,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"galeWinds",fancyName:"Gale Winds",location:{rowIdx:3,colIdx:2},spellIds:[48488,48514],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"solarBeam",fancyName:"Solar Beam",location:{rowIdx:3,colIdx:3},spellIds:[78675],maxPoints:1},{fieldName:"dreamstate",fancyName:"Dreamstate",location:{rowIdx:4,colIdx:0},spellIds:[33597,33599],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"forceOfNature",fancyName:"Force Of Nature",location:{rowIdx:4,colIdx:1},spellIds:[33831],maxPoints:1},{fieldName:"sunfire",fancyName:"Sunfire",location:{rowIdx:4,colIdx:2},spellIds:[93401],maxPoints:1},{fieldName:"earthAndMoon",fancyName:"Earth And Moon",location:{rowIdx:4,colIdx:3},spellIds:[48506],maxPoints:1},{fieldName:"fungalGrowth",fancyName:"Fungal Growth",location:{rowIdx:5,colIdx:1},spellIds:[78788,78789],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"lunarShower",fancyName:"Lunar Shower",location:{rowIdx:5,colIdx:2},spellIds:[33603,33605,33604],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"starfall",fancyName:"Starfall",location:{rowIdx:6,colIdx:1},spellIds:[48505],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/750.jpg",talents:[{fieldName:"feralSwiftness",fancyName:"Feral Swiftness",location:{rowIdx:0,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"furor",fancyName:"Furor",location:{rowIdx:0,colIdx:1},spellIds:[17056,17058,17059],maxPoints:3},{fieldName:"predatoryStrikes",fancyName:"Predatory Strikes",location:{rowIdx:0,colIdx:2},spellIds:[16972,16974],maxPoints:2},{fieldName:"infectedWounds",fancyName:"Infected Wounds",location:{rowIdx:1,colIdx:0},spellIds:[48483,48484],maxPoints:2},{fieldName:"furySwipes",fancyName:"Fury Swipes",location:{rowIdx:1,colIdx:1},spellIds:[48532,80552,80553],maxPoints:3},{fieldName:"primalFury",fancyName:"Primal Fury",location:{rowIdx:1,colIdx:2},spellIds:[37116,37117],maxPoints:2},{fieldName:"feralAggression",fancyName:"Feral Aggression",location:{rowIdx:1,colIdx:3},spellIds:[16858,16859],maxPoints:2},{fieldName:"kingOfTheJungle",fancyName:"King Of The Jungle",location:{rowIdx:2,colIdx:0},spellIds:[48492,48494,48495],maxPoints:3},{fieldName:"feralCharge",fancyName:"Feral Charge",location:{rowIdx:2,colIdx:1},spellIds:[49377],maxPoints:1},{fieldName:"stampede",fancyName:"Stampede",location:{rowIdx:2,colIdx:2},spellIds:[78892,78893],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"thickHide",fancyName:"Thick Hide",location:{rowIdx:2,colIdx:3},spellIds:[16929,16930,16931],maxPoints:3},{fieldName:"leaderOfThePack",fancyName:"Leader Of The Pack",location:{rowIdx:3,colIdx:1},spellIds:[17007],maxPoints:1},{fieldName:"brutalImpact",fancyName:"Brutal Impact",location:{rowIdx:3,colIdx:2},spellIds:[16940,16941],maxPoints:2},{fieldName:"nurturingInstinct",fancyName:"Nurturing Instinct",location:{rowIdx:3,colIdx:3},spellIds:[33872,33873],maxPoints:2},{fieldName:"primalMadness",fancyName:"Primal Madness",location:{rowIdx:4,colIdx:0},spellIds:[80316,80317],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"survivalInstincts",fancyName:"Survival Instincts",location:{rowIdx:4,colIdx:1},spellIds:[61336],maxPoints:1},{fieldName:"endlessCarnage",fancyName:"Endless Carnage",location:{rowIdx:4,colIdx:2},spellIds:[80314,80315],maxPoints:2},{fieldName:"naturalReaction",fancyName:"Natural Reaction",location:{rowIdx:4,colIdx:3},spellIds:[57878,57880],maxPoints:2},{fieldName:"bloodInTheWater",fancyName:"Blood In The Water",location:{rowIdx:5,colIdx:0},spellIds:[80318,80319],maxPoints:2},{fieldName:"rendAndTear",fancyName:"Rend And Tear",location:{rowIdx:5,colIdx:1},spellIds:[48432,48433,48434],maxPoints:3},{fieldName:"pulverize",fancyName:"Pulverize",location:{rowIdx:5,colIdx:2},spellIds:[80313],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}},{fieldName:"berserk",fancyName:"Berserk",location:{rowIdx:6,colIdx:1},spellIds:[50334],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/748.jpg",talents:[{fieldName:"blessingOfTheGrove",fancyName:"Blessing Of The Grove",location:{rowIdx:0,colIdx:0},spellIds:[78784,78785],maxPoints:2},{fieldName:"naturalShapeshifter",fancyName:"Natural Shapeshifter",location:{rowIdx:0,colIdx:1},spellIds:[16833,16834],maxPoints:2},{fieldName:"naturalist",fancyName:"Naturalist",location:{rowIdx:0,colIdx:2},spellIds:[17069,17070],maxPoints:2},{fieldName:"heartOfTheWild",fancyName:"Heart Of The Wild",location:{rowIdx:0,colIdx:3},spellIds:[17003,17004,17005],maxPoints:3},{fieldName:"perseverance",fancyName:"Perseverance",location:{rowIdx:1,colIdx:0},spellIds:[78734,78736,78735,78737,78738],maxPoints:3},{fieldName:"masterShapeshifter",fancyName:"Master Shapeshifter",location:{rowIdx:1,colIdx:1},spellIds:[48411],maxPoints:1,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRejuvenation",fancyName:"Improved Rejuvenation",location:{rowIdx:1,colIdx:2},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"livingSeed",fancyName:"Living Seed",location:{rowIdx:2,colIdx:0},spellIds:[48496,48499,48500],maxPoints:3},{fieldName:"revitalize",fancyName:"Revitalize",location:{rowIdx:2,colIdx:1},spellIds:[48539,48544],maxPoints:2},{fieldName:"naturesSwiftness",fancyName:"Natures Swiftness",location:{rowIdx:2,colIdx:2},spellIds:[17116],maxPoints:1},{fieldName:"furyOfStormrage",fancyName:"Fury Of Stormrage",location:{rowIdx:2,colIdx:3},spellIds:[17104,24943],maxPoints:2},{fieldName:"naturesBounty",fancyName:"Natures Bounty",location:{rowIdx:3,colIdx:1},spellIds:[17074,17075,17076],maxPoints:3},{fieldName:"empoweredTouch",fancyName:"Empowered Touch",location:{rowIdx:3,colIdx:2},spellIds:[33879,33880],maxPoints:2},{fieldName:"malfurionsGift",fancyName:"Malfurions Gift",location:{rowIdx:3,colIdx:3},spellIds:[92363,92364],maxPoints:2},{fieldName:"efflorescence",fancyName:"Efflorescence",location:{rowIdx:4,colIdx:0},spellIds:[34151,81274,81275],maxPoints:3},{fieldName:"wildGrowth",fancyName:"Wild Growth",location:{rowIdx:4,colIdx:1},spellIds:[48438],maxPoints:1},{fieldName:"naturesCure",fancyName:"Natures Cure",location:{rowIdx:4,colIdx:2},spellIds:[88423],maxPoints:1},{fieldName:"naturesWard",fancyName:"Natures Ward",location:{rowIdx:4,colIdx:3},spellIds:[33881,33882],maxPoints:2},{fieldName:"giftOfTheEarthmother",fancyName:"Gift Of The Earthmother",location:{rowIdx:5,colIdx:0},spellIds:[51179,51180,51181],maxPoints:3},{fieldName:"swiftRejuvenation",fancyName:"Swift Rejuvenation",location:{rowIdx:5,colIdx:2},spellIds:[33886],maxPoints:1},{fieldName:"treeOfLife",fancyName:"Tree Of Life",location:{rowIdx:6,colIdx:1},spellIds:[33891],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),kl={primeGlyphs:{[W.GlyphOfBerserk]:{name:"Glyph of Berserk",description:"Increases the duration of Berserk by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_berserk.jpg"},[W.GlyphOfBloodletting]:{name:"Glyph of Bloodletting",description:"Each time you Shred or Mangle in Cat Form, the duration of your Rip on the target is extended by 2 sec, up to a maximum of 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_vampiricaura.jpg"},[W.GlyphOfInsectSwarm]:{name:"Glyph of Insect Swarm",description:"Increases the damage of your Insect Swarm ability by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_insectswarm.jpg"},[W.GlyphOfLacerate]:{name:"Glyph of Lacerate",description:"Increases the critical strike chance of your Lacerate ability by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_lacerate.jpg"},[W.GlyphOfLifebloom]:{name:"Glyph of Lifebloom",description:"Increases the critical effect chance of your Lifebloom by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_herb_felblossom.jpg"},[W.GlyphOfMangle]:{name:"Glyph of Mangle",description:"Increases the damage done by Mangle by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_mangle2.jpg"},[W.GlyphOfMoonfire]:{name:"Glyph of Moonfire",description:"Increases the periodic damage of your Moonfire ability by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg"},[W.GlyphOfRegrowth]:{name:"Glyph of Regrowth",description:"Your Regrowth heal-over-time will automatically refresh its duration on targets at or below 50% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_resistnature.jpg"},[W.GlyphOfRejuvenation]:{name:"Glyph of Rejuvenation",description:"Increases the healing done by your Rejuvenation by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg"},[W.GlyphOfRip]:{name:"Glyph of Rip",description:"Increases the periodic damage of your Rip by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_ghoulfrenzy.jpg"},[W.GlyphOfSavageRoar]:{name:"Glyph of Savage Roar",description:"Your Savage Roar ability grants an additional 5% bonus damage done.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_skinteeth.jpg"},[W.GlyphOfStarfire]:{name:"Glyph of Starfire",description:"Your Starfire ability increases the duration of your Moonfire effect on the target by 3 sec, up to a maximum of 9 additional seconds. Only functions on the target with your most recently applied Moonfire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_starfire.jpg"},[W.GlyphOfStarsurge]:{name:"Glyph of Starsurge",description:"When your Starsurge deals damage, the cooldown remaining on your Starfall is reduced by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcane03.jpg"},[W.GlyphOfSwiftmend]:{name:"Glyph of Swiftmend",description:"Your Swiftmend ability no longer consumes a Rejuvenation or Regrowth effect from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_relics_idolofrejuvenation.jpg"},[W.GlyphOfTigersFury]:{name:"Glyph of Tiger's Fury",description:"Reduces the cooldown of your Tiger's Fury ability by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_jungletiger.jpg"},[W.GlyphOfWrath]:{name:"Glyph of Wrath",description:"Increases the damage done by your Wrath by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_wrathv2.jpg"}},majorGlyphs:{[B.GlyphOfBarkskin]:{name:"Glyph of Barkskin",description:"Reduces the chance you'll be critically hit by 25% while Barkskin is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg"},[B.GlyphOfEntanglingRoots]:{name:"Glyph of Entangling Roots",description:"Reduces the cast time of your Entangling Roots by 0.2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stranglevines.jpg"},[B.GlyphOfFaerieFire]:{name:"Glyph of Faerie Fire",description:"Increases the range of your Faerie Fire and Feral Faerie Fire abilities by 10 yds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg"},[B.GlyphOfFeralCharge]:{name:"Glyph of Feral Charge",description:"Reduces the cooldown of your Feral Charge (Cat) ability by 2 sec and the cooldown of your Feral Charge (Bear) ability by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pet_bear.jpg"},[B.GlyphOfFerociousBite]:{name:"Glyph of Ferocious Bite",description:"Your Ferocious Bite ability heals you for 1% of your maximum health for each 10 energy used.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[B.GlyphOfFocus]:{name:"Glyph of Focus",description:"Increases the damage done by Starfall by 10%, but decreases its radius by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcanepotency.jpg"},[B.GlyphOfFrenziedRegeneration]:{name:"Glyph of Frenzied Regeneration",description:"While Frenzied Regeneration is active, healing effects on you are 30% more powerful but causes your Frenzied Regeneration to no longer convert rage into health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_bullrush.jpg"},[B.GlyphOfHealingTouch]:{name:"Glyph of Healing Touch",description:"When you cast Healing Touch, the cooldown on your Nature's Swiftness is reduced by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg"},[B.GlyphOfHurricane]:{name:"Glyph of Hurricane",description:"Your Hurricane ability now also slows the movement speed of its victims by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg"},[B.GlyphOfInnervate]:{name:"Glyph of Innervate",description:"When Innervate is cast on a friendly target other than the caster, the caster will gain 10% of maximum mana over 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[B.GlyphOfMaul]:{name:"Glyph of Maul",description:"Your Maul ability now hits 1 additional target for 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_maul.jpg"},[B.GlyphOfMonsoon]:{name:"Glyph of Monsoon",description:"Reduces the cooldown of your Typhoon spell by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg"},[B.GlyphOfOmenOfClarity]:{name:"Glyph of Omen of Clarity",description:"Your Omen of Clarity talent has a 100% chance to be triggered by successfully casting Faerie Fire (Feral). Does not trigger on players or player-controlled pets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg"},[B.GlyphOfPounce]:{name:"Glyph of Pounce",description:"Increases the range of your Pounce by 3 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_supriseattack.jpg"},[B.GlyphOfRebirth]:{name:"Glyph of Rebirth",description:"Players resurrected by Rebirth are returned to life with 100% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg"},[B.GlyphOfSolarBeam]:{name:"Glyph of Solar Beam",description:"Increases the duration of your Solar Beam silence effect by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vehicle_sonicshockwave.jpg"},[B.GlyphOfStarfall]:{name:"Glyph of Starfall",description:"Reduces the cooldown of Starfall by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_starfall.jpg"},[B.GlyphOfThorns]:{name:"Glyph of Thorns",description:"Reduces the cooldown of your Thorns spell by 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_thorns.jpg"},[B.GlyphOfWildGrowth]:{name:"Glyph of Wild Growth",description:"Wild Growth can affect 1 additional target, but its cooldown is increased by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_flourish.jpg"}},minorGlyphs:{[z.GlyphOfAquaticForm]:{name:"Glyph of Aquatic Form",description:"Increases your swim speed by 50% while in Aquatic Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_aquaticform.jpg"},[z.GlyphOfChallengingRoar]:{name:"Glyph of Challenging Roar",description:"Reduces the cooldown of your Challenging Roar ability by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_challangingroar.jpg"},[z.GlyphOfDash]:{name:"Glyph of Dash",description:"Reduces the cooldown of your Dash ability by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_dash.jpg"},[z.GlyphOfMarkOfTheWild]:{name:"Glyph of Mark of the Wild",description:"Mana cost of your Mark of the Wild reduced by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_giftofthewild.jpg"},[z.GlyphOfTheTreant]:{name:"Glyph of the Treant",description:"Your Tree of Life Form now resembles a Treant.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_treeoflife.jpg"},[z.GlyphOfTyphoon]:{name:"Glyph of Typhoon",description:"Reduces the cost of your Typhoon spell by 8% and increases its radius by 10 yards, but it no longer knocks enemies back.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_typhoon.jpg"},[z.GlyphOfUnburdenedRebirth]:{name:"Glyph of Unburdened Rebirth",description:"Your Rebirth spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispsplodegreen.jpg"}}},El=bl([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/811.jpg",talents:[{fieldName:"improvedKillCommand",fancyName:"Improved Kill Command",location:{rowIdx:0,colIdx:0},spellIds:[35029,35030],maxPoints:2},{fieldName:"oneWithNature",fancyName:"One With Nature",location:{rowIdx:0,colIdx:1},spellIds:[82682,82683,82684],maxPoints:3},{fieldName:"bestialDiscipline",fancyName:"Bestial Discipline",location:{rowIdx:0,colIdx:2},spellIds:[19590,19592,82687],maxPoints:3},{fieldName:"pathfinding",fancyName:"Pathfinding",location:{rowIdx:1,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"spiritBond",fancyName:"Spirit Bond",location:{rowIdx:1,colIdx:1},spellIds:[19578,20895],maxPoints:2},{fieldName:"frenzy",fancyName:"Frenzy",location:{rowIdx:1,colIdx:2},spellIds:[19621,19622,19623],maxPoints:3},{fieldName:"improvedMendPet",fancyName:"Improved Mend Pet",location:{rowIdx:1,colIdx:3},spellIds:[19572,19573],maxPoints:2},{fieldName:"cobraStrikes",fancyName:"Cobra Strikes",location:{rowIdx:2,colIdx:0},spellIds:[53256,53259,53260],maxPoints:3},{fieldName:"fervor",fancyName:"Fervor",location:{rowIdx:2,colIdx:1},spellIds:[82726],maxPoints:1},{fieldName:"focusFire",fancyName:"Focus Fire",location:{rowIdx:2,colIdx:2},spellIds:[82692],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"longevity",fancyName:"Longevity",location:{rowIdx:3,colIdx:0},spellIds:[53262,53263,53264],maxPoints:3},{fieldName:"killingStreak",fancyName:"Killing Streak",location:{rowIdx:3,colIdx:2},spellIds:[82748,82749],maxPoints:2},{fieldName:"crouchingTigerHiddenChimera",fancyName:"Crouching Tiger Hidden Chimera",location:{rowIdx:4,colIdx:0},spellIds:[82898,82899],maxPoints:2},{fieldName:"bestialWrath",fancyName:"Bestial Wrath",location:{rowIdx:4,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"ferociousInspiration",fancyName:"Ferocious Inspiration",location:{rowIdx:4,colIdx:2},spellIds:[34460],maxPoints:1},{fieldName:"kindredSpirits",fancyName:"Kindred Spirits",location:{rowIdx:5,colIdx:0},spellIds:[56314,56315],maxPoints:2},{fieldName:"theBeastWithin",fancyName:"The Beast Within",location:{rowIdx:5,colIdx:1},spellIds:[34692],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"invigoration",fancyName:"Invigoration",location:{rowIdx:5,colIdx:2},spellIds:[53252,53253],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"beastMastery",fancyName:"Beast Mastery",location:{rowIdx:6,colIdx:1},spellIds:[53270],maxPoints:1}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/807.jpg",talents:[{fieldName:"goForTheThroat",fancyName:"Go For The Throat",location:{rowIdx:0,colIdx:0},spellIds:[34950,34954],maxPoints:2},{fieldName:"efficiency",fancyName:"Efficiency",location:{rowIdx:0,colIdx:1},spellIds:[19416,19417,19418],maxPoints:3},{fieldName:"rapidKilling",fancyName:"Rapid Killing",location:{rowIdx:0,colIdx:2},spellIds:[34948,34949],maxPoints:2},{fieldName:"sicEm",fancyName:"Sic Em",location:{rowIdx:1,colIdx:0},spellIds:[83340,83356],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:0}},{fieldName:"improvedSteadyShot",fancyName:"Improved Steady Shot",location:{rowIdx:1,colIdx:1},spellIds:[53221,53222,53224],maxPoints:3},{fieldName:"carefulAim",fancyName:"Careful Aim",location:{rowIdx:1,colIdx:2},spellIds:[34482,34483],maxPoints:2},{fieldName:"silencingShot",fancyName:"Silencing Shot",location:{rowIdx:2,colIdx:0},spellIds:[34490],maxPoints:1},{fieldName:"concussiveBarrage",fancyName:"Concussive Barrage",location:{rowIdx:2,colIdx:1},spellIds:[35100,35102],maxPoints:2},{fieldName:"piercingShots",fancyName:"Piercing Shots",location:{rowIdx:2,colIdx:2},spellIds:[53234,53237,53238],maxPoints:3},{fieldName:"bombardment",fancyName:"Bombardment",location:{rowIdx:3,colIdx:0},spellIds:[35104,35110],maxPoints:2},{fieldName:"trueshotAura",fancyName:"Trueshot Aura",location:{rowIdx:3,colIdx:1},spellIds:[19506],maxPoints:1},{fieldName:"termination",fancyName:"Termination",location:{rowIdx:3,colIdx:2},spellIds:[83489,83490],maxPoints:2},{fieldName:"resistanceIsFutile",fancyName:"Resistance Is Futile",location:{rowIdx:3,colIdx:3},spellIds:[82893,82894],maxPoints:2},{fieldName:"rapidRecuperation",fancyName:"Rapid Recuperation",location:{rowIdx:4,colIdx:0},spellIds:[53228,53232],maxPoints:2},{fieldName:"masterMarksman",fancyName:"Master Marksman",location:{rowIdx:4,colIdx:1},spellIds:[34485,34486,34487],maxPoints:3},{fieldName:"readiness",fancyName:"Readiness",location:{rowIdx:4,colIdx:3},spellIds:[23989],maxPoints:1},{fieldName:"posthaste",fancyName:"Posthaste",location:{rowIdx:5,colIdx:0},spellIds:[83558,83560],maxPoints:2},{fieldName:"markedForDeath",fancyName:"Marked For Death",location:{rowIdx:5,colIdx:2},spellIds:[53241,53243],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"chimeraShot",fancyName:"Chimera Shot",location:{rowIdx:6,colIdx:1},spellIds:[53209],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/809.jpg",talents:[{fieldName:"hunterVsWild",fancyName:"Hunter Vs Wild",location:{rowIdx:0,colIdx:0},spellIds:[56339,56340,56341],maxPoints:3},{fieldName:"pathing",fancyName:"Pathing",location:{rowIdx:0,colIdx:1},spellIds:[52783,52785,52786],maxPoints:3},{fieldName:"improvedSerpentSting",fancyName:"Improved Serpent Sting",location:{rowIdx:0,colIdx:2},spellIds:[19464,82834],maxPoints:2},{fieldName:"survivalTactics",fancyName:"Survival Tactics",location:{rowIdx:1,colIdx:0},spellIds:[19286,19287],maxPoints:2},{fieldName:"trapMastery",fancyName:"Trap Mastery",location:{rowIdx:1,colIdx:1},spellIds:[19376,63457,63458],maxPoints:3},{fieldName:"entrapment",fancyName:"Entrapment",location:{rowIdx:1,colIdx:2},spellIds:[19184,19387],maxPoints:2},{fieldName:"pointOfNoEscape",fancyName:"Point Of No Escape",location:{rowIdx:1,colIdx:3},spellIds:[53298,53299],maxPoints:2},{fieldName:"thrillOfTheHunt",fancyName:"Thrill Of The Hunt",location:{rowIdx:2,colIdx:0},spellIds:[34497,34498,34499],maxPoints:3},{fieldName:"counterattack",fancyName:"Counterattack",location:{rowIdx:2,colIdx:1},spellIds:[19306],maxPoints:1},{fieldName:"lockAndLoad",fancyName:"Lock And Load",location:{rowIdx:2,colIdx:2},spellIds:[56342,56343],maxPoints:2},{fieldName:"resourcefulness",fancyName:"Resourcefulness",location:{rowIdx:3,colIdx:0},spellIds:[34491,34492,34493],maxPoints:3},{fieldName:"mirroredBlades",fancyName:"Mirrored Blades",location:{rowIdx:3,colIdx:1},spellIds:[83494,83495],maxPoints:2},{fieldName:"tNT",fancyName:"T N T",location:{rowIdx:3,colIdx:2},spellIds:[56333,56336],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"toxicology",fancyName:"Toxicology",location:{rowIdx:4,colIdx:0},spellIds:[82832,82833],maxPoints:2},{fieldName:"wyvernSting",fancyName:"Wyvern Sting",location:{rowIdx:4,colIdx:1},spellIds:[19386],maxPoints:1},{fieldName:"noxiousStings",fancyName:"Noxious Stings",location:{rowIdx:4,colIdx:2},spellIds:[53295,53296],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"huntingParty",fancyName:"Hunting Party",location:{rowIdx:4,colIdx:3},spellIds:[53290],maxPoints:1},{fieldName:"sniperTraining",fancyName:"Sniper Training",location:{rowIdx:5,colIdx:0},spellIds:[53302,53303,53304],maxPoints:3},{fieldName:"serpentSpread",fancyName:"Serpent Spread",location:{rowIdx:5,colIdx:2},spellIds:[87934,87935],maxPoints:2},{fieldName:"blackArrow",fancyName:"Black Arrow",location:{rowIdx:6,colIdx:1},spellIds:[3674],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Pl={primeGlyphs:{[j.GlyphOfAimedShot]:{name:"Glyph of Aimed Shot",description:"When you critically hit with Aimed Shot, you instantly gain 5 Focus.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_07.jpg"},[j.GlyphOfArcaneShot]:{name:"Glyph of Arcane Shot",description:"Your Arcane Shot deals 12% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_impalingbolt.jpg"},[j.GlyphOfChimeraShot]:{name:"Glyph of Chimera Shot",description:"Reduces the cooldown of Chimera Shot by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_chimerashot2.jpg"},[j.GlyphOfDazzledPrey]:{name:"Glyph of Dazzled Prey",description:"Your Steady Shot and Cobra Shot abilities generate an additional 2 Focus on targets afflicted by a daze effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_cheatdeath.jpg"},[j.GlyphOfExplosiveShot]:{name:"Glyph of Explosive Shot",description:"Increases the critical strike chance of Explosive Shot by 6%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_explosiveshot.jpg"},[j.GlyphOfKillCommand]:{name:"Glyph of Kill Command",description:"Reduces the Focus cost of your Kill Command by 3.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_killcommand.jpg"},[j.GlyphOfKillShot]:{name:"Glyph of Kill Shot",description:"If the damage from your Kill Shot fails to kill a target at or below 20% health, your Kill Shot's cooldown is instantly reset. This effect has a 6 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_assassinate2.jpg"},[j.GlyphOfRapidFire]:{name:"Glyph of Rapid Fire",description:"Increases the haste from Rapid Fire by an additional 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_runningshot.jpg"},[j.GlyphOfSerpentSting]:{name:"Glyph of Serpent Sting",description:"Increases the periodic critical strike chance of your Serpent Sting by 6%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_quickshot.jpg"},[j.GlyphOfSteadyShot]:{name:"Glyph of Steady Shot",description:"Increases the damage dealt by Steady Shot by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_steadyshot.jpg"}},majorGlyphs:{[H.GlyphOfBestialWrath]:{name:"Glyph of Bestial Wrath",description:"Decreases the cooldown of Bestial Wrath by 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[H.GlyphOfConcussiveShot]:{name:"Glyph of Concussive Shot",description:"Your Concussive Shot also limits the maximum run speed of your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_stun.jpg"},[H.GlyphOfDeterrence]:{name:"Glyph of Deterrence",description:"Decreases the cooldown of Deterrence by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg"},[H.GlyphOfDisengage]:{name:"Glyph of Disengage",description:"Decreases the cooldown of Disengage by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[H.GlyphOfFreezingTrap]:{name:"Glyph of Freezing Trap",description:"When your Freezing Trap breaks, the victim's movement speed is reduced by 70% for 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[H.GlyphOfIceTrap]:{name:"Glyph of Ice Trap",description:"Increases the radius of the effect from your Ice Trap by 2 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg"},[H.GlyphOfImmolationTrap]:{name:"Glyph of Immolation Trap",description:"Decreases the duration of the effect from your Immolation Trap by 6 sec, but damage while active is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg"},[H.GlyphOfMasterSCall]:{name:"Glyph of Master's Call",description:"Increases the duration of your Master's Call by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_masterscall.jpg"},[H.GlyphOfMending]:{name:"Glyph of Mending",description:"Increases the total amount of healing done by your Mend Pet ability by 60%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg"},[H.GlyphOfMisdirection]:{name:"Glyph of Misdirection",description:"When you use Misdirection on your pet, the cooldown on your Misdirection is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_misdirection.jpg"},[H.GlyphOfRaptorStrike]:{name:"Glyph of Raptor Strike",description:"Reduces damage taken by 20% for 5 sec after using Raptor Strike.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg"},[H.GlyphOfScatterShot]:{name:"Glyph of Scatter Shot",description:"Increases the range of Scatter Shot by 3 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemstormbolt.jpg"},[H.GlyphOfSilencingShot]:{name:"Glyph of Silencing Shot",description:"When you successfully silence an enemy's spell cast with Silencing Shot, you instantly gain 10 Focus.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_theblackarrow.jpg"},[H.GlyphOfSnakeTrap]:{name:"Glyph of Snake Trap",description:"Snakes from your Snake Trap take 90% reduced damage from area of effect spells.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snaketrap.jpg"},[H.GlyphOfTrapLauncher]:{name:"Glyph of Trap Launcher",description:"Reduces the Focus cost of Trap Launcher by 10.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_traplauncher.jpg"},[H.GlyphOfWyvernSting]:{name:"Glyph of Wyvern Sting",description:"Decreases the cooldown of your Wyvern Sting by 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_02.jpg"}},minorGlyphs:{[q.GlyphOfAspectOfThePack]:{name:"Glyph of Aspect of the Pack",description:"Increases the range of your Aspect of the Pack ability by 15 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitetiger.jpg"},[q.GlyphOfFeignDeath]:{name:"Glyph of Feign Death",description:"Reduces the cooldown of your Feign Death spell by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feigndeath.jpg"},[q.GlyphOfLesserProportion]:{name:"Glyph of Lesser Proportion",description:"Slightly reduces the size of your pet.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg"},[q.GlyphOfRevivePet]:{name:"Glyph of Revive Pet",description:"Reduces the pushback suffered from damaging attacks while casting Revive Pet by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beastsoothe.jpg"},[q.GlyphOfScareBeast]:{name:"Glyph of Scare Beast",description:"Reduces the pushback suffered from damaging attacks while casting Scare Beast by 75%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_cower.jpg"}}},Cl=bl([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/799.jpg",talents:[{fieldName:"arcaneConcentration",fancyName:"Arcane Concentration",location:{rowIdx:0,colIdx:0},spellIds:[11213,12574,12575],maxPoints:3},{fieldName:"improvedCounterspell",fancyName:"Improved Counterspell",location:{rowIdx:0,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"netherwindPresence",fancyName:"Netherwind Presence",location:{rowIdx:0,colIdx:2},spellIds:[44400,44402,44403],maxPoints:3},{fieldName:"tormentTheWeak",fancyName:"Torment The Weak",location:{rowIdx:1,colIdx:0},spellIds:[29447,55339,55340],maxPoints:3},{fieldName:"invocation",fancyName:"Invocation",location:{rowIdx:1,colIdx:1},spellIds:[84722,84723],maxPoints:2},{fieldName:"improvedArcaneMissiles",fancyName:"Improved Arcane Missiles",location:{rowIdx:1,colIdx:2},spellIds:[83513,83515],maxPoints:2},{fieldName:"improvedBlink",fancyName:"Improved Blink",location:{rowIdx:1,colIdx:3},spellIds:[31569,31570],maxPoints:2},{fieldName:"arcaneFlows",fancyName:"Arcane Flows",location:{rowIdx:2,colIdx:0},spellIds:[44378,44379],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"presenceOfMind",fancyName:"Presence Of Mind",location:{rowIdx:2,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"missileBarrage",fancyName:"Missile Barrage",location:{rowIdx:2,colIdx:2},spellIds:[44404,54486],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"prismaticCloak",fancyName:"Prismatic Cloak",location:{rowIdx:2,colIdx:3},spellIds:[31574,31575,54354],maxPoints:3},{fieldName:"improvedPolymorph",fancyName:"Improved Polymorph",location:{rowIdx:3,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneTactics",fancyName:"Arcane Tactics",location:{rowIdx:3,colIdx:1},spellIds:[82930],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"incantersAbsorption",fancyName:"Incanters Absorption",location:{rowIdx:3,colIdx:2},spellIds:[44394,44395],maxPoints:2},{fieldName:"improvedArcaneExplosion",fancyName:"Improved Arcane Explosion",location:{rowIdx:3,colIdx:3},spellIds:[90787,90788],maxPoints:2},{fieldName:"arcanePotency",fancyName:"Arcane Potency",location:{rowIdx:4,colIdx:0},spellIds:[31571,31572],maxPoints:2},{fieldName:"slow",fancyName:"Slow",location:{rowIdx:4,colIdx:1},spellIds:[31589],maxPoints:1},{fieldName:"netherVortex",fancyName:"Nether Vortex",location:{rowIdx:4,colIdx:2},spellIds:[86181,86209],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"focusMagic",fancyName:"Focus Magic",location:{rowIdx:5,colIdx:0},spellIds:[54646],maxPoints:1},{fieldName:"improvedManaGem",fancyName:"Improved Mana Gem",location:{rowIdx:5,colIdx:2},spellIds:[31584,31585,31586],maxPoints:2},{fieldName:"arcanePower?Spellmodifier=99064",fancyName:"Arcane Power?Spellmodifier=99064",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/851.jpg",talents:[{fieldName:"masterOfElements",fancyName:"Master Of Elements",location:{rowIdx:0,colIdx:0},spellIds:[29074,29075,29076],maxPoints:2},{fieldName:"burningSoul",fancyName:"Burning Soul",location:{rowIdx:0,colIdx:1},spellIds:[11083,84254,84253],maxPoints:3},{fieldName:"improvedFireBlast",fancyName:"Improved Fire Blast",location:{rowIdx:0,colIdx:2},spellIds:[11078,11080],maxPoints:2},{fieldName:"ignite",fancyName:"Ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846],maxPoints:3},{fieldName:"firePower",fancyName:"Fire Power",location:{rowIdx:1,colIdx:1},spellIds:[18459,18460,54734],maxPoints:3},{fieldName:"blazingSpeed",fancyName:"Blazing Speed",location:{rowIdx:1,colIdx:2},spellIds:[31641,31642],maxPoints:2},{fieldName:"impact",fancyName:"Impact",location:{rowIdx:1,colIdx:3},spellIds:[11103,12357,11242,12358,12467,12469],maxPoints:2},{fieldName:"cauterize",fancyName:"Cauterize",location:{rowIdx:2,colIdx:0},spellIds:[86948,86949],maxPoints:2},{fieldName:"blastWave",fancyName:"Blast Wave",location:{rowIdx:2,colIdx:1},spellIds:[11113],maxPoints:1},{fieldName:"hotStreak",fancyName:"Hot Streak",location:{rowIdx:2,colIdx:2},spellIds:[44445],maxPoints:1},{fieldName:"improvedScorch",fancyName:"Improved Scorch",location:{rowIdx:2,colIdx:3},spellIds:[11115,11367],maxPoints:2},{fieldName:"moltenShields",fancyName:"Molten Shields",location:{rowIdx:3,colIdx:0},spellIds:[11094],maxPoints:1},{fieldName:"combustion",fancyName:"Combustion",location:{rowIdx:3,colIdx:1},spellIds:[11129],maxPoints:1},{fieldName:"improvedHotStreak",fancyName:"Improved Hot Streak",location:{rowIdx:3,colIdx:2},spellIds:[44446,44448],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firestarter",fancyName:"Firestarter",location:{rowIdx:3,colIdx:3},spellIds:[86914],maxPoints:1},{fieldName:"improvedFlamestrike",fancyName:"Improved Flamestrike",location:{rowIdx:4,colIdx:0},spellIds:[84673,84674],maxPoints:2},{fieldName:"dragonsBreath",fancyName:"Dragons Breath",location:{rowIdx:4,colIdx:1},spellIds:[31661],maxPoints:1},{fieldName:"moltenFury",fancyName:"Molten Fury",location:{rowIdx:4,colIdx:2},spellIds:[31679,31680,86880],maxPoints:3},{fieldName:"pyromaniac",fancyName:"Pyromaniac",location:{rowIdx:5,colIdx:0},spellIds:[34293,34295,34296],maxPoints:2},{fieldName:"criticalMass",fancyName:"Critical Mass",location:{rowIdx:5,colIdx:2},spellIds:[11095,12873,12872],maxPoints:3},{fieldName:"livingBomb",fancyName:"Living Bomb",location:{rowIdx:6,colIdx:1},spellIds:[44457],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/823.jpg",talents:[{fieldName:"earlyFrost",fancyName:"Early Frost",location:{rowIdx:0,colIdx:0},spellIds:[83049,83050],maxPoints:2},{fieldName:"piercingIce",fancyName:"Piercing Ice",location:{rowIdx:0,colIdx:1},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"shatter",fancyName:"Shatter",location:{rowIdx:0,colIdx:2},spellIds:[11170,12982,12983,44745,54787],maxPoints:2},{fieldName:"iceFloes",fancyName:"Ice Floes",location:{rowIdx:1,colIdx:0},spellIds:[31670,31672,55094],maxPoints:3},{fieldName:"improvedConeOfCold",fancyName:"Improved Cone Of Cold",location:{rowIdx:1,colIdx:1},spellIds:[11190,12489],maxPoints:2},{fieldName:"piercingChill",fancyName:"Piercing Chill",location:{rowIdx:1,colIdx:2},spellIds:[83156,83157],maxPoints:2},{fieldName:"permafrost",fancyName:"Permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"iceShards",fancyName:"Ice Shards",location:{rowIdx:2,colIdx:0},spellIds:[11185,12487],maxPoints:2},{fieldName:"icyVeins",fancyName:"Icy Veins",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"fingersOfFrost",fancyName:"Fingers Of Frost",location:{rowIdx:2,colIdx:2},spellIds:[44543,44545,83074],maxPoints:3},{fieldName:"improvedFreeze",fancyName:"Improved Freeze",location:{rowIdx:2,colIdx:3},spellIds:[86259,86260,86314],maxPoints:3,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"enduringWinter",fancyName:"Enduring Winter",location:{rowIdx:3,colIdx:0},spellIds:[44561,86500,86508],maxPoints:3},{fieldName:"coldSnap",fancyName:"Cold Snap",location:{rowIdx:3,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"brainFreeze",fancyName:"Brain Freeze",location:{rowIdx:3,colIdx:2},spellIds:[44546,44548,44549],maxPoints:3},{fieldName:"shatteredBarrier",fancyName:"Shattered Barrier",location:{rowIdx:4,colIdx:0},spellIds:[44745,54787],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"iceBarrier?Spellmodifier=63095",fancyName:"Ice Barrier?Spellmodifier=63095",location:{rowIdx:4,colIdx:1},spellIds:[11426],maxPoints:1},{fieldName:"reactiveBarrier",fancyName:"Reactive Barrier",location:{rowIdx:4,colIdx:2},spellIds:[86303,86304],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"frostfireOrb",fancyName:"Frostfire Orb",location:{rowIdx:5,colIdx:2},spellIds:[84726,84727],maxPoints:2},{fieldName:"deepFreeze?Spellmodifier=11151%2C12952%2C12953%2C31674%2C31675%2C31676%2C31677%2C31678",fancyName:"Deep Freeze?Spellmodifier=11151%2C12952%2C12953%2C31674%2C31675%2C31676%2C31677%2C31678",location:{rowIdx:6,colIdx:1},spellIds:[44572],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Nl={primeGlyphs:{[K.GlyphOfArcaneBarrage]:{name:"Glyph of Arcane Barrage",description:"Increases the damage of your Arcane Barrage spell by 4%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_arcanebarrage.jpg"},[K.GlyphOfArcaneBlast]:{name:"Glyph of Arcane Blast",description:"Increases the damage from your Arcane Blast buff by 3%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blast.jpg"},[K.GlyphOfArcaneMissiles]:{name:"Glyph of Arcane Missiles",description:"Increases the critical strike chance of your Arcane Missiles spell by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg"},[K.GlyphOfConeOfCold]:{name:"Glyph of Cone of Cold",description:"Increases the damage of your Cone of Cold spell by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_glacier.jpg"},[K.GlyphOfDeepFreeze]:{name:"Glyph of Deep Freeze",description:"Your Deep Freeze deals 20% additional damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_deepfreeze.jpg"},[K.GlyphOfFireball]:{name:"Glyph of Fireball",description:"Increases the critical strike chance of your Fireball spell by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_flamebolt.jpg"},[K.GlyphOfFrostbolt]:{name:"Glyph of Frostbolt",description:"Increases the critical strike chance of your Frostbolt spell by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostbolt02.jpg"},[K.GlyphOfFrostfire]:{name:"Glyph of Frostfire",description:"Increases the damage done by your Frostfire Bolt by 15% and your Frostfire Bolt now deals 3% additional damage over 12 sec, stacking up to 3 times, but no longer reduces the victim's movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_frostfirebolt.jpg"},[K.GlyphOfIceLance]:{name:"Glyph of Ice Lance",description:"Increases the damage of your Ice Lance spell by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostblast.jpg"},[K.GlyphOfLivingBomb]:{name:"Glyph of Living Bomb",description:"Increases the damage of your Living Bomb spell by 3%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_livingbomb.jpg"},[K.GlyphOfMageArmor]:{name:"Glyph of Mage Armor",description:"Your Mage Armor regenerates 20% more mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magearmor.jpg"},[K.GlyphOfMoltenArmor]:{name:"Glyph of Molten Armor",description:"Your Molten Armor grants an additional 2% spell critical strike chance.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_moltenarmor.jpg"},[K.GlyphOfPyroblast]:{name:"Glyph of Pyroblast",description:"Increases the critical strike chance of your Pyroblast spell by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball02.jpg"}},majorGlyphs:{[$.GlyphOfArcanePower]:{name:"Glyph of Arcane Power",description:"While Arcane Power is active the global cooldown of your Blink, Mana Shield, and Mirror Image is reduced to zero.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[$.GlyphOfBlastWave]:{name:"Glyph of Blast Wave",description:"Increases the duration of Blast Wave's slowing effect by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg"},[$.GlyphOfBlink]:{name:"Glyph of Blink",description:"Increases the distance you travel with the Blink spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[$.GlyphOfDragonSBreath]:{name:"Glyph of Dragon's Breath",description:"Reduces the cooldown of your Dragon's Breath by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_head_dragon_01.jpg"},[$.GlyphOfEvocation]:{name:"Glyph of Evocation",description:"Your Evocation ability also causes you to regain 40% of your health over its duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg"},[$.GlyphOfFrostArmor]:{name:"Glyph of Frost Armor",description:"Your Frost Armor also causes you to regenerate 2% of your maximum mana every 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg"},[$.GlyphOfFrostNova]:{name:"Glyph of Frost Nova",description:"Your Frost Nova targets can take an additional 20% damage before the Frost Nova effect automatically breaks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg"},[$.GlyphOfIceBarrier]:{name:"Glyph of Ice Barrier",description:"Increases the amount of damage absorbed by your Ice Barrier by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_ice_lament.jpg"},[$.GlyphOfIceBlock]:{name:"Glyph of Ice Block",description:"Your Frost Nova cooldown is now reset every time you use Ice Block.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frost.jpg"},[$.GlyphOfIcyVeins]:{name:"Glyph of Icy Veins",description:"Your Icy Veins ability also removes all movement slowing and cast time slowing effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_coldhearted.jpg"},[$.GlyphOfInvisibility]:{name:"Glyph of Invisibility",description:"Increases your movement speed while Invisible by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_invisibility.jpg"},[$.GlyphOfManaShield]:{name:"Glyph of Mana Shield",description:"Reduces the cooldown of your Mana Shield by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_detectlesserinvisibility.jpg"},[$.GlyphOfPolymorph]:{name:"Glyph of Polymorph",description:"Your Polymorph spell also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_polymorph.jpg"},[$.GlyphOfSlow]:{name:"Glyph of Slow",description:"Increases the range of your Slow spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"}},minorGlyphs:{[Y.GlyphOfArcaneBrilliance]:{name:"Glyph of Arcane Brilliance",description:"Reduces the mana cost of your Arcane Brilliance spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_magicalsentry.jpg"},[Y.GlyphOfArmors]:{name:"Glyph of Armors",description:"Increases the duration of your Armor spells by 30 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chillingarmor.jpg"},[Y.GlyphOfConjuring]:{name:"Glyph of Conjuring",description:"Reduces the mana cost of your Conjuring spells by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_conjurefoodrank9.jpg"},[Y.GlyphOfMirrorImage]:{name:"Glyph of Mirror Image",description:"Your Mirror Images cast Arcane Blast or Fireball instead of Frostbolt depending on your primary talent tree.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[Y.GlyphOfSlowFall]:{name:"Glyph of Slow Fall",description:"Your Slow Fall spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_featherfall.jpg"},[Y.GlyphOfTheMonkey]:{name:"Glyph of the Monkey",description:"Your Polymorph: Sheep spell polymorphs the target into a monkey instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectofthemonkey.jpg"},[Y.GlyphOfThePenguin]:{name:"Glyph of the Penguin",description:"Your Polymorph: Sheep spell polymorphs the target into a penguin instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_penguinpet.jpg"}}},_l=bl([{name:"Monk",backgroundUrl:"https://wow.zamimg.com/images/tools/dragonflight-talent-calc/blizzard/talentbg-monk-windwalker.jpg",talents:[{fieldName:"celerity",fancyName:"Celerity",location:{rowIdx:0,colIdx:0},spellIds:[115173],maxPoints:1},{fieldName:"tigersLust",fancyName:"Tiger's Lust",location:{rowIdx:0,colIdx:1},spellIds:[116841],maxPoints:1},{fieldName:"momentum",fancyName:"Momentum",location:{rowIdx:0,colIdx:2},spellIds:[115174],maxPoints:1},{fieldName:"chiWave",fancyName:"Chi Wave",location:{rowIdx:1,colIdx:0},spellIds:[115098],maxPoints:1},{fieldName:"zenSphere",fancyName:"Zen Sphere",location:{rowIdx:1,colIdx:1},spellIds:[124081],maxPoints:1},{fieldName:"chiBurst",fancyName:"Chi Burst",location:{rowIdx:1,colIdx:2},spellIds:[123986],maxPoints:1},{fieldName:"powerStrikes",fancyName:"Power Strikes",location:{rowIdx:2,colIdx:0},spellIds:[121817],maxPoints:1},{fieldName:"ascension",fancyName:"Ascension",location:{rowIdx:2,colIdx:1},spellIds:[115396],maxPoints:1},{fieldName:"chiBrew",fancyName:"Chi Brew",location:{rowIdx:2,colIdx:2},spellIds:[115399],maxPoints:1},{fieldName:"ringOfPeace",fancyName:"Ring of Peace",location:{rowIdx:3,colIdx:0},spellIds:[116844],maxPoints:1},{fieldName:"chargingOxWave",fancyName:"Charging Ox Wave",location:{rowIdx:3,colIdx:1},spellIds:[119392],maxPoints:1},{fieldName:"legSweep",fancyName:"Leg Sweep",location:{rowIdx:3,colIdx:2},spellIds:[119381],maxPoints:1},{fieldName:"healingElixirs",fancyName:"Healing Elixirs",location:{rowIdx:4,colIdx:0},spellIds:[122280],maxPoints:1},{fieldName:"dampenHarm",fancyName:"Dampen Harm",location:{rowIdx:4,colIdx:1},spellIds:[122278],maxPoints:1},{fieldName:"diffuseMagic",fancyName:"Diffuse Magic",location:{rowIdx:4,colIdx:2},spellIds:[122783],maxPoints:1},{fieldName:"rushingJadeWind",fancyName:"Rushing Jade Wind",location:{rowIdx:5,colIdx:0},spellIds:[116847],maxPoints:1},{fieldName:"invokeXuen",fancyName:"Invoke Xuen, the White Tiger",location:{rowIdx:5,colIdx:1},spellIds:[123904],maxPoints:1},{fieldName:"chiTorpedo",fancyName:"Chi Torpedo",location:{rowIdx:5,colIdx:2},spellIds:[115008],maxPoints:1}]}]),Tl={primeGlyphs:{},majorGlyphs:{[J.MonkMajorGlyphAfterlife]:{name:"Glyph of Afterlife",description:"Increases the chance to summon a Healing Sphere when you kill an enemy while gaining experience or honor by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_finalprayer.jpg"},[J.MonkMajorGlyphNimbleBrew]:{name:"Glyph of Nimble Brew",description:"Clearing an effect with Nimble Brew heals you for 10% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_monk_nimblebrew.jpg"},[J.MonkMajorGlyphEnduringHealingSphere]:{name:"Glyph of Enduring Healing Sphere",description:"Increases the duration of your Healing Spheres by 3 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[J.MonkMajorGlyphFistsOfFury]:{name:"Glyph of Fists of Fury",description:"When channeling Fists of Fury, your parry chance is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_fistoffury.jpg"},[J.MonkMajorGlyphFortifyingBrew]:{name:"Glyph of Fortifying Brew",description:"Your Fortifying Brew reduces damage taken by an additional 5%, but increases your health by 10% rather than 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_fortifyingale_new.jpg"},[J.MonkMajorGlyphFortuitousSpheres]:{name:"Glyph of Fortuitous Spheres",description:"Falling below 25% health will automatically summon a healing sphere near you at no cost. This effect cannot occur more often than once every 30 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[J.MonkMajorGlyphSparring]:{name:"Glyph of Sparring",description:"While Sparring, you also have a 5% chance to deflect spells from attackers in front of you, stacking up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_sparring.jpg"},[J.MonkMajorGlyphSpinningCraneKick]:{name:"Glyph of Spinning Crane Kick",description:"You move at full speed while channeling Spinning Crane Kick.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cranekick_new.jpg"},[J.MonkMajorGlyphDetox]:{name:"Glyph of Detox",description:"Detox heals your target for 5% when it successfully removes a harmful effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[J.MonkMajorGlyphTouchOfDeath]:{name:"Glyph of Touch of Death",description:"Your Touch of Death no longer has a Chi cost, but the cooldown is increased by 2 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofdeath.jpg"},[J.MonkMajorGlyphTouchOfKarma]:{name:"Glyph of Touch of Karma",description:"Your Touch of Karma now has a 20 yard range.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofkarma.jpg"},[J.MonkMajorGlyphTranscendence]:{name:"Glyph of Transcendence",description:"Increases the range of your Transcendence: Transfer spell by 10 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_transcendence.jpg"},[J.MonkMajorGlyphZenMeditation]:{name:"Glyph of Zen Meditation",description:"You can now channel Zen Meditation while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenmeditation.jpg"}},minorGlyphs:{[Z.MonkMinorGlyphBlackoutKick]:{name:"Glyph of Blackout Kick",description:"Your Blackout Kick always deals 20% additional damage over 4 sec regardless of positioning but you're unable to trigger the healing effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_blackoutkick.jpg"},[Z.MonkMinorGlyphCracklingTigerLightning]:{name:"Glyph of Crackling Tiger Lightning",description:"Your Crackling Jade Lightning visual is altered to the color of the White Tiger celestial.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cracklingjadelightning.jpg"},[Z.MonkMinorGlyphFightingPose]:{name:"Glyph of Fighting Pose",description:"Your spirit now appears in a fighting pose when using Transcendence.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_dpsstance.jpg"},[Z.MonkMinorGlyphFlyingSerpentKick]:{name:"Glyph of Flying Serpent Kick",description:"Your Flying Serpent Kick automatically ends when you fly into an enemy, triggering the area of effect damage and snare.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_flyingdragonkick.jpg"},[Z.MonkMinorGlyphHonor]:{name:"Glyph of Honor",description:"You honorably bow after each successful Touch of Death.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/pandarenracial_innerpeace.jpg"},[Z.MonkMinorGlyphJab]:{name:"Glyph of Jab",description:"You always will attack with hands and fist with Jab, even with non-fist weapons equipped.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_jab.jpg"},[Z.MonkMinorGlyphRisingTigerKick]:{name:"Glyph of Rising Tiger Kick",description:"Your Rising Sun Kick's visual is altered to the color of the White Tiger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_risingsunkick.jpg"},[Z.MonkMinorGlyphSpinningFireBlossom]:{name:"Glyph of Spinning Fire Blossom",description:"Your Spinning Fire Blossom requires an enemy target rather than traveling in front of you, but is no longer capable of rooting targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_explodingjadeblossom.jpg"},[Z.MonkMinorGlyphSpiritRoll]:{name:"Glyph of Spirit Roll",description:"You can cast Roll or Chi Torpedo while dead as a spirit.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg"},[Z.MonkMinorGlyphWaterRoll]:{name:"Glyph of Water Roll",description:"You can Roll or Chi Torpedo over water",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_roll.jpg"},[Z.MonkMinorGlyphZenFlight]:{name:"Glyph of Zen Flight",description:"Teaches you the spell Zen Flight. Zen Flight requires a Flight Master's License in order to be cast.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenflight.jpg"}}},Rl=bl([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/831.jpg",talents:[{fieldName:"arbiterOfTheLight",fancyName:"Arbiter Of The Light",location:{rowIdx:0,colIdx:0},spellIds:[20359,20360],maxPoints:2},{fieldName:"protectorOfTheInnocent",fancyName:"Protector Of The Innocent",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140],maxPoints:3},{fieldName:"judgementsOfThePure",fancyName:"Judgements Of The Pure",location:{rowIdx:0,colIdx:2},spellIds:[53671,53673,54151],maxPoints:3},{fieldName:"clarityOfPurpose",fancyName:"Clarity Of Purpose",location:{rowIdx:1,colIdx:0},spellIds:[85462,85463,85464],maxPoints:3},{fieldName:"lastWord",fancyName:"Last Word",location:{rowIdx:1,colIdx:1},spellIds:[20234,20235],maxPoints:2},{fieldName:"blazingLight",fancyName:"Blazing Light",location:{rowIdx:1,colIdx:2},spellIds:[20237,20238],maxPoints:2},{fieldName:"denounce",fancyName:"Denounce",location:{rowIdx:2,colIdx:0},spellIds:[31825,85510],maxPoints:2},{fieldName:"divineFavor",fancyName:"Divine Favor",location:{rowIdx:2,colIdx:1},spellIds:[31842],maxPoints:1},{fieldName:"infusionOfLight",fancyName:"Infusion Of Light",location:{rowIdx:2,colIdx:2},spellIds:[53569,53576],maxPoints:2},{fieldName:"daybreak",fancyName:"Daybreak",location:{rowIdx:2,colIdx:3},spellIds:[88820,88821],maxPoints:2},{fieldName:"enlightenedJudgements",fancyName:"Enlightened Judgements",location:{rowIdx:3,colIdx:0},spellIds:[53556,53557],maxPoints:2},{fieldName:"beaconOfLight",fancyName:"Beacon Of Light",location:{rowIdx:3,colIdx:1},spellIds:[53563],maxPoints:1},{fieldName:"speedOfLight",fancyName:"Speed Of Light",location:{rowIdx:3,colIdx:2},spellIds:[85495,85498,85499],maxPoints:3,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"sacredCleansing",fancyName:"Sacred Cleansing",location:{rowIdx:3,colIdx:3},spellIds:[53551],maxPoints:1},{fieldName:"conviction",fancyName:"Conviction",location:{rowIdx:4,colIdx:0},spellIds:[20049,20056,20057],maxPoints:3},{fieldName:"auraMastery",fancyName:"Aura Mastery",location:{rowIdx:4,colIdx:2},spellIds:[31821],maxPoints:1},{fieldName:"paragonOfVirtue",fancyName:"Paragon Of Virtue",location:{rowIdx:4,colIdx:3},spellIds:[93418,93417],maxPoints:2},{fieldName:"towerOfRadiance",fancyName:"Tower Of Radiance",location:{rowIdx:5,colIdx:1},spellIds:[84800,85511,85512],maxPoints:3,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"blessedLife",fancyName:"Blessed Life",location:{rowIdx:5,colIdx:2},spellIds:[31828,31829],maxPoints:2},{fieldName:"lightOfDawn",fancyName:"Light Of Dawn",location:{rowIdx:6,colIdx:1},spellIds:[85222],maxPoints:1}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/839.jpg",talents:[{fieldName:"divinity",fancyName:"Divinity",location:{rowIdx:0,colIdx:0},spellIds:[63646,63647,63648],maxPoints:3},{fieldName:"sealsOfThePure",fancyName:"Seals Of The Pure",location:{rowIdx:0,colIdx:1},spellIds:[20224,20225],maxPoints:2},{fieldName:"eternalGlory",fancyName:"Eternal Glory",location:{rowIdx:0,colIdx:2},spellIds:[87163,87164],maxPoints:2},{fieldName:"judgementsOfTheJust",fancyName:"Judgements Of The Just",location:{rowIdx:1,colIdx:0},spellIds:[53695,53696],maxPoints:2},{fieldName:"toughness",fancyName:"Toughness",location:{rowIdx:1,colIdx:1},spellIds:[20143,20145,20144],maxPoints:3},{fieldName:"improvedHammerOfJustice",fancyName:"Improved Hammer Of Justice",location:{rowIdx:1,colIdx:2},spellIds:[20487,20488],maxPoints:2},{fieldName:"hallowedGround",fancyName:"Hallowed Ground",location:{rowIdx:2,colIdx:0},spellIds:[84631,84633],maxPoints:2},{fieldName:"sanctuary",fancyName:"Sanctuary",location:{rowIdx:2,colIdx:1},spellIds:[20911,84628,84629],maxPoints:3},{fieldName:"hammerOfTheRighteous",fancyName:"Hammer Of The Righteous",location:{rowIdx:2,colIdx:2},spellIds:[53595],maxPoints:1},{fieldName:"wrathOfTheLightbringer",fancyName:"Wrath Of The Lightbringer",location:{rowIdx:2,colIdx:3},spellIds:[84635,84636],maxPoints:2},{fieldName:"reckoning",fancyName:"Reckoning",location:{rowIdx:3,colIdx:0},spellIds:[20177,20179],maxPoints:2},{fieldName:"shieldOfTheRighteous",fancyName:"Shield Of The Righteous",location:{rowIdx:3,colIdx:1},spellIds:[53600],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"grandCrusader",fancyName:"Grand Crusader",location:{rowIdx:3,colIdx:2},spellIds:[75806,85043],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"vindication",fancyName:"Vindication",location:{rowIdx:4,colIdx:0},spellIds:[26016],maxPoints:1},{fieldName:"holyShield",fancyName:"Holy Shield",location:{rowIdx:4,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"guardedByTheLight",fancyName:"Guarded By The Light",location:{rowIdx:4,colIdx:2},spellIds:[85639,85646],maxPoints:2},{fieldName:"divineGuardian",fancyName:"Divine Guardian",location:{rowIdx:4,colIdx:3},spellIds:[70940],maxPoints:1},{fieldName:"sacredDuty",fancyName:"Sacred Duty",location:{rowIdx:5,colIdx:1},spellIds:[53709,53710],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"shieldOfTheTemplar",fancyName:"Shield Of The Templar",location:{rowIdx:5,colIdx:2},spellIds:[31848,31849,84854],maxPoints:3},{fieldName:"ardentDefender",fancyName:"Ardent Defender",location:{rowIdx:6,colIdx:1},spellIds:[31850],maxPoints:1}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/855.jpg",talents:[{fieldName:"eyeForAnEye",fancyName:"Eye For An Eye",location:{rowIdx:0,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"crusade",fancyName:"Crusade",location:{rowIdx:0,colIdx:1},spellIds:[31866,31867,31868],maxPoints:3},{fieldName:"improvedJudgement",fancyName:"Improved Judgement",location:{rowIdx:0,colIdx:2},spellIds:[87174,87175],maxPoints:2},{fieldName:"guardiansFavor",fancyName:"Guardians Favor",location:{rowIdx:1,colIdx:0},spellIds:[20174,20175],maxPoints:2},{fieldName:"ruleOfLaw",fancyName:"Rule Of Law",location:{rowIdx:1,colIdx:1},spellIds:[85457,85458,87461],maxPoints:3},{fieldName:"pursuitOfJustice",fancyName:"Pursuit Of Justice",location:{rowIdx:1,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"communion",fancyName:"Communion",location:{rowIdx:2,colIdx:0},spellIds:[31876],maxPoints:1},{fieldName:"theArtOfWar",fancyName:"The Art Of War",location:{rowIdx:2,colIdx:1},spellIds:[53486,53488,87138],maxPoints:3},{fieldName:"longArmOfTheLaw",fancyName:"Long Arm Of The Law",location:{rowIdx:2,colIdx:2},spellIds:[87168,87172],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"divineStorm",fancyName:"Divine Storm",location:{rowIdx:2,colIdx:3},spellIds:[53385],maxPoints:1},{fieldName:"sacredShield",fancyName:"Sacred Shield",location:{rowIdx:3,colIdx:0},spellIds:[85285],maxPoints:1},{fieldName:"sanctityOfBattle",fancyName:"Sanctity Of Battle",location:{rowIdx:3,colIdx:1},spellIds:[25956],maxPoints:1},{fieldName:"sealsOfCommand",fancyName:"Seals Of Command",location:{rowIdx:3,colIdx:2},spellIds:[85126],maxPoints:1},{fieldName:"sanctifiedWrath",fancyName:"Sanctified Wrath",location:{rowIdx:3,colIdx:3},spellIds:[53375,90286,53376],maxPoints:3},{fieldName:"selflessHealer",fancyName:"Selfless Healer",location:{rowIdx:4,colIdx:0},spellIds:[85803,85804],maxPoints:2},{fieldName:"repentance",fancyName:"Repentance",location:{rowIdx:4,colIdx:1},spellIds:[20066],maxPoints:1},{fieldName:"divinePurpose",fancyName:"Divine Purpose",location:{rowIdx:4,colIdx:2},spellIds:[85117,86172],maxPoints:2},{fieldName:"inquiryOfFaith",fancyName:"Inquiry Of Faith",location:{rowIdx:5,colIdx:1},spellIds:[53380,53381,53382],maxPoints:3},{fieldName:"actsOfSacrifice",fancyName:"Acts Of Sacrifice",location:{rowIdx:5,colIdx:2},spellIds:[85446,85795],maxPoints:2},{fieldName:"zealotry",fancyName:"Zealotry",location:{rowIdx:6,colIdx:1},spellIds:[85696],maxPoints:1}]}]),Dl={primeGlyphs:{[Q.GlyphOfCrusaderStrike]:{name:"Glyph of Crusader Strike",description:"Increases the critical strike chance of Crusader Strike by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderstrike.jpg"},[Q.GlyphOfDivineFavor]:{name:"Glyph of Divine Favor",description:"Increases the duration of Divine Favor by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineillumination.jpg"},[Q.GlyphOfExorcism]:{name:"Glyph of Exorcism",description:"Your Exorcism causes an additional 20% of its damage over 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg"},[Q.GlyphOfHammerOfTheRighteous]:{name:"Glyph of Hammer of the Righteous",description:"Increases the damage of both the physical and Holy components of Hammer of the Righteous by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_hammeroftherighteous.jpg"},[Q.GlyphOfHolyShock]:{name:"Glyph of Holy Shock",description:"Increases the critical effect chance of Holy Shock by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg"},[Q.GlyphOfJudgement]:{name:"Glyph of Judgement",description:"Your Judgement deals 10% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousfury.jpg"},[Q.GlyphOfSealOfInsight]:{name:"Glyph of Seal of Insight",description:"While Seal of Insight is active, the effect of your healing spells is increased by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg"},[Q.GlyphOfSealOfTruth]:{name:"Glyph of Seal of Truth",description:"Your Seal of Truth and Seal of Righteousness also grant 10 expertise while active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"},[Q.GlyphOfShieldOfTheRighteous]:{name:"Glyph of Shield of the Righteous",description:"Increases the damage of Shield of the Righteous by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_shieldofvengeance.jpg"},[Q.GlyphOfTemplarSVerdict]:{name:"Glyph of Templar's Verdict",description:"Increases the damage of Templar's Verdict by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_templarsverdict.jpg"},[Q.GlyphOfWordOfGlory]:{name:"Glyph of Word of Glory",description:"Increases the healing done by Word of Glory by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"}},majorGlyphs:{[X.GlyphOfBeaconOfLight]:{name:"Glyph of Beacon of Light",description:"Your Beacon of Light costs no mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_beaconoflight.jpg"},[X.GlyphOfCleansing]:{name:"Glyph of Cleansing",description:"Reduces the mana cost of your Cleanse by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_purify.jpg"},[X.GlyphOfConsecration]:{name:"Glyph of Consecration",description:"Increases the duration and cooldown of Consecration by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[X.GlyphOfDazingShield]:{name:"Glyph of Dazing Shield",description:"Your Avenger's Shield now also dazes targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[X.GlyphOfDivinePlea]:{name:"Glyph of Divine Plea",description:"Your Divine Plea provides an additional 6% of your total mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_aspiration.jpg"},[X.GlyphOfDivineProtection]:{name:"Glyph of Divine Protection",description:"Removes the physical damage reduction of your Divine Protection, but increases the magical damage reduction by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineprotection.jpg"},[X.GlyphOfDivinity]:{name:"Glyph of Divinity",description:"When you use Lay on Hands, you also gain 10% of your maximum mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg"},[X.GlyphOfFocusedShield]:{name:"Glyph of Focused Shield",description:"Your Avenger's Shield hits 2 fewer targets, but for 30% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[X.GlyphOfHammerOfJustice]:{name:"Glyph of Hammer of Justice",description:"Increases your Hammer of Justice range by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofmight.jpg"},[X.GlyphOfHammerOfWrath]:{name:"Glyph of Hammer of Wrath",description:"Reduces the mana cost of Hammer of Wrath by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_hammer_04.jpg"},[X.GlyphOfHolyWrath]:{name:"Glyph of Holy Wrath",description:"Your Holy Wrath now also stuns Elementals and Dragonkin.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_purifyingpower.jpg"},[X.GlyphOfLayOnHands]:{name:"Glyph of Lay on Hands",description:"Reduces the cooldown of your Lay on Hands spell by 3 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg"},[X.GlyphOfLightOfDawn]:{name:"Glyph of Light of Dawn",description:"Light of Dawn affects 2 fewer targets, but heals each target for 25% more.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_lightofdawn.jpg"},[X.GlyphOfRebuke]:{name:"Glyph of Rebuke",description:"Reduces the mana cost of Rebuke by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_rebuke.jpg"},[X.GlyphOfReckoning]:{name:"Glyph of Reckoning",description:"Your Hand of Reckoning spell no longer taunts the target and can deal damage to untauntable targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg"},[X.GlyphOfSalvation]:{name:"Glyph of Salvation",description:"Hand of Salvation no longer permanently reduces threat over time but instead reduces all threat as long as Hand of Salvation lasts.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsalvation.jpg"},[X.GlyphOfTheAsceticCrusader]:{name:"Glyph of the Ascetic Crusader",description:"Reduces the mana cost of your Crusader Strike by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderstrike.jpg"},[X.GlyphOfTheLongWord]:{name:"Glyph of the Long Word",description:"Your Word of Glory heals for 50% less up front, but provides an additional 50% healing over 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"},[X.GlyphOfTurnEvil]:{name:"Glyph of Turn Evil",description:"Reduces the casting time of your Turn Evil spell by 100%, but increases the cooldown by 8 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_turnundead.jpg"}},minorGlyphs:{[ee.GlyphOfBlessingOfKings]:{name:"Glyph of Blessing of Kings",description:"Reduces the mana cost of Blessing of Kings by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_magearmor.jpg"},[ee.GlyphOfBlessingOfMight]:{name:"Glyph of Blessing of Might",description:"Reduces the mana cost of your Blessing of Might by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_greaterblessingofkings.jpg"},[ee.GlyphOfInsight]:{name:"Glyph of Insight",description:"Reduces the mana cost of Seal of Insight by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg"},[ee.GlyphOfJustice]:{name:"Glyph of Justice",description:"Reduces the mana cost of Seal of Justice by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofwrath.jpg"},[ee.GlyphOfRighteousness]:{name:"Glyph of Righteousness",description:"Reduces the mana cost of Seal of Righteousness by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg"},[ee.GlyphOfTruth]:{name:"Glyph of Truth",description:"Reduces the mana cost of Seal of Truth by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"}}},Gl=bl([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/760.jpg",talents:[{fieldName:"improvedPowerWordShield",fancyName:"Improved Power Word Shield",location:{rowIdx:0,colIdx:0},spellIds:[14748,14768],maxPoints:2},{fieldName:"twinDisciplines",fancyName:"Twin Disciplines",location:{rowIdx:0,colIdx:1},spellIds:[47586,47587,47588],maxPoints:3},{fieldName:"mentalAgility",fancyName:"Mental Agility",location:{rowIdx:0,colIdx:2},spellIds:[14520,14780,14781],maxPoints:3},{fieldName:"evangelism",fancyName:"Evangelism",location:{rowIdx:1,colIdx:0},spellIds:[81659,81662],maxPoints:2},{fieldName:"archangel",fancyName:"Archangel",location:{rowIdx:1,colIdx:1},spellIds:[87151],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"innerSanctum",fancyName:"Inner Sanctum",location:{rowIdx:1,colIdx:2},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"soulWarding",fancyName:"Soul Warding",location:{rowIdx:1,colIdx:3},spellIds:[63574,78500,78501],maxPoints:2},{fieldName:"renewedHope",fancyName:"Renewed Hope",location:{rowIdx:2,colIdx:0},spellIds:[57470,57472],maxPoints:2},{fieldName:"powerInfusion",fancyName:"Power Infusion",location:{rowIdx:2,colIdx:1},spellIds:[10060],maxPoints:1},{fieldName:"atonement",fancyName:"Atonement",location:{rowIdx:2,colIdx:2},spellIds:[14523,81749],maxPoints:2},{fieldName:"innerFocus",fancyName:"Inner Focus",location:{rowIdx:2,colIdx:3},spellIds:[89485],maxPoints:1},{fieldName:"rapture",fancyName:"Rapture",location:{rowIdx:3,colIdx:1},spellIds:[47535,47536,47537],maxPoints:3},{fieldName:"borrowedTime",fancyName:"Borrowed Time",location:{rowIdx:3,colIdx:2},spellIds:[52795,52797,52798],maxPoints:2},{fieldName:"reflectiveShield",fancyName:"Reflective Shield",location:{rowIdx:3,colIdx:3},spellIds:[33201,33202],maxPoints:2},{fieldName:"strengthOfSoul",fancyName:"Strength Of Soul",location:{rowIdx:4,colIdx:0},spellIds:[89488,89489],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"divineAegis",fancyName:"Divine Aegis",location:{rowIdx:4,colIdx:1},spellIds:[47509,47511,47515],maxPoints:3},{fieldName:"painSuppression",fancyName:"Pain Suppression",location:{rowIdx:4,colIdx:2},spellIds:[33206],maxPoints:1},{fieldName:"trainOfThought",fancyName:"Train Of Thought",location:{rowIdx:4,colIdx:3},spellIds:[92295,92297],maxPoints:2},{fieldName:"focusedWill",fancyName:"Focused Will",location:{rowIdx:5,colIdx:0},spellIds:[45234,45243],maxPoints:2},{fieldName:"grace",fancyName:"Grace",location:{rowIdx:5,colIdx:2},spellIds:[47516,47517],maxPoints:2},{fieldName:"powerWordBarrier",fancyName:"Power Word Barrier",location:{rowIdx:6,colIdx:1},spellIds:[62618],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/813.jpg",talents:[{fieldName:"improvedRenew",fancyName:"Improved Renew",location:{rowIdx:0,colIdx:0},spellIds:[14908,15020],maxPoints:2},{fieldName:"empoweredHealing",fancyName:"Empowered Healing",location:{rowIdx:0,colIdx:1},spellIds:[33158,33159,33160],maxPoints:3},{fieldName:"divineFury",fancyName:"Divine Fury",location:{rowIdx:0,colIdx:2},spellIds:[18530,18531,18533],maxPoints:3},{fieldName:"desperatePrayer",fancyName:"Desperate Prayer",location:{rowIdx:1,colIdx:1},spellIds:[19236],maxPoints:1},{fieldName:"surgeOfLight",fancyName:"Surge Of Light",location:{rowIdx:1,colIdx:2},spellIds:[88687,88690],maxPoints:2},{fieldName:"inspiration",fancyName:"Inspiration",location:{rowIdx:1,colIdx:3},spellIds:[14892,15362],maxPoints:2},{fieldName:"divineTouch",fancyName:"Divine Touch",location:{rowIdx:2,colIdx:0},spellIds:[63534,63542],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:0}},{fieldName:"holyConcentration",fancyName:"Holy Concentration",location:{rowIdx:2,colIdx:1},spellIds:[34753,34859],maxPoints:2},{fieldName:"lightwell?spellModifier=47586%2C47587%2C47588",fancyName:"Lightwell?Spellmodifier=47586%2C47587%2C47588",location:{rowIdx:2,colIdx:2},spellIds:[724],maxPoints:1},{fieldName:"tomeOfLight",fancyName:"Tome Of Light",location:{rowIdx:2,colIdx:3},spellIds:[14898,81625],maxPoints:2},{fieldName:"rapidRenewal",fancyName:"Rapid Renewal",location:{rowIdx:3,colIdx:0},spellIds:[95649],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"spiritOfRedemption",fancyName:"Spirit Of Redemption",location:{rowIdx:3,colIdx:2},spellIds:[20711],maxPoints:1},{fieldName:"serendipity",fancyName:"Serendipity",location:{rowIdx:3,colIdx:3},spellIds:[63730,63733],maxPoints:2},{fieldName:"bodyAndSoul",fancyName:"Body And Soul",location:{rowIdx:4,colIdx:0},spellIds:[64127,64129],maxPoints:2},{fieldName:"chakra",fancyName:"Chakra",location:{rowIdx:4,colIdx:1},spellIds:[14751],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"revelations",fancyName:"Revelations",location:{rowIdx:4,colIdx:2},spellIds:[88627],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"blessedResilience",fancyName:"Blessed Resilience",location:{rowIdx:4,colIdx:3},spellIds:[33142,33145],maxPoints:2},{fieldName:"testOfFaith",fancyName:"Test Of Faith",location:{rowIdx:5,colIdx:0},spellIds:[47558,47559,47560],maxPoints:3},{fieldName:"heavenlyVoice",fancyName:"Heavenly Voice",location:{rowIdx:5,colIdx:1},spellIds:[87430,87431],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"circleOfHealing",fancyName:"Circle Of Healing",location:{rowIdx:5,colIdx:2},spellIds:[34861],maxPoints:1},{fieldName:"guardianSpirit",fancyName:"Guardian Spirit",location:{rowIdx:6,colIdx:1},spellIds:[47788],maxPoints:1}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/795.jpg",talents:[{fieldName:"darkness",fancyName:"Darkness",location:{rowIdx:0,colIdx:0},spellIds:[15259,15307,15308],maxPoints:3},{fieldName:"improvedShadowWordPain",fancyName:"Improved Shadow Word Pain",location:{rowIdx:0,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"veiledShadows",fancyName:"Veiled Shadows",location:{rowIdx:0,colIdx:2},spellIds:[15274,15311],maxPoints:2},{fieldName:"improvedPsychicScream",fancyName:"Improved Psychic Scream",location:{rowIdx:1,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",fancyName:"Improved Mind Blast",location:{rowIdx:1,colIdx:1},spellIds:[15273,15312,15313],maxPoints:3},{fieldName:"improvedDevouringPlague",fancyName:"Improved Devouring Plague",location:{rowIdx:1,colIdx:2},spellIds:[63625,63626],maxPoints:2},{fieldName:"twistedFaith",fancyName:"Twisted Faith",location:{rowIdx:1,colIdx:3},spellIds:[47573,47577],maxPoints:2},{fieldName:"shadowform",fancyName:"Shadowform",location:{rowIdx:2,colIdx:1},spellIds:[15473],maxPoints:1},{fieldName:"phantasm",fancyName:"Phantasm",location:{rowIdx:2,colIdx:2},spellIds:[47569,47570],maxPoints:2},{fieldName:"harnessedShadows",fancyName:"Harnessed Shadows",location:{rowIdx:2,colIdx:3},spellIds:[33191,78228],maxPoints:2},{fieldName:"silence",fancyName:"Silence",location:{rowIdx:3,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"vampiricEmbrace",fancyName:"Vampiric Embrace",location:{rowIdx:3,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"masochism",fancyName:"Masochism",location:{rowIdx:3,colIdx:2},spellIds:[88994,88995],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"mindMelt",fancyName:"Mind Melt",location:{rowIdx:3,colIdx:3},spellIds:[14910,33371],maxPoints:2},{fieldName:"painAndSuffering",fancyName:"Pain And Suffering",location:{rowIdx:4,colIdx:0},spellIds:[47580,47581],maxPoints:2},{fieldName:"vampiricTouch",fancyName:"Vampiric Touch",location:{rowIdx:4,colIdx:1},spellIds:[34914],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"paralysis",fancyName:"Paralysis",location:{rowIdx:4,colIdx:2},spellIds:[87192,87195],maxPoints:2},{fieldName:"psychicHorror",fancyName:"Psychic Horror",location:{rowIdx:5,colIdx:0},spellIds:[64044],maxPoints:1},{fieldName:"sinAndPunishment",fancyName:"Sin And Punishment",location:{rowIdx:5,colIdx:1},spellIds:[87099,87100],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"shadowyApparition",fancyName:"Shadowy Apparition",location:{rowIdx:5,colIdx:2},spellIds:[78202,78203,78204],maxPoints:3},{fieldName:"dispersion",fancyName:"Dispersion",location:{rowIdx:6,colIdx:1},spellIds:[47585],maxPoints:1}]}]),Ol={primeGlyphs:{[te.GlyphOfDispersion]:{name:"Glyph of Dispersion",description:"Reduces the cooldown on Dispersion by 45 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_dispersion.jpg"},[te.GlyphOfFlashHeal]:{name:"Glyph of Flash Heal",description:"Increases the critical effect chance of your Flash Heal on targets at or below 25% health by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg"},[te.GlyphOfGuardianSpirit]:{name:"Glyph of Guardian Spirit",description:"Reduces the cooldown of your Guardian Spirit by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg"},[te.GlyphOfLightwell]:{name:"Glyph of Lightwell",description:"Increases the total amount of charges of your Lightwell by 5.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"},[te.GlyphOfMindFlay]:{name:"Glyph of Mind Flay",description:"Increases the damage done by your Mind Flay spell by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_siphonmana.jpg"},[te.GlyphOfPenance]:{name:"Glyph of Penance",description:"Reduces the cooldown of Penance by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_penance.jpg"},[te.GlyphOfPowerWordBarrier]:{name:"Glyph of Power Word: Barrier",description:"Increases the healing received while under Power Word: Barrier by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordbarrier.jpg"},[te.GlyphOfPowerWordShield]:{name:"Glyph of Power Word: Shield",description:"Your Power Word: Shield also heals the target for 20% of the absorption amount.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordshield.jpg"},[te.GlyphOfPrayerOfHealing]:{name:"Glyph of Prayer of Healing",description:"Your Prayer of Healing spell also heals an additional 20% of its initial heal over 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofhealing02.jpg"},[te.GlyphOfRenew]:{name:"Glyph of Renew",description:"Increases the amount healed by your Renew by an additional 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_renew.jpg"},[te.GlyphOfShadowWordDeath]:{name:"Glyph of Shadow Word: Death",description:"If your Shadow Word: Death fails to kill the target at or below 25% health, your Shadow Word: Death's cooldown is instantly reset. This effect cannot occur more often than once every 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonicfortitude.jpg"},[te.GlyphOfShadowWordPain]:{name:"Glyph of Shadow Word: Pain",description:"Increases the periodic damage of your Shadow Word: Pain by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowwordpain.jpg"}},majorGlyphs:{[ae.GlyphOfCircleOfHealing]:{name:"Glyph of Circle of Healing",description:"Your Circle of Healing spell heals 1 additional target, but its mana cost is increased by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_circleofrenewal.jpg"},[ae.GlyphOfDesperation]:{name:"Glyph of Desperation",description:"Allows Pain Suppression and Guardian Spirit to be cast while stunned.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_painsupression.jpg"},[ae.GlyphOfDispelMagic]:{name:"Glyph of Dispel Magic",description:"Your Dispel Magic spell also heals your target for 3% of maximum health when you successfully dispel a magical effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[ae.GlyphOfDivineAccuracy]:{name:"Glyph of Divine Accuracy",description:"Increases your chance to hit with your Smite and Holy Fire spells by 18%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holyprotection.jpg"},[ae.GlyphOfFade]:{name:"Glyph of Fade",description:"Reduces the cooldown of your Fade spell by 9 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[ae.GlyphOfFearWard]:{name:"Glyph of Fear Ward",description:"Reduces the cooldown and duration of Fear Ward by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg"},[ae.GlyphOfHolyNova]:{name:"Glyph of Holy Nova",description:"Reduces the global cooldown of your Holy Nova by .5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holynova.jpg"},[ae.GlyphOfInnerFire]:{name:"Glyph of Inner Fire",description:"Increases the armor gained from your Inner Fire spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[ae.GlyphOfMassDispel]:{name:"Glyph of Mass Dispel",description:"Reduces the cast time of Mass Dispel by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_massdispel.jpg"},[ae.GlyphOfPrayerOfMending]:{name:"Glyph of Prayer of Mending",description:"The first charge of your Prayer of Mending heals for an additional 60%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofmendingtga.jpg"},[ae.GlyphOfPsychicHorror]:{name:"Glyph of Psychic Horror",description:"Reduces the cooldown of your Psychic Horror by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychichorrors.jpg"},[ae.GlyphOfPsychicScream]:{name:"Glyph of Psychic Scream",description:"Targets of your Psychic Scream spell now tremble in place instead of fleeing in fear, but the cooldown of Psychic Scream is increased by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychicscream.jpg"},[ae.GlyphOfScourgeImprisonment]:{name:"Glyph of Scourge Imprisonment",description:"Reduces the cast time of your Shackle Undead by 1.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusade.jpg"},[ae.GlyphOfSmite]:{name:"Glyph of Smite",description:"Your Smite spell inflicts an additional 20% damage against targets afflicted by Holy Fire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holysmite.jpg"},[ae.GlyphOfSpiritTap]:{name:"Glyph of Spirit Tap",description:"When you kill a target with your Shadow Word: Death that yields experience or honor, you receive 12% of your total mana over 12 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_requiem.jpg"}},minorGlyphs:{[ie.GlyphOfFading]:{name:"Glyph of Fading",description:"Reduces the mana cost of your Fade spell by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_invisibility.jpg"},[ie.GlyphOfFortitude]:{name:"Glyph of Fortitude",description:"Reduces the mana cost of your Power Word: Fortitude spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_wordfortitude.jpg"},[ie.GlyphOfLevitate]:{name:"Glyph of Levitate",description:"Your Levitate spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg"},[ie.GlyphOfShackleUndead]:{name:"Glyph of Shackle Undead",description:"Increases the range of your Shackle Undead spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"},[ie.GlyphOfShadow]:{name:"Glyph of Shadow",description:"Alters the appearance of your Shadowform.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg"},[ie.GlyphOfShadowProtection]:{name:"Glyph of Shadow Protection",description:"Increases the duration of your Shadow Protection spell by 10 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofshadowprotection.jpg"},[ie.GlyphOfShadowfiend]:{name:"Glyph of Shadowfiend",description:"Receive 5% of your maximum mana if your Shadowfiend dies from damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowfiend.jpg"}}},Ul=bl([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/182.jpg",talents:[{fieldName:"deadlyMomentum",fancyName:"Deadly Momentum",location:{rowIdx:0,colIdx:0},spellIds:[79121,79122],maxPoints:2},{fieldName:"coupDeGrace",fancyName:"Coup De Grace",location:{rowIdx:0,colIdx:1},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"lethality",fancyName:"Lethality",location:{rowIdx:0,colIdx:2},spellIds:[14128,14132,14135],maxPoints:3},{fieldName:"ruthlessness",fancyName:"Ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"quickening",fancyName:"Quickening",location:{rowIdx:1,colIdx:1},spellIds:[31208,31209],maxPoints:2},{fieldName:"puncturingWounds",fancyName:"Puncturing Wounds",location:{rowIdx:1,colIdx:2},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"blackjack",fancyName:"Blackjack",location:{rowIdx:1,colIdx:3},spellIds:[79123,79125],maxPoints:2},{fieldName:"deadlyBrew",fancyName:"Deadly Brew",location:{rowIdx:2,colIdx:0},spellIds:[51625,51626],maxPoints:2},{fieldName:"coldBlood",fancyName:"Cold Blood",location:{rowIdx:2,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"vilePoisons",fancyName:"Vile Poisons",location:{rowIdx:2,colIdx:2},spellIds:[16513,16514,16515],maxPoints:3},{fieldName:"deadenedNerves",fancyName:"Deadened Nerves",location:{rowIdx:3,colIdx:0},spellIds:[31380,31382,31383],maxPoints:3},{fieldName:"sealFate",fancyName:"Seal Fate",location:{rowIdx:3,colIdx:1},spellIds:[14186,14190],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"murderousIntent",fancyName:"Murderous Intent",location:{rowIdx:4,colIdx:0},spellIds:[14158,14159],maxPoints:2},{fieldName:"overkill",fancyName:"Overkill",location:{rowIdx:4,colIdx:1},spellIds:[58426],maxPoints:1},{fieldName:"masterPoisoner",fancyName:"Master Poisoner",location:{rowIdx:4,colIdx:2},spellIds:[58410],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedExposeArmor",fancyName:"Improved Expose Armor",location:{rowIdx:4,colIdx:3},spellIds:[14168,14169],maxPoints:2},{fieldName:"cutToTheChase",fancyName:"Cut To The Chase",location:{rowIdx:5,colIdx:1},spellIds:[51664,51665,51667],maxPoints:3},{fieldName:"venomousWounds",fancyName:"Venomous Wounds",location:{rowIdx:5,colIdx:2},spellIds:[79133,79134],maxPoints:2},{fieldName:"vendetta",fancyName:"Vendetta",location:{rowIdx:6,colIdx:1},spellIds:[79140],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/181.jpg",talents:[{fieldName:"improvedRecuperate",fancyName:"Improved Recuperate",location:{rowIdx:0,colIdx:0},spellIds:[79007,79008],maxPoints:2},{fieldName:"improvedSinisterStrike",fancyName:"Improved Sinister Strike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863,79004],maxPoints:3},{fieldName:"precision",fancyName:"Precision",location:{rowIdx:0,colIdx:2},spellIds:[13705,13832,13843],maxPoints:3},{fieldName:"improvedSliceAndDice",fancyName:"Improved Slice And Dice",location:{rowIdx:1,colIdx:0},spellIds:[14165,14166],maxPoints:2},{fieldName:"improvedSprint",fancyName:"Improved Sprint",location:{rowIdx:1,colIdx:1},spellIds:[13743,13875],maxPoints:2},{fieldName:"aggression",fancyName:"Aggression",location:{rowIdx:1,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"improvedKick",fancyName:"Improved Kick",location:{rowIdx:1,colIdx:3},spellIds:[13754,13867],maxPoints:2},{fieldName:"lightningReflexes",fancyName:"Lightning Reflexes",location:{rowIdx:2,colIdx:0},spellIds:[13712,13788,13789],maxPoints:3},{fieldName:"revealingStrike",fancyName:"Revealing Strike",location:{rowIdx:2,colIdx:1},spellIds:[84617],maxPoints:1},{fieldName:"reinforcedLeather",fancyName:"Reinforced Leather",location:{rowIdx:2,colIdx:2},spellIds:[79077,79079],maxPoints:2},{fieldName:"improvedGouge",fancyName:"Improved Gouge",location:{rowIdx:2,colIdx:3},spellIds:[13741,13793],maxPoints:2},{fieldName:"combatPotency",fancyName:"Combat Potency",location:{rowIdx:3,colIdx:1},spellIds:[35541,35550,35551],maxPoints:3},{fieldName:"bladeTwisting",fancyName:"Blade Twisting",location:{rowIdx:3,colIdx:2},spellIds:[31124,31126],maxPoints:2},{fieldName:"throwingSpecialization",fancyName:"Throwing Specialization",location:{rowIdx:4,colIdx:0},spellIds:[5952,51679],maxPoints:2},{fieldName:"adrenalineRush",fancyName:"Adrenaline Rush",location:{rowIdx:4,colIdx:1},spellIds:[13750],maxPoints:1},{fieldName:"savageCombat",fancyName:"Savage Combat",location:{rowIdx:4,colIdx:2},spellIds:[51682,58413],maxPoints:2},{fieldName:"banditsGuile",fancyName:"Bandits Guile",location:{rowIdx:5,colIdx:0},spellIds:[84652,84653,84654],maxPoints:3},{fieldName:"restlessBlades",fancyName:"Restless Blades",location:{rowIdx:5,colIdx:2},spellIds:[79095,79096],maxPoints:2},{fieldName:"killingSpree",fancyName:"Killing Spree",location:{rowIdx:6,colIdx:1},spellIds:[51690],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/183.jpg",talents:[{fieldName:"nightstalker",fancyName:"Nightstalker",location:{rowIdx:0,colIdx:0},spellIds:[13975,14062],maxPoints:2},{fieldName:"improvedAmbush",fancyName:"Improved Ambush",location:{rowIdx:0,colIdx:1},spellIds:[14079,14080,84661],maxPoints:3},{fieldName:"relentlessStrikes",fancyName:"Relentless Strikes",location:{rowIdx:0,colIdx:2},spellIds:[14179,58422,58423],maxPoints:3},{fieldName:"elusiveness",fancyName:"Elusiveness",location:{rowIdx:1,colIdx:0},spellIds:[13981,14066],maxPoints:2},{fieldName:"waylay",fancyName:"Waylay",location:{rowIdx:1,colIdx:1},spellIds:[51692,51696],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"opportunity",fancyName:"Opportunity",location:{rowIdx:1,colIdx:2},spellIds:[14057,14072,79141],maxPoints:3},{fieldName:"initiative",fancyName:"Initiative",location:{rowIdx:1,colIdx:3},spellIds:[13976,13979],maxPoints:2},{fieldName:"energeticRecovery",fancyName:"Energetic Recovery",location:{rowIdx:2,colIdx:0},spellIds:[79150,79151,79152],maxPoints:3},{fieldName:"findWeakness",fancyName:"Find Weakness",location:{rowIdx:2,colIdx:1},spellIds:[51632,91023],maxPoints:2},{fieldName:"hemorrhage",fancyName:"Hemorrhage",location:{rowIdx:2,colIdx:2},spellIds:[16511],maxPoints:1},{fieldName:"honorAmongThieves",fancyName:"Honor Among Thieves",location:{rowIdx:3,colIdx:0},spellIds:[51698,51700,51701],maxPoints:3},{fieldName:"premeditation",fancyName:"Premeditation",location:{rowIdx:3,colIdx:1},spellIds:[14183],maxPoints:1},{fieldName:"envelopingShadows",fancyName:"Enveloping Shadows",location:{rowIdx:3,colIdx:3},spellIds:[31211,31212,31213],maxPoints:3},{fieldName:"cheatDeath",fancyName:"Cheat Death",location:{rowIdx:4,colIdx:0},spellIds:[31228,31229,31230],maxPoints:3},{fieldName:"preparation",fancyName:"Preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"sanguinaryVein",fancyName:"Sanguinary Vein",location:{rowIdx:4,colIdx:2},spellIds:[79146,79147],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"slaughterFromTheShadows",fancyName:"Slaughter From The Shadows",location:{rowIdx:5,colIdx:1},spellIds:[51708,51709,51710],maxPoints:3},{fieldName:"serratedBlades",fancyName:"Serrated Blades",location:{rowIdx:5,colIdx:2},spellIds:[14171,14172],maxPoints:2},{fieldName:"shadowDance",fancyName:"Shadow Dance",location:{rowIdx:6,colIdx:1},spellIds:[51713],maxPoints:1}]}]),Al={primeGlyphs:{[se.GlyphOfAdrenalineRush]:{name:"Glyph of Adrenaline Rush",description:"Increases the duration of Adrenaline Rush by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowworddominate.jpg"},[se.GlyphOfBackstab]:{name:"Glyph of Backstab",description:"Your Backstab critical strikes grant you 5 Energy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg"},[se.GlyphOfEviscerate]:{name:"Glyph of Eviscerate",description:"Increases the critical strike chance of Eviscerate by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_eviscerate.jpg"},[se.GlyphOfHemorrhage]:{name:"Glyph of Hemorrhage",description:"Your Hemorrhage ability also causes the target to bleed, dealing 40% of the direct strike's damage over 24 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[se.GlyphOfKillingSpree]:{name:"Glyph of Killing Spree",description:"Increases the bonus to your damage while Killing Spree is active by an additional 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_murderspree.jpg"},[se.GlyphOfMutilate]:{name:"Glyph of Mutilate",description:"Reduces the cost of Mutilate by 5 Energy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowstrikes.jpg"},[se.GlyphOfRevealingStrike]:{name:"Glyph of Revealing Strike",description:"Increases Revealing Strike's bonus effectiveness to your finishing moves by an additional 10%",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_97.jpg"},[se.GlyphOfRupture]:{name:"Glyph of Rupture",description:"Increases the duration of Rupture by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_rupture.jpg"},[se.GlyphOfShadowDance]:{name:"Glyph of Shadow Dance",description:"Increases the duration of Shadow Dance by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowdance.jpg"},[se.GlyphOfSinisterStrike]:{name:"Glyph of Sinister Strike",description:"Your Sinister Strikes have a 20% chance to add an additional combo point.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_ritualofsacrifice.jpg"},[se.GlyphOfSliceAndDice]:{name:"Glyph of Slice and Dice",description:"Increases the duration of Slice and Dice by 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg"},[se.GlyphOfVendetta]:{name:"Glyph of Vendetta",description:"Increases the duration of your Vendetta ability by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadliness.jpg"}},majorGlyphs:{[oe.GlyphOfAmbush]:{name:"Glyph of Ambush",description:"Increases the range on Ambush by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg"},[oe.GlyphOfBladeFlurry]:{name:"Glyph of Blade Flurry",description:"Reduces the penalty to Energy generation while Blade Flurry is active by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg"},[oe.GlyphOfBlind]:{name:"Glyph of Blind",description:"Your Blind ability also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg"},[oe.GlyphOfCloakOfShadows]:{name:"Glyph of Cloak of Shadows",description:"While Cloak of Shadows is active, you take 40% less physical damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_nethercloak.jpg"},[oe.GlyphOfCripplingPoison]:{name:"Glyph of Crippling Poison",description:"Increases the chance to inflict your target with Crippling Poison by an additional 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_poisonsting.jpg"},[oe.GlyphOfDeadlyThrow]:{name:"Glyph of Deadly Throw",description:"Increases the slowing effect on Deadly Throw by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_throwingknife_06.jpg"},[oe.GlyphOfEvasion]:{name:"Glyph of Evasion",description:"Increases the duration of Evasion by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowward.jpg"},[oe.GlyphOfExposeArmor]:{name:"Glyph of Expose Armor",description:"Increases the duration of Expose Armor by 12 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_riposte.jpg"},[oe.GlyphOfFanOfKnives]:{name:"Glyph of Fan of Knives",description:"Increases the radius of your Fan of Knives ability by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_fanofknives.jpg"},[oe.GlyphOfFeint]:{name:"Glyph of Feint",description:"Reduces the Energy cost of Feint by 20.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[oe.GlyphOfGarrote]:{name:"Glyph of Garrote",description:"Increases the duration of your Garrote ability's silence effect by 1.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_garrote.jpg"},[oe.GlyphOfGouge]:{name:"Glyph of Gouge",description:"Your Gouge ability no longer requires that the target be facing you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg"},[oe.GlyphOfKick]:{name:"Glyph of Kick",description:"Increases the cooldown of your Kick ability by 4 sec, but this cooldown is reduced by 6 sec when your Kick successfully interrupts a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_kick.jpg"},[oe.GlyphOfPreparation]:{name:"Glyph of Preparation",description:"Your Preparation ability also instantly resets the cooldown of Kick, Dismantle, and Smoke Bomb.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_preparation.jpg"},[oe.GlyphOfSap]:{name:"Glyph of Sap",description:"Increases the duration of Sap against non-player targets by 80 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_sap.jpg"},[oe.GlyphOfSprint]:{name:"Glyph of Sprint",description:"Increases the movement speed of your Sprint ability by an additional 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[oe.GlyphOfTricksOfTheTrade]:{name:"Glyph of Tricks of the Trade",description:"Removes the Energy cost of your Tricks of the Trade ability but reduces the recipient's damage bonus by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg"},[oe.GlyphOfVanish]:{name:"Glyph of Vanish",description:"Increases the duration of your Vanish effect by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg"}},minorGlyphs:{[ne.GlyphOfBlurredSpeed]:{name:"Glyph of Blurred Speed",description:"Enables you to walk on water while your Sprint ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[ne.GlyphOfDistract]:{name:"Glyph of Distract",description:"Increases the range of your Distract ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg"},[ne.GlyphOfPickLock]:{name:"Glyph of Pick Lock",description:"Reduces the cast time of your Pick Lock ability by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_moonkey.jpg"},[ne.GlyphOfPickPocket]:{name:"Glyph of Pick Pocket",description:"Increases the range of your Pick Pocket ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bag_11.jpg"},[ne.GlyphOfPoisons]:{name:"Glyph of Poisons",description:"You apply poisons to your weapons 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_brewpoison.jpg"},[ne.GlyphOfSafeFall]:{name:"Glyph of Safe Fall",description:"Increases the distance your Safe Fall ability allows you to fall without taking damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg"}}},Ll=bl([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/261.jpg",talents:[{fieldName:"acuity",fancyName:"Acuity",location:{rowIdx:0,colIdx:0},spellIds:[17485,17486,17487],maxPoints:3},{fieldName:"convection",fancyName:"Convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109],maxPoints:2},{fieldName:"concussion",fancyName:"Concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106],maxPoints:3},{fieldName:"callOfFlame",fancyName:"Call Of Flame",location:{rowIdx:1,colIdx:0},spellIds:[16038,16160],maxPoints:2},{fieldName:"elementalWarding",fancyName:"Elemental Warding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"reverberation",fancyName:"Reverberation",location:{rowIdx:1,colIdx:2},spellIds:[16040,16113],maxPoints:2},{fieldName:"elementalPrecision",fancyName:"Elemental Precision",location:{rowIdx:1,colIdx:3},spellIds:[30672,30673,30674],maxPoints:3},{fieldName:"rollingThunder",fancyName:"Rolling Thunder",location:{rowIdx:2,colIdx:0},spellIds:[88756,88764],maxPoints:2},{fieldName:"elementalFocus",fancyName:"Elemental Focus",location:{rowIdx:2,colIdx:1},spellIds:[16164],maxPoints:1},{fieldName:"elementalReach",fancyName:"Elemental Reach",location:{rowIdx:2,colIdx:2},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalOath",fancyName:"Elemental Oath",location:{rowIdx:3,colIdx:1},spellIds:[51466,51470],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"lavaFlows",fancyName:"Lava Flows",location:{rowIdx:3,colIdx:2},spellIds:[51480,51481,51482],maxPoints:3},{fieldName:"fulmination",fancyName:"Fulmination",location:{rowIdx:4,colIdx:0},spellIds:[88766],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"elementalMastery",fancyName:"Elemental Mastery",location:{rowIdx:4,colIdx:1},spellIds:[16166],maxPoints:1},{fieldName:"earthsGrasp",fancyName:"Earths Grasp",location:{rowIdx:4,colIdx:2},spellIds:[51483,51485],maxPoints:2},{fieldName:"totemicWrath",fancyName:"Totemic Wrath",location:{rowIdx:4,colIdx:3},spellIds:[77746],maxPoints:1},{fieldName:"feedback",fancyName:"Feedback",location:{rowIdx:5,colIdx:1},spellIds:[86183,86184,86185],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"lavaSurge",fancyName:"Lava Surge",location:{rowIdx:5,colIdx:2},spellIds:[77755,77756],maxPoints:2},{fieldName:"earthquake",fancyName:"Earthquake",location:{rowIdx:6,colIdx:1},spellIds:[61882],maxPoints:1}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/263.jpg",talents:[{fieldName:"elementalWeapons",fancyName:"Elemental Weapons",location:{rowIdx:0,colIdx:0},spellIds:[16266,29079],maxPoints:2},{fieldName:"focusedStrikes",fancyName:"Focused Strikes",location:{rowIdx:0,colIdx:1},spellIds:[77536,77537,77538],maxPoints:3},{fieldName:"improvedShields",fancyName:"Improved Shields",location:{rowIdx:0,colIdx:2},spellIds:[16261,16290,51881],maxPoints:3},{fieldName:"elementalDevastation",fancyName:"Elemental Devastation",location:{rowIdx:1,colIdx:0},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"flurry",fancyName:"Flurry",location:{rowIdx:1,colIdx:1},spellIds:[16256,16281,16282],maxPoints:3},{fieldName:"ancestralSwiftness",fancyName:"Ancestral Swiftness",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"totemicReach",fancyName:"Totemic Reach",location:{rowIdx:1,colIdx:3},spellIds:[86935,86936],maxPoints:2},{fieldName:"toughness",fancyName:"Toughness",location:{rowIdx:2,colIdx:0},spellIds:[16252,16306,16307],maxPoints:3},{fieldName:"stormstrike",fancyName:"Stormstrike",location:{rowIdx:2,colIdx:1},spellIds:[17364],maxPoints:1},{fieldName:"staticShock",fancyName:"Static Shock",location:{rowIdx:2,colIdx:2},spellIds:[51525,51526,51527],maxPoints:3},{fieldName:"frozenPower",fancyName:"Frozen Power",location:{rowIdx:3,colIdx:0},spellIds:[63373,63374],maxPoints:2},{fieldName:"seasonedWinds",fancyName:"Seasoned Winds",location:{rowIdx:3,colIdx:1},spellIds:[16086,16544],maxPoints:2},{fieldName:"searingFlames",fancyName:"Searing Flames",location:{rowIdx:3,colIdx:2},spellIds:[77655,77656,77657],maxPoints:3},{fieldName:"earthenPower",fancyName:"Earthen Power",location:{rowIdx:4,colIdx:0},spellIds:[51523,51524],maxPoints:2},{fieldName:"shamanisticRage",fancyName:"Shamanistic Rage",location:{rowIdx:4,colIdx:1},spellIds:[30823],maxPoints:1},{fieldName:"unleashedRage",fancyName:"Unleashed Rage",location:{rowIdx:4,colIdx:3},spellIds:[30802,30808],maxPoints:2},{fieldName:"maelstromWeapon",fancyName:"Maelstrom Weapon",location:{rowIdx:5,colIdx:1},spellIds:[51528,51529,51530],maxPoints:3},{fieldName:"improvedLavaLash",fancyName:"Improved Lava Lash",location:{rowIdx:5,colIdx:2},spellIds:[77700,77701],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"feralSpirit",fancyName:"Feral Spirit",location:{rowIdx:6,colIdx:1},spellIds:[51533],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/262.jpg",talents:[{fieldName:"ancestralResolve",fancyName:"Ancestral Resolve",location:{rowIdx:0,colIdx:0},spellIds:[77829,77830],maxPoints:2},{fieldName:"tidalFocus",fancyName:"Tidal Focus",location:{rowIdx:0,colIdx:1},spellIds:[16179,16214,16215],maxPoints:3},{fieldName:"sparkOfLife",fancyName:"Spark Of Life",location:{rowIdx:0,colIdx:2},spellIds:[84846,84847,84848],maxPoints:3},{fieldName:"resurgence",fancyName:"Resurgence",location:{rowIdx:1,colIdx:0},spellIds:[16180,16196],maxPoints:2},{fieldName:"totemicFocus",fancyName:"Totemic Focus",location:{rowIdx:1,colIdx:1},spellIds:[16173,16222],maxPoints:2},{fieldName:"focusedInsight",fancyName:"Focused Insight",location:{rowIdx:1,colIdx:2},spellIds:[77794,77795,77796],maxPoints:3},{fieldName:"naturesGuardian",fancyName:"Natures Guardian",location:{rowIdx:1,colIdx:3},spellIds:[30881,30883,30884],maxPoints:3},{fieldName:"ancestralHealing",fancyName:"Ancestral Healing",location:{rowIdx:2,colIdx:0},spellIds:[16176,16235],maxPoints:2},{fieldName:"naturesSwiftness",fancyName:"Natures Swiftness",location:{rowIdx:2,colIdx:1},spellIds:[16188],maxPoints:1},{fieldName:"naturesBlessing",fancyName:"Natures Blessing",location:{rowIdx:2,colIdx:2},spellIds:[30867,30868,30869],maxPoints:3},{fieldName:"soothingRains",fancyName:"Soothing Rains",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205],maxPoints:2},{fieldName:"improvedCleanseSpirit",fancyName:"Improved Cleanse Spirit",location:{rowIdx:3,colIdx:2},spellIds:[77130],maxPoints:1},{fieldName:"cleansingWaters",fancyName:"Cleansing Waters",location:{rowIdx:3,colIdx:3},spellIds:[86959,86962],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"ancestralAwakening",fancyName:"Ancestral Awakening",location:{rowIdx:4,colIdx:0},spellIds:[51556,51558,51557],maxPoints:3,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"manaTideTotem",fancyName:"Mana Tide Totem",location:{rowIdx:4,colIdx:1},spellIds:[16190],maxPoints:1},{fieldName:"telluricCurrents",fancyName:"Telluric Currents",location:{rowIdx:4,colIdx:2},spellIds:[82984,82988],maxPoints:2},{fieldName:"spiritLinkTotem",fancyName:"Spirit Link Totem",location:{rowIdx:4,colIdx:3},spellIds:[98008],maxPoints:1},{fieldName:"tidalWaves",fancyName:"Tidal Waves",location:{rowIdx:5,colIdx:1},spellIds:[51562,51563,51564],maxPoints:3},{fieldName:"blessingOfTheEternals",fancyName:"Blessing Of The Eternals",location:{rowIdx:5,colIdx:2},spellIds:[51554,51555],maxPoints:2},{fieldName:"riptide",fancyName:"Riptide",location:{rowIdx:6,colIdx:1},spellIds:[61295],maxPoints:1}]}]),Fl={primeGlyphs:{[le.GlyphOfEarthShield]:{name:"Glyph of Earth Shield",description:"Increases the amount healed by your Earth Shield by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_skinofearth.jpg"},[le.GlyphOfEarthlivingWeapon]:{name:"Glyph of Earthliving Weapon",description:"Increases the effectiveness of your Earthliving weapon's periodic healing by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_life.jpg"},[le.GlyphOfFeralSpirit]:{name:"Glyph of Feral Spirit",description:"Your spirit wolves gain an additional 30% of your attack power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_feralspirit.jpg"},[le.GlyphOfFireElementalTotem]:{name:"Glyph of Fire Elemental Totem",description:"Reduces the cooldown of your Fire Elemental Totem by 5 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_elemental_totem.jpg"},[le.GlyphOfFlameShock]:{name:"Glyph of Flame Shock",description:"Increases the duration of your Flame Shock by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg"},[le.GlyphOfFlametongueWeapon]:{name:"Glyph of Flametongue Weapon",description:"Increases your spell critical strike chance by 2% on each of your weapons with Flametongue Weapon active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_flame.jpg"},[le.GlyphOfLavaBurst]:{name:"Glyph of Lava Burst",description:"Your Lava Burst spell deals 10% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_lavaburst.jpg"},[le.GlyphOfLavaLash]:{name:"Glyph of Lava Lash",description:"Increases the damage dealt by your Lava Lash ability by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_lavalash.jpg"},[le.GlyphOfLightningBolt]:{name:"Glyph of Lightning Bolt",description:"Increases the damage dealt by Lightning Bolt by 4%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[le.GlyphOfRiptide]:{name:"Glyph of Riptide",description:"Increases the duration of Riptide by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg"},[le.GlyphOfShocking]:{name:"Glyph of Shocking",description:"Reduces your global cooldown when casting your shock spells by 0.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthshock.jpg"},[le.GlyphOfStormstrike]:{name:"Glyph of Stormstrike",description:"Increases the critical strike chance bonus from your Stormstrike ability by an additional 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_stormstrike.jpg"},[le.GlyphOfUnleashedLightning]:{name:"Glyph of Unleashed Lightning",description:"Allows Lightning Bolt to be cast while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[le.GlyphOfWaterShield]:{name:"Glyph of Water Shield",description:"Increases the passive mana regeneration of your Water Shield spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg"},[le.GlyphOfWindfuryWeapon]:{name:"Glyph of Windfury Weapon",description:"Increases the chance per swing for Windfury Weapon to trigger by 2%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_wind.jpg"}},majorGlyphs:{[re.GlyphOfChainHeal]:{name:"Glyph of Chain Heal",description:"Increases healing done by your Chain Heal spell to targets beyond the first by 15%, but decreases the amount received by the initial target by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[re.GlyphOfChainLightning]:{name:"Glyph of Chain Lightning",description:"Your Chain Lightning spell now strikes 2 additional targets, but deals 10% less initial damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_chainlightning.jpg"},[re.GlyphOfElementalMastery]:{name:"Glyph of Elemental Mastery",description:"While your Elemental Mastery ability is active, you take 20% less damage from all sources.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispheal.jpg"},[re.GlyphOfFireNova]:{name:"Glyph of Fire Nova",description:"Increases the radius of your Fire Nova spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_firenova.jpg"},[re.GlyphOfFrostShock]:{name:"Glyph of Frost Shock",description:"Increases the duration of your Frost Shock by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg"},[re.GlyphOfGhostWolf]:{name:"Glyph of Ghost Wolf",description:"Your Ghost Wolf form grants an additional 5% movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg"},[re.GlyphOfGroundingTotem]:{name:"Glyph of Grounding Totem",description:"Instead of absorbing a spell, your Grounding Totem reflects the next harmful spell back at its caster, but the cooldown of your Grounding Totem is increased by 35 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_groundingtotem.jpg"},[re.GlyphOfHealingStreamTotem]:{name:"Glyph of Healing Stream Totem",description:"Your Healing Stream Totem also increases the Fire, Frost, and Nature resistance of party and raid members within 30 yards by 85.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_04.jpg"},[re.GlyphOfHealingWave]:{name:"Glyph of Healing Wave",description:"Your Healing Wave also heals you for 20% of the healing effect when you heal someone else.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[re.GlyphOfHex]:{name:"Glyph of Hex",description:"Reduces the cooldown of your Hex spell by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_hex.jpg"},[re.GlyphOfLightningShield]:{name:"Glyph of Lightning Shield",description:"Your Lightning Shield can no longer drop below 3 charges from dealing damage to attackers.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightningshield.jpg"},[re.GlyphOfShamanisticRage]:{name:"Glyph of Shamanistic Rage",description:"Activating your Shamanistic Rage ability also cleanses you of all dispellable Magic debuffs.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_shamanrage.jpg"},[re.GlyphOfStoneclawTotem]:{name:"Glyph of Stoneclaw Totem",description:"Your Stoneclaw Totem also places a damage absorb shield on you, equal to 4 times the strength of the shield it places on your totems.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg"},[re.GlyphOfThunder]:{name:"Glyph of Thunder",description:"Reduces the cooldown on Thunderstorm by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[re.GlyphOfTotemicRecall]:{name:"Glyph of Totemic Recall",description:"Causes your Totemic Recall ability to return an additional 50% of the mana cost of any recalled totems.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_totemrecall.jpg"}},minorGlyphs:{[ce.GlyphOfAstralRecall]:{name:"Glyph of Astral Recall",description:"Reduces the cooldown of your Astral Recall spell by 7.5 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecal.jpg"},[ce.GlyphOfRenewedLife]:{name:"Glyph of Renewed Life",description:"Your Reincarnation spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedreincarnation.jpg"},[ce.GlyphOfTheArcticWolf]:{name:"Glyph of the Arctic Wolf",description:"Alters the appearance of your Ghost Wolf transformation, causing it to resemble an arctic wolf.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitedirewolf.jpg"},[ce.GlyphOfThunderstorm]:{name:"Glyph of Thunderstorm",description:"Increases the mana you receive from your Thunderstorm spell by 2%, but it no longer knocks enemies back or reduces their movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[ce.GlyphOfWaterBreathing]:{name:"Glyph of Water Breathing",description:"Your Water Breathing spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg"},[ce.GlyphOfWaterWalking]:{name:"Glyph of Water Walking",description:"Your Water Walking spell no longer requires a reagent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_windwalkon.jpg"}}},Ml=bl([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/871.jpg",talents:[{fieldName:"doomAndGloom",fancyName:"Doom And Gloom",location:{rowIdx:0,colIdx:0},spellIds:[18827,18829],maxPoints:2},{fieldName:"improvedLifeTap",fancyName:"Improved Life Tap",location:{rowIdx:0,colIdx:1},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedCorruption",fancyName:"Improved Corruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:3},{fieldName:"jinx",fancyName:"Jinx",location:{rowIdx:1,colIdx:0},spellIds:[18179,85479],maxPoints:2},{fieldName:"soulSiphon",fancyName:"Soul Siphon",location:{rowIdx:1,colIdx:1},spellIds:[17804,17805],maxPoints:2},{fieldName:"siphonLife",fancyName:"Siphon Life",location:{rowIdx:1,colIdx:2},spellIds:[63108,86667],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"curseOfExhaustion",fancyName:"Curse Of Exhaustion",location:{rowIdx:2,colIdx:0},spellIds:[18223],maxPoints:1},{fieldName:"improvedFear",fancyName:"Improved Fear",location:{rowIdx:2,colIdx:2},spellIds:[53754,53759],maxPoints:2},{fieldName:"eradication",fancyName:"Eradication",location:{rowIdx:2,colIdx:3},spellIds:[47195,47196,47197],maxPoints:3},{fieldName:"improvedHowlOfTerror",fancyName:"Improved Howl Of Terror",location:{rowIdx:3,colIdx:0},spellIds:[30054,30057],maxPoints:2},{fieldName:"soulSwap",fancyName:"Soul Swap",location:{rowIdx:3,colIdx:1},spellIds:[86121],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"shadowEmbrace",fancyName:"Shadow Embrace",location:{rowIdx:3,colIdx:2},spellIds:[32385,32387,32392],maxPoints:3},{fieldName:"deathsEmbrace",fancyName:"Deaths Embrace",location:{rowIdx:4,colIdx:0},spellIds:[47198,47199,47200],maxPoints:3},{fieldName:"nightfall",fancyName:"Nightfall",location:{rowIdx:4,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"soulburnSeedOfCorruption",fancyName:"Soulburn Seed Of Corruption",location:{rowIdx:4,colIdx:2},spellIds:[86664],maxPoints:1},{fieldName:"everlastingAffliction",fancyName:"Everlasting Affliction",location:{rowIdx:5,colIdx:1},spellIds:[47201,47202,47203],maxPoints:3},{fieldName:"pandemic",fancyName:"Pandemic",location:{rowIdx:5,colIdx:2},spellIds:[85099,85100],maxPoints:2},{fieldName:"haunt",fancyName:"Haunt",location:{rowIdx:6,colIdx:1},spellIds:[48181],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/867.jpg",talents:[{fieldName:"demonicEmbrace",fancyName:"Demonic Embrace",location:{rowIdx:0,colIdx:0},spellIds:[18697,18698,18699],maxPoints:3},{fieldName:"darkArts",fancyName:"Dark Arts",location:{rowIdx:0,colIdx:1},spellIds:[18694,85283,85284],maxPoints:3},{fieldName:"felSynergy",fancyName:"Fel Synergy",location:{rowIdx:0,colIdx:2},spellIds:[47230,47231],maxPoints:2},{fieldName:"demonicRebirth",fancyName:"Demonic Rebirth",location:{rowIdx:1,colIdx:0},spellIds:[88446,88447],maxPoints:2},{fieldName:"manaFeed",fancyName:"Mana Feed",location:{rowIdx:1,colIdx:1},spellIds:[30326,85175],maxPoints:2},{fieldName:"demonicAegis",fancyName:"Demonic Aegis",location:{rowIdx:1,colIdx:2},spellIds:[30143,30144],maxPoints:2},{fieldName:"masterSummoner",fancyName:"Master Summoner",location:{rowIdx:1,colIdx:3},spellIds:[18709,18710],maxPoints:2},{fieldName:"impendingDoom",fancyName:"Impending Doom",location:{rowIdx:2,colIdx:0},spellIds:[85106,85107,85108],maxPoints:3},{fieldName:"demonicEmpowerment",fancyName:"Demonic Empowerment",location:{rowIdx:2,colIdx:1},spellIds:[47193],maxPoints:1},{fieldName:"improvedHealthFunnel",fancyName:"Improved Health Funnel",location:{rowIdx:2,colIdx:2},spellIds:[18703,18704],maxPoints:2},{fieldName:"moltenCore",fancyName:"Molten Core",location:{rowIdx:3,colIdx:0},spellIds:[47245,47246,47247],maxPoints:3},{fieldName:"handOfGuldan",fancyName:"Hand Of Guldan",location:{rowIdx:3,colIdx:1},spellIds:[71521],maxPoints:1},{fieldName:"auraOfForeboding",fancyName:"Aura Of Foreboding",location:{rowIdx:3,colIdx:2},spellIds:[89604,89605],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"ancientGrimoire",fancyName:"Ancient Grimoire",location:{rowIdx:4,colIdx:0},spellIds:[85109,85110],maxPoints:2},{fieldName:"inferno",fancyName:"Inferno",location:{rowIdx:4,colIdx:1},spellIds:[85105],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"decimation",fancyName:"Decimation",location:{rowIdx:4,colIdx:2},spellIds:[63156,63158],maxPoints:2},{fieldName:"cremation",fancyName:"Cremation",location:{rowIdx:5,colIdx:1},spellIds:[85103,85104],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"demonicPact",fancyName:"Demonic Pact",location:{rowIdx:5,colIdx:2},spellIds:[47236],maxPoints:1},{fieldName:"metamorphosis",fancyName:"Metamorphosis",location:{rowIdx:6,colIdx:1},spellIds:[59672],maxPoints:1}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/865.jpg",talents:[{fieldName:"bane",fancyName:"Bane",location:{rowIdx:0,colIdx:0},spellIds:[17788,17789,17790],maxPoints:3},{fieldName:"shadowAndFlame",fancyName:"Shadow And Flame",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801],maxPoints:3},{fieldName:"improvedImmolate",fancyName:"Improved Immolate",location:{rowIdx:0,colIdx:2},spellIds:[17815,17833,17834],maxPoints:2},{fieldName:"aftermath",fancyName:"Aftermath",location:{rowIdx:1,colIdx:0},spellIds:[85113,85114],maxPoints:2},{fieldName:"emberstorm",fancyName:"Emberstorm",location:{rowIdx:1,colIdx:1},spellIds:[17954,17955],maxPoints:2},{fieldName:"improvedSearingPain",fancyName:"Improved Searing Pain",location:{rowIdx:1,colIdx:2},spellIds:[17927,17929],maxPoints:2},{fieldName:"improvedSoulFire",fancyName:"Improved Soul Fire",location:{rowIdx:2,colIdx:0},spellIds:[18119,18120],maxPoints:2},{fieldName:"backdraft",fancyName:"Backdraft",location:{rowIdx:2,colIdx:1},spellIds:[47258,47259,47260],maxPoints:3},{fieldName:"shadowburn",fancyName:"Shadowburn",location:{rowIdx:2,colIdx:2},spellIds:[17877],maxPoints:1},{fieldName:"burningEmbers",fancyName:"Burning Embers",location:{rowIdx:3,colIdx:0},spellIds:[91986,85112],maxPoints:2},{fieldName:"soulLeech",fancyName:"Soul Leech",location:{rowIdx:3,colIdx:1},spellIds:[30293,30295,54118],maxPoints:2},{fieldName:"backlash",fancyName:"Backlash",location:{rowIdx:3,colIdx:2},spellIds:[34935,34939,34938],maxPoints:3},{fieldName:"netherWard",fancyName:"Nether Ward",location:{rowIdx:3,colIdx:3},spellIds:[91713],maxPoints:1},{fieldName:"fireAndBrimstone",fancyName:"Fire And Brimstone",location:{rowIdx:4,colIdx:1},spellIds:[47266,47267,47268,47269,47270],maxPoints:3},{fieldName:"shadowfury",fancyName:"Shadowfury",location:{rowIdx:4,colIdx:2},spellIds:[30283],maxPoints:1},{fieldName:"netherProtection",fancyName:"Nether Protection",location:{rowIdx:4,colIdx:3},spellIds:[30299,30301],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:3}},{fieldName:"empoweredImp",fancyName:"Empowered Imp",location:{rowIdx:5,colIdx:0},spellIds:[47220,47221],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"baneOfHavoc",fancyName:"Bane Of Havoc",location:{rowIdx:5,colIdx:2},spellIds:[80240],maxPoints:1},{fieldName:"chaosBolt",fancyName:"Chaos Bolt",location:{rowIdx:6,colIdx:1},spellIds:[50796],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Vl={primeGlyphs:{[de.GlyphOfBaneOfAgony]:{name:"Glyph of Bane of Agony",description:"Increases the duration of your Bane of Agony by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curseofsargeras.jpg"},[de.GlyphOfChaosBolt]:{name:"Glyph of Chaos Bolt",description:"Reduces the cooldown on Chaos Bolt by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_chaosbolt.jpg"},[de.GlyphOfConflagrate]:{name:"Glyph of Conflagrate",description:"Reduces the cooldown of your Conflagrate by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg"},[de.GlyphOfCorruption]:{name:"Glyph of Corruption",description:"Your Corruption spell has a 4% chance to cause you to enter a Shadow Trance state after damaging the opponent. The Shadow Trance state reduces the casting time of your next Shadow Bolt spell by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_abominationexplosion.jpg"},[de.GlyphOfFelguard]:{name:"Glyph of Felguard",description:"Increases the damage done by your Felguard's Legion Strike by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelguard.jpg"},[de.GlyphOfHaunt]:{name:"Glyph of Haunt",description:"The bonus damage granted by your Haunt spell is increased by an additional 3%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_haunt.jpg"},[de.GlyphOfImmolate]:{name:"Glyph of Immolate",description:"Increases the periodic damage of your Immolate by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_immolation.jpg"},[de.GlyphOfImp]:{name:"Glyph of Imp",description:"Increases the damage done by your Imp's Firebolt spell by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonimp.jpg"},[de.GlyphOfIncinerate]:{name:"Glyph of Incinerate",description:"Increases the damage done by Incinerate by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_burnout.jpg"},[de.GlyphOfLashOfPain]:{name:"Glyph of Lash of Pain",description:"Increases the damage done by your Succubus' Lash of Pain by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curse.jpg"},[de.GlyphOfMetamorphosis]:{name:"Glyph of Metamorphosis",description:"Increases the duration of your Metamorphosis by 6 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonform.jpg"},[de.GlyphOfShadowburn]:{name:"Glyph of Shadowburn",description:"If your Shadowburn fails to kill the target at or below 20% health, your Shadowburn's cooldown is instantly reset. This effect has a 6 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_scourgebuild.jpg"},[de.GlyphOfUnstableAffliction]:{name:"Glyph of Unstable Affliction",description:"Decreases the casting time of your Unstable Affliction by 0.2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unstableaffliction_3.jpg"}},majorGlyphs:{[me.GlyphOfDeathCoilWl]:{name:"Glyph of Death Coil",description:"Increases the duration of your Death Coil by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[me.GlyphOfDemonicCircle]:{name:"Glyph of Demonic Circle",description:"Reduces the cooldown on Demonic Circle by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demoniccircleteleport.jpg"},[me.GlyphOfFear]:{name:"Glyph of Fear",description:"Your Fear causes the target to tremble in place instead of fleeing in fear, but now causes Fear to have a 5 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_possession.jpg"},[me.GlyphOfFelhunter]:{name:"Glyph of Felhunter",description:"When your Felhunter uses Devour Magic, you will also be healed for that amount.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelhunter.jpg"},[me.GlyphOfHealthstone]:{name:"Glyph of Healthstone",description:"You receive 30% more healing from using a healthstone.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_stone_04.jpg"},[me.GlyphOfHowlOfTerror]:{name:"Glyph of Howl of Terror",description:"Reduces the cooldown on your Howl of Terror spell by 8 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathscream.jpg"},[me.GlyphOfLifeTap]:{name:"Glyph of Life Tap",description:"Reduces the global cooldown of your Life Tap by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_burningspirit.jpg"},[me.GlyphOfSeduction]:{name:"Glyph of Seduction",description:"Your Succubus's Seduction ability also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg"},[me.GlyphOfShadowBolt]:{name:"Glyph of Shadow Bolt",description:"Reduces the mana cost of your Shadow Bolt by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowbolt.jpg"},[me.GlyphOfShadowflame]:{name:"Glyph of Shadowflame",description:"Your Shadowflame also applies a 70% movement speed slow to its victims.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_shadowflame.jpg"},[me.GlyphOfSoulLink]:{name:"Glyph of Soul Link",description:"Increases the percentage of damage shared via your Soul Link by an additional 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_gathershadows.jpg"},[me.GlyphOfSoulSwap]:{name:"Glyph of Soul Swap",description:"Your Soul Swap leaves your damage-over-time spells behind on the target you Soul Swapped from, but gives Soul Swap a 30 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_soulswap.jpg"},[me.GlyphOfSoulstone]:{name:"Glyph of Soulstone",description:"Increases the amount of health you gain from resurrecting via a Soulstone by an additional 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_04.jpg"},[me.GlyphOfVoidwalker]:{name:"Glyph of Voidwalker",description:"Increases your Voidwalker's total health by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonvoidwalker.jpg"}},minorGlyphs:{[he.GlyphOfCurseOfExhaustion]:{name:"Glyph of Curse of Exhaustion",description:"Increases the range of your Curse of Exhaustion spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_grimward.jpg"},[he.GlyphOfDrainSoul]:{name:"Glyph of Drain Soul",description:"Your Drain Soul restores 10% of your total mana after you kill a target that yields experience or honor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_haunting.jpg"},[he.GlyphOfEyeOfKilrogg]:{name:"Glyph of Eye of Kilrogg",description:"Increases the movement speed of your Eye of Kilrogg by 50% and allows it to fly in areas where flying mounts are enabled.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_evileye.jpg"},[he.GlyphOfHealthFunnel]:{name:"Glyph of Health Funnel",description:"Reduces the pushback suffered from damaging attacks while channeling your Health Funnel spell by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[he.GlyphOfRitualOfSouls]:{name:"Glyph of Ritual of Souls",description:"Reduces the mana cost of your Ritual of Souls spell by 70%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadesofdarkness.jpg"},[he.GlyphOfSubjugateDemon]:{name:"Glyph of Subjugate Demon",description:"Reduces the cast time of your Subjugate Demon spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_enslavedemon.jpg"},[he.GlyphOfUnendingBreath]:{name:"Glyph of Unending Breath",description:"Increases the swim speed of targets affected by your Unending Breath spell by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg"}}},Wl=bl([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/746.jpg",talents:[{fieldName:"warAcademy",fancyName:"War Academy",location:{rowIdx:0,colIdx:0},spellIds:[84570,84571,84572],maxPoints:3},{fieldName:"fieldDressing",fancyName:"Field Dressing",location:{rowIdx:0,colIdx:1},spellIds:[84579,84580],maxPoints:2},{fieldName:"blitz",fancyName:"Blitz",location:{rowIdx:0,colIdx:2},spellIds:[80976,80977],maxPoints:2},{fieldName:"tacticalMastery",fancyName:"Tactical Mastery",location:{rowIdx:1,colIdx:0},spellIds:[12295,12676],maxPoints:2},{fieldName:"secondWind",fancyName:"Second Wind",location:{rowIdx:1,colIdx:1},spellIds:[29834,29838],maxPoints:2},{fieldName:"deepWounds",fancyName:"Deep Wounds",location:{rowIdx:1,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3},{fieldName:"drumsOfWar",fancyName:"Drums Of War",location:{rowIdx:1,colIdx:3},spellIds:[12290,12963],maxPoints:2},{fieldName:"tasteForBlood",fancyName:"Taste For Blood",location:{rowIdx:2,colIdx:0},spellIds:[56636,56637,56638],maxPoints:3},{fieldName:"sweepingStrikes",fancyName:"Sweeping Strikes",location:{rowIdx:2,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"impale",fancyName:"Impale",location:{rowIdx:2,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedHamstring",fancyName:"Improved Hamstring",location:{rowIdx:2,colIdx:3},spellIds:[12289,12668],maxPoints:2},{fieldName:"improvedSlam",fancyName:"Improved Slam",location:{rowIdx:3,colIdx:0},spellIds:[86655,12330],maxPoints:2},{fieldName:"deadlyCalm",fancyName:"Deadly Calm",location:{rowIdx:3,colIdx:1},spellIds:[85730],maxPoints:1},{fieldName:"bloodFrenzy",fancyName:"Blood Frenzy",location:{rowIdx:3,colIdx:2},spellIds:[29836,29859],maxPoints:2},{fieldName:"lambsToTheSlaughter",fancyName:"Lambs To The Slaughter",location:{rowIdx:4,colIdx:0},spellIds:[84583,84588,84587],maxPoints:3},{fieldName:"juggernaut",fancyName:"Juggernaut",location:{rowIdx:4,colIdx:1},spellIds:[64976],maxPoints:1},{fieldName:"suddenDeath",fancyName:"Sudden Death",location:{rowIdx:4,colIdx:3},spellIds:[29723,29725],maxPoints:2},{fieldName:"wreckingCrew",fancyName:"Wrecking Crew",location:{rowIdx:5,colIdx:0},spellIds:[46867,56611,56612],maxPoints:2},{fieldName:"throwdown",fancyName:"Throwdown",location:{rowIdx:5,colIdx:2},spellIds:[85388],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"bladestorm",fancyName:"Bladestorm",location:{rowIdx:6,colIdx:1},spellIds:[46924],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/815.jpg",talents:[{fieldName:"bloodCraze",fancyName:"Blood Craze",location:{rowIdx:0,colIdx:0},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"battleTrance",fancyName:"Battle Trance",location:{rowIdx:0,colIdx:1},spellIds:[12322,85741,85742],maxPoints:3},{fieldName:"cruelty",fancyName:"Cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852],maxPoints:2},{fieldName:"executioner",fancyName:"Executioner",location:{rowIdx:1,colIdx:0},spellIds:[20502,20503],maxPoints:2},{fieldName:"boomingVoice",fancyName:"Booming Voice",location:{rowIdx:1,colIdx:1},spellIds:[12321,12835],maxPoints:2},{fieldName:"rudeInterruption",fancyName:"Rude Interruption",location:{rowIdx:1,colIdx:2},spellIds:[61216,61221],maxPoints:2},{fieldName:"piercingHowl",fancyName:"Piercing Howl",location:{rowIdx:1,colIdx:3},spellIds:[12323],maxPoints:1},{fieldName:"flurry",fancyName:"Flurry",location:{rowIdx:2,colIdx:0},spellIds:[12319,12971,12972],maxPoints:3},{fieldName:"deathWish",fancyName:"Death Wish",location:{rowIdx:2,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"enrage",fancyName:"Enrage",location:{rowIdx:2,colIdx:2},spellIds:[12317,13045,13046],maxPoints:3},{fieldName:"dieByTheSword",fancyName:"Die By The Sword",location:{rowIdx:3,colIdx:0},spellIds:[81913,81914],maxPoints:2},{fieldName:"ragingBlow",fancyName:"Raging Blow",location:{rowIdx:3,colIdx:1},spellIds:[85288],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"rampage",fancyName:"Rampage",location:{rowIdx:3,colIdx:2},spellIds:[29801],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"heroicFury",fancyName:"Heroic Fury",location:{rowIdx:3,colIdx:3},spellIds:[60970],maxPoints:1},{fieldName:"furiousAttacks",fancyName:"Furious Attacks",location:{rowIdx:4,colIdx:0},spellIds:[46910],maxPoints:1},{fieldName:"meatCleaver",fancyName:"Meat Cleaver",location:{rowIdx:4,colIdx:2},spellIds:[12329,12950],maxPoints:2},{fieldName:"intensifyRage",fancyName:"Intensify Rage",location:{rowIdx:4,colIdx:3},spellIds:[46908,46909],maxPoints:2},{fieldName:"bloodsurge",fancyName:"Bloodsurge",location:{rowIdx:5,colIdx:1},spellIds:[46913,46914,46915],maxPoints:3,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"skirmisher",fancyName:"Skirmisher",location:{rowIdx:5,colIdx:2},spellIds:[29888,29889],maxPoints:2},{fieldName:"titansGrip",fancyName:"Titans Grip",location:{rowIdx:6,colIdx:1},spellIds:[46917],maxPoints:1},{fieldName:"singleMindedFury",fancyName:"Single Minded Fury",location:{rowIdx:6,colIdx:2},spellIds:[81099],maxPoints:1}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/845.jpg",talents:[{fieldName:"incite",fancyName:"Incite",location:{rowIdx:0,colIdx:0},spellIds:[50685,50686,50687],maxPoints:3},{fieldName:"toughness",fancyName:"Toughness",location:{rowIdx:0,colIdx:1},spellIds:[12299,12761,12762],maxPoints:3},{fieldName:"bloodAndThunder",fancyName:"Blood And Thunder",location:{rowIdx:0,colIdx:2},spellIds:[84614,84615],maxPoints:2},{fieldName:"shieldSpecialization",fancyName:"Shield Specialization",location:{rowIdx:1,colIdx:0},spellIds:[12298,12724,12725],maxPoints:3},{fieldName:"shieldMastery",fancyName:"Shield Mastery",location:{rowIdx:1,colIdx:1},spellIds:[29598,84607,84608],maxPoints:3},{fieldName:"holdTheLine",fancyName:"Hold The Line",location:{rowIdx:1,colIdx:2},spellIds:[84604,84621],maxPoints:2},{fieldName:"gagOrder",fancyName:"Gag Order",location:{rowIdx:1,colIdx:3},spellIds:[12311,12958],maxPoints:2},{fieldName:"lastStand",fancyName:"Last Stand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1},{fieldName:"concussionBlow",fancyName:"Concussion Blow",location:{rowIdx:2,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"bastionOfDefense",fancyName:"Bastion Of Defense",location:{rowIdx:2,colIdx:2},spellIds:[29593,29594],maxPoints:2},{fieldName:"warbringer",fancyName:"Warbringer",location:{rowIdx:2,colIdx:3},spellIds:[57499],maxPoints:1},{fieldName:"improvedRevenge",fancyName:"Improved Revenge",location:{rowIdx:3,colIdx:0},spellIds:[12797,12799],maxPoints:2},{fieldName:"devastate",fancyName:"Devastate",location:{rowIdx:3,colIdx:2},spellIds:[20243],maxPoints:1},{fieldName:"impendingVictory",fancyName:"Impending Victory",location:{rowIdx:3,colIdx:3},spellIds:[80128,80129],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"thunderstruck",fancyName:"Thunderstruck",location:{rowIdx:4,colIdx:0},spellIds:[80979,80980],maxPoints:2},{fieldName:"vigilance",fancyName:"Vigilance",location:{rowIdx:4,colIdx:1},spellIds:[50720],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"heavyRepercussions",fancyName:"Heavy Repercussions",location:{rowIdx:4,colIdx:3},spellIds:[86894,86896],maxPoints:2},{fieldName:"safeguard",fancyName:"Safeguard",location:{rowIdx:5,colIdx:1},spellIds:[46945,46949],maxPoints:2},{fieldName:"swordAndBoard",fancyName:"Sword And Board",location:{rowIdx:5,colIdx:2},spellIds:[46951,46952,46953],maxPoints:3,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"shockwave",fancyName:"Shockwave",location:{rowIdx:6,colIdx:1},spellIds:[46968],maxPoints:1}]}]),Bl={primeGlyphs:{[pe.GlyphOfBladestorm]:{name:"Glyph of Bladestorm",description:"Reduces the cooldown on Bladestorm by 15 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_bladestorm.jpg"},[pe.GlyphOfBloodthirst]:{name:"Glyph of Bloodthirst",description:"Increases the damage of Bloodthirst by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg"},[pe.GlyphOfDevastate]:{name:"Glyph of Devastate",description:"Increases the critical strike chance of Devastate by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_11.jpg"},[pe.GlyphOfMortalStrike]:{name:"Glyph of Mortal Strike",description:"Increases the damage of Mortal Strike by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_savageblow.jpg"},[pe.GlyphOfOverpower]:{name:"Glyph of Overpower",description:"Increases the damage of Overpower by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg"},[pe.GlyphOfRagingBlow]:{name:"Glyph of Raging Blow",description:"Increases the critical strike chance of Raging Blow by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_swiftstrike.jpg"},[pe.GlyphOfRevenge]:{name:"Glyph of Revenge",description:"Increases the damage of Revenge by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_revenge.jpg"},[pe.GlyphOfShieldSlam]:{name:"Glyph of Shield Slam",description:"Increases the damage of Shield Slam by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_shield_05.jpg"},[pe.GlyphOfSlam]:{name:"Glyph of Slam",description:"Increases the critical strike chance of Slam by 5%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_decisivestrike.jpg"}},majorGlyphs:{[ue.GlyphOfCleaving]:{name:"Glyph of Cleaving",description:"Increases the number of targets your Cleave hits by 1.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_cleave.jpg"},[ue.GlyphOfColossusSmash]:{name:"Glyph of Colossus Smash",description:"Your Colossus Smash also applies the Sunder Armor effect to your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_colossussmash.jpg"},[ue.GlyphOfDeathWish]:{name:"Glyph of Death Wish",description:"Death Wish no longer increases damage taken.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathpact.jpg"},[ue.GlyphOfHeroicThrow]:{name:"Glyph of Heroic Throw",description:"Your Heroic Throw applies a stack of Sunder Armor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_66.jpg"},[ue.GlyphOfIntercept]:{name:"Glyph of Intercept",description:"Increases the duration of your Intercept stun by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[ue.GlyphOfIntervene]:{name:"Glyph of Intervene",description:"Increases the number of attacks you intercept for your Intervene target by 1.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_victoryrush.jpg"},[ue.GlyphOfLongCharge]:{name:"Glyph of Long Charge",description:"Increases the range of your Charge ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg"},[ue.GlyphOfPiercingHowl]:{name:"Glyph of Piercing Howl",description:"Increases the radius of Piercing Howl by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathscream.jpg"},[ue.GlyphOfRapidCharge]:{name:"Glyph of Rapid Charge",description:"Reduces the cooldown of your Charge ability by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg"},[ue.GlyphOfResonatingPower]:{name:"Glyph of Resonating Power",description:"Reduces the rage cost of your Thunder Clap ability by 5.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg"},[ue.GlyphOfShieldWall]:{name:"Glyph of Shield Wall",description:"Shield Wall now reduces damage taken by an additional 20%, but its cooldown is increased by 2 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldwall.jpg"},[ue.GlyphOfShockwave]:{name:"Glyph of Shockwave",description:"Reduces the cooldown on Shockwave by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shockwave.jpg"},[ue.GlyphOfSpellReflection]:{name:"Glyph of Spell Reflection",description:"Reduces the cooldown on Spell Reflection by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldreflection.jpg"},[ue.GlyphOfSunderArmor]:{name:"Glyph of Sunder Armor",description:"When you use Sunder Armor or Devastate, a second nearby target also receives Sunder Armor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_sunder.jpg"},[ue.GlyphOfSweepingStrikes]:{name:"Glyph of Sweeping Strikes",description:"Reduces the rage cost of your Sweeping Strikes ability by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg"},[ue.GlyphOfThunderClap]:{name:"Glyph of Thunder Clap",description:"Increases the radius of your Thunder Clap ability by 2 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg"},[ue.GlyphOfVictoryRush]:{name:"Glyph of Victory Rush",description:"Increases the total healing provided by your Victory Rush by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"}},minorGlyphs:{[ge.GlyphOfBattle]:{name:"Glyph of Battle",description:"Increases the duration by 2 min and area of effect by 50% of your Battle Shout.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg"},[ge.GlyphOfBerserkerRage]:{name:"Glyph of Berserker Rage",description:"Berserker Rage generates 5 Rage when used.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_ancestralguardian.jpg"},[ge.GlyphOfBloodyHealing]:{name:"Glyph of Bloody Healing",description:"Increases the healing you receive from Bloodthirst by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg"},[ge.GlyphOfCommand]:{name:"Glyph of Command",description:"Increases the duration by 2 min and area of effect by 50% of your Commanding Shout.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_rallyingcry.jpg"},[ge.GlyphOfDemoralizingShout]:{name:"Glyph of Demoralizing Shout",description:"Increases the duration by 15 sec and area of effect by 50% of your Demoralizing Shout.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_warcry.jpg"},[ge.GlyphOfEnduringVictory]:{name:"Glyph of Enduring Victory",description:"Increases the window of opportunity in which you can use Victory Rush by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"},[ge.GlyphOfFuriousSundering]:{name:"Glyph of Furious Sundering",description:"Reduces the cost of Sunder Armor by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_sunder.jpg"},[ge.GlyphOfIntimidatingShout]:{name:"Glyph of Intimidating Shout",description:"All targets of your Intimidating Shout now tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemthunderclap.jpg"}}},zl={[O.ClassUnknown]:[],[O.ClassDeathKnight]:xl,[O.ClassDruid]:vl,[O.ClassShaman]:Ll,[O.ClassHunter]:El,[O.ClassMage]:Cl,[O.ClassMonk]:_l,[O.ClassRogue]:Ul,[O.ClassPaladin]:Rl,[O.ClassPriest]:Gl,[O.ClassWarlock]:Ml,[O.ClassWarrior]:Wl},jl={[O.ClassUnknown]:{primeGlyphs:[],majorGlyphs:[],minorGlyphs:[]},[O.ClassDeathKnight]:Sl,[O.ClassDruid]:kl,[O.ClassShaman]:Fl,[O.ClassHunter]:Pl,[O.ClassMage]:Nl,[O.ClassMonk]:Tl,[O.ClassRogue]:Al,[O.ClassPaladin]:Dl,[O.ClassPriest]:Ol,[O.ClassWarlock]:Vl,[O.ClassWarrior]:Bl};function Hl(e,t,a){return t.split("-").forEach(((t,i)=>{const s=a[i];[...t].forEach(((t,a)=>{const i=s.talents[a],o=parseInt(t);i.fieldName&&(1==i.maxPoints?e[i.fieldName]=1==o:e[i.fieldName]=o)}))})),e}function ql(e,t){return t.map((t=>t.talents.map((t=>String(Number(e[t.fieldName])))).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}class Kl extends cl{constructor(e,a){super(e,a,{title:"Sixty Upgrades Cataclysm Import",allowFileUpload:!0}),this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from"," ",t("a",{href:"https://sixtyupgrades.com/cata",target:"_blank"},"Sixty Upgrades"),"."),t("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),t("p",null,"To import, paste the output from the site's export option below and click, 'Import'.")))}async onImport(e){let a;try{a=JSON.parse(e)}catch{throw new Error("Please use a valid Sixty Upgrades export.")}const i=we(a?.character?.gameClass||"");if(i==O.ClassUnknown)throw new Error("Could not parse Class!");const s=ye(a?.character?.race||"");if(s==Ie.RaceUnknown)throw new Error("Could not parse Race!");let o="";if(a?.talents?.length>0){o=function(e,t){return zl[e].map((e=>e.talents.map((e=>{const a=e.spellIds.findIndex((e=>t.includes(e)));return-1==a?"0":String(a+1)})).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}(i,a.talents.map((e=>e.spellId)))}let n=!1;const l=[],c=D.create();a.items.forEach((e=>{const t=P.create();t.id=e.id,e.enchant?.id&&(t.enchant=e.enchant.id),e.gems&&(t.gems=e.gems.filter((e=>e?.id)).map((e=>e.id))),e.suffixId&&(n=!0,e.reforge?.id&&(e.reforge.id=null),l.push(e.name)),e.reforge?.id&&(t.reforging=e.reforge.id),c.items.push(t)})),this.simUI.sim.db.lookupEquipmentSpec(c),this.finishIndividualImport(this.simUI,i,s,c,o,null,[]),n&&l.length&&new Nn({variant:"warning",body:t(r,null,t("p",null,"Sixty Upgrades currently exports the wrong Random Suffixes. We have removed the random suffix on the following item(s):"),t("ul",null,l.map((e=>t("li",null,t("strong",null,e)))))),delay:8e3})}}class $l extends cl{constructor(e,i){super(e,i,{title:"Addon Import",allowFileUpload:!0});const s=a();this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from the"," ",t("a",{href:"https://www.curseforge.com/wow/addons/wowsimsexporter",target:"_blank"},"WoWSims Exporter In-Game Addon"),"."),t("p",null,"This feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),t("p",null,"To import, paste the output from the addon below and click, 'Import'."),t("div",{ref:s}))),s.value&&new Nn({title:"Reforging issues",body:t(r,null,"There are known issues with Reforging when using the WSE addon.",t("br",null),"Always make sure to double check your reforges after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(e){let t;try{t=JSON.parse(e)}catch{throw new Error("Please use a valid Addon export.")}const a=we(t.class||"");if(a==O.ClassUnknown)throw new Error("Could not parse Class!");const i=ye(t.race||"");if(i==Ie.RaceUnknown)throw new Error("Could not parse Race!");const s=t.professions.map((e=>be(e.name)));s.forEach(((e,a)=>{if(e==xe.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[a]}'`)}));const o=t.talents||"",n=jl[a],l=await R.get(),r=t.glyphs.prime.map((e=>Yl(e,l,n.primeGlyphs))),c=t.glyphs.major.map((e=>Yl(e,l,n.majorGlyphs))),d=t.glyphs.minor.map((e=>Yl(e,l,n.minorGlyphs))),m=Se.create({prime1:r[0]||0,prime2:r[1]||0,prime3:r[2]||0,major1:c[0]||0,major2:c[1]||0,major3:c[2]||0,minor1:d[0]||0,minor2:d[1]||0,minor3:d[2]||0}),h=t.gear;h.items=h.items.filter((e=>null!=e)),delete h.version,h.items.forEach((e=>{e.gems&&(e.gems=e.gems.map((e=>e||0)))}));const p=D.fromJson(h);this.finishIndividualImport(this.simUI,a,i,p,o,m,s)}}function Yl(e,t,a){return"string"==typeof e?function(e,t){if(!e)return 0;for(const a in t)if(t[a].name==e)return parseInt(a);throw new Error(`Unknown glyph name '${e}'`)}(e,a):t.glyphSpellToItemId(e.spellID)}class Jl extends cl{constructor(e,a){super(e,a,{title:"JSON Import",allowFileUpload:!0}),this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from a JSON file, which can be created using the JSON Export feature."),t("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){let t=null;try{t=ve.fromJsonString(e,{ignoreUnknownFields:!0})}catch{throw new Error("Please use a valid JSON object.")}t.player?.equipment&&await R.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(n.nextEventID(),t.player):this.simUI.fromProto(n.nextEventID(),t),this.close()}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Zl(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ql=256,Xl=286,er=30,tr=15,ar=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ir=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),sr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),or=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nr=new Array(576);Zl(nr);const lr=new Array(60);Zl(lr);const rr=new Array(512);Zl(rr);const cr=new Array(256);Zl(cr);const dr=new Array(29);Zl(dr);const mr=new Array(er);function hr(e,t,a,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let pr,ur,gr;function fr(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Zl(mr);const wr=e=>e<256?rr[e]:rr[256+(e>>>7)],yr=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ir=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,yr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},br=(e,t,a)=>{Ir(e,a[2*t],a[2*t+1])},xr=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},Sr=(e,t,a)=>{const i=new Array(16);let s,o,n=0;for(s=1;s<=tr;s++)n=n+a[s-1]<<1,i[s]=n;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=xr(i[t]++,t))}},vr=e=>{let t;for(t=0;t<Xl;t++)e.dyn_ltree[2*t]=0;for(t=0;t<er;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},kr=e=>{e.bi_valid>8?yr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Er=(e,t,a,i)=>{const s=2*t,o=2*a;return e[s]<e[o]||e[s]===e[o]&&i[t]<=i[a]},Pr=(e,t,a)=>{const i=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Er(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!Er(t,i,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=i},Cr=(e,t,a)=>{let i,s,o,n,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,s=e.pending_buf[e.sym_buf+l++],0===i?br(e,s,t):(o=cr[s],br(e,o+Ql+1,t),n=ar[o],0!==n&&(s-=dr[o],Ir(e,s,n)),i--,o=wr(i),br(e,o,a),n=ir[o],0!==n&&(i-=mr[o],Ir(e,i,n)))}while(l<e.sym_next);br(e,256,t)},Nr=(e,t)=>{const a=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let n,l,r,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<o;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=c<2?++c:0,a[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=i[2*r+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)Pr(e,a,n);r=o;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Pr(e,a,1),l=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=l,a[2*r]=a[2*n]+a[2*l],e.depth[r]=(e.depth[n]>=e.depth[l]?e.depth[n]:e.depth[l])+1,a[2*n+1]=a[2*l+1]=r,e.heap[1]=r++,Pr(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,n=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let c,d,m,h,p,u,g=0;for(h=0;h<=tr;h++)e.bl_count[h]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],h=a[2*a[2*d+1]+1]+1,h>r&&(h=r,g++),a[2*d+1]=h,d>i||(e.bl_count[h]++,p=0,d>=l&&(p=n[d-l]),u=a[2*d],e.opt_len+=u*(h+p),o&&(e.static_len+=u*(s[2*d+1]+p)));if(0!==g){do{for(h=r-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(h=r;0!==h;h--)for(d=e.bl_count[h];0!==d;)m=e.heap[--c],m>i||(a[2*m+1]!==h&&(e.opt_len+=(h-a[2*m+1])*a[2*m],a[2*m+1]=h),d--)}})(e,t),Sr(a,c,e.bl_count)},_r=(e,t,a)=>{let i,s,o=-1,n=t[1],l=0,r=7,c=4;for(0===n&&(r=138,c=3),t[2*(a+1)+1]=65535,i=0;i<=a;i++)s=n,n=t[2*(i+1)+1],++l<r&&s===n||(l<c?e.bl_tree[2*s]+=l:0!==s?(s!==o&&e.bl_tree[2*s]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,o=s,0===n?(r=138,c=3):s===n?(r=6,c=3):(r=7,c=4))},Tr=(e,t,a)=>{let i,s,o=-1,n=t[1],l=0,r=7,c=4;for(0===n&&(r=138,c=3),i=0;i<=a;i++)if(s=n,n=t[2*(i+1)+1],!(++l<r&&s===n)){if(l<c)do{br(e,s,e.bl_tree)}while(0!=--l);else 0!==s?(s!==o&&(br(e,s,e.bl_tree),l--),br(e,16,e.bl_tree),Ir(e,l-3,2)):l<=10?(br(e,17,e.bl_tree),Ir(e,l-3,3)):(br(e,18,e.bl_tree),Ir(e,l-11,7));l=0,o=s,0===n?(r=138,c=3):s===n?(r=6,c=3):(r=7,c=4)}};let Rr=!1;const Dr=(e,t,a,i)=>{Ir(e,0+(i?1:0),3),kr(e),yr(e,a),yr(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var Gr={_tr_init:e=>{Rr||((()=>{let e,t,a,i,s;const o=new Array(16);for(a=0,i=0;i<28;i++)for(dr[i]=a,e=0;e<1<<ar[i];e++)cr[a++]=i;for(cr[a-1]=i,s=0,i=0;i<16;i++)for(mr[i]=s,e=0;e<1<<ir[i];e++)rr[s++]=i;for(s>>=7;i<er;i++)for(mr[i]=s<<7,e=0;e<1<<ir[i]-7;e++)rr[256+s++]=i;for(t=0;t<=tr;t++)o[t]=0;for(e=0;e<=143;)nr[2*e+1]=8,e++,o[8]++;for(;e<=255;)nr[2*e+1]=9,e++,o[9]++;for(;e<=279;)nr[2*e+1]=7,e++,o[7]++;for(;e<=287;)nr[2*e+1]=8,e++,o[8]++;for(Sr(nr,287,o),e=0;e<er;e++)lr[2*e+1]=5,lr[2*e]=xr(e,5);pr=new hr(nr,ar,257,Xl,tr),ur=new hr(lr,ir,0,er,tr),gr=new hr(new Array(0),sr,0,19,7)})(),Rr=!0),e.l_desc=new fr(e.dyn_ltree,pr),e.d_desc=new fr(e.dyn_dtree,ur),e.bl_desc=new fr(e.bl_tree,gr),e.bi_buf=0,e.bi_valid=0,vr(e)},_tr_stored_block:Dr,_tr_flush_block:(e,t,a,i)=>{let s,o,n=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ql;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Nr(e,e.l_desc),Nr(e,e.d_desc),n=(e=>{let t;for(_r(e,e.dyn_ltree,e.l_desc.max_code),_r(e,e.dyn_dtree,e.d_desc.max_code),Nr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*or[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=a+5,a+4<=s&&-1!==t?Dr(e,t,a,i):4===e.strategy||o===s?(Ir(e,2+(i?1:0),3),Cr(e,nr,lr)):(Ir(e,4+(i?1:0),3),((e,t,a,i)=>{let s;for(Ir(e,t-257,5),Ir(e,a-1,5),Ir(e,i-4,4),s=0;s<i;s++)Ir(e,e.bl_tree[2*or[s]+1],3);Tr(e,e.dyn_ltree,t-1),Tr(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,n+1),Cr(e,e.dyn_ltree,e.dyn_dtree)),vr(e),i&&kr(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(cr[a]+Ql+1)]++,e.dyn_dtree[2*wr(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Ir(e,2,3),br(e,256,nr),(e=>{16===e.bi_valid?(yr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Or=(e,t,a,i)=>{let s=65535&e,o=e>>>16&65535,n=0;for(;0!==a;){n=a>2e3?2e3:a,a-=n;do{s=s+t[i++]|0,o=o+s|0}while(--n);s%=65521,o%=65521}return s|o<<16};const Ur=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var Ar=(e,t,a,i)=>{const s=Ur,o=i+a;e^=-1;for(let n=i;n<o;n++)e=e>>>8^s[255&(e^t[n])];return~e},Lr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Fr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Mr,_tr_stored_block:Vr,_tr_flush_block:Wr,_tr_tally:Br,_tr_align:zr}=Gr,{Z_NO_FLUSH:jr,Z_PARTIAL_FLUSH:Hr,Z_FULL_FLUSH:qr,Z_FINISH:Kr,Z_BLOCK:$r,Z_OK:Yr,Z_STREAM_END:Jr,Z_STREAM_ERROR:Zr,Z_DATA_ERROR:Qr,Z_BUF_ERROR:Xr,Z_DEFAULT_COMPRESSION:ec,Z_FILTERED:tc,Z_HUFFMAN_ONLY:ac,Z_RLE:ic,Z_FIXED:sc,Z_DEFAULT_STRATEGY:oc,Z_UNKNOWN:nc,Z_DEFLATED:lc}=Fr,rc=258,cc=262,dc=42,mc=113,hc=666,pc=(e,t)=>(e.msg=Lr[t],t),uc=e=>2*e-(e>4?9:0),gc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},fc=e=>{let t,a,i,s=e.w_size;t=e.hash_size,i=t;do{a=e.head[--i],e.head[i]=a>=s?a-s:0}while(--t);t=s,i=t;do{a=e.prev[--i],e.prev[i]=a>=s?a-s:0}while(--t)};let wc=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const yc=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},Ic=(e,t)=>{Wr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,yc(e.strm)},bc=(e,t)=>{e.pending_buf[e.pending++]=t},xc=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Sc=(e,t,a,i)=>{let s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=Or(e.adler,t,s,a):2===e.state.wrap&&(e.adler=Ar(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},vc=(e,t)=>{let a,i,s=e.max_chain_length,o=e.strstart,n=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-cc?e.strstart-(e.w_size-cc):0,c=e.window,d=e.w_mask,m=e.prev,h=e.strstart+rc;let p=c[o+n-1],u=c[o+n];e.prev_length>=e.good_match&&(s>>=2),l>e.lookahead&&(l=e.lookahead);do{if(a=t,c[a+n]===u&&c[a+n-1]===p&&c[a]===c[o]&&c[++a]===c[o+1]){o+=2,a++;do{}while(c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&c[++o]===c[++a]&&o<h);if(i=rc-(h-o),o=h-rc,i>n){if(e.match_start=t,n=i,i>=l)break;p=c[o+n-1],u=c[o+n]}}}while((t=m[t&d])>r&&0!=--s);return n<=e.lookahead?n:e.lookahead},kc=e=>{const t=e.w_size;let a,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-cc)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),fc(e),i+=t),0===e.strm.avail_in)break;if(a=Sc(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=wc(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=wc(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<cc&&0!==e.strm.avail_in)},Ec=(e,t)=>{let a,i,s,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n=0,l=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,i=e.strstart-e.block_start,a>i+e.strm.avail_in&&(a=i+e.strm.avail_in),a>s&&(a=s),a<o&&(0===a&&t!==Kr||t===jr||a!==i+e.strm.avail_in))break;n=t===Kr&&a===i+e.strm.avail_in?1:0,Vr(e,0,0,n),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,yc(e.strm),i&&(i>a&&(i=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,a-=i),a&&(Sc(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===n);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),n?4:t!==jr&&t!==Kr&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(Sc(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,o=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=o||(i||t===Kr)&&t!==jr&&0===e.strm.avail_in&&i<=s)&&(a=i>s?s:i,n=t===Kr&&0===e.strm.avail_in&&a===i?1:0,Vr(e,e.block_start,a,n),e.block_start+=a,yc(e.strm)),n?3:1)},Pc=(e,t)=>{let a,i;for(;;){if(e.lookahead<cc){if(kc(e),e.lookahead<cc&&t===jr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=wc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-cc&&(e.match_length=vc(e,a)),e.match_length>=3)if(i=Br(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=wc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=wc(e,e.ins_h,e.window[e.strstart+1]);else i=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ic(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Kr?(Ic(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ic(e,!1),0===e.strm.avail_out)?1:2},Cc=(e,t)=>{let a,i,s;for(;;){if(e.lookahead<cc){if(kc(e),e.lookahead<cc&&t===jr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=wc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-cc&&(e.match_length=vc(e,a),e.match_length<=5&&(e.strategy===tc||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=Br(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=wc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Ic(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Br(e,0,e.window[e.strstart-1]),i&&Ic(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Br(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Kr?(Ic(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ic(e,!1),0===e.strm.avail_out)?1:2};function Nc(e,t,a,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=i,this.func=s}const _c=[new Nc(0,0,0,0,Ec),new Nc(4,4,8,4,Pc),new Nc(4,5,16,8,Pc),new Nc(4,6,32,32,Pc),new Nc(4,4,16,16,Cc),new Nc(8,16,32,32,Cc),new Nc(8,16,128,128,Cc),new Nc(8,32,128,256,Cc),new Nc(32,128,258,1024,Cc),new Nc(32,258,258,4096,Cc)];function Tc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=lc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),gc(this.dyn_ltree),gc(this.dyn_dtree),gc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),gc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),gc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Rc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==dc&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==mc&&t.status!==hc?1:0},Dc=e=>{if(Rc(e))return pc(e,Zr);e.total_in=e.total_out=0,e.data_type=nc;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?dc:mc,e.adler=2===t.wrap?0:1,t.last_flush=-2,Mr(t),Yr},Gc=e=>{const t=Dc(e);var a;return t===Yr&&((a=e.state).window_size=2*a.w_size,gc(a.head),a.max_lazy_match=_c[a.level].max_lazy,a.good_match=_c[a.level].good_length,a.nice_match=_c[a.level].nice_length,a.max_chain_length=_c[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},Oc=(e,t,a,i,s,o)=>{if(!e)return Zr;let n=1;if(t===ec&&(t=6),i<0?(n=0,i=-i):i>15&&(n=2,i-=16),s<1||s>9||a!==lc||i<8||i>15||t<0||t>9||o<0||o>sc||8===i&&1!==n)return pc(e,Zr);8===i&&(i=9);const l=new Tc;return e.state=l,l.strm=e,l.status=dc,l.wrap=n,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=o,l.method=a,Gc(e)};var Uc={deflateInit:(e,t)=>Oc(e,t,lc,15,8,oc),deflateInit2:Oc,deflateReset:Gc,deflateResetKeep:Dc,deflateSetHeader:(e,t)=>Rc(e)||2!==e.state.wrap?Zr:(e.state.gzhead=t,Yr),deflate:(e,t)=>{if(Rc(e)||t>$r||t<0)return e?pc(e,Zr):Zr;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===hc&&t!==Kr)return pc(e,0===e.avail_out?Xr:Zr);const i=a.last_flush;if(a.last_flush=t,0!==a.pending){if(yc(e),0===e.avail_out)return a.last_flush=-1,Yr}else if(0===e.avail_in&&uc(t)<=uc(i)&&t!==Kr)return pc(e,Xr);if(a.status===hc&&0!==e.avail_in)return pc(e,Xr);if(a.status===dc&&0===a.wrap&&(a.status=mc),a.status===dc){let t=lc+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=ac||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,xc(a,t),0!==a.strstart&&(xc(a,e.adler>>>16),xc(a,65535&e.adler)),e.adler=1,a.status=mc,yc(e),0!==a.pending)return a.last_flush=-1,Yr}if(57===a.status)if(e.adler=0,bc(a,31),bc(a,139),bc(a,8),a.gzhead)bc(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),bc(a,255&a.gzhead.time),bc(a,a.gzhead.time>>8&255),bc(a,a.gzhead.time>>16&255),bc(a,a.gzhead.time>>24&255),bc(a,9===a.level?2:a.strategy>=ac||a.level<2?4:0),bc(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(bc(a,255&a.gzhead.extra.length),bc(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=Ar(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(bc(a,0),bc(a,0),bc(a,0),bc(a,0),bc(a,0),bc(a,9===a.level?2:a.strategy>=ac||a.level<2?4:0),bc(a,3),a.status=mc,yc(e),0!==a.pending)return a.last_flush=-1,Yr;if(69===a.status){if(a.gzhead.extra){let t=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,yc(e),0!==a.pending)return a.last_flush=-1,Yr;t=0,i-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>t&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-i,i)),yc(e),0!==a.pending)return a.last_flush=-1,Yr;i=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,bc(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-i,i)),yc(e),0!==a.pending)return a.last_flush=-1,Yr;i=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,bc(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=Ar(e.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(yc(e),0!==a.pending))return a.last_flush=-1,Yr;bc(a,255&e.adler),bc(a,e.adler>>8&255),e.adler=0}if(a.status=mc,yc(e),0!==a.pending)return a.last_flush=-1,Yr}if(0!==e.avail_in||0!==a.lookahead||t!==jr&&a.status!==hc){let i=0===a.level?Ec(a,t):a.strategy===ac?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(kc(e),0===e.lookahead)){if(t===jr)return 1;break}if(e.match_length=0,a=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(Ic(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Kr?(Ic(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ic(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===ic?((e,t)=>{let a,i,s,o;const n=e.window;for(;;){if(e.lookahead<=rc){if(kc(e),e.lookahead<=rc&&t===jr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,i=n[s],i===n[++s]&&i===n[++s]&&i===n[++s])){o=e.strstart+rc;do{}while(i===n[++s]&&i===n[++s]&&i===n[++s]&&i===n[++s]&&i===n[++s]&&i===n[++s]&&i===n[++s]&&i===n[++s]&&s<o);e.match_length=rc-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=Br(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(Ic(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Kr?(Ic(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ic(e,!1),0===e.strm.avail_out)?1:2})(a,t):_c[a.level].func(a,t);if(3!==i&&4!==i||(a.status=hc),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Yr;if(2===i&&(t===Hr?zr(a):t!==$r&&(Vr(a,0,0,!1),t===qr&&(gc(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),yc(e),0===e.avail_out))return a.last_flush=-1,Yr}return t!==Kr?Yr:a.wrap<=0?Jr:(2===a.wrap?(bc(a,255&e.adler),bc(a,e.adler>>8&255),bc(a,e.adler>>16&255),bc(a,e.adler>>24&255),bc(a,255&e.total_in),bc(a,e.total_in>>8&255),bc(a,e.total_in>>16&255),bc(a,e.total_in>>24&255)):(xc(a,e.adler>>>16),xc(a,65535&e.adler)),yc(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Yr:Jr)},deflateEnd:e=>{if(Rc(e))return Zr;const t=e.state.status;return e.state=null,t===mc?pc(e,Qr):Yr},deflateSetDictionary:(e,t)=>{let a=t.length;if(Rc(e))return Zr;const i=e.state,s=i.wrap;if(2===s||1===s&&i.status!==dc||i.lookahead)return Zr;if(1===s&&(e.adler=Or(e.adler,t,a,0)),i.wrap=0,a>=i.w_size){0===s&&(gc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(a-i.w_size,a),0),t=e,a=i.w_size}const o=e.avail_in,n=e.next_in,l=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,kc(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=wc(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,kc(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=n,e.input=l,e.avail_in=o,i.wrap=s,Yr},deflateInfo:"pako deflate (from Nodeca project)"};const Ac=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Lc={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)Ac(a,t)&&(e[t]=a[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const a=new Uint8Array(t);for(let i=0,s=0,o=e.length;i<o;i++){let t=e[i];a.set(t,s),s+=t.length}return a}};let Fc=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(gw){Fc=!1}const Mc=new Uint8Array(256);for(let fw=0;fw<256;fw++)Mc[fw]=fw>=252?6:fw>=248?5:fw>=240?4:fw>=224?3:fw>=192?2:1;Mc[254]=Mc[254]=1;var Vc={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,i,s,o,n=e.length,l=0;for(s=0;s<n;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<n&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),l+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(l),o=0,s=0;o<l;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<n&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),a<128?t[o++]=a:a<2048?(t[o++]=192|a>>>6,t[o++]=128|63&a):a<65536?(t[o++]=224|a>>>12,t[o++]=128|a>>>6&63,t[o++]=128|63&a):(t[o++]=240|a>>>18,t[o++]=128|a>>>12&63,t[o++]=128|a>>>6&63,t[o++]=128|63&a);return t},buf2string:(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const o=new Array(2*a);for(s=0,i=0;i<a;){let t=e[i++];if(t<128){o[s++]=t;continue}let n=Mc[t];if(n>4)o[s++]=65533,i+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&i<a;)t=t<<6|63&e[i++],n--;n>1?o[s++]=65533:t<65536?o[s++]=t:(t-=65536,o[s++]=55296|t>>10&1023,o[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Fc)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let i=0;i<t;i++)a+=String.fromCharCode(e[i]);return a})(o,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+Mc[e[a]]>t?a:t}};var Wc=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Bc=Object.prototype.toString,{Z_NO_FLUSH:zc,Z_SYNC_FLUSH:jc,Z_FULL_FLUSH:Hc,Z_FINISH:qc,Z_OK:Kc,Z_STREAM_END:$c,Z_DEFAULT_COMPRESSION:Yc,Z_DEFAULT_STRATEGY:Jc,Z_DEFLATED:Zc}=Fr;function Qc(e){this.options=Lc.assign({level:Yc,method:Zc,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jc},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wc,this.strm.avail_out=0;let a=Uc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==Kc)throw new Error(Lr[a]);if(t.header&&Uc.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Vc.string2buf(t.dictionary):"[object ArrayBuffer]"===Bc.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=Uc.deflateSetDictionary(this.strm,e),a!==Kc)throw new Error(Lr[a]);this._dict_set=!0}}function Xc(e,t){const a=new Qc(t);if(a.push(e,!0),a.err)throw a.msg||Lr[a.err];return a.result}Qc.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize;let s,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?qc:zc,"string"==typeof e?a.input=Vc.string2buf(e):"[object ArrayBuffer]"===Bc.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(o===jc||o===Hc)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=Uc.deflate(a,o),s===$c)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=Uc.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Kc;if(0!==a.avail_out){if(o>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Qc.prototype.onData=function(e){this.chunks.push(e)},Qc.prototype.onEnd=function(e){e===Kc&&(this.result=Lc.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ed={Deflate:Qc,deflate:Xc,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Xc(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Xc(e,t)},constants:Fr};const td=16209;var ad=function(e,t){let a,i,s,o,n,l,r,c,d,m,h,p,u,g,f,w,y,I,b,x,S,v,k,E;const P=e.state;a=e.next_in,k=e.input,i=a+(e.avail_in-5),s=e.next_out,E=e.output,o=s-(t-e.avail_out),n=s+(e.avail_out-257),l=P.dmax,r=P.wsize,c=P.whave,d=P.wnext,m=P.window,h=P.hold,p=P.bits,u=P.lencode,g=P.distcode,f=(1<<P.lenbits)-1,w=(1<<P.distbits)-1;e:do{p<15&&(h+=k[a++]<<p,p+=8,h+=k[a++]<<p,p+=8),y=u[h&f];t:for(;;){if(I=y>>>24,h>>>=I,p-=I,I=y>>>16&255,0===I)E[s++]=65535&y;else{if(!(16&I)){if(64&I){if(32&I){P.mode=16191;break e}e.msg="invalid literal/length code",P.mode=td;break e}y=u[(65535&y)+(h&(1<<I)-1)];continue t}for(b=65535&y,I&=15,I&&(p<I&&(h+=k[a++]<<p,p+=8),b+=h&(1<<I)-1,h>>>=I,p-=I),p<15&&(h+=k[a++]<<p,p+=8,h+=k[a++]<<p,p+=8),y=g[h&w];;){if(I=y>>>24,h>>>=I,p-=I,I=y>>>16&255,16&I){if(x=65535&y,I&=15,p<I&&(h+=k[a++]<<p,p+=8,p<I&&(h+=k[a++]<<p,p+=8)),x+=h&(1<<I)-1,x>l){e.msg="invalid distance too far back",P.mode=td;break e}if(h>>>=I,p-=I,I=s-o,x>I){if(I=x-I,I>c&&P.sane){e.msg="invalid distance too far back",P.mode=td;break e}if(S=0,v=m,0===d){if(S+=r-I,I<b){b-=I;do{E[s++]=m[S++]}while(--I);S=s-x,v=E}}else if(d<I){if(S+=r+d-I,I-=d,I<b){b-=I;do{E[s++]=m[S++]}while(--I);if(S=0,d<b){I=d,b-=I;do{E[s++]=m[S++]}while(--I);S=s-x,v=E}}}else if(S+=d-I,I<b){b-=I;do{E[s++]=m[S++]}while(--I);S=s-x,v=E}for(;b>2;)E[s++]=v[S++],E[s++]=v[S++],E[s++]=v[S++],b-=3;b&&(E[s++]=v[S++],b>1&&(E[s++]=v[S++]))}else{S=s-x;do{E[s++]=E[S++],E[s++]=E[S++],E[s++]=E[S++],b-=3}while(b>2);b&&(E[s++]=E[S++],b>1&&(E[s++]=E[S++]))}break}if(64&I){e.msg="invalid distance code",P.mode=td;break e}y=g[(65535&y)+(h&(1<<I)-1)]}}break}}while(a<i&&s<n);b=p>>3,a-=b,p-=b<<3,h&=(1<<p)-1,e.next_in=a,e.next_out=s,e.avail_in=a<i?i-a+5:5-(a-i),e.avail_out=s<n?n-s+257:257-(s-n),P.hold=h,P.bits=p};const id=15,sd=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),od=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),nd=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ld=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var rd=(e,t,a,i,s,o,n,l)=>{const r=l.bits;let c,d,m,h,p,u,g=0,f=0,w=0,y=0,I=0,b=0,x=0,S=0,v=0,k=0,E=null;const P=new Uint16Array(16),C=new Uint16Array(16);let N,_,T,R=null;for(g=0;g<=id;g++)P[g]=0;for(f=0;f<i;f++)P[t[a+f]]++;for(I=r,y=id;y>=1&&0===P[y];y--);if(I>y&&(I=y),0===y)return s[o++]=20971520,s[o++]=20971520,l.bits=1,0;for(w=1;w<y&&0===P[w];w++);for(I<w&&(I=w),S=1,g=1;g<=id;g++)if(S<<=1,S-=P[g],S<0)return-1;if(S>0&&(0===e||1!==y))return-1;for(C[1]=0,g=1;g<id;g++)C[g+1]=C[g]+P[g];for(f=0;f<i;f++)0!==t[a+f]&&(n[C[t[a+f]]++]=f);if(0===e?(E=R=n,u=20):1===e?(E=sd,R=od,u=257):(E=nd,R=ld,u=0),k=0,f=0,g=w,p=o,b=I,x=0,m=-1,v=1<<I,h=v-1,1===e&&v>852||2===e&&v>592)return 1;for(;;){N=g-x,n[f]+1<u?(_=0,T=n[f]):n[f]>=u?(_=R[n[f]-u],T=E[n[f]-u]):(_=96,T=0),c=1<<g-x,d=1<<b,w=d;do{d-=c,s[p+(k>>x)+d]=N<<24|_<<16|T}while(0!==d);for(c=1<<g-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,f++,0==--P[g]){if(g===y)break;g=t[a+n[f]]}if(g>I&&(k&h)!==m){for(0===x&&(x=I),p+=w,b=g-x,S=1<<b;b+x<y&&(S-=P[b+x],!(S<=0));)b++,S<<=1;if(v+=1<<b,1===e&&v>852||2===e&&v>592)return 1;m=k&h,s[m]=I<<24|b<<16|p-o}}return 0!==k&&(s[p+k]=g-x<<24|64<<16),l.bits=I,0};const{Z_FINISH:cd,Z_BLOCK:dd,Z_TREES:md,Z_OK:hd,Z_STREAM_END:pd,Z_NEED_DICT:ud,Z_STREAM_ERROR:gd,Z_DATA_ERROR:fd,Z_MEM_ERROR:wd,Z_BUF_ERROR:yd,Z_DEFLATED:Id}=Fr,bd=16180,xd=16190,Sd=16191,vd=16192,kd=16194,Ed=16199,Pd=16200,Cd=16206,Nd=16209,_d=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Td(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<bd||t.mode>16211?1:0},Dd=e=>{if(Rd(e))return gd;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=bd,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,hd},Gd=e=>{if(Rd(e))return gd;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Dd(e)},Od=(e,t)=>{let a;if(Rd(e))return gd;const i=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?gd:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=a,i.wbits=t,Gd(e))},Ud=(e,t)=>{if(!e)return gd;const a=new Td;e.state=a,a.strm=e,a.window=null,a.mode=bd;const i=Od(e,t);return i!==hd&&(e.state=null),i};let Ad,Ld,Fd=!0;const Md=e=>{if(Fd){Ad=new Int32Array(512),Ld=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(rd(1,e.lens,0,288,Ad,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;rd(2,e.lens,0,32,Ld,0,e.work,{bits:5}),Fd=!1}e.lencode=Ad,e.lenbits=9,e.distcode=Ld,e.distbits=5},Vd=(e,t,a,i)=>{let s;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(a-o.wsize,a),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),o.window.set(t.subarray(a-i,a-i+s),o.wnext),(i-=s)?(o.window.set(t.subarray(a-i,a),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0};var Wd={inflateReset:Gd,inflateReset2:Od,inflateResetKeep:Dd,inflateInit:e=>Ud(e,15),inflateInit2:Ud,inflate:(e,t)=>{let a,i,s,o,n,l,r,c,d,m,h,p,u,g,f,w,y,I,b,x,S,v,k=0;const E=new Uint8Array(4);let P,C;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rd(e)||!e.output||!e.input&&0!==e.avail_in)return gd;a=e.state,a.mode===Sd&&(a.mode=vd),n=e.next_out,s=e.output,r=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,c=a.hold,d=a.bits,m=l,h=r,v=hd;e:for(;;)switch(a.mode){case bd:if(0===a.wrap){a.mode=vd;break}for(;d<16;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(2&a.wrap&&35615===c){0===a.wbits&&(a.wbits=15),a.check=0,E[0]=255&c,E[1]=c>>>8&255,a.check=Ar(a.check,E,2,0),c=0,d=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",a.mode=Nd;break}if((15&c)!==Id){e.msg="unknown compression method",a.mode=Nd;break}if(c>>>=4,d-=4,S=8+(15&c),0===a.wbits&&(a.wbits=S),S>15||S>a.wbits){e.msg="invalid window size",a.mode=Nd;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&c?16189:Sd,c=0,d=0;break;case 16181:for(;d<16;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(a.flags=c,(255&a.flags)!==Id){e.msg="unknown compression method",a.mode=Nd;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=Nd;break}a.head&&(a.head.text=c>>8&1),512&a.flags&&4&a.wrap&&(E[0]=255&c,E[1]=c>>>8&255,a.check=Ar(a.check,E,2,0)),c=0,d=0,a.mode=16182;case 16182:for(;d<32;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.head&&(a.head.time=c),512&a.flags&&4&a.wrap&&(E[0]=255&c,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,a.check=Ar(a.check,E,4,0)),c=0,d=0,a.mode=16183;case 16183:for(;d<16;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.head&&(a.head.xflags=255&c,a.head.os=c>>8),512&a.flags&&4&a.wrap&&(E[0]=255&c,E[1]=c>>>8&255,a.check=Ar(a.check,E,2,0)),c=0,d=0,a.mode=16184;case 16184:if(1024&a.flags){for(;d<16;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.length=c,a.head&&(a.head.extra_len=c),512&a.flags&&4&a.wrap&&(E[0]=255&c,E[1]=c>>>8&255,a.check=Ar(a.check,E,2,0)),c=0,d=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(p=a.length,p>l&&(p=l),p&&(a.head&&(S=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(o,o+p),S)),512&a.flags&&4&a.wrap&&(a.check=Ar(a.check,i,p,o)),l-=p,o+=p,a.length-=p),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===l)break e;p=0;do{S=i[o+p++],a.head&&S&&a.length<65536&&(a.head.name+=String.fromCharCode(S))}while(S&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=Ar(a.check,i,p,o)),l-=p,o+=p,S)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===l)break e;p=0;do{S=i[o+p++],a.head&&S&&a.length<65536&&(a.head.comment+=String.fromCharCode(S))}while(S&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=Ar(a.check,i,p,o)),l-=p,o+=p,S)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;d<16;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(4&a.wrap&&c!==(65535&a.check)){e.msg="header crc mismatch",a.mode=Nd;break}c=0,d=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=Sd;break;case 16189:for(;d<32;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}e.adler=a.check=_d(c),c=0,d=0,a.mode=xd;case xd:if(0===a.havedict)return e.next_out=n,e.avail_out=r,e.next_in=o,e.avail_in=l,a.hold=c,a.bits=d,ud;e.adler=a.check=1,a.mode=Sd;case Sd:if(t===dd||t===md)break e;case vd:if(a.last){c>>>=7&d,d-=7&d,a.mode=Cd;break}for(;d<3;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}switch(a.last=1&c,c>>>=1,d-=1,3&c){case 0:a.mode=16193;break;case 1:if(Md(a),a.mode=Ed,t===md){c>>>=2,d-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=Nd}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",a.mode=Nd;break}if(a.length=65535&c,c=0,d=0,a.mode=kd,t===md)break e;case kd:a.mode=16195;case 16195:if(p=a.length,p){if(p>l&&(p=l),p>r&&(p=r),0===p)break e;s.set(i.subarray(o,o+p),n),l-=p,o+=p,r-=p,n+=p,a.length-=p;break}a.mode=Sd;break;case 16196:for(;d<14;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(a.nlen=257+(31&c),c>>>=5,d-=5,a.ndist=1+(31&c),c>>>=5,d-=5,a.ncode=4+(15&c),c>>>=4,d-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=Nd;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;d<3;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.lens[N[a.have++]]=7&c,c>>>=3,d-=3}for(;a.have<19;)a.lens[N[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,P={bits:a.lenbits},v=rd(0,a.lens,0,19,a.lencode,0,a.work,P),a.lenbits=P.bits,v){e.msg="invalid code lengths set",a.mode=Nd;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=d);){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(y<16)c>>>=f,d-=f,a.lens[a.have++]=y;else{if(16===y){for(C=f+2;d<C;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(c>>>=f,d-=f,0===a.have){e.msg="invalid bit length repeat",a.mode=Nd;break}S=a.lens[a.have-1],p=3+(3&c),c>>>=2,d-=2}else if(17===y){for(C=f+3;d<C;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}c>>>=f,d-=f,S=0,p=3+(7&c),c>>>=3,d-=3}else{for(C=f+7;d<C;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}c>>>=f,d-=f,S=0,p=11+(127&c),c>>>=7,d-=7}if(a.have+p>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=Nd;break}for(;p--;)a.lens[a.have++]=S}}if(a.mode===Nd)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=Nd;break}if(a.lenbits=9,P={bits:a.lenbits},v=rd(1,a.lens,0,a.nlen,a.lencode,0,a.work,P),a.lenbits=P.bits,v){e.msg="invalid literal/lengths set",a.mode=Nd;break}if(a.distbits=6,a.distcode=a.distdyn,P={bits:a.distbits},v=rd(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,P),a.distbits=P.bits,v){e.msg="invalid distances set",a.mode=Nd;break}if(a.mode=Ed,t===md)break e;case Ed:a.mode=Pd;case Pd:if(l>=6&&r>=258){e.next_out=n,e.avail_out=r,e.next_in=o,e.avail_in=l,a.hold=c,a.bits=d,ad(e,h),n=e.next_out,s=e.output,r=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,c=a.hold,d=a.bits,a.mode===Sd&&(a.back=-1);break}for(a.back=0;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=d);){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(w&&!(240&w)){for(I=f,b=w,x=y;k=a.lencode[x+((c&(1<<I+b)-1)>>I)],f=k>>>24,w=k>>>16&255,y=65535&k,!(I+f<=d);){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}c>>>=I,d-=I,a.back+=I}if(c>>>=f,d-=f,a.back+=f,a.length=y,0===w){a.mode=16205;break}if(32&w){a.back=-1,a.mode=Sd;break}if(64&w){e.msg="invalid literal/length code",a.mode=Nd;break}a.extra=15&w,a.mode=16201;case 16201:if(a.extra){for(C=a.extra;d<C;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.length+=c&(1<<a.extra)-1,c>>>=a.extra,d-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;k=a.distcode[c&(1<<a.distbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=d);){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(!(240&w)){for(I=f,b=w,x=y;k=a.distcode[x+((c&(1<<I+b)-1)>>I)],f=k>>>24,w=k>>>16&255,y=65535&k,!(I+f<=d);){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}c>>>=I,d-=I,a.back+=I}if(c>>>=f,d-=f,a.back+=f,64&w){e.msg="invalid distance code",a.mode=Nd;break}a.offset=y,a.extra=15&w,a.mode=16203;case 16203:if(a.extra){for(C=a.extra;d<C;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}a.offset+=c&(1<<a.extra)-1,c>>>=a.extra,d-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=Nd;break}a.mode=16204;case 16204:if(0===r)break e;if(p=h-r,a.offset>p){if(p=a.offset-p,p>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=Nd;break}p>a.wnext?(p-=a.wnext,u=a.wsize-p):u=a.wnext-p,p>a.length&&(p=a.length),g=a.window}else g=s,u=n-a.offset,p=a.length;p>r&&(p=r),r-=p,a.length-=p;do{s[n++]=g[u++]}while(--p);0===a.length&&(a.mode=Pd);break;case 16205:if(0===r)break e;s[n++]=a.length,r--,a.mode=Pd;break;case Cd:if(a.wrap){for(;d<32;){if(0===l)break e;l--,c|=i[o++]<<d,d+=8}if(h-=r,e.total_out+=h,a.total+=h,4&a.wrap&&h&&(e.adler=a.check=a.flags?Ar(a.check,s,h,n-h):Or(a.check,s,h,n-h)),h=r,4&a.wrap&&(a.flags?c:_d(c))!==a.check){e.msg="incorrect data check",a.mode=Nd;break}c=0,d=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;d<32;){if(0===l)break e;l--,c+=i[o++]<<d,d+=8}if(4&a.wrap&&c!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=Nd;break}c=0,d=0}a.mode=16208;case 16208:v=pd;break e;case Nd:v=fd;break e;case 16210:return wd;default:return gd}return e.next_out=n,e.avail_out=r,e.next_in=o,e.avail_in=l,a.hold=c,a.bits=d,(a.wsize||h!==e.avail_out&&a.mode<Nd&&(a.mode<Cd||t!==cd))&&Vd(e,e.output,e.next_out,h-e.avail_out),m-=e.avail_in,h-=e.avail_out,e.total_in+=m,e.total_out+=h,a.total+=h,4&a.wrap&&h&&(e.adler=a.check=a.flags?Ar(a.check,s,h,e.next_out-h):Or(a.check,s,h,e.next_out-h)),e.data_type=a.bits+(a.last?64:0)+(a.mode===Sd?128:0)+(a.mode===Ed||a.mode===kd?256:0),(0===m&&0===h||t===cd)&&v===hd&&(v=yd),v},inflateEnd:e=>{if(Rd(e))return gd;let t=e.state;return t.window&&(t.window=null),e.state=null,hd},inflateGetHeader:(e,t)=>{if(Rd(e))return gd;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,hd):gd},inflateSetDictionary:(e,t)=>{const a=t.length;let i,s,o;return Rd(e)?gd:(i=e.state,0!==i.wrap&&i.mode!==xd?gd:i.mode===xd&&(s=1,s=Or(s,t,a,0),s!==i.check)?fd:(o=Vd(e,t,a,a),o?(i.mode=16210,wd):(i.havedict=1,hd)))},inflateInfo:"pako inflate (from Nodeca project)"};var Bd=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const zd=Object.prototype.toString,{Z_NO_FLUSH:jd,Z_FINISH:Hd,Z_OK:qd,Z_STREAM_END:Kd,Z_NEED_DICT:$d,Z_STREAM_ERROR:Yd,Z_DATA_ERROR:Jd,Z_MEM_ERROR:Zd}=Fr;function Qd(e){this.options=Lc.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wc,this.strm.avail_out=0;let a=Wd.inflateInit2(this.strm,t.windowBits);if(a!==qd)throw new Error(Lr[a]);if(this.header=new Bd,Wd.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Vc.string2buf(t.dictionary):"[object ArrayBuffer]"===zd.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=Wd.inflateSetDictionary(this.strm,t.dictionary),a!==qd)))throw new Error(Lr[a])}function Xd(e,t){const a=new Qd(t);if(a.push(e),a.err)throw a.msg||Lr[a.err];return a.result}Qd.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let o,n,l;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Hd:jd,"[object ArrayBuffer]"===zd.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),o=Wd.inflate(a,n),o===$d&&s&&(o=Wd.inflateSetDictionary(a,s),o===qd?o=Wd.inflate(a,n):o===Jd&&(o=$d));a.avail_in>0&&o===Kd&&a.state.wrap>0&&0!==e[a.next_in];)Wd.inflateReset(a),o=Wd.inflate(a,n);switch(o){case Yd:case Jd:case $d:case Zd:return this.onEnd(o),this.ended=!0,!1}if(l=a.avail_out,a.next_out&&(0===a.avail_out||o===Kd))if("string"===this.options.to){let e=Vc.utf8border(a.output,a.next_out),t=a.next_out-e,s=Vc.buf2string(a.output,e);a.next_out=t,a.avail_out=i-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(o!==qd||0!==l){if(o===Kd)return o=Wd.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},Qd.prototype.onData=function(e){this.chunks.push(e)},Qd.prototype.onEnd=function(e){e===qd&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Lc.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var em={Inflate:Qd,inflate:Xd,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Xd(e,t)},ungzip:Xd,constants:Fr};const{Deflate:tm,deflate:am,deflateRaw:im,gzip:sm}=ed,{Inflate:om,inflate:nm,inflateRaw:lm,ungzip:rm}=em;var cm={Deflate:tm,deflate:am,deflateRaw:im,gzip:sm,Inflate:om,inflate:nm,inflateRaw:lm,ungzip:rm,constants:Fr};class dm{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const a=atob(t),i=new Uint8Array(a.length);for(let r=0;r<i.length;r++)i[r]=a.charCodeAt(r);const s=cm.inflate(i),o=ve.fromBinary(s);let n=cl.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(cl.CATEGORY_PARAM)){n=l.get(cl.CATEGORY_PARAM).split("").map((e=>[...nl.entries()].find((t=>t[1]==e)))).filter((e=>e)).map((e=>e[0]))}return{settings:o,categories:n}}}const mm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function hm(e){if(!e.length)return 0;let t=0,a=1,i=e[0];for(;(32&i)>0;)a++,i<<=1;const s=63>>a;let o=e.shift()&s;a--;for(let n=1;n<=a;n++)t+=1<<5*n,o=o<<6|(e.shift()||0);return o+t}function pm(e){const t={};if(e.match(/^#?~(-?\d+)$/))return t;const a=/^([a-z-]+)\/([a-z-]+)(?:\/([a-zA-Z0-9_-]+))?$/.exec(e);if(!a)return t;t.class=a[1],t.race=a[2];let i=a[3];if(!i)return t;const s=mm.indexOf(i.substring(0,1));if(i=i.substring(1),!i.length)return t;const o=[];for(let n=0;n<i.length;n++)o.push(mm.indexOf(i.substring(n,n+1)));if(s>1)return t;{const e=hm(o)-1;e>=0&&(t.genderId=e)}{const e=hm(o);e&&(t.level=e)}{const e=function(e){let t="";for(let a=0;a<3;a++){let a=hm(e);for(;a>0;){let i="",s=hm(e);for(;a>0&&i.length<7;){const e=7&s;s>>=3,i=`${e}${i}`,a--}t+=i}t+="-"}return t.replace(/-+$/,"")}(o),a=hm(o),i=o.splice(0,a).map((e=>mm[e])).join(""),s=e+(a?`_${i}`:"");if(""!==s&&(t.talentHash=s),t.talentHash){const e=function(e){const[t,a]=e.split("_"),i=t;let s=[];a&&(s=function(e){const t=Array(9).fill(0),a="0123456789abcdefghjkmnpqrstvwxyz";let i=1;for(;i<e.length;){const s=e[i],o=a.indexOf(s);if(i++,o<0||o>=t.length)continue;if(i+4>e.length)break;const n=a.indexOf(e[i]),l=a.indexOf(e[i+1]),r=a.indexOf(e[i+2]),c=a.indexOf(e[i+3]);if(i+=4,n<0||l<0||r<0||c<0)continue;const d=n<<15|l<<10|r<<5|c;t[o]=d}return t}(a));return{talents:i,glyphs:s}}(t.talentHash);t.talents=e.talents,t.glyphs=e.glyphs}}{let e=hm(o);for(t.items=[];e--;){const e={};let a;if(s<1){a=o.shift();const e=a>>5&1;a&=31,e&&(a|=64)}else a=hm(o);if(e.slotId=hm(o),e.itemId=hm(o),a>>6&1){let t=hm(o);const a=1&t;t>>=1,a&&(t*=-1),e.randomEnchantId=t}a>>5&1&&(e.reforge=hm(o));{let t=a>>2&7;for(;t--;)e.gemItemIds||(e.gemItemIds=[]),e.gemItemIds.push(hm(o))}{let t=3&a;for(;t--;)e.enchantIds||(e.enchantIds=[]),e.enchantIds.push(hm(o))}t.items.push(e)}}return t}const um=class e extends cl{constructor(e,i){super(e,i,{title:"Wowhead Import",allowFileUpload:!0});const s=a();this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from"," ",t("a",{href:"https://www.wowhead.com/cata/gear-planner",target:"_blank"},"Wowhead Gear Planner"),"."),t("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),t("p",null,"To import, paste the gear planner link below and click, 'Import'."),t("div",{ref:s}))),s.value&&new Nn({title:"Tinker issues",body:t(r,null,"There are known issues importing tinkers from Wowhead.",t("br",null),"Always make sure to double check your tinkers after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(t){if(!t.match(/www\.wowhead\.com\/cata\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/))throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/cata/gear-planner/CLASS/RACE/XXXX"`);console.log(t);const a=function(e){const t=e.match(/cata\/gear-planner\/(.+)/);if(!t)throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/cata/gear-planner/CLASS/RACE/XXXX"`);return pm(t[1])}(t);console.log(a);const i=a.glyphs,s=we(a.class.replaceAll("-",""));if(s==O.ClassUnknown)throw new Error("Could not parse Class: "+a.class);const o=ye(a.race.replaceAll("-",""));if(o==Ie.RaceUnknown)throw new Error("Could not parse Race: "+a.race);const n=D.create();a.items.forEach((t=>{const a=P.create(),i=t.slotId,s=t.enchantIds?.length>0;a.id=t.itemId,s&&(a.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(t.enchantIds[0])),t.gemItemIds&&(a.gems=t.gemItemIds),t.randomEnchantId&&(a.randomSuffix=t.randomEnchantId),t.reforge&&(a.reforging=t.reforge);null!=Object.entries(e.slotIDs).find((e=>e[1]==i))&&n.items.push(a)}));const l=Se.create({prime1:this.simUI.sim.db.glyphSpellToItemId(i[0]),prime2:this.simUI.sim.db.glyphSpellToItemId(i[1]),prime3:this.simUI.sim.db.glyphSpellToItemId(i[2]),major1:this.simUI.sim.db.glyphSpellToItemId(i[3]),major2:this.simUI.sim.db.glyphSpellToItemId(i[4]),major3:this.simUI.sim.db.glyphSpellToItemId(i[5]),minor1:this.simUI.sim.db.glyphSpellToItemId(i[6]),minor2:this.simUI.sim.db.glyphSpellToItemId(i[7]),minor3:this.simUI.sim.db.glyphSpellToItemId(i[8])});this.finishIndividualImport(this.simUI,s,o,n,a.talents??"",l,[])}};um.slotIDs={[y.ItemSlotHead]:1,[y.ItemSlotNeck]:2,[y.ItemSlotShoulder]:3,[y.ItemSlotBack]:15,[y.ItemSlotChest]:5,[y.ItemSlotWrist]:9,[y.ItemSlotHands]:10,[y.ItemSlotWaist]:6,[y.ItemSlotLegs]:7,[y.ItemSlotFeet]:8,[y.ItemSlotFinger1]:11,[y.ItemSlotFinger2]:12,[y.ItemSlotTrinket1]:13,[y.ItemSlotTrinket2]:14,[y.ItemSlotMainHand]:16,[y.ItemSlotOffHand]:17,[y.ItemSlotRanged]:18};let gm=um;class fm extends Cn{constructor(e,i){super(e,i,{identifier:"bulk-tab",title:'Batch (<span class="text-success">New</span>)'}),this.itemsChangedEmitter=new n,this.settingsChangedEmitter=new n,this.items=new Array,this.pickerGroups=new Map,this.combinations=0,this.iterations=0,this.simUI=i,this.playerCanDualWield=this.simUI.player.getPlayerSpec().canDualWield,this.playerIsFuryWarrior=this.simUI.player.getSpec()===w.SpecFuryWarrior;const s=a(),o=a(),l=a(),c=a(),d=a(),m=a(),h=a(),p=a();this.contentContainer.appendChild(t(r,null,t("div",{className:"bulk-tab-left tab-panel-left"},t("div",{className:"bulk-tab-tabs"},t("ul",{className:"nav nav-tabs",attributes:{role:"tablist"}},t("li",{className:"nav-item",attributes:{role:"presentation"}},t("button",{className:"nav-link active",type:"button",attributes:{role:"tab","aria-controls":"bulkSetupTab","aria-selected":!0},dataset:{bsToggle:"tab",bsTarget:"#bulkSetupTab"},ref:s},"Setup")),t("li",{className:"nav-item",attributes:{role:"presentation"}},t("button",{className:"nav-link",type:"button",attributes:{role:"tab","aria-controls":"bulkResultsTab","aria-selected":!1},dataset:{bsToggle:"tab",bsTarget:"#bulkResultsTab"},ref:l},"Results"))),t("div",{className:"tab-content"},t("div",{id:"bulkSetupTab",className:"tab-pane fade active show",ref:o}),t("div",{id:"bulkResultsTab",className:"tab-pane fade show",ref:c},t("div",{className:"d-flex align-items-center justify-content-center p-gap"},"Run a simulation to view results"))))),t("div",{className:"bulk-tab-right tab-panel-right"},t("div",{className:"bulk-settings-outer-container"},t("div",{className:"bulk-settings-container",ref:d},t("div",{className:"bulk-combinations-count h4",ref:m}),t("button",{className:"btn btn-primary bulk-settings-btn",ref:h},"Simulate Batch"),t("div",{className:"bulk-boolean-settings-container",ref:p}))),","))),this.setupTabElem=o.value,this.resultsTabElem=c.value,this.pendingDiv=t("div",{className:"results-pending-overlay"}),this.combinationsElem=m.value,this.bulkSimButton=h.value,this.settingsContainer=d.value,this.booleanSettingsContainer=p.value,this.setupTab=new gn(s.value),this.resultsTab=new gn(l.value),this.pendingResults=new Pn(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new Kf(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal"}),this.doCombos=!0,this.fastMode=!0,this.autoGem=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.defaultGems=[ke.create(),ke.create(),ke.create(),ke.create()],this.gemIconElements=[],this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings();const e=()=>{for(const e of this.pickerGroups.values())e.has(-1)&&e.remove(-1),e.has(-2)&&e.remove(-2);this.simUI.player.getEquippedItems().forEach(((e,t)=>{const a=el(t,this.playerCanDualWield),i=this.pickerGroups.get(a),s=this.isSecondaryItemSlot(t)?-2:-1;e&&i.add(s,e)}))};e(),this.simUI.player.gearChangeEmitter.on((()=>e())),this.itemsChangedEmitter.on((()=>this.storeSettings())),n.onAny([this.itemsChangedEmitter,this.settingsChangedEmitter,this.simUI.sim.iterationsChangeEmitter]).on((()=>{this.getCombinationsCount().then((e=>this.combinationsElem.replaceChildren(e)))})),this.getCombinationsCount().then((e=>this.combinationsElem.replaceChildren(e)))}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=Ee.fromJsonString(e,{ignoreUnknownFields:!0});this.addItems(t.items),this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.autoGem=t.autoGem,this.simTalents=t.simTalents,this.defaultGems=new Array(Pe.create({id:t.defaultRedGem}),Pe.create({id:t.defaultYellowGem}),Pe.create({id:t.defaultBlueGem}),Pe.create({id:t.defaultMetaGem})),this.defaultGems.forEach(((e,t)=>{h.fromItemId(e.id).fill().then((a=>{e.id&&(this.gemIconElements[t].src=a.iconUrl,this.gemIconElements[t].classList.remove("hide"))}))}))}}storeSettings(){const e=this.createBulkSettings(),t=Ee.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return Ee.create({items:this.getItems(),combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,autoGem:this.autoGem,simTalents:this.simTalents,talentsToSim:this.savedTalents,defaultRedGem:this.defaultGems[0].id,defaultYellowGem:this.defaultGems[1].id,defaultBlueGem:this.defaultGems[2].id,defaultMetaGem:this.defaultGems[3].id,iterationsPerCombo:this.getDefaultIterationsCount()})}getDefaultIterationsCount(){return Ce()?1e3:this.simUI.sim.getIterations()}createBulkItemsDatabase(){const e=Ne.create();for(const t of this.items.values()){if(!t)continue;const a=this.simUI.sim.db.lookupItemSpec(t);if(!a)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(_e.fromJson(Te.toJson(a.item),{ignoreUnknownFields:!0})),a.enchant&&e.enchants.push(Re.fromJson(De.toJson(a.enchant),{ignoreUnknownFields:!0})),a.randomSuffix&&e.randomSuffixes.push(Ge.fromJson(Ge.toJson(a.randomSuffix),{ignoreUnknownFields:!0})),a.reforge&&e.reforgeStats.push(Oe.fromJson(Oe.toJson(a.reforge),{ignoreUnknownFields:!0}));for(const t of a.gems)t&&e.gems.push(Pe.fromJson(ke.toJson(t),{ignoreUnknownFields:!0}))}for(const t of this.defaultGems)t.id>0&&e.gems.push(t);return e}addItem(e){this.addItems([e])}addItems(e){e.forEach((e=>{const t=this.simUI.sim.db.lookupItemSpec(e);t&&v(t.item,this.playerIsFuryWarrior).forEach((a=>{if(this.isSecondaryItemSlot(a))return;const i=this.items.push(e)-1,s=el(a,this.playerCanDualWield);this.pickerGroups.get(s).add(i,t)}))})),this.itemsChangedEmitter.emit(n.nextEventID())}addItemToSlot(e,t){const a=this.simUI.sim.db.lookupItemSpec(e);if(a){const i=v(a.item,this.playerIsFuryWarrior);if(!k(a.item,this.simUI.player.getPlayerSpec(),i[0]))return;const s=this.items.push(e)-1;this.pickerGroups.get(t).add(s,a),this.itemsChangedEmitter.emit(n.nextEventID())}}updateItem(e,t){const a=this.simUI.sim.db.lookupItemSpec(t);a&&(this.items[e]=t,v(a.item,this.playerIsFuryWarrior).forEach((t=>{if(this.isSecondaryItemSlot(t))return;const i=el(t,this.playerCanDualWield);this.pickerGroups.get(i).update(e,a)}))),this.itemsChangedEmitter.emit(n.nextEventID())}removeItem(e){this.items.forEach(((t,a)=>{t&&t.id===e.id&&this.removeItemByIndex(a)}))}removeItemByIndex(e){if(e<0||this.items.length<e||!this.items[e])return void new Nn({variant:"error",body:"Failed to remove item, please report this issue."});const t=this.items[e],a=this.simUI.sim.db.lookupItemSpec(t);a&&(this.items[e]=null,v(a.item,this.playerIsFuryWarrior).forEach((t=>{const a=el(t,this.playerCanDualWield);this.pickerGroups.get(a).remove(e),this.itemsChangedEmitter.emit(n.nextEventID())})))}clearItems(){for(let e=0;e<this.items.length;e++)this.removeItemByIndex(e);this.items=new Array,this.itemsChangedEmitter.emit(n.nextEventID())}hasItem(e){return this.items.some((t=>!!t&&P.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{t&&e.push(P.clone(t))})),e}setCombinations(e){this.doCombos=e,this.settingsChangedEmitter.emit(n.nextEventID())}setFastMode(e){this.fastMode=e,this.settingsChangedEmitter.emit(n.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{const t=await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e);t.error?.type==Ue.ErrorOutcomeAborted&&new Nn({variant:"info",body:"Bulk sim cancelled."})}catch(t){this.isPending=!1,this.simUI.handleCrash(t)}}async calculateBulkCombinations(){try{const e=await this.simUI.sim.calculateBulkCombinations(this.createBulkSettings(),this.createBulkItemsDatabase());this.combinations=e?.numCombinations??0,this.iterations=e?.numIterations??0}catch(e){this.simUI.handleCrash(e)}}buildTabContent(){this.buildSetupTabContent(),this.buildResultsTabContent(),this.buildBatchSettings()}buildSetupTabContent(){const e=a(),i=a(),s=a();this.setupTabElem.appendChild(t(r,null,t("p",{className:"mb-0"},t("span",{className:"bold"},"Batch Simming")," is a new feature akin to the ",t("span",{className:"bold"},"Top Gear")," sim on"," ",t("a",{href:"https://raidbots.com",target:"_blank"},"Raidbots.com")," ","that allows you to select multiple items and sim them find the best combinations.",t("br",null),"This is an ",t("span",{className:"text-brand"},"Alpha")," feature, so if you have feedback or find a bug, please report it!"),Ce()&&t("p",{className:"mb-0"},t("a",{href:Ae,target:"_blank"},t("i",{className:"fas fa-gauge-high me-1"}),"Download the local sim for faster results.")),t("div",{className:"bulk-gear-actions"},t("button",{className:"btn btn-secondary",ref:e},t("i",{className:"fa fa-download me-1"})," Import From Bags"),t("button",{className:"btn btn-secondary",ref:i},t("i",{className:"fa fa-download me-1"})," Import Favorites"),t("button",{className:"btn btn-danger ms-auto",ref:s},t("i",{className:"fas fa-times me-1"}),"Clear Items"))));const o=e.value,n=i.value,l=s.value;o.addEventListener("click",(()=>new dl(this.simUI.rootElem,this.simUI,this).open())),n.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>P.create({id:e})));this.addItems(e)})),l.addEventListener("click",(()=>this.clearItems())),new al(this.setupTabElem,this.simUI,this);const c=t("div",{className:"bulk-gear-combo"});this.setupTabElem.appendChild(c),_(Zn).forEach((e=>{this.playerCanDualWield&&[Zn.ItemSlotMainHand,Zn.ItemSlotOffHand].includes(e)||(this.playerCanDualWield||e!==Zn.ItemSlotHandWeapon)&&this.pickerGroups.set(e,new tl(c,this.simUI,this,e))}))}buildResultsTabContent(){this.simUI.sim.bulkSimStartEmitter.on((()=>this.resultsTabElem.replaceChildren())),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{for(const a of t.results)new il(this.resultsTabElem,this.simUI,this,a,t.equippedGearResult);this.isPending=!1,this.resultsTab.show()}))}isSecondaryItemSlot(e){return Le(e)||this.playerCanDualWield&&e===y.ItemSlotOffHand}set isPending(e){e?(this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",this.pendingDiv)):(this.simUI.rootElem.classList.remove("blurred"),this.pendingDiv.remove(),this.pendingResults.hideAll())}buildBatchSettings(){let e=!1;this.bulkSimButton.addEventListener("click",(async()=>{if(e)return;e=!0,this.bulkSimButton.disabled=!0,this.isPending=!0;let t=!1;try{await this.simUI.sim.signalManager.abortType(Fe.All),this.pendingResults.addAbortButton((async()=>{if(!t)try{t=!0,await this.simUI.sim.signalManager.abortType(Fe.BulkSim)}catch(a){console.error("Error on bulk sim abort!"),console.error(a)}finally{t=!1,e||(this.bulkSimButton.disabled=!1)}}));let a=(new Date).getTime(),i=0,s=0,o=0,n=0;await this.runBulkSim((e=>{const t=(new Date).getTime()-a,l=e.completedIterations/(t/1e3);0===n&&(n=e.totalSims),this.fastMode&&(0===s&&e.totalSims>0&&(s=Math.ceil(Math.log(e.totalSims/20)/Math.log(2))+1,o=1),e.totalSims<i&&(o+=1,a=(new Date).getTime())),this.setSimProgress(e,l,o,s,n),i=e.totalSims}))}catch(a){console.error(a)}finally{e=!1,t||(this.bulkSimButton.disabled=!1),this.isPending=!1}})),Ce()||new Me(this.booleanSettingsContainer,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,a)=>{this.setFastMode(a)}}),new Me(this.booleanSettingsContainer,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations because they each have two slots to fill.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,a)=>{this.setCombinations(a)}}),new Me(this.booleanSettingsContainer,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,a)=>{t.autoEnchant=a}});const i=a(),s=t("div",{className:u("default-gem-container",!this.autoGem&&"hide")},t("h6",null,"Default Gems"),t("div",{ref:i,className:"sockets-container"})),o=a(),l=t("div",{className:u("talents-picker-container",!this.simTalents&&"hide")},t("h6",null,"Talents to Sim"),t("div",{ref:o,className:"talents-container"}));new Me(this.booleanSettingsContainer,this,{id:"bulk-auto-gem",label:"Auto Gem",labelTooltip:"When checked bulk simulator will fill any un-filled gem sockets with default gems.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoGem,setValue:(e,t,a)=>{t.autoGem=a,s.classList[a?"remove":"add"]("hide")}}),new Me(this.booleanSettingsContainer,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,a)=>{t.simTalents=a,l.classList[a?"remove":"add"]("hide")}}),this.settingsContainer.appendChild(t(r,null,s,l)),Array(Ve.GemColorRed,Ve.GemColorYellow,Ve.GemColorBlue,Ve.GemColorMeta).forEach(((e,s)=>{const o=a(),n=a(),l=a();let r;i.value.appendChild(t("div",{ref:o,className:"gem-socket-container"},t("img",{ref:n,className:"gem-icon hide"}),t("img",{ref:l,className:"socket-icon"}))),this.gemIconElements.push(n.value),l.value.src=I(e);const c=e=>{this.defaultGems[s]=e.item,this.storeSettings(),h.fromItemId(e.id).fill().then((t=>{e.id&&(this.gemIconElements[s].src=t.iconUrl,this.gemIconElements[s].classList.remove("hide"))})),r.close()},d=()=>{this.defaultGems[s]=ke.create(),this.storeSettings(),this.gemIconElements[s].classList.add("hide"),this.gemIconElements[s].src="",r.close()},m=()=>{r||(r=new sl(this.simUI.rootElem,this.simUI,e,c,d)),r.show()};this.gemIconElements[s].addEventListener("click",m),o.value?.addEventListener("click",m)}));const c=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let d;try{null!==c&&(d=JSON.parse(c))}catch(g){console.warn("Invalid json for local storage value: "+c)}const m=(e,t)=>{if(this.savedTalents.some((e=>e.name===t.name))){const a=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(a,1),e?.classList.remove("active")}else this.savedTalents.push(t),e?.classList.add("active");this.settingsChangedEmitter.emit(n.nextEventID())},p=this.simUI.individualConfig.presets.talents.map((e=>({talentsString:e.data.talentsString,glyphs:e.data.glyphs,name:e.name})));for(const t in d)try{const e=We.fromJson(d[t]);p.push({talentsString:e.talentsString,glyphs:e.glyphs,name:t})}catch(g){console.log(g),console.warn("Failed parsing saved data: "+d[t])}p.forEach((e=>{const i=this.savedTalents.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))),s=a(),n=a();o.value.appendChild(t("div",{ref:s,className:u("saved-data-set-chip badge rounded-pill",-1!==i&&"active")},t("button",{ref:n,className:"saved-data-set-name"},e.name))),n.value.addEventListener("click",(()=>m(s.value,e)))}))}async getCombinationsCount(){await this.calculateBulkCombinations();const e=a(),i=t(r,null,t("span",{className:u(this.showIterationsWarning()&&"text-danger")},1===this.combinations?"1 Combination":`${this.combinations} Combinations`,t("br",null),t("small",null,this.iterations," Iterations")),this.showIterationsWarning()&&t("button",{className:"warning link-warning",ref:e},t("i",{className:"fas fa-exclamation-triangle fa-2x"})));return e.value&&mn(e.value,{content:"Simming over 50000 iterations in the web sim will take a long time or may not run at all.\n\t\t\t\t\tFor larger batch sims we recommend using Fast Mode or downloading the executable and running on your machine.",placement:"left",popperOptions:{modifiers:[{name:"flip",options:{fallbackPlacements:["auto"]}}]}}),i}showIterationsWarning(){return this.iterations>this.getIterationsLimit()}getIterationsLimit(){return Ce()?5e4:1e6}setSimProgress(e,a,i,s,o){const n=((e.totalIterations-e.completedIterations)/a).toFixed();isNaN(Number(n))||this.pendingResults.setContent(t("div",{className:"results-sim"},t("div",null,o," total combinations."),t("div",null,s>0&&t(r,null,i," / ",s," refining rounds")),t("div",null,e.completedSims," / ",e.totalSims,t("br",null),"simulations complete"),t("div",null,e.completedIterations," / ",e.totalIterations,t("br",null),"iterations complete"),t("div",null,n," seconds remaining.")))}}class wm extends yn{constructor(e,i){if(super(e,"exporter",{title:i.title,header:!0,footer:!0}),this.changedEvent=new n,this.textElem=t("textarea",{spellcheck:!1,className:"exporter-textarea form-control"}),this.body.append(this.textElem),new ml(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),i.allowDownload){const e=a();this.footer.appendChild(t("button",{className:"exporter-button btn btn-primary download-button",ref:e},t("i",{className:"fa fa-download me-1"}),"Download"));e.value.addEventListener("click",(e=>{const t=this.textElem.textContent;Be(t,"wowsims.json")}))}}open(){super.open(),this.init()}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const ym=class e extends wm{constructor(a,i,s){super(a,s),this.simUI=i;const o={};if(_(ol).forEach((e=>o[e]=cl.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=o,s.selectCategories){const a=t("div",{className:"exporter-category-pickers"});this.body.prepend(a),e.exportPickerConfigs.forEach((e=>{const t=e.category;new Me(a,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,a,i)=>{this.exportCategories[t]=i,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}}};ym.exportPickerConfigs=[{category:ol.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:ol.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:ol.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:ol.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:ol.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:ol.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:ol.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let Im=ym;const bm=class e extends Im{constructor(e,t){super(e,t,{title:"Sixty Upgrades Cataclysm EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=ze.getAll(),s={};return i.forEach((t=>{const i=e.getName(t),o=a.getUnitStat(t);0!=o&&""!=i&&(s[i]?s[i]+=o:s[i]=o)})),`https://sixtyupgrades.com/cata/ep/import?name=${encodeURIComponent(`${t.getPlayerSpec().friendlyName} WoWSims Weights`)}`+Object.keys(s).map((e=>`&${e}=${s[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};bm.statNames={[l.StatStrength]:"strength",[l.StatAgility]:"agility",[l.StatStamina]:"stamina",[l.StatIntellect]:"intellect",[l.StatSpirit]:"spirit",[l.StatSpellPower]:"spellDamage",[l.StatMP5]:"mp5",[l.StatHitRating]:"hitRating",[l.StatCritRating]:"critRating",[l.StatHasteRating]:"hasteRating",[l.StatSpellPenetration]:"spellPen",[l.StatAttackPower]:"attackPower",[l.StatMasteryRating]:"masteryRating",[l.StatExpertiseRating]:"expertiseRating",[l.StatMana]:"mana",[l.StatArmor]:"armor",[l.StatRangedAttackPower]:"attackPower",[l.StatDodgeRating]:"dodgeRating",[l.StatParryRating]:"parryRating",[l.StatResilienceRating]:"resilienceRating",[l.StatHealth]:"health",[l.StatArcaneResistance]:"arcaneResistance",[l.StatFireResistance]:"fireResistance",[l.StatFrostResistance]:"frostResistance",[l.StatNatureResistance]:"natureResistance",[l.StatShadowResistance]:"shadowResistance",[l.StatBonusArmor]:"armorBonus"},bm.pseudoStatNames={[g.PseudoStatMainHandDps]:"dps",[g.PseudoStatRangedDps]:"rangedDps"};let xm=bm;class Sm extends Im{constructor(e,t){super(e,t,{title:"CLI Export",allowDownload:!0})}getData(){const e=je.toJson(this.simUI.sim.makeRaidSimRequest(!1));return delete e.raid?.parties[0]?.players[0]?.database,JSON.stringify(e,null,2)}}class vm extends Im{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0,selectCategories:!0})}getData(){return vm.getData(this.simUI,_(ol).filter((e=>this.exportCategories[e])))}static getData(e,t){return t||(t=cl.DEFAULT_CATEGORIES),He(ve.toJson(e.toProto(t)),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,a)=>t[a]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}class km extends Im{constructor(e,t){super(e,t,{title:"Shareable Link",selectCategories:!0})}getData(){return km.createLink(this.simUI,_(ol).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=cl.DEFAULT_CATEGORIES);const a=e.toProto(t),i=ve.toBinary(a),s=cm.deflate(i,{to:"string"}),o=btoa(String.fromCharCode(...s)),n=new URL(window.location.href);if(n.hash=o,qe(t,cl.DEFAULT_CATEGORIES))n.searchParams.delete(cl.CATEGORY_PARAM);else{const e=t.map((e=>nl.get(e))).join("");n.searchParams.set(cl.CATEGORY_PARAM,e)}return n.toString()}}const Em=class e extends Im{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=ze.getAll(),s={};return i.forEach((t=>{const i=e.getName(t),o=a.getUnitStat(t);0!=o&&""!=i&&(s[i]?s[i]+=o:s[i]=o)})),`( Pawn: v1: "${t.getPlayerSpec().friendlyName} WoWSims Weights": Class=${t.getPlayerClass().friendlyName},`+Object.keys(s).map((e=>`${e}=${s[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};Em.statNames={[l.StatStrength]:"Strength",[l.StatAgility]:"Agility",[l.StatStamina]:"Stamina",[l.StatIntellect]:"Intellect",[l.StatSpirit]:"Spirit",[l.StatSpellPower]:"SpellDamage",[l.StatMP5]:"Mp5",[l.StatHitRating]:"HitRating",[l.StatCritRating]:"CritRating",[l.StatHasteRating]:"HasteRating",[l.StatSpellPenetration]:"SpellPen",[l.StatAttackPower]:"Ap",[l.StatMasteryRating]:"MasteryRating",[l.StatExpertiseRating]:"ExpertiseRating",[l.StatMana]:"Mana",[l.StatArmor]:"Armor",[l.StatRangedAttackPower]:"Ap",[l.StatDodgeRating]:"DodgeRating",[l.StatParryRating]:"ParryRating",[l.StatResilienceRating]:"ResilienceRating",[l.StatHealth]:"Health",[l.StatArcaneResistance]:"ArcaneResistance",[l.StatFireResistance]:"FireResistance",[l.StatFrostResistance]:"FrostResistance",[l.StatNatureResistance]:"NatureResistance",[l.StatShadowResistance]:"ShadowResistance",[l.StatBonusArmor]:"Armor2"},Em.pseudoStatNames={[g.PseudoStatMainHandDps]:"MeleeDps",[g.PseudoStatRangedDps]:"RangedDps"};let Pm=Em;const Cm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function Nm(e){let t=e,a=0;const i=[];for(let s=1;s<=5;s++){const e=5*s;if(t<1<<e){const e=[];for(;e.length<s;){const a=63&t;t>>=6,e.unshift(a)}return e[0]=e[0]|a,i.push(...e),i}t-=1<<e,a=(64|a)>>1}throw new Error("Value too large to encode.")}function _m(e){let t="";const a=[];t+=Cm[1],a.push(0),a.push(...Nm(e.level??0));const i=function(e){const t=[],a=e.split("-");for(let i=0;i<3;i++){const e=a[i]||"";t.push(...Nm(e.length));let s=0;for(;s<e.length;){let a=0,i=0;for(;i<7&&s<e.length;)a=a<<3|parseInt(e[s],10),s++,i++;t.push(...Nm(a))}}return t}(e.talents.join("-"));a.push(...i);const s=function(e){const t="0123456789abcdefghjkmnpqrstvwxyz";let a="0";for(let i=0;i<e.length;i++){const s=e[i];if(s){const e=t[i],o=s>>15&31,n=s>>10&31,l=s>>5&31,r=31&s;if(o<0||n<0||l<0||r<0)continue;a+=e+t[o]+t[n]+t[l]+t[r]}}return a}(e.glyphs??[]).split("").map((e=>Cm.indexOf(e)));a.push(...Nm(s.length)),a.push(...s);const o=e.items??[];a.push(...Nm(o.length));for(const l of o){let e=0;const t=[];l.randomEnchantId&&(e|=64),l.reforge&&(e|=32);const i=Math.min((l.gemItemIds??[]).length,7);e|=i<<2;const s=Math.min((l.enchantIds??[]).length,3);if(e|=s,t.push(...Nm(l.slotId??0)),t.push(...Nm(l.itemId??0)),l.randomEnchantId){let e=l.randomEnchantId;const a=e<0?1:0;a&&(e*=-1),e=e<<1|a,t.push(...Nm(e))}l.reforge&&t.push(...Nm(l.reforge));const o=l.gemItemIds??[];for(let a=0;a<i;a++)t.push(...Nm(o[a]));const n=l.enchantIds??[];for(let a=0;a<s;a++)t.push(...Nm(n[a]));a.push(...Nm(e)),a.push(...t)}let n="";for(const l of a)n+=Cm.charAt(l);return n&&(t+=n),t}class Tm extends Im{constructor(e,t){super(e,t,{title:"Wowhead Export",allowDownload:!0})}getData(){const e=this.simUI.player,t=`https://www.wowhead.com/cata/gear-planner/${e.getPlayerClass().friendlyName.replaceAll(/\s/g,"-").toLowerCase()}/${Ke.get(e.getRace()).replaceAll(/\s/g,"-").toLowerCase()}/`,a=e=>{const t=this.simUI.sim.db.glyphItemToSpellId(e);return t||0},i=e.getGlyphs(),s={level:$e,talents:e.getTalentsString().split("-"),glyphs:[a(i.prime1),a(i.prime2),a(i.prime3),a(i.major1),a(i.major2),a(i.major3),a(i.minor1),a(i.minor2),a(i.minor3)],items:[]},o=e.getGear();o.getItemSlots().sort(((e,t)=>gm.slotIDs[e]-gm.slotIDs[t])).forEach((e=>{const t=o.getEquippedItem(e);if(!t)return;const a={slotId:gm.slotIDs[e],itemId:t.id};t._randomSuffix?.id&&(a.randomEnchantId=t._randomSuffix.id),t._enchant&&(a.enchantIds=[t._enchant.spellId]),y.ItemSlotHands,t._gems&&(a.gemItemIds=t._gems.map((e=>e?.id??0))),t._reforge&&(a.reforge=t._reforge.id),s.items.push(a)}));const n=function(e){return""+_m(e)}(s);return t+n}}class Rm extends e{constructor(e,i,s){super(e,"saved-data-manager-root"),this.modObject=i,this.config=s,this.userData=[],this.presets=[],this.frozen=!1,s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses);const o=new _n(this.rootElem,"saved-data",{header:s.header}),n=a(),l=a(),r=a();o.bodyElement.replaceChildren(t("div",{ref:n,className:"saved-data-container"},t("div",{ref:l,className:"saved-data-presets hide"}),t("div",{ref:r,className:"saved-data-custom hide"}))),this.savedDataDiv=n.value,this.presetDataDiv=l.value,this.customDataDiv=r.value,s.presetsOnly||this.config.loadOnly||o.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){const t=this.makeSavedData(e),a=e.isPreset?this.presets:this.userData,i=a.findIndex((t=>t.name===e.name));-1===i?(e.isPreset?(this.presetDataDiv.classList.remove("hide"),this.presetDataDiv.appendChild(t.elem)):(this.customDataDiv.classList.remove("hide"),this.customDataDiv.appendChild(t.elem)),a.push(t)):(a[i].elem.replaceWith(t.elem),a[i]=t)}makeSavedData(e){const i=a(),s=t("div",{className:"saved-data-set-chip badge rounded-pill"},t("button",{className:"saved-data-set-name"},e.name),!this.config.loadOnly&&!e.isPreset&&t("button",{ref:i,className:"saved-data-set-delete"},t("i",{className:"fa fa-times fa-lg"})));if(s?.addEventListener("click",(()=>{this.config.setData(n.nextEventID(),this.modObject,e.data),e.onLoad?.(this.modObject),this.saveInput&&(this.saveInput.value=e.name)})),!this.config.loadOnly&&!e.isPreset&&i.value){const t=mn(i.value,{content:`Delete saved ${this.config.label}`});i.value.addEventListener("click",(a=>{a.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;t.destroy();const i=this.userData.findIndex((t=>t.name===e.name));this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()}))}e.tooltip&&mn(s,{content:e.tooltip,placement:"bottom"});const o=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?(s.classList.add("active"),this.saveInput&&(this.saveInput.value=e.name)):s.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};o();const l=this.config.changeEmitters.map((e=>e.on(o)));return this.addOnDisposeCallback((()=>l.map((e=>e.dispose())))),{name:e.name,data:e.data,elem:s,enableWhen:e.enableWhen,onLoad:e.onLoad}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),this.presets.length||this.presetDataDiv.classList.add("hide"),this.userData.length||this.customDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(a){console.warn("Invalid json for local storage value: "+e)}for(const i in t)try{this.addSavedData({name:i,data:this.config.fromJson(t[i])})}catch(a){console.warn("Failed parsing saved data: "+t[i])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const e=a(),i=a(),s=t("div",{className:"saved-data-create-container"},t("label",{className:"form-label"},this.config.label," Name"),t("input",{ref:i,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),t("button",{ref:e,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=i.value,e.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),s}}class Dm extends e{constructor(e,t,a){super(e,"summary-table-root"),this.simUI=t,this.player=a,this.container=new _n(this.rootElem,"summary-table-container",{header:{title:"Gem Summary",extraCssClasses:["summary-table--gems"]},extraCssClasses:["summary-table--gems"]}),a.gearChangeEmitter.on((()=>this.updateTable()))}updateTable(){const e=t(r,null),i=this.player.getGear().getAllGems(this.player.isBlacksmithing()),s=!!i.length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){const s={};for(const e of i)s[e.name]?s[e.name].count+=1:s[e.name]={gem:e,count:1};for(const i of Object.keys(s)){const o=s[i],n=a(),l=a(),r=t("div",{className:"summary-table-row d-flex align-items-center"},t("a",{ref:n,className:"summary-table-link","data-whtticon":"false",target:"_blank"},t("img",{ref:l,className:"gem-icon"}),t("div",null,i)),t("div",null,o.count.toFixed(0)));e.appendChild(r);const c=n.value,d=l.value;bn(c,o.gem.quality),h.fromItemId(o.gem.id).fill().then((e=>{d.src=e.iconUrl,e.setWowheadHref(c)}))}if(this.container.bodyElement.replaceChildren(e),!this.container.headerElement)return;const o=this.container.headerElement.querySelector(".summary-table-reset-button"),l=t("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{this.player.setGear(n.nextEventID(),this.player.getGear().withoutGems())}},t("i",{className:"fas fa-times me-1"}),"Reset gems");o?this.container.headerElement.replaceChild(l,o):this.container.headerElement.appendChild(l)}}}class Gm extends e{constructor(e,i,s){if(super(e,"preset-configuration-picker-root"),this.rootElem.classList.add("saved-data-manager-root"),this.simUI=i,this.builds=(this.simUI.individualConfig.presets.builds??[]).filter((e=>Object.keys(e).some((t=>s?.includes(t)&&!!e[t])))),!this.builds.length)return void this.rootElem.classList.add("hide");const o=new _n(this.rootElem,"saved-data",{header:{title:"Preset Configurations",tooltip:"Preset configurations can apply an optimal combination of gear, talents, rotation and encounter settings."}}),l=a(),c=t("div",{className:"saved-data-container"},t("div",{className:"saved-data-presets",ref:l}));this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((e=>{const i=a();l.value.appendChild(t("button",{className:"saved-data-set-chip badge rounded-pill",ref:i},t("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(e)},e.name))),mn(i.value,{content:t(r,null,t("p",{className:"mb-1"},"This preset affects the following settings:"),t("ul",{className:"mb-0 text-capitalize"},Object.keys(e).filter((e=>"name"!==e)).map((a=>e[a]?t("li",null,a):void 0))))});const s=()=>i.value.classList[this.isBuildActive(e)?"add":"remove"]("active");s(),n.onAny([this.simUI.player.changeEmitter,this.simUI.sim.settingsChangeEmitter,this.simUI.sim.raid.changeEmitter,this.simUI.sim.encounter.changeEmitter]).on(s)})),o.bodyElement.replaceChildren(c)}))}applyBuild({gear:e,itemSwap:t,rotation:a,rotationType:i,talents:s,epWeights:o,encounter:l,race:r}){const c=n.nextEventID();n.freezeAllAndDo((()=>{e&&this.simUI.player.setGear(c,this.simUI.sim.db.lookupEquipmentSpec(e.gear)),r&&this.simUI.player.setRace(c,r),t?this.simUI.player.itemSwapSettings.setItemSwapSettings(c,!0,this.simUI.sim.db.lookupItemSwap(t.itemSwap),d.fromProto(t.itemSwap.prepullBonusStats)):this.simUI.player.itemSwapSettings.setEnableItemSwap(c,!1),s&&(this.simUI.player.setTalentsString(c,s.data.talentsString),s.data.glyphs&&this.simUI.player.setGlyphs(c,s.data.glyphs)),i?(this.simUI.player.aplRotation.type=i,this.simUI.player.rotationChangeEmitter.emit(c)):a?.rotation.rotation&&this.simUI.player.setAplRotation(c,a.rotation.rotation),o&&this.simUI.player.setEpWeights(c,o.epWeights),l&&(l.encounter&&this.simUI.sim.encounter.fromProto(c,l.encounter),l.healingModel&&this.simUI.player.setHealingModel(c,l.healingModel),l.tanks&&this.simUI.sim.raid.setTanks(c,l.tanks),l.buffs&&this.simUI.player.setBuffs(c,l.buffs),l.debuffs&&this.simUI.sim.raid.setDebuffs(c,l.debuffs),l.raidBuffs&&this.simUI.sim.raid.setBuffs(c,l.raidBuffs),l.consumes&&this.simUI.player.setConsumes(c,l.consumes))}))}isBuildActive({gear:e,rotation:t,rotationType:a,talents:i,epWeights:s,encounter:o,race:n}){const l=!e||D.equals(e.gear,this.simUI.player.getGear().asSpec()),r="number"!=typeof n||n===this.simUI.player.getRace(),c=!i||We.equals(i.data,We.create({talentsString:this.simUI.player.getTalentsString(),glyphs:this.simUI.player.getGlyphs()}));let d=!0;if(a)d=a===this.simUI.player.getRotationType();else if(t){const e=this.simUI.player.getResolvedAplRotation();e.type===Ye.TypeAuto&&(e.type=Ye.TypeAPL),d=t.rotation?.rotation?.type===Ye.TypeSimple&&t.rotation.rotation?.simple?.specRotationJson?this.simUI.player.specTypeFunctions.rotationEquals(this.simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(t.rotation.rotation.simple.specRotationJson)),this.simUI.player.getSimpleRotation()):Je.equals(t.rotation.rotation,e)}const m=!s||this.simUI.player.getEpWeights().equals(s.epWeights),h=!o?.encounter||Ze.equals(o.encounter,this.simUI.sim.encounter.toProto()),p=!o?.healingModel||Qe.equals(o.healingModel,this.simUI.player.getHealingModel());return l&&r&&c&&d&&m&&h&&p}}class Om extends e{constructor(e,t,a){super(e,"summary-table-root"),this.simUI=t,this.player=a,this.container=new _n(this.rootElem,"summary-table-container",{header:{title:"Reforge Summary"},extraCssClasses:["summary-table--reforge"]}),a.gearChangeEmitter.on((()=>this.updateTable()))}updateTable(){const e=t(r,null),a=this.player.getGear().getAllReforges(),i={};for(const[t,o]of a){const{fromStat:e,toStat:t,fromAmount:a,toAmount:s}=o;"number"!=typeof i[e]&&(i[e]=0),"number"!=typeof i[t]&&(i[t]=0),a&&(i[e]+=a),s&&(i[t]+=s)}const s=!!Object.keys(i).length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){if(Object.keys(i).forEach((a=>{const s=Number(a),o=i[s];o&&e.appendChild(t("div",{className:"summary-table-row d-flex align-items-center"},t("div",null,b.get(s)),t("div",{className:""+(0===o?"":o>0?"positive":"negative")},o)))})),this.container.bodyElement.replaceChildren(e),!this.container.headerElement)return;const a=this.container.headerElement.querySelector(".summary-table-reset-button"),s=t("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{const e=this.player.getGear().withoutReforges(this.player.canDualWield2H());this.player.setGear(n.nextEventID(),e)}},t("i",{className:"fas fa-times me-1"}),"Reset Reforges");a?this.container.headerElement.replaceChild(s,a):this.container.headerElement.appendChild(s)}}}class Um extends Cn{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSummaryTablesContainer(),this.buildPresetConfigurationPicker(),this.buildSavedGearsetPicker()}buildSummaryTablesContainer(){const e=document.createElement("div");e.classList.add("summary-tables-container"),this.leftPanel.appendChild(e),new Dm(e,this.simUI,this.simUI.player),new Om(e,this.simUI,this.simUI.player)}buildGearPickers(){new Kn(this.leftPanel,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new Gm(this.rightPanel,this.simUI,["gear"])}buildSavedGearsetPicker(){const e=new Rm(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>Xe.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,a)=>{n.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(a.gear||D.create())),t.setBonusStats(e,d.fromProto(a.bonusStatsStats||et.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>Xe.equals(e,t),toJson:e=>Xe.toJson(e),fromJson:e=>Xe.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:Xe.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new d).toProto()}),enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}function Am(e,t,a){return{inputs:e,label:t,categoryId:a,showWhen:t=>e.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function Lm(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,description:e.description,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}function Fm(e){return Lm({id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Mm(e){return Lm({id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Vm(e){return Lm({id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Wm(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}const Bm=(e,t)=>Number(o(e/100,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1})),zm=(e,t)=>Number(o(100*e,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1}));function jm(e){const t={id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>zm(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Bm(s,e))}return Wm(t)}function Hm(e){const t={id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>zm(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Bm(s,e))}return Wm(t)}function qm(e){const t={id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>zm(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Bm(s,e))}return Wm(t)}function Km(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0}}function $m(e){return Km({id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Ym(e){return Km({id:`${String(e.fieldName)||tt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Jm(e){const t=e.getModObject;return{type:"icon",actionId:e.actionId,states:e.states,changedEvent:a=>e.changedEvent(t(a)),showWhen:a=>!e.showWhen||e.showWhen(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function Zm(e,t,a,i){return Jm({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>i?e.getValue(t)[a]==i:e.getValue(t)[a]),setValue:e.setFieldValue||((t,s,o)=>{const n=e.getValue(s);i?o?n[a]=i:n[a]==i&&(n[a]=0):n[a]=o,e.setValue(t,s,n)}),extraCssClasses:e.extraCssClasses})}function Qm(e){return Zm({getModObject:e=>e,getValue:e=>e.getClassOptions(),setValue:(e,t,a)=>t.setClassOptions(e,a),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.id,e.fieldName,e.value)}function Xm(e,t,a,i){return Jm({getModObject:e.getModObject,actionId:t,states:0,changedEvent:e.changeEmitter,getValue:t=>e.getValue(t)[a],setValue:(t,s,o)=>{const n=e.getValue(s);if(i){const e=o-n[a];o+=(i-1)*e}o<0&&(o=0),n[a]=o,e.setValue(t,s,n)}})}function eh(e,t,a,i,s){const o=Xm(e,t,i,s);return o.states=a,o}function th(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,values:e.values.map((e=>{if(e.showWhen){const a=e.showWhen;e.showWhen=e=>a(t(e))}return e})),equals:e.equals,showWhen:a=>!e.showWhen||e.showWhen(t(a)),zeroValue:e.zeroValue,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function ah(e){return th({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}function ih(e){return th({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}class sh extends s{constructor(e,i,s){super(e,"icon-enum-picker-root",i,s),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??"vertical")?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue;const o=this.config.changedEvent(this.modObject).on((()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))}));if(this.addOnDisposeCallback((()=>o.dispose())),s.tooltip){const e=mn(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}const l=a(),c=a(),d=a();this.rootElem.appendChild(t(r,null,t("a",{ref:l,href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("ul",{ref:c,className:"dropdown-menu",style:{gridTemplateColumns:this.config.numColumns?`repeat(${this.config.numColumns}, 1fr)`:void 0,gridAutoFlow:"Horizontal"==this.config.direction?"column":void 0}}),t("label",{ref:d,className:"form-label"}))),this.buttonElem=l.value,this.buttonText=d.value;const m=c.value;this.config.values.forEach((e=>{const t=document.createElement("li");t.classList.add("icon-dropdown-option","dropdown-option"),m.appendChild(t);const a=document.createElement("a");a.classList.add("icon-picker-button"),a.dataset.whtticon="false",a.dataset.disableWowheadTouchTooltip="true",t.appendChild(a);const i=()=>{this.setImage(a,e),this.showValueWhen(e)?t.classList.remove("hide"):(t.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(n.nextEventID())))},s=this.config.changedEvent(this.modObject).on(i);if(i(),a.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(n.nextEventID())}),{signal:this.signal}),this.addOnDisposeCallback((()=>s.dispose())),e.tooltip){const t=mn(a,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init()}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(n.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(n.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const a=t.actionId;a?(this.setActionImage(e,a),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId)&&(!e.showWhen||e.showWhen(this.modObject))}}class oh extends s{constructor(e,i,s){super(e,"icon-picker-root",i,s),this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const o=Boolean(this.config.improvedId);o&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!o&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const n=a(),l=a(),r=a();this.rootAnchor.appendChild(t("div",{className:"icon-input-level-container"},t("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("a",{ref:l,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("span",{ref:r,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=n.value,this.improvedAnchor2=l.value,this.counterElem=r.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0);const c=this.config.changedEvent(this.modObject).on((()=>{this.config.actionId.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))}));this.init(),this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),this.handleLeftClick()}),{signal:this.signal}),this.rootAnchor.addEventListener("contextmenu",(e=>{e.preventDefault()}),{signal:this.signal}),this.rootAnchor.addEventListener("mousedown",(e=>{L(e)&&(e.preventDefault(),this.handleRightClick())}),{signal:this.signal}),this.addOnDisposeCallback((()=>c.dispose()))}handleLeftClick(){0==this.config.states||this.currentValue+1<this.config.states?(this.currentValue++,this.inputChanged(n.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(n.nextEventID()))}handleRightClick(){this.currentValue>0?this.currentValue--:0===this.config.states?this.currentValue=1:this.currentValue=this.config.states-1,this.inputChanged(n.nextEventID())}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId:2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(n.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(n.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}const nh=(e,t,a)=>{if("icon"==a.type)return new oh(e,t,a);if("iconEnum"==a.type)return new sh(e,t,a);throw new Error("Unsupported input type")};function lh(e){return Zm({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>n.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function rh(e){return Zm({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>n.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function ch(e){return Zm({getModObject:e=>e,getValue:e=>e.getConsumes(),setValue:(e,t,a)=>t.setConsumes(e,a),changeEmitter:e=>n.onAny([e.consumesChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t)},e.actionId,e.fieldName,e.value)}function dh(e){return Zm({getModObject:e=>e,getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,a)=>t.getRaid().setDebuffs(e,a),changeEmitter:e=>n.onAny([e.getRaid().debuffsChangeEmitter])},e.actionId,e.fieldName,e.value)}function mh(e){return eh({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>n.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier)}class hh extends s{constructor(e,t,a){super(e,"enum-picker-root",t,a),this.selectElem=document.createElement("select"),this.selectElem.id=a.id,this.selectElem.classList.add("enum-picker-selector","form-select"),a.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(n.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return Number(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const ph={actions:{create:{useIcon:!1}}};let uh=null;const gh=class e extends s{constructor(a,i,s){if(s.isCompact&&(s.extraCssClasses=[...s.extraCssClasses||[],"list-picker-compact"]),super(a,"list-picker-root",i,s),this.config={...ph,...s},this.itemPickerPairs=[],this.rootElem.appendChild(t(r,null,s.title&&t("label",{className:"list-picker-title form-label"},s.title),t("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=mn(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let a=null,i=null;this.config.actions?.create?.useIcon?(a=e.makeActionElem("link-success","fa-plus"),i=mn(a,{allowHTML:!1,content:`New ${s.itemLabel}`}),this.addOnDisposeCallback((()=>i?.destroy()))):a=t("button",{className:"btn btn-primary"},"New ",s.itemLabel),a.classList.add("list-picker-new-button"),a.addEventListener("click",(()=>{const e=this.config.newItem(),t=this.config.getValue(this.modObject).concat([e]);this.config.setValue(n.nextEventID(),this.modObject,t),i&&i.hide()}),{signal:this.signal}),this.rootElem.appendChild(a)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addHoverListeners(e){e.addEventListener("mouseenter",(()=>{e.classList.add("hover")}),{signal:this.signal}),e.addEventListener("mouseleave",(()=>{e.classList.remove("hover")}),{signal:this.signal})}addNewPicker(){const t=this.itemPickerPairs.length,a=document.createElement("div");a.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&a.classList.add("inline"),this.itemsDiv.appendChild(a);const i=document.createElement("div");i.classList.add("list-picker-item");const s=document.createElement("div");s.classList.add("list-picker-item-header");const o=document.createElement("div");o.classList.add("list-picker-item-popover"),o.setAttribute("popover","auto"),s.appendChild(o);let l=!1;if(this.config.inlineMenuBar)a.appendChild(i),a.appendChild(s);else if(a.appendChild(s),a.appendChild(i),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,s.appendChild(e)}const r=this.config.newItemPicker(i,this,t,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[t],setValue:(e,a,i)=>{const s=this.getSourceValue();s[t]=i,this.config.setValue(e,a,s)}}),c={elem:a,picker:r,idx:t};if(this.actionEnabled("delete")&&(!this.config.minimumItems||t+1>this.config.minimumItems)){l=!0;const a=e.makeActionElem("list-picker-item-delete","fa-times");a.classList.add("link-danger"),o.appendChild(a);const i=mn(a,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});a.addEventListener("click",(()=>{const e=this.config.getValue(this.modObject);e.splice(t,1),this.config.setValue(n.nextEventID(),this.modObject,e),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy())),this.addHoverListeners(a)}if(this.actionEnabled("copy")){l=!0;const a=e.makeActionElem("list-picker-item-copy","fa-copy");o.appendChild(a);const i=mn(a,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});a.addEventListener("click",(()=>{const e=this.config.getValue(this.modObject).slice();e.splice(t,0,this.config.copyItem(e[t])),this.config.setValue(n.nextEventID(),this.modObject,e),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy())),this.addHoverListeners(a)}if(this.actionEnabled("move")){l=!0,a.classList.add("draggable"),this.config.itemLabel&&a.classList.add(this.config.itemLabel.toLowerCase().replace(" ","-"));const i=e.makeActionElem("list-picker-item-move","fa-arrows-up-down");o.appendChild(i);const s=mn(i,{allowHTML:!1,content:"Move (Drag+Drop)"});i.addEventListener("click",(()=>{s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{s?.destroy()})),this.addHoverListeners(i),i.addEventListener("mousedown",(()=>{i.setAttribute("draggable","true"),a.setAttribute("draggable","true")}),{signal:this.signal}),i.addEventListener("mouseup",(()=>{i.removeAttribute("draggable"),a.removeAttribute("draggable")}),{signal:this.signal}),i.addEventListener("dragstart",(e=>{if(e.target==i){const t=o.getBoundingClientRect();e.dataTransfer.setDragImage(a,0,t.height/2),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",a.classList.add("dragfrom"),uh={listPicker:this,item:c}}}),{signal:this.signal});const r=()=>uh&&"Action"===this.config.itemLabel&&uh.listPicker!==this,d=()=>uh&&uh.listPicker===this&&uh.item.idx===t,m=()=>uh&&uh.item.elem.contains(a),h=(e=!0)=>!uh||uh.listPicker.config.itemLabel!==this.config.itemLabel||(!!r()||(!(!e||!d())||!(!e||!m())));let p=0;a.addEventListener("dragenter",(e=>{h()||(e.stopPropagation(),p++,a.classList.add("dragto"))}),{signal:this.signal}),a.addEventListener("dragleave",(e=>{h()||(e.preventDefault(),p--,p<=0&&a.classList.remove("dragto"))}),{signal:this.signal}),a.addEventListener("dragover",(e=>{h()?(r()||d())&&(e.dataTransfer.dropEffect="none"):(e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault())}),{signal:this.signal});const u=()=>{uh&&(i.removeAttribute("draggable"),a.removeAttribute("draggable"),uh.item.elem.removeAttribute("draggable"),[...document.querySelectorAll(".dragfrom,.dragto")].forEach((e=>{e.classList.remove("dragfrom"),e.classList.remove("dragto")})))};a.addEventListener("dragend",(e=>{h(!1)||(e.stopPropagation(),u(),uh=null)}),{signal:this.signal}),a.addEventListener("drop",(e=>{if(!uh||h())return void(d()&&(e.stopPropagation(),u()));e.stopPropagation(),u();const i=uh.item.idx;let s=t;const o=a.getBoundingClientRect();e.clientY>o.top+o.height/2&&s++;const l=this.config.getValue(this.modObject);let r;if(uh.listPicker!==this){const e=uh.listPicker.config.getValue(uh.listPicker.modObject);r=e[i],e.splice(i,1),uh.listPicker.config.setValue(n.nextEventID(),uh.listPicker.modObject,e)}else r=l[i],l.splice(i,1);l.splice(s,0,r),this.config.setValue(n.nextEventID(),this.modObject,l),uh=null}),{signal:this.signal})}if(l){const t=e.makeActionElem("list-picker-item-actions","fa-ellipsis");s.appendChild(t),t.addEventListener("mouseover",(()=>{o.showPopover();const e=t.getBoundingClientRect(),a=o.getBoundingClientRect(),i=(a.height-e.height)/2;o.style.top=e.top-i+"px",o.style.left=e.right-a.width+10+"px",o.classList.add("hover")}),{signal:this.signal}),o.addEventListener("mouseleave",(()=>{o.classList.remove("hover"),o.hidePopover()}),{signal:this.signal})}this.itemPickerPairs.push(c)}static makeActionElem(e,a){return t("button",{type:"button",className:u("list-picker-item-action",e)},t("i",{className:u("fa","fa-xl",a)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,a=t.nextElementSibling||t.previousElementSibling;if(!a?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return a}static makeListItemValidations(t,a,i){const s=e.makeActionElem("apl-validations","fa-exclamation-triangle");s.setAttribute("data-bs-html","true");const o=mn(s,{theme:"dropdown-tooltip",content:"Warnings"});t.appendChild(s);const n=s.querySelector("i"),l=async()=>{if(!it(s))return o?.destroy(),s?.remove(),void a.currentStatsEmitter.off(l);o.setContent("");const e=i(a);if(e.length){s.style.removeProperty("display");const t=await Promise.all(e.map((async e=>({...e,validation:await h.replaceAllInString(e.validation)}))));let a=at.Undefined;const i=t.reduce(((e,t)=>{const i=t.logLevel;a=Math.max(i,a);const s=e.get(i);return s?s.push(t.validation):e.set(i,[t.validation]),e}),new Map);for(const[e,s]of this.logLevelDisplayData)n.classList.remove(s.icon);const l=this.logLevelDisplayData.get(a)?.icon;l&&n.classList.add(l);for(const[e,o]of Object.entries(at))s.classList[o===a?"add":"remove"](`apl-validation-${e.toLowerCase()}`);let r="";for(const[e,s]of i)r+=`\n\t\t\t\t\t\t<p>${this.logLevelDisplayData.get(e)?.header}</p>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t${s.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t`;o.setContent(r)}else s.style.display="none"};l(),a.currentStatsEmitter.on(l)}};gh.logLevelDisplayData=new Map([[at.Information,{icon:"fa-info-circle",header:"Additional Information&#58;"}],[at.Warning,{icon:"fa-exclamation-triangle",header:"This action has warnings, and might not behave as expected."}],[at.Error,{icon:"fa-exclamation-triangle",header:"This action has errors, and will not behave as expected."}]]);let fh=gh;class wh extends s{constructor(e,t,a){super(e,"adaptive-string-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=a.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(n.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const yh={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((e=>({value:e.id})))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((e=>({value:e.id})))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((e=>({value:e.id})))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((e=>({value:e.id})))},spells:{defaultLabel:"Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable)).map((e=>({value:e.id})))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:a,cooldowns:i}=ft(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),s=[h.fromOtherId(wt.OtherActionPotion)];return[[{value:h.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(a||[]).map((e=>({value:e.id,submenu:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}))),[{value:h.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map((e=>({value:e.id,submenu:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}))),[{value:h.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],s.map((e=>({value:e,submenu:["Placeholders"],tooltip:"The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started."})))].flat()}},non_instant_spells:{defaultLabel:"Non-instant Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.hasCastTime)).map((e=>({value:e.id})))},friendly_spells:{defaultLabel:"Friendly Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isFriendly)).map((e=>({value:e.id})))},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((e=>({value:e.id})))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).filter(((e,t,a)=>a.findIndex((t=>t.id.anyId()===e.id.anyId()))===t)).map((e=>({value:e.id})))},castable_dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.hasDot)).map((e=>({value:e.id})))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((e=>({value:e.id})))}},Ih=new st;class bh extends ht{constructor(e,i,s){const o=yh[s.actionIdSet];super(e,i,{...s,sourceToValue:e=>e?h.fromProto(e):h.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:o.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,i)=>{const o=i.value,n=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(s.actionIdSet),l=`${o.toString()}${n}`,c=Ih.get(l)?.cloneNode(!0);c&&e.appendChild(c);const d=a(),m=t(r,null,t("a",{ref:d,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),o.name);e.appendChild(m),o.setBackgroundAndHref(d.value),o.setWowheadDataset(d.value,{useBuffAura:n}),Ih.set(l,m)},createMissingValue:e=>0==e.anyId()?new Promise((()=>{o.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const n=s.getUnitRef,l="self"==s.defaultUnitRef?nt.create({type:pt.Self}):nt.create({type:pt.CurrentTarget}),c=o.getActionIDs,d=async()=>{const e=n(i),t=i.sim.getUnitMetadata(e,i,l);if(t){const e=await c(t);this.setOptions(e)}};d();const m=i.sim.unitMetadataEmitter.on(d),p=i.rotationChangeEmitter.on(d);this.addOnDisposeCallback((()=>{m.dispose(),p.dispose()}))}}const xh={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>nt.create({type:pt.Pet,index:t,owner:nt.create({type:pt.Self})}))),nt.create({type:pt.CurrentTarget}),e.sim.raid.getActivePlayers().filter((t=>t!=e)).map((e=>nt.create({type:pt.Player,index:e.getRaidIndex()}))),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>nt.create({type:pt.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>nt.create({type:pt.Target,index:t}))),nt.create({type:pt.Self}),e.getPetMetadatas().asList().map(((e,t)=>nt.create({type:pt.Pet,index:t,owner:nt.create({type:pt.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>nt.create({type:pt.Target,index:t})))].flat()},players:{targetUI:!0,getUnits:e=>[void 0,e.sim.raid.getActivePlayers().map((e=>nt.create({type:pt.Player,index:e.getRaidIndex()})))].flat()}};class Sh extends ut{constructor(e,t,a){const i=!!xh[a.unitSet].targetUI;super(e,t,{...a,sourceToValue:e=>Sh.refToValue(e,t,i),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=a.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const s=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{s.dispose()}))}static refToValue(e,t,a){if(!e||e.type==pt.Unknown)return{value:e,iconUrl:a?"fa-bullseye":"fa-user",text:a?"Current Target":"Self"};if(e.type==pt.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==pt.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==pt.Player){const a=t.sim.raid.getPlayer(e.index);if(a)return{value:e,iconUrl:a.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==pt.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:gt,text:`Target ${e.index+1}`}}else if(e.type==pt.Pet){const a=t.sim.getUnitMetadata(e,t,nt.create({type:pt.Self}));let i=`Pet ${e.index+1}`,s="fa-paw";if(a){const e=a.getName();if(e){const t=e.indexOf(" - ");i=e.substring(t+3),s=yt(i)||s}}return{value:e,iconUrl:s,text:i}}return{value:e}}updateValues(){const e=xh[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const a={value:Sh.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==pt.Pet&&(e.targetUI?a.submenu=[Sh.refToValue(t.owner,this.modObject,e.targetUI)]:a.submenu=[Sh.refToValue(void 0,this.modObject,e.targetUI)]),a})))}}class vh extends s{constructor(e,t,a){super(e,"apl-picker-builder-root",t,a),this.config=a,this.fieldPickers=a.fields.map((e=>vh.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const a=t.field,i=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:tt(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const i=e.getSourceValue();return i[a]||(i[a]=t.newValue()),i[a]},setValue:(t,i,s)=>{e.getSourceValue()[a]=s,i.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==a&&"actions"!==a||i.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function kh(e,t,a,i,s){return{field:e,newValue:()=>ot.create(),factory:(e,s,o,n)=>new bh(e,s,{id:tt(),...o,actionIdSet:t,getUnitRef:()=>a?n()[a]:nt.create(),defaultUnitRef:i||"self"})}}function Eh(e,t,a){return{field:e,newValue:()=>{},factory:(e,a,i)=>new Sh(e,a,{id:tt(),...i,unitSet:t})}}function Ph(e,t,a){return{field:e,newValue:()=>!1,factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new Me(e,t,{id:tt(),...a})),...a||{},label:t}}function Ch(e,t,a){return{field:e,newValue:()=>0,factory:(e,a,i)=>{const s=i;return s.float=t,s.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new xn(e,a,s)},...a||{}}}function Nh(e,t){return{field:e,newValue:()=>"",factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new wh(e,t,{id:tt(),...a})),...t||{}}}function _h(e,t){const a=[{value:rt.RuneBlood,label:"Blood"},{value:rt.RuneFrost,label:"Frost"},{value:rt.RuneUnholy,label:"Unholy"}];return t&&a.push({value:rt.RuneDeath,label:"Death"}),{field:e,newValue:()=>rt.RuneBlood,factory:(e,t,i)=>new ct(e,t,{id:tt(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}function Th(e){return{field:e,newValue:()=>dt.SlotLeftBlood,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:dt.SlotLeftBlood,label:"Blood Left"},{value:dt.SlotRightBlood,label:"Blood Right"},{value:dt.SlotLeftFrost,label:"Frost Left"},{value:dt.SlotRightFrost,label:"Frost Right"},{value:dt.SlotLeftUnholy,label:"Unholy Left"},{value:dt.SlotRightUnholy,label:"Unholy Right"}]})}}function Rh(e){const t=_(l),a=[{value:-1,label:"None"}].concat(t.map((e=>({value:e,label:f(e)}))));return{field:e,label:"Buff Type",newValue:()=>0,factory:(e,t,i)=>new ct(e,t,{id:tt(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}const Dh=Ch("minIcdSeconds",!1,{label:"Min ICD",labelTooltip:"If non-zero, filter out any procs that either lack an ICD or for which the ICD is smaller than the specified value (in seconds). This can be useful for certain snapshotting checks, since procs with low ICDs are often too weak to snapshot."});function Gh(e,t){return(a,i,s)=>new vh(a,i,{...s,newValue:e,fields:t})}class Oh extends s{constructor(e,t,a){super(e,"apl-value-picker-root",t,a);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(Fh).filter((e=>Fh[e].includeIf?.(t,i)??!0));if(this.rootElem.parentElement.classList.contains("list-picker-item")){const e=fh.getItemHeaderElem(this)||this.rootElem;fh.makeListItemValidations(e,t,(e=>e.getCurrentStats().rotationStats?.uuidValidations?.find((e=>e.uuid?.value===this.rootElem.id))?.validations||[]))}this.kindPicker=new ct(this.rootElem,t,{defaultLabel:"No Condition",id:tt(),values:[{value:void 0,label:"<None>"}].concat(s.map((e=>{const t=Fh[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.value.oneofKind;if(s!=a){if(a){const t=Fh[a];let o=this.makeAPLValue(a,t.newValue());i&&s&&this.valuePicker&&("not"==a?o.value.not.val=this.makeAPLValue(s,this.valuePicker.getInputValue()):"not"==i.value.oneofKind&&i.value.not.val?.value.oneofKind==a?o=i.value.not.val:"and"==a?"or"==i.value.oneofKind?o.value.and.vals=i.value.or.vals:o.value.and.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"or"==a?"and"==i.value.oneofKind?o.value.or.vals=i.value.and.vals:o.value.or.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"min"==a?"max"==i.value.oneofKind?o.value.min.vals=i.value.max.vals:o.value.min.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"max"==a?"min"==i.value.oneofKind?o.value.max.vals=i.value.min.vals:o.value.max.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"and"==i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind==a?o=i.value.and.vals[0]:"or"==i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind==a?o=i.value.or.vals[0]:"min"==i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind==a?o=i.value.min.vals[0]:"max"==i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind==a?o=i.value.max.vals[0]:"cmp"==a&&(o.value.cmp.lhs=this.makeAPLValue(s,this.valuePicker.getInputValue()))),i?i.value=o.value:this.setSourceValue(e,o)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?ri.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()},uuid:{value:tt()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t]),e&&(e.uuid&&""!=e.uuid.value||(e.uuid={value:tt()}),this.rootElem.id=e.uuid.value)}makeAPLValue(e,t){if(!e)return ri.create({uuid:{value:tt()}});const a={oneofKind:e};return a[e]=t,ri.create({value:a,uuid:{value:tt()}})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const a=Fh[e];this.valuePicker=a.factory(this.rootElem,this.modObject,{id:tt(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||a.newValue()},setValue:(t,a,i)=>{const s=this.getSourceValue();s&&(s.value[e]=i),a.rotationChangeEmitter.emit(t)}})}}function Uh(e,t){return{field:e,newValue:()=>ri.create({uuid:{value:tt()}}),factory:(e,t,a)=>new Oh(e,t,a),...t||{}}}function Ah(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new fh(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map((e=>e||ri.create({uuid:{value:tt()}}))))},itemLabel:"Value",newItem:()=>ri.create({uuid:{value:tt()}}),copyItem:e=>e?ri.clone(e):e,newItemPicker:(e,a,i,s)=>new Oh(e,t,s),allowedActions:["copy","create","delete","move"],actions:{create:{useIcon:!0}}})}}function Lh(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:Gh(e.newValue,e.fields)}}const Fh={const:Lh({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:It.create,fields:[Nh("val")]}),cmp:Lh({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:bt.create,fields:[Uh("lhs"),(Mh="op",{field:Mh,newValue:()=>si.OpEq,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:si.OpEq,label:"=="},{value:si.OpNe,label:"!="},{value:si.OpGe,label:">="},{value:si.OpGt,label:">"},{value:si.OpLe,label:"<="},{value:si.OpLt,label:"<"}]})}),Uh("rhs")]}),math:Lh({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:xt.create,fields:[Uh("lhs"),function(e){return{field:e,newValue:()=>oi.OpAdd,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:oi.OpAdd,label:"+"},{value:oi.OpSub,label:"-"},{value:oi.OpMul,label:"*"},{value:oi.OpDiv,label:"/"}]})}}("op"),Uh("rhs")]}),max:Lh({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:St.create,fields:[Ah("vals")]}),min:Lh({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:vt.create,fields:[Ah("vals")]}),and:Lh({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:kt.create,fields:[Ah("vals")]}),or:Lh({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Et.create,fields:[Ah("vals")]}),not:Lh({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:Pt.create,fields:[Uh("val")]}),currentTime:Lh({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Ct.create,fields:[]}),currentTimePercent:Lh({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Nt.create,fields:[]}),remainingTime:Lh({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:_t.create,fields:[]}),remainingTimePercent:Lh({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Tt.create,fields:[]}),isExecutePhase:Lh({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Rt.create,fields:[function(e){return{field:e,newValue:()=>ni.E20,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ni.E20,label:"20%"},{value:ni.E25,label:"25%"},{value:ni.E35,label:"35%"},{value:ni.E90,label:"90%"}]})}}("threshold")]}),numberTargets:Lh({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Dt.create,fields:[]}),frontOfTarget:Lh({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Gt.create,fields:[]}),bossSpellIsCasting:Lh({label:"Spell is Casting",submenu:["Boss"],shortDescription:"",newValue:Ot.create,fields:[Eh("targetUnit","targets"),kh("spellId","non_instant_spells","targetUnit","currentTarget")]}),bossSpellTimeToReady:Lh({label:"Spell Time to Ready",submenu:["Boss"],shortDescription:"",newValue:Ut.create,fields:[Eh("targetUnit","targets"),kh("spellId","spells","targetUnit","currentTarget")]}),unitIsMoving:Lh({label:"Is moving",submenu:["Unit"],shortDescription:"",newValue:At.create,fields:[Eh("sourceUnit","aura_sources")]}),currentHealth:Lh({label:"Current Health",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health.",newValue:Lt.create,fields:[Eh("sourceUnit","aura_sources")]}),currentHealthPercent:Lh({label:"Current Health (%)",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:Ft.create,fields:[Eh("sourceUnit","aura_sources")]}),currentMana:Lh({label:"Current Mana",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana.",newValue:Mt.create,includeIf(e,t){const a=e.getClass();return a!==O.ClassDeathKnight&&a!==O.ClassHunter&&a!==O.ClassRogue&&a!==O.ClassWarrior},fields:[]}),currentManaPercent:Lh({label:"Current Mana (%)",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:Vt.create,includeIf(e,t){const a=e.getClass();return a!==O.ClassDeathKnight&&a!==O.ClassHunter&&a!==O.ClassRogue&&a!==O.ClassWarrior},fields:[]}),currentRage:Lh({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:Wt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassWarrior},fields:[]}),currentFocus:Lh({label:"Current Focus",submenu:["Resources","Focus"],shortDescription:"Amount of currently available Focus.",newValue:Bt.create,includeIf:(e,t)=>e.getClass()==O.ClassHunter,fields:[]}),maxFocus:Lh({label:"Max Focus",submenu:["Resources","Focus"],shortDescription:"Amount of maximum available Focus.",newValue:zt.create,includeIf:(e,t)=>e.getClass()==O.ClassHunter,fields:[]}),focusRegenPerSecond:Lh({label:"Focus Regen Per Second",submenu:["Resources","Focus"],shortDescription:"Focus regen per second.",newValue:jt.create,includeIf:(e,t)=>e.getClass()==O.ClassHunter,fields:[]}),focusTimeToTarget:Lh({label:"Estimated Time To Target Focus",submenu:["Resources","Focus"],shortDescription:"Estimated time until target Focus is reached, will return 0 if at or above target.",newValue:Ht.create,includeIf:(e,t)=>e.getClass()==O.ClassHunter,fields:[Uh("targetFocus")]}),currentEnergy:Lh({label:"Current Energy",submenu:["Resources","Energy"],shortDescription:"Amount of currently available Energy.",newValue:qt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue||a===O.ClassMonk},fields:[]}),maxEnergy:Lh({label:"Max Energy",submenu:["Resources","Energy"],shortDescription:"Amount of maximum available Energy.",newValue:Kt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue||a===O.ClassMonk},fields:[]}),energyRegenPerSecond:Lh({label:"Energy Regen Per Second",submenu:["Resources","Energy"],shortDescription:"Energy regen per second.",newValue:$t.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue||a===O.ClassMonk},fields:[]}),energyTimeToTarget:Lh({label:"Estimated Time To Target Energy",submenu:["Resources","Energy"],shortDescription:"Estimated time until target Energy is reached, will return 0 if at or above target.",newValue:Yt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue||a===O.ClassMonk},fields:[Uh("targetEnergy")]}),currentComboPoints:Lh({label:"Current Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of currently available Combo Points.",newValue:Jt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue},fields:[]}),maxComboPoints:Lh({label:"Max Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of maximum available Combo Points.",newValue:Zt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===w.SpecFeralDruid||i===w.SpecGuardianDruid||a===O.ClassRogue},fields:[]}),monkCurrentChi:Lh({label:"Current Chi",submenu:["Resources","Chi"],shortDescription:"Amount of currently available Chi.",newValue:Qt.create,includeIf:(e,t)=>e.getClass()===O.ClassMonk,fields:[]}),monkMaxChi:Lh({label:"Max Chi",submenu:["Resources","Chi"],shortDescription:"Amount of maximum available Chi.",newValue:Xt.create,includeIf:(e,t)=>e.getClass()===O.ClassMonk,fields:[]}),currentRunicPower:Lh({label:"Current Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of currently available Runic Power.",newValue:ea.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[]}),maxRunicPower:Lh({label:"Max Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of maximum available Runic Power.",newValue:ta.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[]}),currentLunarEnergy:Lh({label:"Solar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Solar Energy.",newValue:aa.create,includeIf:(e,t)=>e.getSpec()==w.SpecBalanceDruid,fields:[]}),currentSolarEnergy:Lh({label:"Lunar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Lunar Energy",newValue:ia.create,includeIf:(e,t)=>e.getSpec()==w.SpecBalanceDruid,fields:[]}),druidCurrentEclipsePhase:Lh({label:"Current Eclipse Phase",submenu:["Resources","Eclipse"],shortDescription:"The eclipse phase the druid currently is in.",newValue:sa.create,includeIf:(e,t)=>e.getSpec()==w.SpecBalanceDruid,fields:[function(e){const t=[{value:lt.LunarPhase,label:"Lunar"},{value:lt.SolarPhase,label:"Solar"},{value:lt.NeutralPhase,label:"Neutral"}];return{field:e,newValue:()=>rt.RuneBlood,factory:(e,a,i)=>new ct(e,a,{id:tt(),...i,defaultLabel:"Lunar",equals:(e,t)=>e==t,values:t})}}("eclipsePhase")]}),currentHolyPower:Lh({label:"Holy Power",submenu:["Resources"],shortDescription:"Amount of currently available Holy Power.",newValue:oa.create,includeIf:(e,t)=>e.getClass()==O.ClassPaladin,fields:[]}),currentRuneCount:Lh({label:"Num Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type including Death.",newValue:na.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[_h("runeType",!0)]}),currentNonDeathRuneCount:Lh({label:"Num Non Death Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type ignoring Death",newValue:la.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[_h("runeType",!1)]}),currentRuneActive:Lh({label:"Rune Is Ready",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently available.",newValue:ra.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[Th("runeSlot")]}),currentRuneDeath:Lh({label:"Rune Is Death",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently converted to Death.",newValue:ca.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[Th("runeSlot")]}),runeCooldown:Lh({label:"Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there is a rune available",newValue:da.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[_h("runeType",!1)]}),nextRuneCooldown:Lh({label:"Next Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a 2nd rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there are 2 runes available",newValue:ma.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[_h("runeType",!1)]}),runeSlotCooldown:Lh({label:"Rune Slot Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain slot is ready to use.<br><b>NOTE:</b> Returns 0 if rune is ready",newValue:ha.create,includeIf:(e,t)=>e.getClass()==O.ClassDeathKnight,fields:[Th("runeSlot")]}),gcdIsReady:Lh({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:pa.create,fields:[]}),gcdTimeToReady:Lh({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:ua.create,fields:[]}),autoTimeToNext:Lh({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:ga.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return a!==O.ClassHunter&&a!==O.ClassMage&&a!==O.ClassPriest&&a!==O.ClassWarlock&&i!==w.SpecBalanceDruid&&i!==w.SpecElementalShaman},fields:[]}),spellIsKnown:Lh({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:fa.create,fields:[kh("spellId","castable_spells","")]}),spellCurrentCost:Lh({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:wa.create,fields:[kh("spellId","castable_spells","")]}),spellCanCast:Lh({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:ya.create,fields:[kh("spellId","castable_spells","")]}),spellIsReady:Lh({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:Ia.create,fields:[kh("spellId","castable_spells","")]}),spellTimeToReady:Lh({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:ba.create,fields:[kh("spellId","castable_spells","")]}),spellCastTime:Lh({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:xa.create,fields:[kh("spellId","castable_spells","")]}),spellTravelTime:Lh({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:Sa.create,fields:[kh("spellId","castable_spells","")]}),spellCpm:Lh({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:va.create,fields:[kh("spellId","castable_spells","")]}),spellIsChanneling:Lh({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:ka.create,fields:[kh("spellId","channel_spells","")]}),spellChanneledTicks:Lh({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:Ea.create,fields:[kh("spellId","channel_spells","")]}),channelClipDelay:Lh({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:Pa.create,fields:[]}),inputDelay:Lh({label:"Input Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Input Dleay</b> setting.",newValue:Ca.create,fields:[]}),auraIsKnown:Lh({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:Na.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","auras","sourceUnit")]}),auraIsActive:Lh({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:_a.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:Lh({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Ta.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","auras","sourceUnit")]}),auraIsInactiveWithReactionTime:Lh({label:"Aura Inactive (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is not currently active AND it has been inactive for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Ra.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","auras","sourceUnit")]}),auraRemainingTime:Lh({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:Da.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","auras","sourceUnit")]}),auraNumStacks:Lh({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:Ga.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:Lh({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:Oa.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:Lh({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Ua.create,fields:[Eh("sourceUnit","aura_sources"),kh("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:Lh({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>Aa.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Eh("sourceUnit","aura_sources_targets_first"),kh("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),Uh("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),monkNextChiBrewRecharge:Lh({label:"Next Chi Brew Recharge",submenu:["Aura"],shortDescription:"Returns the amount of time until the next Chi Brew stack will be ready.",newValue:La.create,includeIf:(e,t)=>e.getClass()==O.ClassMonk,fields:[]}),allTrinketStatProcsActive:Lh({label:"All Item Proc Buffs Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if all item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>Fa.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3"),Dh]}),anyTrinketStatProcsActive:Lh({label:"Any Item Proc Buff Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if any item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>Ma.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3"),Dh]}),trinketProcsMinRemainingTime:Lh({label:"Item Procs Min Remaining Time",submenu:["Aura Sets"],shortDescription:"Shortest remaining duration on any active item/enchant procs that buff the specified stat type(s), or infinity if none are currently active.",newValue:()=>Va.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3"),Dh]}),trinketProcsMaxRemainingIcd:Lh({label:"Item Procs Max Remaining ICD",submenu:["Aura Sets"],shortDescription:"Longest remaining ICD on any inactive item/enchant procs that buff the specified stat type(s), or 0 if all are currently active.",newValue:()=>Wa.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3"),Dh]}),numEquippedStatProcTrinkets:Lh({label:"Num Equipped Stat Proc Effects",submenu:["Aura Sets"],shortDescription:"Number of equipped passive item/enchant effects that buff the specified stat type(s) when they proc.",newValue:()=>Ba.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3"),Dh]}),numStatBuffCooldowns:Lh({label:"Num Stat Buff Cooldowns",submenu:["Aura Sets"],shortDescription:"Number of registered Major Cooldowns that buff the specified stat type(s) when they are cast.",fullDescription:'\n\t\t<p>Both manually casted cooldowns as well as cooldowns controlled by "Cast All Stat Buff Cooldowns" and "Autocast Other Cooldowns" actions are included in the total count returned by this value.</p>\n\t\t',newValue:()=>za.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3")]}),dotIsActive:Lh({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:ja.create,fields:[Eh("targetUnit","targets"),kh("spellId","dot_spells","")]}),dotRemainingTime:Lh({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:Ha.create,fields:[Eh("targetUnit","targets"),kh("spellId","dot_spells","")]}),dotTickFrequency:Lh({label:"Dot Tick Frequency",submenu:["DoT"],shortDescription:"The time between each tick.",newValue:qa.create,fields:[Eh("targetUnit","targets"),kh("spellId","dot_spells","")]}),sequenceIsComplete:Lh({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:Ka.create,fields:[Nh("sequenceName")]}),sequenceIsReady:Lh({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:$a.create,fields:[Nh("sequenceName")]}),sequenceTimeToReady:Lh({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:Ya.create,fields:[Nh("sequenceName")]}),totemRemainingTime:Lh({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:Ja.create,includeIf:(e,t)=>e.getClass()==O.ClassShaman,fields:[function(e){return{field:e,newValue:()=>li.Water,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:li.Earth,label:"Earth"},{value:li.Air,label:"Air"},{value:li.Fire,label:"Fire"},{value:li.Water,label:"Water"}]})}}("totemType")]}),shamanCanSnapshotStrongerFireElemental:Lh({label:"Can snapshot stronger Fire Elemental",submenu:["Shaman"],shortDescription:"Returns true if a new Fire Elemental would be stronger than the current.",newValue:Za.create,includeIf:(e,t)=>e.getClass()==O.ClassShaman,fields:[]}),shamanFireElementalDuration:Lh({label:"Fire Elemental Total Duration",submenu:["Shaman"],shortDescription:"Returns the duration of Fire Elemental depending on if Totemic Focus is talented or not.",newValue:Qa.create,includeIf:(e,t)=>e.getClass()==O.ClassShaman,fields:[]}),catExcessEnergy:Lh({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:Xa.create,includeIf:(e,t)=>e.getSpec()==w.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:Lh({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:ei.create,includeIf:(e,t)=>e.getSpec()==w.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:Lh({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:ti.create,includeIf:(e,t)=>e.getClass()==O.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:Lh({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:ai.create,includeIf:(e,t)=>e.getClass()==O.ClassWarlock,fields:[Eh("targetUnit","targets")]}),mageCurrentCombustionDotEstimate:Lh({label:"Combustion Dot Value",submenu:["Mage"],shortDescription:"Returns the current estimated size of your Combustion Dot.",newValue:ii.create,includeIf:(e,t)=>e.getSpec()==w.SpecFireMage,fields:[]})};var Mh;class Vh extends s{constructor(e,t,a){super(e,"apl-action-picker-root",t,a),this.conditionPicker=new Oh(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,a)=>{const i=this.getSourceValue();i?(i.condition=a,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,_i.create({condition:a}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(jh).filter((e=>jh[e].includeIf?.(t,i)??!0));this.kindPicker=new ct(this.actionDiv,t,{id:tt(),defaultLabel:"Action",values:s.map((e=>{const t=jh[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.action.oneofKind;if(s!=a){if(a){const t=jh[a];let o=this.makeAPLAction(a,t.newValue());i&&s&&this.actionPicker&&("sequence"==a?"strictSequence"==i.action.oneofKind?o.action.sequence.actions=i.action.strictSequence.actions:o.action.sequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"strictSequence"==a?"sequence"==i.action.oneofKind?o.action.strictSequence.actions=i.action.sequence.actions:o.action.strictSequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==a?o=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==a&&(o=i.action.strictSequence.actions[0])),i?i.action=o.action:this.setSourceValue(e,o)}else i.action={oneofKind:a};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return _i.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||ri.create({uuid:{value:tt()}}));const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return _i.create();const a={oneofKind:e};return a[e]=t,_i.create({action:a})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const a=jh[e];this.actionPicker=a.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||a.newValue(),setValue:(t,a,i)=>{const s=this.getSourceValue();s&&((s?.action)[e]=i),a.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function Wh(e){return{field:e,newValue:()=>Ei.Swap1,factory:(e,t,a)=>new ct(e,t,{id:tt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ei.Main,label:"Main"},{value:Ei.Swap1,label:"Swapped"}]})}}function Bh(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new fh(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map((e=>e||_i.create())))},itemLabel:"Action",newItem:_i.create,copyItem:e=>e?_i.clone(e):e,newItemPicker:(e,a,i,s)=>new Vh(e,t,s),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function zh(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:Gh(e.newValue,e.fields)}}const jh={castSpell:zh({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:ci.create,fields:[kh("spellId","castable_spells",""),Eh("target","targets")]}),castFriendlySpell:zh({label:"Cast at Player",shortDescription:"Casts a friendly spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:di.create,fields:[kh("spellId","friendly_spells",""),Eh("target","players")],includeIf:(e,t)=>e.getRaid().size()>1}),multidot:zh({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>mi.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[kh("spellId","castable_dot_spells",""),Ch("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Uh("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),strictMultidot:zh({label:"Strict Multi Dot",submenu:["Casting"],shortDescription:"Like a regular <b>Multi Dot</b>, except all Dots are applied immediately after each other. Keeps a DoT active on multiple targets by casting the specified spell. Will take Cast Time/GCD into account when refreshing subsequent DoTs.",includeIf:(e,t)=>!t,newValue:()=>hi.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[kh("spellId","castable_dot_spells",""),Ch("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Uh("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:zh({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&e.getSpec().isHealingSpec,newValue:()=>pi.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[kh("spellId","shield_spells",""),Ch("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),Uh("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:zh({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>ui.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[kh("spellId","channel_spells",""),Eh("target","targets"),Uh("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Ph("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),castAllStatBuffCooldowns:zh({label:"Cast All Stat Buff Cooldowns",submenu:["Casting"],shortDescription:"Casts all cooldowns that buff the specified stat type(s).",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>By default, this action will cast such cooldowns greedily as they become available. However, when embedded in a sequence, the action will only fire when ALL cooldowns matching the specified buff type(s) are ready.</li>\n\t\t\t</ul>\n\t\t",newValue:()=>gi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Rh("statType1"),Rh("statType2"),Rh("statType3")]}),autocastOtherCooldowns:zh({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:fi.create,fields:[]}),wait:zh({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>wi.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[Uh("duration")]}),waitUntil:zh({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>yi.create(),fields:[Uh("condition")]}),schedule:zh({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>Ii.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[Nh("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:()=>ri.create({uuid:{value:tt()}}),factory:(e,t,a)=>new Vh(e,t,a)}}("innerAction")]}),sequence:zh({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:bi.create,fields:[Nh("name"),Bh("actions")]}),resetSequence:zh({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:xi.create,fields:[Nh("sequenceName")]}),strictSequence:zh({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Si.create,fields:[Bh("actions")]}),changeTarget:zh({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Ti.create(),fields:[Eh("newTarget","targets")]}),activateAura:zh({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>Ri.create(),fields:[kh("auraId","auras")]}),activateAuraWithStacks:zh({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>vi.create({numStacks:1}),fields:[kh("auraId","stackable_auras"),Ch("numStacks",!1,{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),activateAllStatBuffProcAuras:zh({label:"Activate All Stat Buff Proc Auras",submenu:["Misc"],shortDescription:"Activates all item/enchant proc auras that buff the specified stat type(s) using the specified item set.",includeIf:(e,t)=>t,newValue:()=>ki.create({swapSet:Ei.Main,statType1:-1,statType2:-1,statType3:-1}),fields:[Wh("swapSet"),Rh("statType1"),Rh("statType2"),Rh("statType3")]}),cancelAura:zh({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>Di.create(),fields:[kh("auraId","auras")]}),triggerIcd:zh({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>Gi.create(),fields:[kh("auraId","icd_auras")]}),itemSwap:zh({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>Ef.includes(e.getSpec()),newValue:()=>Oi.create(),fields:[Wh("swapSet")]}),move:zh({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>Pi.create(),fields:[Uh("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),moveDuration:zh({label:"Move duration",submenu:["Misc"],shortDescription:"The characters moves for the given duration.",newValue:()=>Ci.create(),fields:[Uh("duration",{label:"Duration",labelTooltip:"Amount of time the character should move."})]}),customRotation:zh({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>Ui.create(),fields:[]}),catOptimalRotationAction:zh({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded algorithm.",includeIf:(e,t)=>e.getSpec()==w.SpecFeralDruid,newValue:()=>Ni.create({rotationType:mt.SingleTarget,maintainFaerieFire:!0,manualParams:!0,minRoarOffset:31,ripLeeway:1,useRake:!0,useBite:!0,biteTime:11,berserkBiteTime:6,biteDuringExecute:!0,allowAoeBerserk:!1,meleeWeave:!0,bearWeave:!0,snekWeave:!0,cancelPrimalMadness:!1}),fields:[function(e){const t=[{value:mt.SingleTarget,label:"Single Target"},{value:mt.Aoe,label:"AOE"}];return{field:e,label:"Type",newValue:()=>mt.SingleTarget,factory:(e,a,i)=>new ct(e,a,{id:tt(),...i,defaultLabel:"Single Target",equals:(e,t)=>e==t,values:t})}}("rotationType"),Ph("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"Maintain Faerie Fire debuff. Overwrites any external Sunder effects specified in settings."}),Ph("meleeWeave","Enable leave-weaving",{labelTooltip:"Weave out of melee range for Stampede procs. Ignored for AoE rotation or if Stampede is not talented."}),Ph("bearWeave","Enable bear-weaving",{labelTooltip:"Weave into Bear Form while pooling Energy. Ignored for AoE rotation."}),Ph("snekWeave","Use Albino Snake",{labelTooltip:"Reset swing timer at the end of bear-weaves using Albino Snake pet. Ignored if not bear-weaving."}),Ph("allowAoeBerserk","Allow AoE Berserk",{labelTooltip:"Allow Berserk usage in AoE rotation. Ignored for single target rotation."}),Ph("manualParams","Manual Advanced Parameters",{labelTooltip:"Manually specify advanced parameters, otherwise will use preset defaults."}),Ch("minRoarOffset",!0,{label:"Roar Offset",labelTooltip:"Targeted offset in Rip/Roar timings. Ignored for AOE rotation or if not using manual advanced parameters."}),Ch("ripLeeway",!1,{label:"Rip Leeway",labelTooltip:"Rip leeway when optimizing Roar clips. Ignored for AOE rotation or if not using manual advanced parameters."}),Ph("useRake","Use Rake",{labelTooltip:"Use Rake during rotation. Ignored for AOE rotation or if not using manual advanced parameters."}),Ph("useBite","Bite during rotation",{labelTooltip:"Use Bite during rotation rather than exclusively at end of fight. Ignored for AOE rotation or if not using manual advanced parameters."}),Ch("biteTime",!0,{label:"Bite Time",labelTooltip:"Min seconds remaining on Rip/Roar to allow a Bite. Ignored if not Biting during rotation."}),Ch("berserkBiteTime",!0,{label:"Bite Time during Berserk",labelTooltip:"More aggressive threshold when Berserk is active."}),Ph("biteDuringExecute","Bite during Execute phase",{labelTooltip:"Bite aggressively during Execute phase. Ignored if Blood in the Water is not talented, or if not using manual advanced parameters."}),Ph("cancelPrimalMadness","Enable Primal Madness cancellation",{labelTooltip:"Click off Primal Madness buff when doing so will result in net Energy gains. Ignored if Primal Madness is not talented, or if not using manual advanced parameters."})]})};class Hh extends e{constructor(e,t,a){super(e,"apl-rotation-picker-root"),new fh(this.rootElem,a,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,a)=>{t.aplRotation.prepullActions=a,t.rotationChangeEmitter.emit(e)},newItem:()=>Ai.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>Ai.clone(e),newItemPicker:(e,t,i,s)=>new qh(e,a,s,i),inlineMenuBar:!0}),new fh(this.rootElem,a,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,a)=>{t.aplRotation.priorityList=a,t.rotationChangeEmitter.emit(e)},newItem:()=>Li.create({action:{}}),copyItem:e=>Li.clone(e),newItemPicker:(e,t,i,s)=>new Kh(e,a,s,i),inlineMenuBar:!0})}}class qh extends s{getItem(){return this.getSourceValue()||Ai.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=fh.getItemHeaderElem(this);fh.makeListItemValidations(s,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[i]?.validations||[])),this.hidePicker=new $h(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new wh(this.rootElem,this.player,{id:tt(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,a)=>{this.getItem().doAtValue=a?ri.create({value:{oneofKind:"const",const:{val:a}},uuid:{value:tt()}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Vh(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Ai.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||_i.create()))}}class Kh extends s{getItem(){return this.getSourceValue()||Li.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=fh.getItemHeaderElem(this);fh.makeListItemValidations(s,t,(e=>e.getCurrentStats().rotationStats?.priorityList[i]?.validations||[])),this.hidePicker=new $h(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Vh(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Li.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||_i.create()))}}class $h extends s{constructor(e,t,a){super(e,"hide-picker-root",t,a),this.inputElem=fh.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(n.nextEventID())}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.tooltip=mn(this.inputElem,{content:"Enable/Disable"}),this.addOnDisposeCallback((()=>this.tooltip.destroy())),this.init()}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class Yh extends s{constructor(e,t,a){super(e,"number-list-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.placeholder=a.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(n.nextEventID())}),{signal:this.signal})}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){qe(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class Jh extends e{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[];const a=n.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((()=>{it(this.rootElem)?this.update():this.dispose()}));this.addOnDisposeCallback((()=>{this.rootElem.remove(),this.cooldownPickers.forEach((e=>e.remove())),a.dispose()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const a=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const s=document.createElement("label");s.classList.add("cooldown-picker-label","form-label"),a&&a.id&&h.fromProto(a.id).fill(this.player.getRaidIndex()).then((e=>s.textContent=e.name)),i.appendChild(s),this.makeTimingsPicker(i,t);const o=document.createElement("fragment");o.innerHTML='\n\t\t\t\t<button class="delete-cooldown link-danger">\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</button>\n\t\t\t';const l=o.children[0],r=mn(l,{content:"Delete Cooldown"});l.addEventListener("click",(()=>{const e=this.player.getSimpleCooldowns();e.cooldowns.splice(t,1),this.player.setSimpleCooldowns(n.nextEventID(),e),r.hide()})),i.appendChild(l),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const a=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id)).filter((e=>{const t=0!==e.spellId?e.spellId:e.itemId;return!this.player.hiddenMCDs.includes(t)}));this.rootElem.closest(".cooldown-settings")?.classList[a.length?"remove":"add"]("hide");return new sh(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:ot.create()}].concat(a.map((e=>({actionId:e,value:e.toProto()})))),equals:(e,t)=>ot.equals(e,t),zeroValue:ot.create(),backupIconUrl:e=>h.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||ot.create(),setValue:(e,a,i)=>{if(!i.rawId.oneofKind)return;const s=a.getSimpleCooldowns();for(;s.cooldowns.length<t;)s.cooldowns.push(Fi.create());s.cooldowns[t]=Fi.create({id:i,timings:[]}),a.setSimpleCooldowns(e,s)}})}makeTimingsPicker(e,t){return new Yh(e,this.player,{id:`cooldown-timings-${t}`,extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,a,i)=>{const s=a.getSimpleCooldowns();s.cooldowns[t].timings=i,a.setSimpleCooldowns(e,s)},enableWhen:e=>{const a=e.getSimpleCooldowns().cooldowns[t];return a&&!ot.equals(a.id,ot.create())}})}}class Zh extends Cn{constructor(e,a){super(e,a,{identifier:"rotation-tab",title:"Rotation"}),this.leftCol=this.buildColumn(1,"rotation-tab-col"),this.simUI=a,this.leftPanel=t("div",{className:"rotation-tab-left tab-panel-left"}),this.rightPanel=t("div",{className:"rotation-tab-right tab-panel-right"}),this.leftPanel.appendChild(this.leftCol),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto","rotation-type-simple","rotation-type-apl","rotation-type-legacy");let e="";switch(this.simUI.player.getRotationType()){case Ye.TypeAuto:e="rotation-type-auto";break;case Ye.TypeSimple:e="rotation-type-simple";break;case Ye.TypeAPL:e="rotation-type-apl"}this.rootElem.classList.add(e)}buildHeader(){const e=a(),i=a(),s=a();this.leftCol.appendChild(t("div",{ref:e,className:"rotation-tab-header d-flex justify-content-between align-items-baseline"},t("div",{ref:s}),t("button",{ref:i,className:"btn btn-sm btn-link btn-reset summary-table-reset-button"},t("i",{className:"fas fa-times me-1"}),"Reset APL"))),i.value.addEventListener("click",(()=>{this.simUI.applyEmptyAplRotation(n.nextEventID())})),this.simUI.player.rotationChangeEmitter.on((()=>{const e=this.simUI.player.getRotationType();i.value?.classList[e===Ye.TypeAPL?"remove":"add"]("hide")})),new hh(s.value,this.simUI.player,{extraCssClasses:["w-auto"],id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:Ye.TypeAuto,name:"Auto"},{value:Ye.TypeSimple,name:"Simple"},{value:Ye.TypeAPL,name:"APL"}]:[{value:Ye.TypeAuto,name:"Auto"},{value:Ye.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,a)=>{t.aplRotation.type=a,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){this.leftCol.appendChild(t("div",{className:"rotation-tab-auto"}))}buildAplContent(){const e=a();this.leftCol.appendChild(t("div",{ref:e,className:"rotation-tab-apl"})),new Hh(e.value,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new _n(this.leftCol,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const a=s.newGroupContainer();a.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(a),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(a,this.simUI.individualConfig.rotationIconInputs.map((e=>nh(a,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs);const i=new _n(this.leftCol,"cooldown-settings",{header:{title:"Cooldowns",tooltip:Mi}});i.rootElem.classList.add(e),new Jh(i.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{t.extraCssClasses=[...t.extraCssClasses||[],"input-inline"],"number"==t.type?new xn(e,this.simUI.player,{...t,inline:!0}):"boolean"==t.type?new Me(e,this.simUI.player,{...t,inline:!0}):"enum"==t.type&&new hh(e,this.simUI.player,{...t,inline:!0})}))}configureIconSection(e,t,a){t.length?a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`)):e.classList.add("hide")}buildPresetConfigurationPicker(){new Gm(this.rightPanel,this.simUI,["rotation"])}buildSavedDataPickers(){const e=new Rm(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Vi.create({rotation:Je.clone(e.aplRotation)}),setData:(e,t,a)=>{n.freezeAllAndDo((()=>{t.setAplRotation(e,a.rotation||Je.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(e,t)=>Vi.equals(e,t),toJson:e=>Vi.toJson(e),fromJson:e=>Vi.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const a=t.rotation;a.rotation||(a.rotation=Je.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:a,enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}class Qh{constructor(e){this.duration=300,this.durationVariation=60,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.executeProportion90=.9,this.useHealth=!1,this.targetsChangeEmitter=new n,this.durationChangeEmitter=new n,this.executeProportionChangeEmitter=new n,this.changeEmitter=new n,this.sim=e,this.targets=[Qh.defaultTargetProto()],this.targetsMetadata=new Qf,[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}get primaryTarget(){return this.targets[0]}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion90(){return this.executeProportion90}setExecuteProportion90(e,t){t!=this.executeProportion90&&(this.executeProportion90=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,a)=>Wi.equals(t,e.targets[a].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||Wi.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,a){this.targets[a]=t.target||Wi.create(),this.targetsChangeEmitter.emit(e)}toProto(){return Ze.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,executeProportion90:this.executeProportion90,useHealth:this.useHealth,targets:this.targets,apiVersion:Bi})}fromProto(e,t){Qh.updateProtoVersion(t),n.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setExecuteProportion90(e,t.executeProportion90),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){this.fromProto(e,Ze.create({duration:300,durationVariation:60,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,executeProportion90:.9,targets:[Qh.defaultTargetProto()],apiVersion:Bi}))}static defaultTargetProto(){return Wi.create({id:31146,name:"Raid Target",level:zi,mobType:ji.MobTypeMechanical,stats:d.fromMap({[l.StatArmor]:11977,[l.StatAttackPower]:650,[l.StatHealth]:120016403}).asProtoArray(),minBaseDamage:21e4,damageSpread:.4,tankIndex:0,swingSpeed:2.5,suppressDodge:!1,parryHaste:!1,dualWield:!1,dualWieldPenalty:!1,spellSchool:Hi.SpellSchoolPhysical,targetInputs:new Array(0)})}static updateProtoVersion(e){e.apiVersion<Bi&&(e.targets.forEach((t=>{t.stats=d.migrateStatsArray(t.stats,e.apiVersion,this.defaultTargetProto().stats)})),e.apiVersion=Bi)}}class Xh extends e{constructor(e,t,a,i){super(e,"encounter-picker-root"),ip(this.rootElem,t,a.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets(),a=t.sim.db.getAllPresetEncounters();if(new hh(this.rootElem,t,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["damage-metrics","npc-picker"],values:[{name:"Custom",value:-1}].concat(a.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:e=>a.findIndex((t=>e.matchesPreset(t))),setValue:(e,t,i)=>{-1!=i&&t.applyPreset(e,a[i])}}),i.isIndividualSim()&&i.player.canEnableTargetDummies()){const e=i.player;new xn(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:t=>n.onAny([t.targetDummiesChangeEmitter,e.itemSwapSettings.changeEmitter]),getValue:e=>e.getTargetDummies(),setValue:(e,t,a)=>{t.setTargetDummies(e,a)},showWhen:t=>{const a=e.shouldEnableTargetDummies();return a||t.setTargetDummies(n.nextEventID(),0),a}})}i.isIndividualSim()&&i.player.getPlayerSpec().isTankSpec&&new xn(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,a)=>{t.primaryTarget.minBaseDamage=a,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),o=e[s]?.target?.targetInputs||[];(o.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=o[t].label)))&&(t.primaryTarget.targetInputs=o,t.targetsChangeEmitter.emit(n.nextEventID())),sp(this.rootElem,t,0);const l=new ep(i.rootElem,i,t),r=document.createElement("button");r.classList.add("advanced-button","btn","btn-primary"),r.textContent="Advanced",r.addEventListener("click",(()=>l.open())),this.rootElem.appendChild(r)}))}}class ep extends yn{constructor(e,t,a){super(e,"advanced-encounter-picker-modal",{disposeOnClose:!1}),this.encounter=a,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("encounter-header")[0],s=this.rootElem.getElementsByClassName("encounter-targets")[0];ip(i,this.encounter,!0),t.isIndividualSim()||new Me(i,a,{id:"aem-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,a)=>{t.setUseHealth(e,a)}}),new fh(s,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,a)=>{t.targets=a,t.targetsChangeEmitter.emit(e)},newItem:()=>Qh.defaultTargetProto(),copyItem:e=>Wi.clone(e),newItemPicker:(e,t,i,s)=>new tp(e,a,i,s),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new hh(this.header,this.encounter,{id:"aem-encounter-picker",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,a,i)=>{-1!=i&&a.applyPreset(t,e[i])}})}}class tp extends s{getTarget(){return this.encounter.targets[this.targetIndex]||Wi.create()}constructor(e,t,a,i){super(e,"target-picker-root",t,i),this.encounter=t,this.targetIndex=a,this.rootElem.innerHTML='\n\t\t\t<div class="picker-group target-picker-section target-picker-section1"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section2"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const s=this.rootElem.querySelector(".target-picker-section1"),o=this.rootElem.querySelector(".target-picker-section2"),n=this.rootElem.querySelector(".target-picker-section3"),l=t.sim.db.getAllPresetTargets();new hh(s,null,{id:"target-picker-npc",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>function(e,t){if(!!e!=!!t)return!1;if(!e)return!0;const a=Wi.clone(t);return a.targetInputs=e.targetInputs,Wi.equals(e,a)}(this.getTarget(),e.target))),setValue:(e,a,i)=>{-1!=i&&(t.applyPresetTarget(e,l[i],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new hh(s,null,{id:"target-picker-ai",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,a,i)=>{const s=this.getTarget();s.id=i,s.targetInputs=(l.find((e=>s.id==e.target?.id))?.target?.targetInputs||[]).map((e=>qi.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new hh(s,null,{id:"target-picker-level",label:"Level",values:[{name:"88",value:88},{name:"87",value:87},{name:"86",value:86},{name:"85",value:85},{name:"83",value:83}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,a,i)=>{this.getTarget().level=i,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new hh(s,null,{id:"target-picker-mob-type",label:"Mob Type",values:np,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,a,i)=>{this.getTarget().mobType=i,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new hh(s,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,a,i)=>{this.getTarget().tankIndex=i,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=sp(s,t,this.targetIndex),this.statPickers=op.map((e=>{const a=e.stat;return new xn(o,null,{id:`target-${this.targetIndex}-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:f(a),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[a],setValue:(e,i,s)=>{this.getTarget().stats[a]=s,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new xn(n,null,{id:`target-${this.targetIndex}-picker-swing-speed`,label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,a,i)=>{this.getTarget().swingSpeed=i,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new xn(n,null,{id:`target-${this.targetIndex}-picker-min-base-damage`,label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,a,i)=>{this.getTarget().minBaseDamage=i,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new xn(n,null,{id:`target-${this.targetIndex}-picker-damage-spread`,label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,a,i)=>{this.getTarget().damageSpread=i,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new Me(n,null,{id:`target-${this.targetIndex}-picker-dual-wield`,label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,a,i)=>{this.getTarget().dualWield=i,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new Me(n,null,{id:`target-${this.targetIndex}-picker-dw-miss-penalty`,label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,a,i)=>{this.getTarget().dualWieldPenalty=i,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new Me(n,null,{id:`target-${this.targetIndex}-picker-parry-haste`,label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,a,i)=>{this.getTarget().parryHaste=i,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new hh(n,null,{id:`target-${this.targetIndex}-picker-spell-school`,label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:Hi.SpellSchoolPhysical},{name:"Arcane",value:Hi.SpellSchoolArcane},{name:"Fire",value:Hi.SpellSchoolFire},{name:"Frost",value:Hi.SpellSchoolFrost},{name:"Holy",value:Hi.SpellSchoolHoly},{name:"Nature",value:Hi.SpellSchoolNature},{name:"Shadow",value:Hi.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,a,i)=>{this.getTarget().spellSchool=i,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return Wi.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new d).withStat(op[t].stat,e))).reduce(((e,t)=>e.add(t))).asProtoArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),op.forEach(((t,a)=>this.statPickers[a].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class ap extends s{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||qi.create()}clearPickers(){this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.enumPicker&&(this.enumPicker.rootElem.remove(),this.enumPicker=null)}constructor(e,t,a,i,s){super(e,"target-input-picker-root",t,s),this.encounter=t,this.targetIndex=a,this.targetInputIndex=i,this.boolPicker=null,this.numberPicker=null,this.enumPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return qi.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0,enumValue:this.enumPicker?this.enumPicker.getInputValue():void 0})}setInputValue(e){if(e)if(e.inputType==Ki.Number){if(this.numberPicker&&this.numberPicker.inputConfig.label===e.label)return;this.clearPickers(),this.numberPicker=new xn(this.rootElem,null,{id:tt(),float:!0,label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,a)=>{this.getTargetInput().numberValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else if(e.inputType==Ki.Bool){if(this.boolPicker&&this.boolPicker.inputConfig.label===e.label)return;this.clearPickers(),this.boolPicker=new Me(this.rootElem,null,{id:tt(),label:e.label,labelTooltip:e.tooltip,extraCssClasses:["input-inline"],changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,a)=>{this.getTargetInput().boolValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else e.inputType==Ki.Enum&&(this.clearPickers(),this.enumPicker=new hh(this.rootElem,null,{id:tt(),label:e.label,values:e.enumOptions.map(((e,t)=>({value:t,name:e}))),changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().enumValue,setValue:(e,t,a)=>{this.getTargetInput().enumValue=a,this.encounter.targetsChangeEmitter.emit(e)}}))}}function ip(e,t,a){const i=s.newGroupContainer();if(e.appendChild(i),new xn(i,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,a)=>{t.setDuration(e,a)},enableWhen:e=>!t.getUseHealth()}),new xn(i,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,a)=>{t.setDurationVariation(e,a)},enableWhen:e=>!t.getUseHealth()}),a){const a=s.newGroupContainer();a.classList.add("execute-group"),e.appendChild(a),new xn(a,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,a)=>{t.setExecuteProportion20(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new xn(a,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,a)=>{t.setExecuteProportion25(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new xn(a,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,a)=>{t.setExecuteProportion35(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new xn(a,t,{id:"encounter-execute-proportion-50",label:"Duration spent below high-HP regime (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets are considered out of range for effects like Hunter Careful Aim (<90% HP) or Druid Predatory Strikes (<80% HP).",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion90(),setValue:(e,t,a)=>{t.setExecuteProportion90(e,a/100)},enableWhen:e=>!t.getUseHealth()})}}function sp(e,t,a){return new fh(e,t,{allowedActions:[],itemLabel:"Target Input",extraCssClasses:["mt-2"],isCompact:!0,changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[a].targetInputs,setValue:(e,t,i)=>{t.targets[a].targetInputs=i,t.targetsChangeEmitter.emit(e)},newItem:()=>qi.create(),copyItem:e=>qi.clone(e),newItemPicker:(e,i,s,o)=>new ap(e,t,a,s,o)})}const op=[{stat:l.StatHealth,tooltip:"",extraCssClasses:[]},{stat:l.StatArmor,tooltip:"",extraCssClasses:[]},{stat:l.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]}],np=[{name:"None",value:ji.MobTypeUnknown},{name:"Beast",value:ji.MobTypeBeast},{name:"Demon",value:ji.MobTypeDemon},{name:"Dragonkin",value:ji.MobTypeDragonkin},{name:"Elemental",value:ji.MobTypeElemental},{name:"Giant",value:ji.MobTypeGiant},{name:"Humanoid",value:ji.MobTypeHumanoid},{name:"Mechanical",value:ji.MobTypeMechanical},{name:"Undead",value:ji.MobTypeUndead}];class lp extends e{constructor(e,t,a,i){super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.abortController=new AbortController,this.signal=this.abortController.signal,this.config=a,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<div class="dropend">\n\t\t\t\t<a\n\t\t\t\t\tclass="icon-picker-button"\n\t\t\t\t\trole="button"\n\t\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\t\taria-expanded="false"\n\t\t\t\t\tdata-disable-wowhead-touch-tooltip=\'true\'\n\t\t\t\t\tdata-whtticon=\'false\'\n\t\t\t\t></a>\n\t\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t</div>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n    ';const s=this.rootElem.querySelector(".multi-icon-picker-label");a.label?s.textContent=a.label:s.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()}),{signal:this.signal}),this.buttonElem.addEventListener("contextmenu",(e=>{e.preventDefault()}),{signal:this.signal}),this.buttonElem.addEventListener("mousedown",(e=>{L(e)&&this.clearPicker()}),{signal:this.signal}),this.buildBlankOption(),this.pickers=a.inputs.map(((e,a)=>{const i=document.createElement("li");return i.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(i),new oh(i,t,e)})),i.sim.waitForInit().then((()=>this.updateButtonImage()));const o=i.changeEmitter.on((()=>{if(!it(this.rootElem)||!it(this.dropdownMenu)||!it(this.buttonElem))return void this.dispose();this.updateButtonImage();!this.config.showWhen||this.config.showWhen(i.sim.raid.getPlayer(0))?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}));this.addOnDisposeCallback((()=>o.dispose()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t);t.addEventListener("click",(()=>this.clearPicker()),{signal:this.signal})}clearPicker(){n.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(n.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const rp=Am([lh({actionId:h.fromSpellId(20217),fieldName:"blessingOfKings"}),lh({actionId:h.fromSpellId(1126),fieldName:"markOfTheWild"}),lh({actionId:h.fromSpellId(116781),fieldName:"legacyOfTheWhiteTiger"}),lh({actionId:h.fromItemId(63140),fieldName:"drumsOfTheBurningWild"})],"Stats"),cp=Am([lh({actionId:h.fromSpellId(465),fieldName:"devotionAura"}),lh({actionId:h.fromSpellId(8071),fieldName:"stoneskinTotem"})],"Armor"),dp=Am([lh({actionId:h.fromSpellId(19740),fieldName:"blessingOfMight"}),lh({actionId:h.fromSpellId(53138),fieldName:"abominationsMight"}),lh({actionId:h.fromSpellId(30808),fieldName:"unleashedRage"}),lh({actionId:h.fromSpellId(19506),fieldName:"trueshotAura"})],"Atk Pwr %"),mp=Am([lh({actionId:h.fromSpellId(2825),fieldName:"bloodlust"}),lh({actionId:h.fromSpellId(80353),fieldName:"timeWarp"})],"Lust"),hp=Am([lh({actionId:h.fromSpellId(31876),fieldName:"communion"}),lh({actionId:h.fromSpellId(82930),fieldName:"arcaneTactics"}),lh({actionId:h.fromSpellId(34460),fieldName:"ferociousInspiration"})],"+3% Dmg"),pp=Am([mh({actionId:h.fromSpellId(6940),numStates:11,fieldName:"handOfSacrificeCount"}),mh({actionId:h.fromSpellId(33206),numStates:11,fieldName:"painSuppressionCount"}),mh({actionId:h.fromSpellId(97462),numStates:11,fieldName:"rallyingCryCount"})],"Defensive CDs"),up=Am([lh({actionId:h.fromSpellId(15473),fieldName:"shadowForm"}),lh({actionId:h.fromSpellId(24858),fieldName:"moonkinForm"}),lh({actionId:h.fromSpellId(3738),fieldName:"wrathOfAirTotem"})],"Spell Haste"),gp=Am([lh({actionId:h.fromSpellId(1459),fieldName:"arcaneBrilliance"}),lh({actionId:h.fromSpellId(54424),fieldName:"felIntelligence"})],"Mana"),fp=Am([lh({actionId:h.fromSpellId(17007),fieldName:"leaderOfThePack"}),lh({actionId:h.fromSpellId(51470),fieldName:"elementalOath"}),lh({actionId:h.fromSpellId(51701),fieldName:"honorAmongThieves"}),lh({actionId:h.fromSpellId(29801),fieldName:"rampage"}),lh({actionId:h.fromSpellId(24604),fieldName:"furiousHowl"}),lh({actionId:h.fromSpellId(115921),fieldName:"legacyOfTheEmperor"})],"Crit %"),wp=Am([lh({actionId:h.fromSpellId(55610),fieldName:"icyTalons"}),lh({actionId:h.fromSpellId(8512),fieldName:"windfuryTotem"}),lh({actionId:h.fromSpellId(53290),fieldName:"huntingParty"})],"Melee Haste"),yp=Am([lh({actionId:h.fromSpellId(19740),fieldName:"blessingOfMight"}),lh({actionId:h.fromSpellId(54424),fieldName:"felIntelligence"}),lh({actionId:h.fromSpellId(5675),fieldName:"manaSpringTotem"})],"MP5"),Ip=Am([rh({actionId:h.fromSpellId(34914),fieldName:"vampiricTouch"}),rh({actionId:h.fromSpellId(31876),fieldName:"communion"}),rh({actionId:h.fromSpellId(48544),fieldName:"revitalize"}),rh({actionId:h.fromSpellId(30295),fieldName:"soulLeach"}),rh({actionId:h.fromSpellId(86508),fieldName:"enduringWinter"})],"Replen"),bp=Am([lh({actionId:h.fromSpellId(19891),fieldName:"resistanceAura"}),lh({actionId:h.fromSpellId(8184),fieldName:"elementalResistanceTotem"}),lh({actionId:h.fromSpellId(20043),fieldName:"aspectOfTheWild"}),lh({actionId:h.fromSpellId(27683),fieldName:"shadowProtection"}),lh({actionId:h.fromSpellId(20217),fieldName:"blessingOfKings"}),lh({actionId:h.fromSpellId(1126),fieldName:"markOfTheWild"})],"Resistances"),xp=Am([lh({actionId:h.fromSpellId(47236),fieldName:"demonicPact"}),lh({actionId:h.fromSpellId(77746),fieldName:"totemicWrath"}),lh({actionId:h.fromSpellId(1459),fieldName:"arcaneBrilliance"}),lh({actionId:h.fromSpellId(8227),fieldName:"flametongueTotem"})],"Spell Power"),Sp=Am([lh({actionId:h.fromSpellId(21562),fieldName:"powerWordFortitude"}),lh({actionId:h.fromSpellId(6307),fieldName:"bloodPact"}),lh({actionId:h.fromSpellId(469),fieldName:"commandingShout"})],"Stamina"),vp=Am([lh({actionId:h.fromSpellId(8075),fieldName:"strengthOfEarthTotem"}),lh({actionId:h.fromSpellId(57330),fieldName:"hornOfWinter"}),lh({actionId:h.fromSpellId(6673),fieldName:"battleShout"})],"Str/Agi"),kp=lh({actionId:h.fromSpellId(7294),fieldName:"retributionAura"}),Ep=eh({getModObject:e=>e,showWhen:e=>!Pp.faction||Pp.faction==e.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>n.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},(Pp={actionId:h.fromSpellId(16190),numStates:5,fieldName:"manaTideTotemCount"}).actionId,Pp.numStates,Pp.fieldName,Pp.multiplier);var Pp;const Cp=mh({actionId:h.fromSpellId(29166),numStates:11,fieldName:"innervateCount"}),Np=mh({actionId:h.fromSpellId(10060),numStates:11,fieldName:"powerInfusionCount"}),_p=rh({actionId:h.fromSpellId(54648),fieldName:"focusMagic"}),Tp=function(e){return function(e,t,a,i){const s=Xm(e,t,i);return s.states=3,s.improvedId=a,s}({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>n.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}({actionId:h.fromItemId(45767),impId:h.fromSpellId(57933),fieldName:"tricksOfTheTrade"}),Rp=mh({actionId:h.fromSpellId(49016),numStates:11,fieldName:"unholyFrenzyCount"}),Dp=rh({actionId:h.fromSpellId(85759),fieldName:"darkIntent"}),Gp=mh({actionId:h.fromSpellId(64382),numStates:11,fieldName:"shatteringThrowCount"}),Op=Am([dh({actionId:h.fromSpellId(7386),fieldName:"sunderArmor"}),dh({actionId:h.fromSpellId(8647),fieldName:"exposeArmor"}),dh({actionId:h.fromSpellId(770),fieldName:"faerieFire"}),dh({actionId:h.fromSpellId(35387),fieldName:"corrosiveSpit"})],"-Armor %"),Up=Am([dh({actionId:h.fromSpellId(26017),fieldName:"vindication"}),dh({actionId:h.fromSpellId(702),fieldName:"curseOfWeakness"}),dh({actionId:h.fromSpellId(99),fieldName:"demoralizingRoar"}),dh({actionId:h.fromSpellId(81130),fieldName:"scarletFever"}),dh({actionId:h.fromSpellId(1160),fieldName:"demoralizingShout"})],"-Dmg %"),Ap=Am([dh({actionId:h.fromSpellId(29859),fieldName:"bloodFrenzy"}),dh({actionId:h.fromSpellId(33878),fieldName:"mangle"}),dh({actionId:h.fromSpellId(57386),fieldName:"stampede"}),dh({actionId:h.fromSpellId(16511),fieldName:"hemorrhage"})],"+Bleed %"),Lp=Am([dh({actionId:h.fromSpellId(12873),fieldName:"criticalMass"}),dh({actionId:h.fromSpellId(17801),fieldName:"shadowAndFlame"})],"Spell Crit"),Fp=Am([dh({actionId:h.fromSpellId(6343),fieldName:"thunderClap"}),dh({actionId:h.fromSpellId(59921),fieldName:"frostFever"}),dh({actionId:h.fromSpellId(53696),fieldName:"judgementsOfTheJust"}),dh({actionId:h.fromSpellId(48484),fieldName:"infectedWounds"}),dh({actionId:h.fromSpellId(8042),fieldName:"earthShock"})],"Atk Speed"),Mp=Am([dh({actionId:h.fromSpellId(29859),fieldName:"bloodFrenzy"}),dh({actionId:h.fromSpellId(58413),fieldName:"savageCombat"}),dh({actionId:h.fromSpellId(81328),fieldName:"brittleBones"}),dh({actionId:h.fromSpellId(55749),fieldName:"acidSpit"})],"Phys Vuln"),Vp=Am([dh({actionId:h.fromSpellId(51160),fieldName:"ebonPlaguebringer"}),dh({actionId:h.fromSpellId(60433),fieldName:"earthAndMoon"}),dh({actionId:h.fromSpellId(1490),fieldName:"curseOfElements"}),dh({actionId:h.fromSpellId(58410),fieldName:"masterPoisoner"}),dh({actionId:h.fromSpellId(34889),fieldName:"fireBreath"})],"Spell Dmg"),Wp=[{config:rp,picker:lp,stats:[]},{config:cp,picker:lp,stats:[l.StatArmor]},{config:Sp,picker:lp,stats:[l.StatStamina]},{config:vp,picker:lp,stats:[l.StatStrength,l.StatAgility]},{config:gp,picker:lp,stats:[l.StatMana]},{config:dp,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:fp,picker:lp,stats:[l.StatCritRating]},{config:wp,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:xp,picker:lp,stats:[l.StatSpellPower]},{config:up,picker:lp,stats:[l.StatSpellPower]},{config:hp,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:bp,picker:lp,stats:[l.StatNatureResistance,l.StatShadowResistance,l.StatFrostResistance]},{config:yp,picker:lp,stats:[l.StatMP5]},{config:Ip,picker:lp,stats:[l.StatMP5]},{config:mp,picker:lp,stats:[l.StatHasteRating]},{config:pp,picker:lp,stats:[l.StatStamina]}],Bp=[{config:Dp,picker:oh,stats:[l.StatHasteRating]},{config:_p,picker:oh,stats:[l.StatIntellect]},{config:kp,picker:oh,stats:[l.StatArmor]},{config:Ep,picker:oh,stats:[l.StatMP5]},{config:Cp,picker:oh,stats:[l.StatMP5]},{config:Np,picker:oh,stats:[l.StatMP5,l.StatSpellPower]},{config:Tp,picker:oh,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:Rp,picker:oh,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Gp,picker:oh,stats:[l.StatAttackPower,l.StatRangedAttackPower]}],zp=[{config:Op,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Mp,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Ap,picker:lp,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Vp,picker:lp,stats:[l.StatSpellPower]},{config:Lp,picker:lp,stats:[l.StatIntellect]},{config:Up,picker:lp,stats:[l.StatArmor]},{config:Fp,picker:lp,stats:[l.StatArmor]}],jp=[];function Hp(e,t){return e.filter((e=>0==e.stats.length||e.stats.some((e=>t.individualConfig.epStats.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))).filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)))}function qp(e){return(t,a)=>({type:"iconEnum",tooltip:a,numColumns:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>(!e.config.showWhen||e.config.showWhen(t))&&(e.config.faction||t.getFaction())==t.getFaction()})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>n.onAny([e.consumesChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,a,i)=>{const s=a.getConsumes();s[e.consumesFieldName]!==i&&(s[e.consumesFieldName]=i,n.freezeAllAndDo((()=>{a.setConsumes(t,s),e.onSet&&e.onSet(t,a,i)})))}})}const Kp={actionId:h.fromItemId(12662),value:$i.ConjuredDarkRune},$p={actionId:h.fromItemId(5512),value:$i.ConjuredHealthstone},Yp=[{config:{actionId:h.fromItemId(7676),value:$i.ConjuredRogueThistleTea,showWhen:e=>e.getClass()==O.ClassRogue},stats:[]},{config:$p,stats:[l.StatStamina]},{config:Kp,stats:[l.StatIntellect]}],Jp=qp({consumesFieldName:"defaultConjured"}),Zp=ch({actionId:h.fromItemId(63396),fieldName:"explosiveBigDaddy",showWhen:e=>e.hasProfession(xe.Engineering)}),Qp=ch({actionId:h.fromItemId(60223),fieldName:"highpoweredBoltGun",showWhen:e=>e.hasProfession(xe.Engineering)}),Xp={actionId:h.fromSpellId(82174),value:Yi.TinkerHandsSynapseSprings},eu=[{config:Xp,stats:[]},{config:{actionId:h.fromSpellId(82176),value:Yi.TinkerHandsQuickflipDeflectionPlates},stats:[]},{config:{actionId:h.fromSpellId(82179),value:Yi.TinkerHandsTazikShocker},stats:[]},{config:{actionId:h.fromSpellId(82184),value:Yi.TinkerHandsSpinalHealingInjector},stats:[]},{config:{actionId:h.fromSpellId(82186),value:Yi.TinkerHandsZ50ManaGulper},stats:[]}],tu=qp({consumesFieldName:"tinkerHands",showWhen:e=>e.hasProfession(xe.Engineering)}),au={actionId:h.fromItemId(58088),value:Ji.FlaskOfTitanicStrength},iu={actionId:h.fromItemId(58087),value:Ji.FlaskOfTheWinds},su={actionId:h.fromItemId(58085),value:Ji.FlaskOfSteelskin},ou={actionId:h.fromItemId(67438),value:Ji.FlaskOfFlowingWater},nu={actionId:h.fromItemId(58086),value:Ji.FlaskOfTheDraconicMind},lu={actionId:h.fromItemId(46376),value:Ji.FlaskOfTheFrostWyrm},ru={actionId:h.fromItemId(46377),value:Ji.FlaskOfEndlessRage},cu={actionId:h.fromItemId(46378),value:Ji.FlaskOfPureMojo},du={actionId:h.fromItemId(46379),value:Ji.FlaskOfStoneblood},mu={actionId:h.fromItemId(40079),value:Ji.LesserFlaskOfToughness},hu={actionId:h.fromItemId(44939),value:Ji.LesserFlaskOfResistance},pu=[{config:nu,stats:[l.StatSpellPower]},{config:au,stats:[l.StatStrength]},{config:iu,stats:[l.StatAgility]},{config:su,stats:[l.StatStamina]},{config:ou,stats:[l.StatSpirit]},{config:lu,stats:[l.StatSpellPower]},{config:ru,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:cu,stats:[l.StatMP5]},{config:du,stats:[l.StatStamina]},{config:mu,stats:[l.StatResilienceRating]},{config:hu,stats:[l.StatArcaneResistance,l.StatFireResistance,l.StatFrostResistance,l.StatNatureResistance,l.StatShadowResistance]}],uu=qp({consumesFieldName:"flask",onSet:(e,t,a)=>{if(a){const a=t.getConsumes();a.battleElixir=Zi.BattleElixirUnknown,a.guardianElixir=Qi.GuardianElixirUnknown,t.setConsumes(e,a)}}}),gu={actionId:h.fromItemId(58148),value:Zi.ElixirOfTheMaster},fu={actionId:h.fromItemId(58144),value:Zi.ElixirOfMightySpeed},wu={actionId:h.fromItemId(58094),value:Zi.ElixirOfImpossibleAccuracy},yu={actionId:h.fromItemId(58092),value:Zi.ElixirOfTheCobra},Iu={actionId:h.fromItemId(58089),value:Zi.ElixirOfTheNaga},bu={actionId:h.fromItemId(58084),value:Zi.GhostElixir},xu={actionId:h.fromItemId(44325),value:Zi.ElixirOfAccuracy};h.fromItemId(44330),Zi.ElixirOfArmorPiercing;const Su={actionId:h.fromItemId(44327),value:Zi.ElixirOfDeadlyStrikes},vu={actionId:h.fromItemId(44329),value:Zi.ElixirOfExpertise},ku={actionId:h.fromItemId(44331),value:Zi.ElixirOfLightningSpeed},Eu={actionId:h.fromItemId(39666),value:Zi.ElixirOfMightyAgility},Pu={actionId:h.fromItemId(40073),value:Zi.ElixirOfMightyStrength},Cu={actionId:h.fromItemId(40076),value:Zi.GurusElixir},Nu={actionId:h.fromItemId(40070),value:Zi.SpellpowerElixir},_u={actionId:h.fromItemId(40068),value:Zi.WrathElixir};h.fromItemId(9224),Zi.ElixirOfDemonslaying;const Tu=[{config:gu,stats:[l.StatMasteryRating]},{config:fu,stats:[l.StatHasteRating]},{config:wu,stats:[l.StatHitRating]},{config:yu,stats:[l.StatCritRating]},{config:Iu,stats:[l.StatExpertiseRating]},{config:bu,stats:[l.StatSpirit]},{config:xu,stats:[l.StatHitRating]},{config:Su,stats:[l.StatCritRating]},{config:vu,stats:[l.StatExpertiseRating]},{config:ku,stats:[l.StatHasteRating]},{config:Eu,stats:[l.StatAgility]},{config:Pu,stats:[l.StatStrength]},{config:Cu,stats:[l.StatStamina,l.StatAgility,l.StatStrength,l.StatSpirit,l.StatIntellect]},{config:Nu,stats:[l.StatSpellPower]},{config:_u,stats:[l.StatAttackPower,l.StatRangedAttackPower]}],Ru=qp({consumesFieldName:"battleElixir",onSet:(e,t,a)=>{if(a){const a=t.getConsumes();a.flask=Ji.FlaskUnknown,t.setConsumes(e,a)}}}),Du={actionId:h.fromItemId(58093),value:Qi.ElixirOfDeepEarth},Gu={actionId:h.fromItemId(58143),value:Qi.PrismaticElixir},Ou={actionId:h.fromItemId(44328),value:Qi.ElixirOfMightyDefense},Uu={actionId:h.fromItemId(40078),value:Qi.ElixirOfMightyFortitude},Au={actionId:h.fromItemId(40109),value:Qi.ElixirOfMightyMageblood},Lu={actionId:h.fromItemId(44332),value:Qi.ElixirOfMightyThoughts},Fu={actionId:h.fromItemId(40097),value:Qi.ElixirOfProtection},Mu={actionId:h.fromItemId(40072),value:Qi.ElixirOfSpirit},Vu=[{config:Du,stats:[l.StatArmor]},{config:Gu,stats:[l.StatArcaneResistance,l.StatFireResistance,l.StatFrostResistance,l.StatNatureResistance,l.StatShadowResistance]},{config:Ou,stats:[l.StatArmor]},{config:Uu,stats:[l.StatStamina]},{config:Au,stats:[l.StatMP5]},{config:Lu,stats:[l.StatIntellect]},{config:Fu,stats:[l.StatArmor]},{config:Mu,stats:[l.StatSpirit]}],Wu=qp({consumesFieldName:"guardianElixir",onSet:(e,t,a)=>{if(a){const a=t.getConsumes();a.flask=Ji.FlaskUnknown,t.setConsumes(e,a)}}}),Bu={actionId:h.fromItemId(43015),value:Xi.FoodFishFeast},zu={actionId:h.fromItemId(34753),value:Xi.FoodGreatFeast},ju={actionId:h.fromItemId(42999),value:Xi.FoodBlackenedDragonfin},Hu={actionId:h.fromItemId(42995),value:Xi.FoodHeartyRhino},qu={actionId:h.fromItemId(34754),value:Xi.FoodMegaMammothMeal},Ku={actionId:h.fromItemId(34756),value:Xi.FoodSpicedWormBurger},$u={actionId:h.fromItemId(42994),value:Xi.FoodRhinoliciousWormsteak},Yu={actionId:h.fromItemId(34769),value:Xi.FoodImperialMantaSteak},Ju={actionId:h.fromItemId(42996),value:Xi.FoodSnapperExtreme},Zu={actionId:h.fromItemId(34758),value:Xi.FoodMightyRhinoDogs},Qu={actionId:h.fromItemId(34767),value:Xi.FoodFirecrackerSalmon},Xu={actionId:h.fromItemId(42998),value:Xi.FoodCuttlesteak},eg={actionId:h.fromItemId(43e3),value:Xi.FoodDragonfinFilet};h.fromItemId(27657),Xi.FoodBlackenedBasilisk,h.fromItemId(27664),Xi.FoodGrilledMudfish,h.fromItemId(27655),Xi.FoodRavagerDog,h.fromItemId(27658),Xi.FoodRoastedClefthoof,h.fromItemId(33872),Xi.FoodSpicyHotTalbuk,h.fromItemId(33825),Xi.FoodSkullfishSoup,h.fromItemId(33052),Xi.FoodFishermansFeast;const tg={actionId:h.fromItemId(62290),value:Xi.FoodSeafoodFeast},ag={actionId:h.fromItemId(62649),value:Xi.FoodFortuneCookie},ig={actionId:h.fromItemId(62671),value:Xi.FoodSeveredSagefish},sg={actionId:h.fromItemId(62670),value:Xi.FoodBeerBasedCrocolisk},og={actionId:h.fromItemId(62661),value:Xi.FoodBakedRockfish},ng={actionId:h.fromItemId(62665),value:Xi.FoodBasiliskLiverdog},lg={actionId:h.fromItemId(62668),value:Xi.FoodBlackbellySushi},rg={actionId:h.fromItemId(62669),value:Xi.FoodSkeweredEel},cg={actionId:h.fromItemId(62664),value:Xi.FoodCrocoliskAuGratin},dg={actionId:h.fromItemId(62666),value:Xi.FoodDeliciousSagefishTail},mg={actionId:h.fromItemId(62667),value:Xi.FoodMushroomSauceMudfish},hg={actionId:h.fromItemId(62662),value:Xi.FoodGrilledDragon},pg={actionId:h.fromItemId(62663),value:Xi.FoodLavascaleMinestrone},ug=[{config:tg,stats:[l.StatStamina,l.StatStrength,l.StatIntellect,l.StatAgility]},{config:ag,stats:[l.StatAgility,l.StatStamina,l.StatStrength,l.StatAgility]},{config:ig,stats:[l.StatIntellect]},{config:sg,stats:[l.StatStrength]},{config:rg,stats:[l.StatAgility]},{config:dg,stats:[l.StatSpirit]},{config:og,stats:[l.StatCritRating]},{config:ng,stats:[l.StatHasteRating]},{config:pg,stats:[l.StatMasteryRating]},{config:hg,stats:[l.StatHitRating]},{config:cg,stats:[l.StatExpertiseRating]},{config:mg,stats:[l.StatDodgeRating]},{config:lg,stats:[l.StatParryRating]},{config:Bu,stats:[l.StatStamina,l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:zu,stats:[l.StatStamina,l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:ju,stats:[l.StatAgility]},{config:eg,stats:[l.StatStrength]},{config:Xu,stats:[l.StatSpirit]},{config:qu,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Hu,stats:[l.StatCritRating]},{config:$u,stats:[l.StatExpertiseRating]},{config:Qu,stats:[l.StatSpellPower]},{config:Ju,stats:[l.StatHitRating]},{config:Ku,stats:[l.StatCritRating]},{config:Yu,stats:[l.StatHasteRating]},{config:Zu,stats:[l.StatMP5]}],gg=qp({consumesFieldName:"food"});ch({actionId:h.fromItemId(27498),fieldName:"petScrollOfAgility",value:5}),ch({actionId:h.fromItemId(27503),fieldName:"petScrollOfStrength",value:5});const fg={actionId:h.fromItemId(58146),value:es.GolembloodPotion},wg={actionId:h.fromItemId(58145),value:es.PotionOfTheTolvir},yg={actionId:h.fromItemId(57194),value:es.PotionOfConcentration},Ig={actionId:h.fromItemId(58091),value:es.VolcanicPotion},bg={actionId:h.fromItemId(58090),value:es.EarthenPotion},xg={actionId:h.fromItemId(57193),value:es.MightyRejuvenationPotion},Sg={actionId:h.fromItemId(57191),value:es.MythicalHealingPotion},vg={actionId:h.fromItemId(57192),value:es.MythicalManaPotion},kg={actionId:h.fromItemId(40211),value:es.PotionOfSpeed};h.fromItemId(22838),es.HastePotion,h.fromItemId(13442),es.MightyRagePotion;const Eg={actionId:h.fromItemId(22788),value:es.FlameCap},Pg=[{config:fg,stats:[l.StatStrength]},{config:wg,stats:[l.StatAgility]},{config:yg,stats:[l.StatMana]},{config:Ig,stats:[l.StatIntellect]},{config:bg,stats:[l.StatArmor]},{config:xg,stats:[l.StatIntellect,l.StatHealth]},{config:Sg,stats:[l.StatHealth]},{config:vg,stats:[l.StatIntellect]},{config:kg,stats:[l.StatHasteRating]},{config:Eg,stats:[]}],Cg=[{config:fg,stats:[l.StatStrength]},{config:wg,stats:[l.StatAgility]},{config:Ig,stats:[l.StatIntellect]},{config:bg,stats:[l.StatArmor]},{config:kg,stats:[l.StatHasteRating]},{config:Eg,stats:[]}],Ng=qp({consumesFieldName:"defaultPotion"}),_g=qp({consumesFieldName:"prepopPotion"});class Tg extends e{constructor(e,t,a){super(e,"consumes-picker-root"),this.settingsTab=t,this.simUI=a,this.buildPotionsPicker(),this.buildElixirsPicker(),this.buildFoodPicker(),this.buildEngPicker(),this.buildPetPicker()}buildPotionsPicker(){const e=a(),i=this.rootElem.appendChild(t(Rg,{label:"Potions"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-potions"}))),s=e.value,o=_g(Hp(Cg,this.simUI),"Prepop Potion"),l=nh(s,this.simUI.player,o),r=Ng(Hp(Pg,this.simUI),"Combat Potion"),c=nh(s,this.simUI.player,r),d=Jp(Hp(Yp,this.simUI)),m=nh(s,this.simUI.player,d),h=n.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(i,[c,m,l])));this.addOnDisposeCallback((()=>h.dispose()))}buildElixirsPicker(){const e=a(),i=a(),s=a();this.rootElem.appendChild(t(Rg,{label:"Elixirs"},t("div",{className:"picker-group icon-group consumes-row-inputs"},t("div",{ref:e,className:"consumes-flasks"}),t("span",{className:"elixir-space"},"or"),t("div",{ref:i,className:"consumes-battle-elixirs"}),t("div",{ref:s,className:"consumes-guardian-elixirs"}))));const o=e.value,n=i.value,l=s.value,r=uu(Hp(pu,this.simUI));nh(o,this.simUI.player,r);const c=Ru(Hp(Tu,this.simUI));nh(n,this.simUI.player,c);const d=Wu(Hp(Vu,this.simUI));nh(l,this.simUI.player,d)}buildFoodPicker(){const e=a();this.rootElem.appendChild(t(Rg,{label:"Food"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-food"})));const i=e.value,s=gg(Hp(ug,this.simUI));nh(i,this.simUI.player,s)}buildEngPicker(){const e=a(),i=this.rootElem.appendChild(t(Rg,{label:"Engineering"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-engi"}))),s=e.value,o=tu(Hp(eu,this.simUI),"Gloves Tinkers"),l=nh(s,this.simUI.player,o),r=nh(s,this.simUI.player,Zp),c=nh(s,this.simUI.player,Qp),d=n.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(i,[r,c,l])));this.addOnDisposeCallback((()=>d.dispose())),this.updateRow(i,[r,c,l])}buildPetPicker(){if(this.simUI.individualConfig.petConsumeInputs?.length){const e=a();this.rootElem.appendChild(t(Rg,{label:"Pet"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-pet"})));const i=e.value;this.simUI.individualConfig.petConsumeInputs.map((e=>nh(i,this.simUI.player,e)))}}updateRow(e,t){e.classList[t.find((e=>e?.showWhen()))?"remove":"add"]("hide")}}const Rg=({label:e,children:a})=>t("div",{className:"consumes-row input-root input-inline"},t("label",{className:"form-label"},e),a);class Dg extends Cn{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildDebuffsSettings()),this.simUI.isWithinRaidSim||(this.buildPresetConfigurationPicker(),this.buildSavedDataPickers())}buildEncounterSettings(){const e=new _n(this.column1,"encounter-settings",{header:{title:"Encounter"}});new Xh(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=this.column1,t=new _n(e,"player-settings",{header:{title:"Player"}}),a=s.newGroupContainer();a.classList.add("player-icon-group","icon-group"),t.bodyElement.appendChild(a),this.configureIconSection(a,this.simUI.individualConfig.playerIconInputs.map((e=>nh(a,this.simUI.player,e))),!0);const i=this.simUI.player.getPlayerClass().races;new hh(t.bodyElement,this.simUI.player,{id:"simui-race",label:"Race",values:i.map((e=>({name:Ke.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,a)=>t.setRace(e,a)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(t.bodyElement,this.simUI.individualConfig.playerInputs);const o=s.newGroupContainer();t.bodyElement.appendChild(o);const n=_(xe).filter((e=>e!=xe.Archeology));new hh(o,this.simUI.player,{id:"simui-profession1",label:"Profession 1",values:n.map((e=>({name:ts.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,a)=>t.setProfession1(e,a)}),new hh(o,this.simUI.player,{id:"simui-profession2",label:"Profession 2",values:n.map((e=>({name:ts.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,a)=>t.setProfession2(e,a)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new _n(e,"consumes-settings",{header:{title:"Consumables"}});new Tg(t.bodyElement,this,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses?.includes("within-raid-sim-hide")||!0)),t=this.simUI.individualConfig.itemSwapSlots||[];if(e.length>0||t.length>0){const a=new _n(this.column2,"other-settings",{header:{title:"Other"}});e.length>0&&(this.configureInputSection(a.bodyElement,this.simUI.individualConfig.otherInputs),a.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t.length>0&&new Jf(a.bodyElement,this.simUI,this.simUI.player,{itemSlots:t})}}buildBuffsSettings(){const e=new _n(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:as}}),t=Hp(Wp,this.simUI);this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))));const a=Hp(Bp,this.simUI);a.length>0&&new lp(e.bodyElement,this.simUI.player,{inputs:a.map((e=>e.config)),label:"Misc"},this.simUI)}buildDebuffsSettings(){const e=new _n(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:is}}),t=Hp(zp,this.simUI);this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))));const a=Hp(jp,this.simUI);a.length&&new lp(e.bodyElement,this.simUI.player,{inputs:a.map((e=>e.config)),label:"Misc"},this.simUI)}buildPresetConfigurationPicker(){new Gm(this.rightPanel,this.simUI,["encounter","race"])}buildSavedDataPickers(){const e=new Rm(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>ss.create({encounter:e.toProto()}),setData:(e,t,a)=>t.fromProto(e,a.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>ss.equals(e,t),toJson:e=>ss.toJson(e),fromJson:e=>ss.fromJson(e)}),t=new Rm(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:()=>this.getCurrentSavedSettings(),setData:(e,t,a)=>{n.freezeAllAndDo((()=>{t.sim.raid.setBuffs(e,a.raidBuffs||os.create()),t.sim.raid.setDebuffs(e,a.debuffs||ns.create());const i=t.player.getParty();i&&i.setBuffs(e,a.partyBuffs||ls.create()),t.player.setBuffs(e,a.playerBuffs||rs.create()),t.player.setConsumes(e,a.consumes||cs.create()),t.player.setRace(e,a.race),t.player.setProfessions(e,a.professions),t.player.itemSwapSettings.setItemSwapSettings(e,a.enableItemSwap,t.sim.db.lookupItemSwap(a.itemSwap||ds.create()),d.fromProto(a.itemSwap?.prepullBonusStats)),t.player.setReactionTime(e,a.reactionTimeMs),t.player.setChannelClipDelay(e,a.channelClipDelayMs),t.player.setInFrontOfTarget(e,a.inFrontOfTarget),t.player.setDistanceFromTarget(e,a.distanceFromTarget),t.player.setHealingModel(e,a.healingModel||Qe.create()),t.player.setDarkIntentUptime(e,a.darkIntentUptime)}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapSettings.changeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>ms.equals(e,t),toJson:e=>ms.toJson(e),fromJson:e=>ms.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData(),this.simUI.individualConfig.presets.itemSwaps?.forEach((e=>{this.simUI.player,t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:ms.create({...this.getCurrentSavedSettings(),enableItemSwap:!0,itemSwap:e.itemSwap})})}))}))}getCurrentSavedSettings(){return ms.create({raidBuffs:this.simUI.sim.raid.getBuffs(),partyBuffs:this.simUI.player.getParty()?.getBuffs()||ls.create(),playerBuffs:this.simUI.player.getBuffs(),debuffs:this.simUI.sim.raid.getDebuffs(),consumes:this.simUI.player.getConsumes(),race:this.simUI.player.getRace(),professions:this.simUI.player.getProfessions(),enableItemSwap:this.simUI.player.itemSwapSettings.getEnableItemSwap(),itemSwap:this.simUI.player.itemSwapSettings.toProto(),reactionTimeMs:this.simUI.player.getReactionTime(),channelClipDelayMs:this.simUI.player.getChannelClipDelay(),inFrontOfTarget:this.simUI.player.getInFrontOfTarget(),distanceFromTarget:this.simUI.player.getDistanceFromTarget(),healingModel:this.simUI.player.getHealingModel(),darkIntentUptime:this.simUI.player.getDarkIntentUptime()})}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new xn(e,this.simUI.player,t):"boolean"==t.type?new Me(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new hh(e,this.simUI.player,t)}))}configureIconSection(e,t,a){0==t.length?e.classList.add("hide"):a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}function Gg(){return ah({extraCssClasses:["pet-type-picker"],fieldName:"petType",numColumns:5,values:[{value:hs.PetNone,tooltip:"No Pet"},{actionId:h.fromPetName("Bat"),tooltip:"Bat",value:hs.Bat},{actionId:h.fromPetName("Bear"),tooltip:"Bear",value:hs.Bear},{actionId:h.fromPetName("Bird of Prey"),tooltip:"Bird of Prey",value:hs.BirdOfPrey},{actionId:h.fromPetName("Boar"),tooltip:"Boar",value:hs.Boar},{actionId:h.fromPetName("Carrion Bird"),tooltip:"Carrion Bird",value:hs.CarrionBird},{actionId:h.fromPetName("Cat"),tooltip:"Cat",value:hs.Cat},{actionId:h.fromPetName("Chimaera"),tooltip:"Chimaera (Exotic)",value:hs.Chimaera},{actionId:h.fromPetName("Core Hound"),tooltip:"Core Hound (Exotic)",value:hs.CoreHound},{actionId:h.fromPetName("Crab"),tooltip:"Crab",value:hs.Crab},{actionId:h.fromPetName("Crocolisk"),tooltip:"Crocolisk",value:hs.Crocolisk},{actionId:h.fromPetName("Devilsaur"),tooltip:"Devilsaur (Exotic)",value:hs.Devilsaur},{actionId:h.fromPetName("Dragonhawk"),tooltip:"Dragonhawk",value:hs.Dragonhawk},{actionId:h.fromPetName("Gorilla"),tooltip:"Gorilla",value:hs.Gorilla},{actionId:h.fromPetName("Hyena"),tooltip:"Hyena",value:hs.Hyena},{actionId:h.fromPetName("Moth"),tooltip:"Moth",value:hs.Moth},{actionId:h.fromPetName("Nether Ray"),tooltip:"Nether Ray",value:hs.NetherRay},{actionId:h.fromPetName("Raptor"),tooltip:"Raptor",value:hs.Raptor},{actionId:h.fromPetName("Ravager"),tooltip:"Ravager",value:hs.Ravager},{actionId:h.fromPetName("Rhino"),tooltip:"Rhino",value:hs.Rhino},{actionId:h.fromPetName("Scorpid"),tooltip:"Scorpid",value:hs.Scorpid},{actionId:h.fromPetName("Serpent"),tooltip:"Serpent",value:hs.Serpent},{actionId:h.fromPetName("Silithid"),tooltip:"Silithid (Exotic)",value:hs.Silithid},{actionId:h.fromPetName("Spider"),tooltip:"Spider",value:hs.Spider},{actionId:h.fromPetName("Spirit Beast"),tooltip:"Spirit Beast (Exotic)",value:hs.SpiritBeast},{actionId:h.fromPetName("Spore Bat"),tooltip:"Spore Bat",value:hs.SporeBat},{actionId:h.fromPetName("Tallstrider"),tooltip:"Tallstrider",value:hs.Tallstrider},{actionId:h.fromPetName("Turtle"),tooltip:"Turtle",value:hs.Turtle},{actionId:h.fromPetName("Warp Stalker"),tooltip:"Warp Stalker",value:hs.WarpStalker},{actionId:h.fromPetName("Wasp"),tooltip:"Wasp",value:hs.Wasp},{actionId:h.fromPetName("Wind Serpent"),tooltip:"Wind Serpent",value:hs.WindSerpent},{actionId:h.fromPetName("Wolf"),tooltip:"Wolf",value:hs.Wolf},{actionId:h.fromPetName("Worm"),tooltip:"Worm (Exotic)",value:hs.Worm},{actionId:h.fromPetName("Fox"),tooltip:"Fox",value:hs.Fox},{actionId:h.fromPetName("Shale Spider"),tooltip:"Shale Spider (Exotic)",value:hs.ShaleSpider}]})}const Og={[hs.PetNone]:1,[hs.Bat]:0,[hs.Bear]:2,[hs.BirdOfPrey]:0,[hs.Boar]:2,[hs.CarrionBird]:1,[hs.Cat]:1,[hs.Chimaera]:0,[hs.CoreHound]:1,[hs.Crab]:2,[hs.Crocolisk]:2,[hs.Devilsaur]:1,[hs.Dragonhawk]:0,[hs.Gorilla]:2,[hs.Hyena]:1,[hs.Moth]:1,[hs.NetherRay]:0,[hs.Raptor]:1,[hs.Ravager]:0,[hs.Rhino]:2,[hs.Scorpid]:2,[hs.Serpent]:0,[hs.Silithid]:0,[hs.Spider]:0,[hs.SpiritBeast]:1,[hs.SporeBat]:0,[hs.Tallstrider]:1,[hs.Turtle]:2,[hs.WarpStalker]:2,[hs.Wasp]:1,[hs.WindSerpent]:0,[hs.Wolf]:1,[hs.Worm]:2,[hs.ShaleSpider]:2,[hs.Fox]:1},Ug=[0,1,2],Ag=["cunning","ferocity","tenacity"];const Lg=ps.create({serpentSwiftness:2,dive:!0,owlsFocus:2,spikedCollar:3,cullingTheHerd:3,feedingFrenzy:2,roarOfRecovery:!0,wolverineBite:!0,wildHunt:2}),Fg=ps.create({serpentSwiftness:2,dash:!0,spikedCollar:3,boarsSpeed:!0,cullingTheHerd:3,spidersBite:3,rabid:!0,callOfTheWild:!0,wildHunt:2}),Mg=[Lg,Fg,ps.create({serpentSwiftness:2,charge:!0,spikedCollar:3,boarsSpeed:!0,cullingTheHerd:3,thunderstomp:!0,graceOfTheMantis:2,roarOfSacrifice:!0,intervene:!0,wildHunt:2})],Vg=[ps.create({serpentSwiftness:2,spikedCollar:3,boarsSpeed:!0,cullingTheHerd:3,wildHunt:2,dive:!0,owlsFocus:2,cornered:2,feedingFrenzy:2,wolverineBite:!0,roarOfRecovery:!0,bullheaded:!0}),ps.create({serpentSwiftness:2,dash:!0,bloodthirsty:2,spikedCollar:3,cullingTheHerd:3,charge:!0,spidersBite:3,rabid:!0,callOfTheWild:!0,sharkAttack:2,wildHunt:2}),ps.create({serpentSwiftness:2,spikedCollar:3,boarsSpeed:!0,cullingTheHerd:3,charge:!0,greatResistance:3,wildHunt:2,thunderstomp:!0,graceOfTheMantis:2,lastStand:!0,roarOfSacrifice:!0,intervene:!0})],Wg=[bl([{name:"Cunning",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/411.jpg",talents:[{fieldName:"serpentSwiftness",fancyName:"Serpent Swiftness",location:{rowIdx:0,colIdx:0},spellIds:[61682,61683],maxPoints:2},{fieldName:"dive",fancyName:"Dive",location:{rowIdx:0,colIdx:1},spellIds:[23145],maxPoints:1},{fieldName:"greatStamina",fancyName:"Great Stamina",location:{rowIdx:0,colIdx:2},spellIds:[61686,61687,61688],maxPoints:3},{fieldName:"naturalArmor",fancyName:"Natural Armor",location:{rowIdx:0,colIdx:3},spellIds:[61689,61690],maxPoints:2},{fieldName:"boarsSpeed",fancyName:"Boars Speed",location:{rowIdx:1,colIdx:0},spellIds:[19596],maxPoints:1},{fieldName:"mobility",fancyName:"Mobility",location:{rowIdx:1,colIdx:1},spellIds:[53554,53483,53485,53555],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"owlsFocus",fancyName:"Owls Focus",location:{rowIdx:1,colIdx:2},spellIds:[53514,53516],maxPoints:2},{fieldName:"spikedCollar",fancyName:"Spiked Collar",location:{rowIdx:1,colIdx:3},spellIds:[53182,53183,53184],maxPoints:3},{fieldName:"cullingTheHerd",fancyName:"Culling The Herd",location:{rowIdx:2,colIdx:0},spellIds:[61680,52858,61681],maxPoints:3},{fieldName:"lionhearted",fancyName:"Lionhearted",location:{rowIdx:2,colIdx:1},spellIds:[53409,53411],maxPoints:2},{fieldName:"carrionFeeder",fancyName:"Carrion Feeder",location:{rowIdx:2,colIdx:2},spellIds:[54044],maxPoints:1},{fieldName:"greatResistance",fancyName:"Great Resistance",location:{rowIdx:3,colIdx:1},spellIds:[53427,53429,53430],maxPoints:3},{fieldName:"cornered",fancyName:"Cornered",location:{rowIdx:3,colIdx:2},spellIds:[52234,53497],maxPoints:2},{fieldName:"feedingFrenzy",fancyName:"Feeding Frenzy",location:{rowIdx:3,colIdx:3},spellIds:[53511,53512],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:3}},{fieldName:"wolverineBite",fancyName:"Wolverine Bite",location:{rowIdx:4,colIdx:0},spellIds:[53508],maxPoints:1},{fieldName:"roarOfRecovery",fancyName:"Roar Of Recovery",location:{rowIdx:4,colIdx:1},spellIds:[53517],maxPoints:1},{fieldName:"bullheaded",fancyName:"Bullheaded",location:{rowIdx:4,colIdx:2},spellIds:[53490],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"graceOfTheMantis",fancyName:"Grace Of The Mantis",location:{rowIdx:4,colIdx:3},spellIds:[53450,53451],maxPoints:2},{fieldName:"wildHunt",fancyName:"Wild Hunt",location:{rowIdx:5,colIdx:0},spellIds:[62758,62762],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:0}},{fieldName:"roarOfSacrifice",fancyName:"Roar Of Sacrifice",location:{rowIdx:5,colIdx:3},spellIds:[53480],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:3}}]}]),bl([{name:"Ferocity",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/410.jpg",talents:[{fieldName:"serpentSwiftness",fancyName:"Serpent Swiftness",location:{rowIdx:0,colIdx:0},spellIds:[61682,61683],maxPoints:2},{fieldName:"dash",fancyName:"Dash",location:{rowIdx:0,colIdx:1},spellIds:[61684],maxPoints:1},{fieldName:"greatStamina",fancyName:"Great Stamina",location:{rowIdx:0,colIdx:2},spellIds:[61686,61687,61688],maxPoints:3},{fieldName:"naturalArmor",fancyName:"Natural Armor",location:{rowIdx:0,colIdx:3},spellIds:[61689,61690],maxPoints:2},{fieldName:"improvedCower",fancyName:"Improved Cower",location:{rowIdx:1,colIdx:0},spellIds:[53180,53181],maxPoints:2},{fieldName:"bloodthirsty",fancyName:"Bloodthirsty",location:{rowIdx:1,colIdx:1},spellIds:[53186,53187],maxPoints:2},{fieldName:"spikedCollar",fancyName:"Spiked Collar",location:{rowIdx:1,colIdx:2},spellIds:[53182,53183,53184],maxPoints:3},{fieldName:"boarsSpeed",fancyName:"Boars Speed",location:{rowIdx:1,colIdx:3},spellIds:[19596],maxPoints:1},{fieldName:"cullingTheHerd",fancyName:"Culling The Herd",location:{rowIdx:2,colIdx:0},spellIds:[61680,52858,61681],maxPoints:3},{fieldName:"lionhearted",fancyName:"Lionhearted",location:{rowIdx:2,colIdx:2},spellIds:[53409,53411],maxPoints:2},{fieldName:"charge",fancyName:"Charge",location:{rowIdx:2,colIdx:3},spellIds:[61685],maxPoints:1},{fieldName:"heartOfThePhoenix",fancyName:"Heart Of The Phoenix",location:{rowIdx:3,colIdx:1},spellIds:[55709],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"spidersBite",fancyName:"Spiders Bite",location:{rowIdx:3,colIdx:2},spellIds:[53203,53204,53205],maxPoints:3},{fieldName:"greatResistance",fancyName:"Great Resistance",location:{rowIdx:3,colIdx:3},spellIds:[53427,53429,53430],maxPoints:3},{fieldName:"rabid",fancyName:"Rabid",location:{rowIdx:4,colIdx:0},spellIds:[53401],maxPoints:1},{fieldName:"lickYourWounds",fancyName:"Lick Your Wounds",location:{rowIdx:4,colIdx:1},spellIds:[53426],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"callOfTheWild",fancyName:"Call Of The Wild",location:{rowIdx:4,colIdx:2},spellIds:[53434],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"sharkAttack",fancyName:"Shark Attack",location:{rowIdx:5,colIdx:0},spellIds:[62759,62760],maxPoints:2},{fieldName:"wildHunt",fancyName:"Wild Hunt",location:{rowIdx:5,colIdx:2},spellIds:[62758,62762],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:2}}]}]),bl([{name:"Tenacity",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/409.jpg",talents:[{fieldName:"serpentSwiftness",fancyName:"Serpent Swiftness",location:{rowIdx:0,colIdx:0},spellIds:[61682,61683],maxPoints:2},{fieldName:"charge",fancyName:"Charge",location:{rowIdx:0,colIdx:1},spellIds:[61685],maxPoints:1},{fieldName:"greatStamina",fancyName:"Great Stamina",location:{rowIdx:0,colIdx:2},spellIds:[61686,61687,61688],maxPoints:3},{fieldName:"naturalArmor",fancyName:"Natural Armor",location:{rowIdx:0,colIdx:3},spellIds:[61689,61690],maxPoints:2},{fieldName:"spikedCollar",fancyName:"Spiked Collar",location:{rowIdx:1,colIdx:0},spellIds:[53182,53183,53184],maxPoints:3},{fieldName:"boarsSpeed",fancyName:"Boars Speed",location:{rowIdx:1,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"bloodOfTheRhino",fancyName:"Blood Of The Rhino",location:{rowIdx:1,colIdx:2},spellIds:[53481,53482],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"petBarding",fancyName:"Pet Barding",location:{rowIdx:1,colIdx:3},spellIds:[53175,53176],maxPoints:2,prereqLocation:{rowIdx:0,colIdx:3}},{fieldName:"cullingTheHerd",fancyName:"Culling The Herd",location:{rowIdx:2,colIdx:0},spellIds:[61680,52858,61681],maxPoints:3},{fieldName:"guardDog",fancyName:"Guard Dog",location:{rowIdx:2,colIdx:1},spellIds:[53178,53179],maxPoints:2},{fieldName:"lionhearted",fancyName:"Lionhearted",location:{rowIdx:2,colIdx:2},spellIds:[53409,53411],maxPoints:2},{fieldName:"thunderstomp",fancyName:"Thunderstomp",location:{rowIdx:2,colIdx:3},spellIds:[63900],maxPoints:1},{fieldName:"graceOfTheMantis",fancyName:"Grace Of The Mantis",location:{rowIdx:3,colIdx:2},spellIds:[53450,53451],maxPoints:2},{fieldName:"greatResistance",fancyName:"Great Resistance",location:{rowIdx:3,colIdx:3},spellIds:[53427,53429,53430],maxPoints:3},{fieldName:"lastStand",fancyName:"Last Stand",location:{rowIdx:4,colIdx:0},spellIds:[53478],maxPoints:1},{fieldName:"taunt",fancyName:"Taunt",location:{rowIdx:4,colIdx:1},spellIds:[53477],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"roarOfSacrifice",fancyName:"Roar Of Sacrifice",location:{rowIdx:4,colIdx:2},spellIds:[53480],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"intervene",fancyName:"Intervene",location:{rowIdx:4,colIdx:3},spellIds:[53476],maxPoints:1},{fieldName:"silverback",fancyName:"Silverback",location:{rowIdx:5,colIdx:1},spellIds:[62764,62765],maxPoints:2},{fieldName:"wildHunt",fancyName:"Wild Hunt",location:{rowIdx:5,colIdx:2},spellIds:[62758,62762],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:2}}]}])];class Bg{constructor(e){this.player=e,this.talents=e.getClassOptions().petTalents??ps.create(),this.talentsConfig=function(e){const t=Og[e],a=Ug.indexOf(t);return Wg[a]}(e.getClassOptions().petType),this.talentsString=ql(this.talents,this.talentsConfig),this.talentsChangeEmitter=this.player.specOptionsChangeEmitter}getTalents(){return this.talents}getTalentsString(){return ql(this.talents,this.talentsConfig)}setTalentsString(e,t){if(t==this.talentsString)return;const a=this.player.getClassOptions();a.petTalents=Hl(ps.create(),t,this.talentsConfig),this.talents=a.petTalents,this.talentsString=t,this.player.setClassOptions(e,a)}getTalentTree(){return us(this.getTalentsString())}getTalentTreePoints(){return gs(this.getTalentsString())}}class zg extends e{constructor(e,t,a){super(e,"hunter-pet-talents-picker"),this.simUI=t,this.player=a,this.curCategory=this.getCategoryFromPlayer(),this.curTalents=this.getPetTalentsFromPlayer(),this.defaultSets=Mg.slice(),this.savedSets=[],this.talentsContainer=document.createElement("div"),this.talentsContainer.className="pet-talents-container",this.rootElem.appendChild(this.talentsContainer),this.rootElem.classList.add(Ag[this.curCategory]),this.initializeTalentsPicker(),t.sim.waitForInit().then((()=>this.initializeTalentsPicker())),new sh(this.rootElem,this.player,Gg()),a.specOptionsChangeEmitter.on((()=>{const e=this.getCategoryFromPlayer();if(e!==this.curCategory){const t=this.player.getClassOptions();t.petTalents=this.savedSets[e]||this.defaultSets[e],this.player.setClassOptions(n.nextEventID(),t),this.curTalents=t.petTalents,this.switchCategory(e)}}))}initializeTalentsPicker(){if(this.talentsContainer.innerHTML="",null!==this.curCategory){const e=new Bg(this.player),t=Wg[this.curCategory];new fl(this.talentsContainer,e,{playerClass:this.player.getClass(),trees:t,changedEvent:e=>e.player.specOptionsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,a)=>{t.setTalentsString(e,a),this.savedSets[this.curCategory]=t.getTalents(),this.curTalents=t.getTalents()},pointsPerRow:3})}}switchCategory(e){this.curCategory=e,this.rootElem.classList.remove(...Ag),this.rootElem.classList.add(Ag[Ug.indexOf(e)]),this.talentsContainer.innerHTML="",this.initializeTalentsPicker()}getDefaultTalentsFromSpec(){return this.player.isSpec(w.SpecBeastMasteryHunter)?Vg:Mg}getPetTalentsFromPlayer(){return this.player.getClassOptions().petTalents||ps.create()}getCategoryFromPlayer(){const e=this.player.getClassOptions().petType;return Og[e]}}class jg extends Cn{constructor(e,t){super(e,t,{identifier:"talents-tab",title:"Talents"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.player.getClass()==O.ClassHunter?this.buildHunterPickers():this.buildTalentsPicker(this.leftPanel),this.buildPresetConfigurationPicker(),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new fl(e,this.simUI.player,{playerClass:this.simUI.player.getClass(),trees:zl[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,a)=>{t.setTalentsString(e,a)},pointsPerRow:5})}buildHunterPickers(){this.leftPanel.innerHTML='\n      <div class="hunter-talents-pickers-container tab-content">\n        <ul class="nav nav-tabs" role="tablist">\n          <li class="nav-item" role="presentation">\n            <button\n              class="nav-link active"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#player-talents-tab"\n              aria-controls="#player-talents-tab"\n              aria-selected="true"\n            >\n              Player\n            </button>\n          </li>\n          <li class="nav-item" role="presentation">\n            <button\n              class="nav-link"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#pet-talents-tab"\n              aria-controls="#pet-talents-tab"\n              aria-selected="false"\n            >\n              Pet</button\n            >\n          </li>\n        </ul>\n        <div id="player-talents-tab" class="tab-pane fade active show" role="tabpanel">\n        </div>\n        <div id="pet-talents-tab" class="tab-pane fade" role="tabpanel">\n        </div>\n      </div>\n    ';const e=this.leftPanel.querySelector("#player-talents-tab"),t=this.leftPanel.querySelector("#pet-talents-tab");this.buildTalentsPicker(e),this.buildHunterPetPicker(t)}buildHunterPetPicker(e){this.simUI.player.isClass(O.ClassHunter)&&new zg(e,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new Gm(this.rightPanel,this.simUI,["talents"])}buildSavedTalentsPicker(){const e=new Rm(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>We.create({talentsString:e.getTalentsString(),glyphs:e.getGlyphs()}),setData:(e,t,a)=>{n.freezeAllAndDo((()=>{t.setTalentsString(e,a.talentsString),t.setGlyphs(e,a.glyphs||Se.create())}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.glyphsChangeEmitter],equals:(e,t)=>We.equals(e,t),toJson:e=>We.toJson(e),fromJson:e=>We.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,onLoad:t.onLoad})}))}))}}const Hg=(e,t,a)=>{const i=new Rm(e,t.player,{label:"EP Weights",header:{title:"Saved EP weights"},storageKey:t.getSavedEPWeightsStorageKey(),getData:e=>fs.create({epWeights:e.getEpWeights().toProto()}),setData:(e,t,a)=>{n.freezeAllAndDo((()=>{t.setEpWeights(e,d.fromProto(a.epWeights))}))},changeEmitters:[t.player.epWeightsChangeEmitter],equals:(e,t)=>fs.equals(e,t),toJson:e=>fs.toJson(e),fromJson:e=>fs.fromJson(e),...a});return t.sim.waitForInit().then((()=>{i.loadUserData(),t.individualConfig.presets.epWeights.forEach((({name:e,epWeights:t,enableWhen:a,onLoad:s})=>{i.addSavedData({name:e,isPreset:!0,data:fs.create({epWeights:t.toProto()}),enableWhen:a,onLoad:s})}))})),i},qg=e=>{const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()?{size:"xl",...t}:t},Kg=class e extends yn{constructor(e){super(e.rootElem,"ep-weights-menu",{...qg(e),disposeOnClose:!1}),this.showAllStats=!1,this.header?.insertAdjacentElement("afterbegin",t("h5",{className:"modal-title"},"Calculate Stat Weights")),this.simUI=e,this.statsType="ep",this.epStats=this.simUI.individualConfig.epStats,this.epPseudoStats=this.simUI.individualConfig.epPseudoStats||[],this.epReferenceStat=this.simUI.individualConfig.epReferenceStat;const i=this.buildStatsTable(),s=a(),o=a(),l=a(),c=a(),m=a(),h=a(),p=a(),g=a(),w=a(),y=a(),I=a(),b=e=>void 0!==e?f(e):"??",x=e=>Object.values(this.epStats).find((t=>b(t)===e)),S=t(r,null,this.epStats.map((e=>t("option",null,b(e)))));this.body.appendChild(t("div",{className:"d-flex flex-column flex-lg-row align-items-lg-start gap-3"},t("div",{className:"ep-weights-content order-1 order-lg-0"},t("div",{className:"ep-weights-options row"},t("div",{className:"col col-sm-3"},t("select",{ref:g,className:"ep-type-select form-select"},t("option",{value:"ep"},"EP"),t("option",{value:"weight"},"Weights"))),t("div",{ref:I,className:"show-all-stats-container col col-sm-3"})),t("div",{className:"ep-reference-options row"},t("div",{className:"col col-sm-4 damage-metrics"},t("span",null,"DPS/TPS reference:"),t("select",{ref:m,className:"ref-stat-select form-select damage-metrics"},S.cloneNode(!0))),t("div",{className:"col col-sm-4 healing-metrics"},t("span",null,"Healing reference:"),t("select",{ref:h,className:"ref-stat-select form-select healing-metrics"},S.cloneNode(!0))),t("div",{className:"col col-sm-4 threat-metrics"},t("span",null,"Mitigation reference:"),t("select",{ref:p,className:"ref-stat-select form-select threat-metrics"},S.cloneNode(!0))),t("p",null,"The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.")),t("p",null,"The 'Current EP' column displays the values currently used by the item pickers to sort items.",t("br",null),"Use the ",t("button",{className:"fa fa-copy"})," icon above the EPs to use newly calculated EPs."),t("div",{ref:s,className:"results-ep-table-container modal-scroll-table"},t("table",{ref:l,className:"results-ep-table"},t("thead",null,t("tr",null,t("th",null,"Stat"),i.map((({metric:e,type:a,label:i,metricRef:s})=>{const o="action"===a;return t("th",{className:u(e&&`${e}-metrics`,o?"text-center":`type-${a}`)},t("span",null,i),t("button",{ref:s,className:"col-action"},t("i",{className:u("fas",o?"fa-arrows-rotate":"fa-copy")})))}))),t("tr",{className:"ep-ratios"},t("td",null,"EP Ratio"),i.filter((({type:e})=>"action"!==e)).map((({metric:e,type:a,ratioRef:i})=>t("td",{ref:i,className:u("type-ratio",`${e}-metrics`,`type-${a}`)}))),t("td",{className:"text-center align-middle"},t("button",{ref:w,className:"btn btn-primary compute-ep"},t("i",{className:"fas fa-calculator"}),t("span",{className:"not-tiny"},"Update "),"EP")))),t("tbody",{ref:c})))),t("div",{ref:o,className:"ep-weights-sidebar sticky-lg-top order-0 order-lg-1"}))),this.footer.appendChild(t(r,null,t("button",{ref:y,className:"btn btn-primary calc-weights"},t("i",{className:"fas fa-calculator me-1"}),"Calculate"))),this.container=s.value,this.sidebar=o.value,this.table=l.value,this.tableBody=c.value;const v=t("div",{className:"results-pending-overlay"});this.resultsViewer=new Pn(v);const k=()=>{"ep"===this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},E=g.value;E.addEventListener("input",(()=>{this.statsType=E.value,k()})),E.value=this.statsType,k();const P=()=>{this.simUI.player.epRefStatChangeEmitter.emit(n.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()},C=m.value;C&&(C.addEventListener("input",(()=>{this.simUI.dpsRefStat=x(C.value),P()})),C.value=b(this.getDpsEpRefStat()));const N=h.value;N&&(N.addEventListener("input",(()=>{this.simUI.healRefStat=x(N.value),P()})),N.value=b(this.getHealEpRefStat()));const _=p.value;_&&(_.addEventListener("input",(()=>{this.simUI.tankRefStat=x(_.value),P()})),_.value=b(this.getTankEpRefStat()));const T=y.value;let R=!1;T?.addEventListener("click",(async()=>{if(R)return;R=!0;try{await this.simUI.sim.signalManager.abortType(Fe.All)}catch(s){return void console.error(s)}T.disabled=!0,this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",v),this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const t=this.simUI.sim.getIterations();let a=!1;this.resultsViewer.addAbortButton((async()=>{if(!a)try{a=!0,await e.sim.signalManager.abortType(Fe.StatWeights)}catch(s){console.error("Error on stat weight abort!"),console.error(s)}finally{a=!1,R||(T.disabled=!1)}}));const i=await this.simUI.player.computeStatWeights(n.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.simUI.rootElem.classList.remove("blurred"),v.remove(),this.container.classList.remove("pending"),this.resultsViewer.hideAll(),R=!1,a||(T.disabled=!1),i&&(this.simUI.prevEpIterations=t,this.simUI.prevEpSimResult=this.calculateEp(i),this.updateTable())})),this.addOnHideCallback((()=>{this.simUI.sim.signalManager.abortType(Fe.StatWeights).catch(console.error)}));const D=(e,t,a,i,s)=>{const o=e.previousElementSibling;mn(o,{content:()=>{if(!s)return t;const e=b(s());return`${t} Normalized by ${e}.`}}),mn(e,{content:a}),e.addEventListener("click",(()=>{this.simUI.player.setEpWeights(n.nextEventID(),d.fromProto(i())),this.updateTable()}))};i.forEach((({metricRef:e,labelTooltip:t,actionTooltip:a,getWeights:i,getEpRefStat:s})=>D(e.value,t,a,i,s))),new Me(I.value,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new n,getValue:()=>this.showAllStats,setValue:(e,t,a)=>{this.showAllStats=a,this.updateTable()}}),this.updateTable();const G=(e,t)=>{new xn(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:()=>this.simUI.player.getEpRatios()[t],setValue:(e,a,i)=>{const s=a.getEpRatios();s[t]=i,a.setEpRatios(e,s)}})};i.filter((({type:e,ratioRef:t})=>"ep"===e&&!!t?.value)).map((({ratioRef:e})=>e.value)).forEach(G),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));i.filter((({type:e,ratioRef:t})=>"weight"===e&&!!t?.value)).map((({ratioRef:e})=>e.value)).forEach(G);const O=w.value;mn(O,{content:"Compute Weighted EP"}),O.addEventListener("click",(()=>{const e=this.getPrevSimResult(),t=this.simUI.player.getEpRatios();if("ep"===this.statsType){const a=d.fromProto(e.dps.epValues).scale(t[0]),i=d.fromProto(e.hps.epValues).scale(t[1]),s=d.fromProto(e.tps.epValues).scale(t[2]),o=d.fromProto(e.dtps.epValues).scale(t[3]),l=d.fromProto(e.tmi.epValues).scale(t[4]),r=d.fromProto(e.pDeath.epValues).scale(t[5]),c=a.add(i).add(s).add(o).add(l).add(r);this.simUI.player.setEpWeights(n.nextEventID(),c)}else{const a=d.fromProto(e.dps.weights).scale(t[0]),i=d.fromProto(e.hps.weights).scale(t[1]),s=d.fromProto(e.tps.weights).scale(t[2]),o=d.fromProto(e.dtps.weights).scale(t[3]),l=d.fromProto(e.tmi.weights).scale(t[4]),r=d.fromProto(e.pDeath.weights).scale(t[5]),c=a.add(i).add(s).add(o).add(l).add(r);this.simUI.player.setEpWeights(n.nextEventID(),c)}this.updateTable()})),this.buildSavedEPWeightsPicker()}setSimProgress(e){this.resultsViewer.setContent(t("div",{className:"results-sim"},t("div",null,e.completedSims," / ",e.totalSims,t("br",null),"simulations complete"),t("div",null,e.completedIterations," / ",e.totalIterations,t("br",null),"iterations complete")))}updateTable(){const a=t(r,null);e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);a.appendChild(t)})),this.tableBody.replaceChildren(a)}makeTableRow(e){const i=this.simUI.prevEpSimResult,s=this.simUI.player.getEpRatios(),o=((e,t,a)=>a?(a.dps?.epValues?t[0]*e.getProtoValue(a.dps.epValues):0)+(a.hps?.epValues?t[1]*e.getProtoValue(a.hps.epValues):0)+(a.tps?.epValues?t[2]*e.getProtoValue(a.tps.epValues):0)+(a.dtps?.epValues?t[3]*e.getProtoValue(a.dtps.epValues):0)+(a.tmi?.epValues?t[4]*e.getProtoValue(a.tmi.epValues):0)+(a.pDeath?.epValues?t[5]*e.getProtoValue(a.pDeath.epValues):0):0)(e,s,i),n=a(),l=t("tr",null,t("td",null,e.getFullName(this.simUI.player.getClass())),this.makeTableRowCells(e,i?.dps,"damage-metrics",o,s[0]),this.makeTableRowCells(e,i?.hps,"healing-metrics",o,s[1]),this.makeTableRowCells(e,i?.tps,"threat-metrics",o,s[2]),this.makeTableRowCells(e,i?.dtps,"threat-metrics",o,s[3]),this.makeTableRowCells(e,i?.tmi,"threat-metrics",o,s[4]),this.makeTableRowCells(e,i?.pDeath,"threat-metrics",o,s[5]),t("td",{ref:n,className:"current-ep"})),r=n.value;return new xn(r,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:()=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,a,i)=>{const s=a.getEpWeights().withUnitStat(e,i);a.setEpWeights(t,s)}}),l}makeTableRowCells(e,i,s,o,n){let l=null,c=null;const d=0===n,m=a(),h=a();if(i){const t=e.getProtoValue(i.weights),a=e.getProtoValue(i.weightsStdev);l=this.makeTableCellContents(t,a);const s=e.getProtoValue(i.epValues),o=e.getProtoValue(i.epValuesStdev);c=this.makeTableCellContents(s,o)}else l=t("span",{className:"results-avg notapplicable"},"N/A"),c=l.cloneNode(!0);const p=t(r,null,t("td",{ref:m,className:u("stdev-cell","type-weight",i&&d&&"unused-ep",s)},l),t("td",{ref:h,className:u("stdev-cell","type-ep",i&&d&&"unused-ep",s)},c));if(!i||d)return p;const g=o-this.simUI.player.getEpWeights().getUnitStat(e),f=h.value.querySelector(".type-ep .results-avg");return"0.00"===g.toFixed(2)||(g>0?f.classList.add("positive"):g<0&&f.classList.add("negative")),p}makeTableCellContents(e,a){const i=this.simUI.prevEpIterations||1;return t(r,null,t("span",{className:"results-avg"},e.toFixed(2)),t("span",{className:"results-stdev"},"(",t("i",{className:"fas fa-plus-minus fa-xs"}),ws(a,i).toFixed(2),")"))}calculateEp(t){const a=ys.clone(t);return void 0!==this.simUI.dpsRefStat&&(e.normaliseEpValue(this.simUI.dpsRefStat,a.dps),e.normaliseEpValue(this.simUI.dpsRefStat,a.tps)),void 0!==this.simUI.healRefStat&&e.normaliseEpValue(this.simUI.healRefStat,a.hps),void 0!==this.simUI.tankRefStat&&(e.normaliseEpValue(this.simUI.tankRefStat,a.dtps),e.normaliseEpValue(this.simUI.tankRefStat,a.tmi),e.normaliseEpValue(this.simUI.tankRefStat,a.pDeath)),a}static normaliseEpValue(t,a){const i=ze.fromStat(t),s=i.getProtoValue(a.weights),o=i.getProtoValue(a.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(a.weights);e.setProtoValue(a.epValues,0===s?0:t/s);const i=e.getProtoValue(a.weightsStdev);e.setProtoValue(a.epValuesStdev,0===o?0:i/o)}))}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:l.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||ys.create({dps:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()},hps:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()},tps:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()},dtps:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()},tmi:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()},pDeath:{weights:(new d).toProto(),weightsStdev:(new d).toProto(),epValues:(new d).toProto(),epValuesStdev:(new d).toProto()}})}buildSavedEPWeightsPicker(){Hg(this.sidebar,this.simUI)}buildStatsTable(){const e="Copy to Current EP",t=()=>({metricRef:a(),ratioRef:a()});return[{metric:"damage",type:"weight",label:"DPS Weight",labelTooltip:"Per-point increase in DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.weights,...t()},{metric:"damage",type:"ep",label:"DPS EP",labelTooltip:"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...t()},{metric:"healing",type:"weight",label:"HPS Weight",labelTooltip:"Per-point increase in HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.weights,...t()},{metric:"healing",type:"ep",label:"HPS EP",labelTooltip:"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.epValues,getEpRefStat:()=>this.getHealEpRefStat(),...t()},{metric:"threat",type:"weight",label:"TPS Weight",labelTooltip:"Per-point increase in TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.weights,...t()},{metric:"threat",type:"ep",label:"TPS EP",labelTooltip:"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...t()},{metric:"threat",type:"weight",label:"DTPS Weight",labelTooltip:"Per-point increase in DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.weights,...t()},{metric:"threat",type:"ep",label:"DTPS EP",labelTooltip:"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{metric:"threat",type:"weight",label:"TMI Weight",labelTooltip:"Per-point decrease in TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.weights,...t()},{metric:"threat",type:"ep",label:"TMI EP",labelTooltip:"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{metric:"threat",type:"weight",label:"Death Weight",labelTooltip:"Per-point decrease in p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.weights,...t()},{metric:"threat",type:"ep",label:"Death EP",labelTooltip:"EP (Equivalency Points) for p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{type:"action",label:"Current EP",labelTooltip:"Current EP Weights. Used to sort the gear selector menus.",actionTooltip:"Restore Default EP",getWeights:()=>this.simUI.individualConfig.defaults.epWeights.toProto(),...t()}]}};Kg.epUnitStats=ze.getAll().filter((e=>!!e.isStat()||[g.PseudoStatMainHandDps,g.PseudoStatOffHandDps,g.PseudoStatRangedDps,g.PseudoStatPhysicalHitPercent,g.PseudoStatSpellHitPercent,g.PseudoStatPhysicalCritPercent,g.PseudoStatSpellCritPercent].includes(e.getPseudoStat())));let $g=Kg;var Yg=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))(Yg||{});const Jg={phase:Is.Phase2,status:0},Zg={[w.SpecUnknown]:{phase:Is.Phase3,status:0},[w.SpecBloodDeathKnight]:{phase:Is.Phase3,status:2},[w.SpecFrostDeathKnight]:{phase:Is.Phase4,status:2},[w.SpecUnholyDeathKnight]:{phase:Is.Phase4,status:2},[w.SpecBalanceDruid]:{phase:Is.Phase4,status:2},[w.SpecFeralDruid]:{phase:Is.Phase3,status:3},[w.SpecGuardianDruid]:{phase:Is.Phase4,status:3},[w.SpecRestorationDruid]:{phase:Is.Phase2,status:0},[w.SpecBeastMasteryHunter]:{phase:Is.Phase3,status:3},[w.SpecMarksmanshipHunter]:{phase:Is.Phase3,status:3},[w.SpecSurvivalHunter]:{phase:Is.Phase4,status:2},[w.SpecArcaneMage]:{phase:Is.Phase4,status:2},[w.SpecFireMage]:{phase:Is.Phase4,status:2},[w.SpecFrostMage]:{phase:Is.Phase2,status:0},[w.SpecBrewmasterMonk]:{phase:Is.Phase4,status:0},[w.SpecMistweaverMonk]:{phase:Is.Phase4,status:0},[w.SpecWindwalkerMonk]:{phase:Is.Phase4,status:1},[w.SpecHolyPaladin]:{phase:Is.Phase2,status:0},[w.SpecProtectionPaladin]:{phase:Is.Phase3,status:3},[w.SpecRetributionPaladin]:{phase:Is.Phase4,status:3},[w.SpecDisciplinePriest]:{phase:Is.Phase2,status:0},[w.SpecHolyPriest]:{phase:Is.Phase2,status:0},[w.SpecShadowPriest]:{phase:Is.Phase4,status:2},[w.SpecAssassinationRogue]:{phase:Is.Phase4,status:3},[w.SpecCombatRogue]:{phase:Is.Phase4,status:3},[w.SpecSubtletyRogue]:{phase:Is.Phase4,status:3},[w.SpecElementalShaman]:{phase:Is.Phase4,status:2},[w.SpecEnhancementShaman]:{phase:Is.Phase4,status:2},[w.SpecRestorationShaman]:{phase:Is.Phase2,status:0},[w.SpecAfflictionWarlock]:{phase:Is.Phase4,status:2},[w.SpecDemonologyWarlock]:{phase:Is.Phase4,status:2},[w.SpecDestructionWarlock]:{phase:Is.Phase4,status:2},[w.SpecArmsWarrior]:{phase:Is.Phase4,status:2},[w.SpecFuryWarrior]:{phase:Is.Phase4,status:2},[w.SpecProtectionWarrior]:{phase:Is.Phase4,status:2}};class Qg extends e{constructor(e){super(null),this.toast=null,this.container=e,this.hasSeenNotice||bs()||xs()||(this.render(),this.toast?.element.addEventListener("hide.bs.toast",(()=>{this.setHasSeenNotice()}),{once:!0}))}get settingsKey(){return`${Ss}_notice-local-sim.v1`}get hasSeenNotice(){return window.localStorage.getItem(this.settingsKey)}setHasSeenNotice(){window.localStorage.setItem(this.settingsKey,"true")}render(){this.toast=new Nn({additionalClasses:["toast-notice-local-download"],container:this.container,variant:"info",title:"Did you know?",autohide:!1,body:t(r,null,t("p",null,"You can download our local sim to speed up your simulations significantly?"),t("a",{href:Ae,className:"btn btn-outline-light",target:"_blank",onclick:()=>this.setHasSeenNotice()},"Download"))})}}class Xg extends yn{constructor(e,i){super(e,"settings-menu",{title:"Options",footer:!0,disposeOnClose:!1}),this.simUI=i;const s=a(),o=a(),l=a(),r=a(),c=a(),d=a(),m=a(),h=a(),p=a(),u=a(),g=t("div",null,t("div",{className:"picker-group"},t("div",{className:"fixed-rng-seed-container"},t("div",{ref:o,className:"fixed-rng-seed"}),t("div",{className:"form-text"},t("span",null,"Last used RNG seed:")," ",t("span",{ref:l,className:"last-used-rng-seed"},"0"))),t("div",{ref:r,className:"language-picker within-raid-sim-hide"})),t("div",{ref:c,className:"show-threat-metrics-picker w-50 pe-2"}),t("div",{ref:d,className:"show-experimental-picker w-50 pe-2"}),t("div",{ref:m,className:"show-quick-swap-picker w-50 pe-2"}),t("div",{ref:h,className:"use-concurrency-container w-50 pe-2"},t("div",{ref:p,className:"use-concurrent-workers-picker"}),t("div",{ref:u,className:"form-text",hidden:!0})));this.body.innerHTML="",this.body.appendChild(g);const f=t("button",{ref:s,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&(this.footer.innerHTML="",this.footer.appendChild(f)),s.value&&(mn(s.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.value.addEventListener("click",(()=>{this.simUI.applyDefaults(n.nextEventID()),new Nn({variant:"success",body:"Restored to default settings."})}))),o.value&&new xn(o.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,a)=>{t.setFixedRngSeed(e,a)}}),l.value&&(l.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{l.value&&(l.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),r.value){const e=Object.keys(vs),t=e.indexOf("en");new hh(r.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:vs[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:a=>{const i=e.indexOf(a.getLanguage());return-1==i?t:i},setValue:(t,a,i)=>{a.setLanguage(t,e[i]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}if(c.value&&new Me(c.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,a)=>{t.setShowThreatMetrics(e,a)}}),d.value&&new Me(d.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,a)=>{t.setShowExperimental(e,a)}}),m.value&&new Me(m.value,this.simUI.sim,{id:"simui-show-quick-swap",label:"Show quick swap interface",labelTooltip:"Allows you to quickly swap between Gems/Enchants through your favorites. (Disabled on touch devices)",inline:!0,changedEvent:e=>e.showQuickSwapChangeEmitter,getValue:e=>e.getShowQuickSwap(),setValue:(e,t,a)=>{t.setShowQuickSwap(e,a)}}),h.value&&p.value){const e=[{value:0,name:"Off"}];for(let t=2;t<=navigator.hardwareConcurrency;t++)e.push({value:t,name:t.toString()});if(new hh(p.value,this.simUI.sim,{id:"simui-concurrent-workers-picker",label:"Use Multiple CPU Cores",labelTooltip:"Use web workers to spread sim workload over multiple CPU cores.",changedEvent:e=>e.wasmConcurrencyChangeEmitter,getValue:e=>e.getWasmConcurrency(),setValue:(e,t,a)=>t.setWasmConcurrency(e,a),values:e}),u.value&&navigator.userAgent.toLowerCase().includes("firefox")){const e=u.value;e.hidden=!1,e.textContent="Too many workers can cause significant memory usage! If sim doesn't finish due to RAM running out use a lower number."}this.simUI.sim.isWasm().then((e=>{e||(h.value.hidden=!0)}))}}}class ef extends e{static buildDiscordLink(){const e=t("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},t("i",{className:"fab fa-discord fa-lg"}));return mn(e),e}static buildGitHubLink(){const e=t("a",{href:ks,target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},t("i",{className:"fab fa-github fa-lg"}));return mn(e),e}static buildPatreonLink(){const e=t("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},t("i",{className:"fab fa-patreon fa-lg"})," Patreon");return mn(e),e}}class tf extends e{constructor(e,a){super(e,"sim-header"),this.simUI=a,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=t("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,a){const i=0==this.simTabsContainer.children.length;this.simTabsContainer.appendChild(t("li",{className:`${a} nav-item`,attributes:{role:"presentation","aria-controls":a}},t("button",{className:`nav-link ${i&&"active"}`,type:"button",dataset:{bsToggle:"tab",bsTarget:`#${a}`},attributes:{role:"tab","aria-selected":i}},e)))}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,a,i=!1){this.addImportExportLink(".import-dropdown",e,t,a,i)}addExportLink(e,t,a,i=!1){this.addImportExportLink(".export-dropdown",e,t,a,i)}addImportExportLink(e,i,s,o,n){const l=this.rootElem.querySelector(e).querySelector(".dropdown-menu"),r=a();if(l.appendChild(t("li",null,t("button",{ref:r,className:u("dropdown-item",n&&"disabled")},i))),r.value){if(n)return void mn(r.value,{content:"Currently unsupported"});r.value.addEventListener("click",(()=>s.open()))}}addToolbarLink({parent:e,tooltip:i,classes:s,onclick:o,text:n,...l}){const r=a();return e.appendChild(t(kn,{linkRef:r,buttonClassName:s,...l},n)),o&&r.value.addEventListener("click",o),i&&mn(r.value,{content:i,placement:"bottom"}),r.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(e){const a=t("li",null);a.innerHTML=e,this.knownIssuesContent.appendChild(a),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:Es,parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e=Ae,t="fas fa-gauge-high fa-lg",a=this.simToolbar;bs()?fetch("/version").then((i=>{i.json().then((i=>{2==i.outdated&&this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})).catch(N):this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new Xg(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=t("div",{className:"sim-toolbar-socials"});this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){e.appendChild(t(kn,null,ef.buildDiscordLink()))}addGitHubLink(e){e.appendChild(t(kn,null,ef.buildGitHubLink()))}addPatreonLink(e){e.appendChild(t(kn,null,ef.buildPatreonLink()))}customRootElement(){return t("header",{className:"sim-header"},t("div",{className:"sim-header-container"},t("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),t("div",{className:"import-export nav within-raid-sim-hide"},t("div",{className:"dropdown sim-dropdown-menu import-dropdown"},t("button",{className:"import-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},t("i",{className:"fa fa-download"})," Import"),t("ul",{className:"dropdown-menu"})),t("div",{className:"dropdown sim-dropdown-menu export-dropdown"},t("button",{className:"export-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},t("i",{className:"fa fa-right-from-bracket"})," Export"),t("ul",{className:"dropdown-menu"}))),t("div",{className:"sim-toolbar nav"})))}}class af extends e{constructor(e,i,s={}){super(e,"sim-title-dropdown-root");const o=i?{type:"Spec",spec:i}:{type:"Raid"},n=this.buildRootSimLink(o);if(s.noDropdown)return void this.rootElem.replaceChildren(n);const l=a();this.rootElem.replaceChildren(t("div",{className:"dropdown sim-link-dropdown"},n,t("ul",{ref:l,className:"dropdown-menu"}))),this.dropdownMenu=l.value,this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest("a")||(e.stopPropagation(),e.preventDefault())}))}buildDropdown(){Jg.status>=Yg.Alpha&&this.dropdownMenu?.appendChild(t("li",null,this.buildRaidLink())),A.naturalOrder.forEach((e=>this.dropdownMenu?.appendChild(t("li",null,this.buildClassDropdown(e)))))}buildClassDropdown(e){return t("div",{className:"dropend sim-link-dropdown"},this.buildClassLink(e),t("ul",{className:"dropdown-menu"},Object.values(e.specs).map((e=>t("li",null,this.buildSpecLink(e))))))}buildRootSimLink(e){return t("button",{className:u("sim-link",this.getContextualKlass(e)),dataset:{bsToggle:"dropdown",bsTrigger:"click"},attributes:{"aria-expanded":"false"}},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath(e),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-label text-white"},"WoWSims - Cataclysm"),t("span",{className:"sim-link-title"},"Raid"===e.type&&Ps,"Spec"===e.type&&Cs.getFullSpecName(e.spec)),this.launchStatusLabel(e))))}buildRaidLink(){return t("a",{href:Ns,className:u("sim-link",this.getContextualKlass({type:"Raid"}))},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Raid"}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-title"},Ps),this.launchStatusLabel({type:"Raid"}))))}buildClassLink(e){return t("button",{className:u("sim-link",this.getContextualKlass({type:"Class",class:e})),dataset:{bsToggle:"dropdown"},attributes:{"aria-expanded":"false"}},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Class",class:e}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-title"},e.friendlyName))))}buildSpecLink(e){return t("a",{href:e.simLink,className:u("sim-link",this.getContextualKlass({type:"Spec",spec:e}))},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Spec",spec:e}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-label"},Cs.getPlayerClass(e).friendlyName),t("span",{className:"sim-link-title"},e.friendlyName),this.launchStatusLabel({type:"Spec",spec:e}))))}launchStatusLabel(e){if("Raid"===e.type&&Jg.status===Yg.Launched)return null;const a="Raid"===e.type?Jg.status:Zg[e.spec.specID].status,i="Raid"===e.type?Jg.phase:Zg[e.spec.specID].phase;return t("span",{className:"launch-status-label text-brand"},a===Yg.Unlaunched?t(r,null,"Not Yet Supported"):t(r,null,"Phase ",i," - ",Yg[a]))}getSimIconPath(e){let t="";switch(e.type){case"Raid":t=Rs;break;case"Class":t=e.class.getIcon("large");break;case"Spec":t=e.spec.getIcon("large")}return t}getContextualKlass(e){switch(e.type){case"Class":return Ts(e.class);case"Spec":return _s(e.spec);default:return"text-white"}}}var sf=(e=>(e.bulkSimAsync="bulkSimAsync",e.bulkSimCombos="bulkSimCombos",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e.statWeightRequests="statWeightRequests",e.statWeightCompute="statWeightCompute",e.raidSimRequestSplit="raidSimRequestSplit",e.raidSimResultCombination="raidSimResultCombination",e.abortById="abortById",e))(sf||{});const of=5;class nf{constructor(e,t){this.buffs=ls.create(),this.compChangeEmitter=new n,this.buffsChangeEmitter=new n,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=n.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,ls.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,a){if(t<0||t>=5)throw new Error("Invalid player index: "+t);a!=this.players[t]&&n.freezeAllAndDo((()=>{const i=this.players[t];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=a){const i=a.getParty();i&&i.setPlayer(e,a.getPartyIndex(),null),this.players[t]=a,a.changeEmitter.on(this.playerChangeListener),a.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return ls.clone(this.buffs)}setBuffs(e,t){ls.equals(this.buffs,t)||(this.buffs=ls.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return Ds.create({players:this.players.map((a=>null==a?Gs.create():a.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){n.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||ls.create());for(let a=0;a<5;a++){if(!t.players[a]||t.players[a].class==O.ClassUnknown){this.setPlayer(e,a,null);continue}const i=t.players[a],s=Os(i),o=this.players[a];if(o&&s.specID==o.getSpec())o.fromProto(e,i);else{const t=new aw(s,this.sim);t.fromProto(e,i),this.setPlayer(e,a,t)}}}))}}const lf=5;class rf{constructor(e){this.buffs=os.create(),this.debuffs=ns.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new n,this.buffsChangeEmitter=new n,this.debuffsChangeEmitter=new n,this.tanksChangeEmitter=new n,this.targetDummiesChangeEmitter=new n,this.numActivePartiesChangeEmitter=new n,this.sim=e,this.parties=[...Array(5).keys()].map((t=>{const a=new nf(this,e);return a.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),a.changeEmitter.on((e=>this.changeEmitter.emit(e))),a})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=n.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return U(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=pt.Unknown?e.type==pt.Player?this.getPlayer(e.index):e.type==pt.Self&&t||null:null}setPlayer(e,t,a){this.parties[Math.floor(t/5)].setPlayer(e,t%5,a)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return os.clone(this.buffs)}setBuffs(e,t){os.equals(this.buffs,t)||(this.buffs=os.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return ns.clone(this.debuffs)}setDebuffs(e,t){ns.equals(this.debuffs,t)||(this.debuffs=ns.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>nt.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,a)=>nt.equals(e,t[a])))||(this.tanks=t.map((e=>nt.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return Us.create({parties:this.parties.map((a=>a.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){n.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||os.create()),this.setDebuffs(e,t.debuffs||ns.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let a=0;a<5;a++)t.parties[a]?this.parties[a].fromProto(e,t.parties[a]):this.parties[a].clear(e)}))}clear(e){n.freezeAllAndDo((()=>{for(let t=0;t<5;t++)this.parties[t].clear(e)}))}}const cf=`/${Qs}/sim_worker.js`,df=e=>e+"-"+Array.from(Array(4)).map((()=>Math.floor(65536*Math.random()).toString(16))).join("");class mf{constructor(e){this.workers=[],this.workersDisabled=[],this.setNumWorkers(e)}setNumWorkers(e){if(e<this.workers.length){for(let t=this.workers.length-1;t>=e;t--)this.workers[t].disable(),this.workersDisabled[t]=this.workers[t];this.workers.length=e}else for(let t=0;t<e;t++)this.workers[t]||(this.workersDisabled[t]?(this.workers[t]=this.workersDisabled[t],delete this.workersDisabled[t],this.workers[t].enable()):this.workers[t]=new hf(t))}getNumWorkers(){return this.workers.length}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.getSimTaskWorkAmount()<t.getSimTaskWorkAmount()?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,df(e))}async computeStats(e){const t=await this.makeApiCall(sf.computeStats,As.toBinary(e));return Ls.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Stat weights request: "+Fs.toJsonString(e));const s=df(sf.statWeightsAsync);a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const o=e.simOptions?e.simOptions.iterations*e.statsToWeigh.length:3e4,n=await this.doAsyncRequest(sf.statWeightsAsync,Fs.toBinary(e),s,i,t,o);return i.log("Stat weights result: "+ys.toJsonString(n.finalWeightResult)),n.finalWeightResult}async statWeightRequests(e){const t=await this.makeApiCall(sf.statWeightRequests,Fs.toBinary(e));return Ms.fromBinary(t)}async statWeightCompute(e){const t=await this.makeApiCall(sf.statWeightCompute,Vs.toBinary(e));return ys.fromBinary(t)}async bulkSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("bulk sim request: "+Ws.toJsonString(e,{enumAsInteger:!0}));const s=df(sf.bulkSimAsync);a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const o=e.baseSettings?.simOptions?.iterations??3e4,n=await this.doAsyncRequest(sf.bulkSimAsync,Ws.toBinary(e),s,i,t,o),l=Bs.toJson(n.finalBulkResult);return i.log("bulk sim result: "+JSON.stringify(l)),n.finalBulkResult}async bulkSimCombosAsync(e){const t=this.getLeastBusyWorker();t.log("bulk sim combinations request: "+zs.toJsonString(e,{enumAsInteger:!0}));const a=df(sf.bulkSimCombos),i=await t.doApiCall(sf.bulkSimCombos,zs.toBinary(e),a);return js.fromBinary(i)}async raidSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Raid sim request: "+je.toJsonString(e));const s=e.requestId;a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const o=e.simOptions?.iterations??3e3,n=await this.doAsyncRequest(sf.raidSimAsync,je.toBinary(e),s,i,t,o),l=Hs.toJson(n.finalRaidResult);return delete l.logs,i.log("Raid sim result: "+JSON.stringify(l)),n.finalRaidResult}async raidSimRequestSplit(e){const t=await this.makeApiCall(sf.raidSimRequestSplit,qs.toBinary(e));return Ks.fromBinary(t)}async raidSimResultCombination(e){const t=await this.makeApiCall(sf.raidSimResultCombination,$s.toBinary(e));return Hs.fromBinary(t)}isWasm(){return this.workers[0].isWasmWorker()}async doAsyncRequest(e,t,a,i,s,o){try{i.addSimTaskRunning(a,o),i.doApiCall(e,t,a);const n=new Promise((e=>{i.addPromiseFunc(this.getProgressName(a),this.newProgressHandler(a,i,s,(t=>e(t))),N)}));return await n}finally{i.updateSimTask(a,0)}}newProgressHandler(e,t,a,i){return s=>{const o=Ys.fromBinary(s);a(o),t.updateSimTask(e,Math.max(1,o.totalIterations-o.completedIterations)),null==o.finalRaidResult&&null==o.finalWeightResult&&null==o.finalBulkResult?t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,a,i),N):i(o)}}}class hf{constructor(e){this.workerId=e,this.simTasksRunning={},this.taskIdsToPromiseFuncs={},this.wasmWorker=!1,this.shouldDestroy=!1,this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.setupWorker(),this.log("Created.")}setupWorker(){this.setTaskActive("setup",!0),this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.worker=new window.Worker(cf),this.worker.addEventListener("message",(({data:e})=>{const{id:t,msg:a,outputData:i}=e;switch(a){case"ready":this.wasmWorker=!!i&&!!i[0],this.postMessage({msg:"setID",id:this.workerId.toString()}),this.resolveReady(),this.setTaskActive("setup",!1),this.log(`Ready, isWasm: ${this.wasmWorker}`);break;case"idConfirm":break;default:const e=this.taskIdsToPromiseFuncs[t];if(!e)return void console.warn(`Unrecognized result id ${t} for msg ${a}`);t.includes("progress")||this.setTaskActive(t,!1),delete this.taskIdsToPromiseFuncs[t],e[0](i)}}))}addSimTaskRunning(e,t){this.simTasksRunning[e]={workLeft:t},this.log(`Added work ${e}, current work amount: ${this.getSimTaskWorkAmount()}`)}updateSimTask(e,t){if(t<=0)return delete this.simTasksRunning[e],this.log(`Work ${e} done, current work amount: ${this.getSimTaskWorkAmount()}`),void(this.shouldDestroy&&0==this.getSimTaskWorkAmount()&&this.disable(!0));this.simTasksRunning[e].workLeft=t}getSimTaskWorkAmount(){let e=0;for(const t of Object.values(this.simTasksRunning))e+=t.workLeft;return e}hasTaskId(e){return!!this.simTasksRunning[e]}setTaskActive(e,t){t?this.addSimTaskRunning(e+"task",1):this.updateSimTask(e+"task",0)}async isWasmWorker(){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");return await this.onReady,this.wasmWorker}addPromiseFunc(e,t,a){this.taskIdsToPromiseFuncs[e]=[t,a]}async doApiCall(e,t,a){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");if(!a)throw new Error("ApiCall with empty id!");this.setTaskActive(a,!0),await this.onReady;const i=new Promise(((i,s)=>{this.taskIdsToPromiseFuncs[a]=[i,s],this.postMessage({msg:e,id:a,inputData:t})}));return await i}postMessage(e){if(!this.worker)throw new Error(`Worker ${this.workerId} postMessage while disabled!`);this.worker.postMessage(e)}disable(e=!1){this.shouldDestroy=!0,!this.worker||!e&&this.getSimTaskWorkAmount()||(this.worker.terminate(),delete this.worker,delete this.onReady,delete this.resolveReady,this.log("Disabled."))}enable(){this.shouldDestroy=!1,this.worker||(this.setupWorker(),this.log("Enabled."))}log(e){}async sendAbortById(e){const t=Js.toBinary(Js.create({requestId:e})),a=df(sf.abortById),i=await this.doApiCall(sf.abortById,t,a);return Zs.fromBinary(i)}}class pf{constructor(e,t){this.concurrency=e,this.iterationsTotal=t,this.iterationsDone=Array(this.concurrency).fill(0),this.dpsValues=Array(this.concurrency).fill(0),this.hpsValues=Array(this.concurrency).fill(0),this.finalResults=Array(this.concurrency)}getIterationsDone(){let e=0;for(const t of this.iterationsDone)e+=t;return e}getDpsAvg(){let e=0;for(const t of this.dpsValues)e+=t;return e/this.concurrency}getHpsAvg(){let e=0;for(const t of this.hpsValues)e+=t;return e/this.concurrency}updateProgress(e,t){this.iterationsDone[e]=t.completedIterations,this.dpsValues[e]=t.dps,this.hpsValues[e]=t.hps,t.finalRaidResult&&(this.finalResults[e]=t.finalRaidResult)}makeProgressMetrics(){return Ys.create({totalIterations:this.iterationsTotal,completedIterations:this.getIterationsDone(),dps:this.getDpsAvg(),hps:this.getHpsAvg()})}}const uf=(e,t)=>{const a=Hs.create();return"string"==typeof e?(console.error(e),a.error=Xs.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(Ys.create({finalRaidResult:a})),a},gf=async(e,t,a,i)=>{console.log(`Sending requests split for ${t.getNumWorkers()} splits.`);const s=await t.raidSimRequestSplit(qs.create({splitCount:t.getNumWorkers(),request:e}));if(s.errorResult)return uf(s.errorResult,a);if(i.abort.isTriggered())return uf(Xs.create({type:Ue.ErrorOutcomeAborted}),a);console.log(`Running ${e.simOptions.iterations} iterations on ${s.splitsDone} concurrent sims...`);const o=await((e,t,a,i,s)=>new Promise((o=>{const n=new pf(e.length,t);let l=0,r=e.length;const c=(e,t)=>{if(r&&(n.updateProgress(e,t),l++,l%r==0&&i(n.makeProgressMetrics()),t.finalRaidResult)){let a;if(r--,t.finalRaidResult.error&&(t.finalRaidResult.error.type==Ue.ErrorOutcomeError&&console.error(`Worker ${e} had an error!`),a=t.finalRaidResult,s.abort.trigger()),a||0==r){r=0;const e=n.makeProgressMetrics();return e.finalRaidResult=a,i(e),void o({errorResult:a,results:n.finalResults,progressMetricsFinal:e})}}};for(let t=0;t<e.length;t++)a.raidSimAsync(e[t],(e=>c(t,e)),s)})))(s.requests,e.simOptions.iterations,t,a,i);if(o.errorResult&&o.errorResult.error)return uf(o.errorResult.error,a);if(i.abort.isTriggered())return uf(Xs.create({type:Ue.ErrorOutcomeAborted}),a);console.log(`All ${s.splitsDone} sims finished successfully. Combining ${o.results.length} results.`);const n=await t.raidSimResultCombination($s.create({results:o.results}));return n.error?uf(n.error,a):(o.progressMetricsFinal.finalRaidResult=n,a(o.progressMetricsFinal),n)},ff=(e,t)=>{const a=Hs.create();return"string"==typeof e?(console.error(e),a.error=Xs.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(Ys.create({finalWeightResult:a})),a},wf=`${Ss}_wasmconcurrency`,yf=class e{constructor({type:t}={}){this.iterations=12500,this.phase=to,this.faction=ao.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.wasmConcurrency=0,this.showQuickSwap=!1,this.showEPValues=!1,this.useCustomEPValues=!1,this.useSoftCapBreakpoints=!0,this.language="",this.db_=null,this.iterationsChangeEmitter=new n,this.phaseChangeEmitter=new n,this.factionChangeEmitter=new n,this.fixedRngSeedChangeEmitter=new n,this.lastUsedRngSeedChangeEmitter=new n,this.filtersChangeEmitter=new n,this.showDamageMetricsChangeEmitter=new n,this.showThreatMetricsChangeEmitter=new n,this.showHealingMetricsChangeEmitter=new n,this.showExperimentalChangeEmitter=new n,this.wasmConcurrencyChangeEmitter=new n,this.showQuickSwapChangeEmitter=new n,this.showEPValuesChangeEmitter=new n,this.useCustomEPValuesChangeEmitter=new n,this.useSoftCapBreakpointsChangeEmitter=new n,this.languageChangeEmitter=new n,this.crashEmitter=new n,this.unitMetadataEmitter=new n("UnitMetadata"),this.simResultEmitter=new n,this.bulkSimStartEmitter=new n,this.bulkSimResultEmitter=new n,this.lastUsedRngSeed=0,this.modifyRaidProto=N,this.type=t??io.SimTypeIndividual,this.workerPool=new mf(1),this.wasmConcurrencyChangeEmitter.on((async()=>{if(await this.workerPool.isWasm()){const e=Math.max(1,Math.min(this.wasmConcurrency,navigator.hardwareConcurrency));this.workerPool.setNumWorkers(e)}}));let a=parseInt(window.localStorage.getItem(wf)??"NaN");isNaN(a)&&(a=0,navigator.hardwareConcurrency>1&&(a=Math.min(4,Math.floor(navigator.hardwareConcurrency/2)))),this.setWasmConcurrency(n.nextEventID(),a),this.signalManager=new so,this._initPromise=R.get().then((e=>{this.db_=e})),this.raid=new rf(this),this.encounter=new Qh(this),this.settingsChangeEmitter=n.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.wasmConcurrencyChangeEmitter,this.showQuickSwapChangeEmitter,this.showEPValuesChangeEmitter,this.useCustomEPValuesChangeEmitter,this.useSoftCapBreakpointsChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=n.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),n.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}isWasm(){return this.workerPool.isWasm()}async shouldUseWasmConcurrency(){return await this.isWasm()&&this.getWasmConcurrency()>=2&&this.workerPool.getNumWorkers()>=2}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{if(!e.equipment)return;let t=this.db.lookupEquipmentSpec(e.equipment),a=!1;const i=[e.profession1,e.profession2].includes(xe.Blacksmithing);t.hasInactiveMetaGem(i)&&(t=t.withoutMetaGem(),a=!0),i||(t=t.withoutBlacksmithSockets(),a=!0),a&&(e.equipment=t.asSpec())}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),a=this.encounter.toProto();return je.create({requestId:df(sf.raidSimAsync),type:this.type,raid:t,encounter:a,simOptions:oo.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=Ws.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const s=i.baseSettings.raid.parties[0].players[0].database;s.items.push(...t.items),s.enchants.push(...t.enchants),s.gems.push(...t.gems),s.reforgeStats.push(...t.reforgeStats),s.randomSuffixes.push(...t.randomSuffixes),this.bulkSimStartEmitter.emit(n.nextEventID(),i);const o=this.signalManager.registerRunning(Fe.BulkSim);try{const e=await this.workerPool.bulkSimAsync(i,a,o);if(e.error){if(e.error.type!=Ue.ErrorOutcomeError)return e;throw new bf(e.error.message)}return this.bulkSimResultEmitter.emit(n.nextEventID(),e),e}catch(l){if(l instanceof bf)throw l;throw console.log(l),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(o)}}async calculateBulkCombinations(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const a=zs.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=a.baseSettings&&null!=a.baseSettings.simOptions&&(a.baseSettings.simOptions.debugFirstIteration=!1),!a.baseSettings?.raid||0==a.baseSettings?.raid?.parties.length||0==a.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const i=a.baseSettings.raid.parties[0].players[0].database;i.items.push(...t.items),i.enchants.push(...t.enchants),i.gems.push(...t.gems),i.reforgeStats.push(...t.reforgeStats),i.randomSuffixes.push(...t.randomSuffixes),this.bulkSimStartEmitter.emit(n.nextEventID(),a);try{const e=await this.workerPool.bulkSimCombosAsync(a);if(""!=e.errorResult)throw new bf(e.errorResult);return e}catch(s){if(s instanceof bf)throw s;throw console.log(s),new Error("Something went wrong running your raid sim. Reload the page and try again.")}}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const a=this.signalManager.registerRunning(Fe.RaidSim);try{await this.waitForInit();const i=this.makeRaidSimRequest(!1);let s;if(s=await this.shouldUseWasmConcurrency()?await gf(i,this.workerPool,t,a):await this.workerPool.raidSimAsync(i,t,a),s.error){if(s.error.type!=Ue.ErrorOutcomeError)return s.error;throw new bf(s.error.message)}const o=await no.makeNew(i,s);return this.simResultEmitter.emit(e,o),o}catch(i){if(i instanceof bf)throw i;throw console.error(i),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(a)}}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const t=this.signalManager.registerRunning(Fe.RaidSim);try{await this.waitForInit();const a=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(a,N,t);if(i.error)throw new bf(i.error.message);const s=await no.makeNew(a,i);return this.simResultEmitter.emit(e,s),s}catch(a){if(a instanceof bf)throw a;throw console.error(a),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(t)}}async updateCharacterStats(e){if(0==e)return;e=n.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),a=As.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(a);""==i.errorResult?n.freezeAllAndDo((async()=>{const a=i.raidStats.parties.map(((a,i)=>a.players.map(((a,s)=>{const o=t[5*i+s];return o?(o.setCurrentStats(e,a),o.updateMetadata()):null})))).flat().filter((e=>null!=e)),s=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(a.concat([s]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new bf(i.errorResult))}async statWeights(e,t,a,i,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),ys.create();{const n=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[nt.create({type:pt.Player,index:0})]:[],l=Fs.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:oo.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:n,statsToWeigh:t,pseudoStatsToWeigh:a,epReferenceStat:i}),r=this.signalManager.registerRunning(Fe.StatWeights);try{let e;if(e=await this.shouldUseWasmConcurrency()?await(async(e,t,a,i)=>{console.log("Getting stat weight sim requests.");const s=df(sf.statWeightsAsync),o=await t.statWeightRequests(e);if(o.baseRequest.requestId=s,i.abort.isTriggered())return ff(Xs.create({type:Ue.ErrorOutcomeAborted}),a);let n=o.baseRequest.simOptions.iterations,l=0,r=1,c=0;for(const g of o.statSimRequests)g.requestLow.requestId=s,g.requestHigh.requestId=s,n+=g.requestLow.simOptions.iterations+g.requestHigh.simOptions.iterations,r+=2;console.log(`Need to run a total of ${r} sims and ${n} iterations.`);let d=0;const m=e=>{l+=e.completedIterations-d,d=e.completedIterations,a(Ys.create({totalIterations:n,completedIterations:l,totalSims:r,completedSims:c})),e.finalRaidResult&&c++},h=await gf(o.baseRequest,t,m,i);if(h.error)return ff(h.error,a);const p=Vs.create({baseResult:h,epReferenceStat:o.epReferenceStat,statSimResults:[]});for(const g of o.statSimRequests){if(i.abort.isTriggered())return ff(Xs.create({type:Ue.ErrorOutcomeAborted}),a);d=0;const e=await gf(g.requestLow,t,m,i);if(e.error)return ff(e.error,a);d=0;const s=await gf(g.requestHigh,t,m,i);if(s.error)return ff(s.error,a);p.statSimResults.push(eo.create({statData:g.statData,resultLow:e,resultHigh:s}))}console.log(`All ${r} sims finished successfully. Computing weights.`);const u=await t.statWeightCompute(p);return u.error?ff(u.error,a):(a(Ys.create({finalWeightResult:u})),u)})(l,this.workerPool,s,r):await this.workerPool.statWeightsAsync(l,s,r),e.error){if(e.error.type!=Ue.ErrorOutcomeError)return e;throw new bf(e.error.message)}return e}catch(o){if(o instanceof bf)throw o;throw console.error(o),new Error("Something went wrong calculating your stat weights. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(r)}}}getUnitMetadata(e,t,a){if(!e||e.type==pt.Unknown)return this.getUnitMetadata(a,t,a);if(e.type==pt.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==pt.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==pt.Pet){const a=this.raid.getPlayerFromUnitReference(e.owner,t);return a?a.getPetMetadatas().asList()[e.index]:void 0}return e.type==pt.Self?t?.getMetadata():e.type==pt.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(n.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return lo.clone(this.filters)}setFilters(e,t){lo.equals(t,this.filters)||(this.filters=lo.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics||this.showThreatMetrics&&this.raid.getPlayer(0)?.playerSpec.specID==w.SpecBloodDeathKnight}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getWasmConcurrency(){return this.wasmConcurrency}setWasmConcurrency(e,t){t!=this.wasmConcurrency&&(this.wasmConcurrency=t,window.localStorage.setItem(wf,t.toString()),this.wasmConcurrencyChangeEmitter.emit(e))}getShowQuickSwap(){return!fn()&&this.showQuickSwap}setShowQuickSwap(e,t){t!=this.showQuickSwap&&(this.showQuickSwap=t,this.showQuickSwapChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getUseCustomEPValues(){return this.useCustomEPValues}setUseCustomEPValues(e,t){t!==this.useCustomEPValues&&(this.useCustomEPValues=t,this.useCustomEPValuesChangeEmitter.emit(e))}getUseSoftCapBreakpoints(){return this.useSoftCapBreakpoints}setUseSoftCapBreakpoints(e,t){t!==this.useSoftCapBreakpoints&&(this.useSoftCapBreakpoints=t,this.useSoftCapBreakpointsChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||ro())!=this.language&&(this.language=t,co(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),mo.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showQuickSwap:this.getShowQuickSwap(),showEpValues:this.getShowEPValues(),useCustomEpValues:this.getUseCustomEPValues(),useSoftCapBreakpoints:this.getUseSoftCapBreakpoints(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,a){n.freezeAllAndDo((()=>{this.setIterations(t,a.iterations||12500),this.setPhase(t,a.phase||to),this.setFixedRngSeed(t,Number(a.fixedRngSeed)),this.setShowDamageMetrics(t,a.showDamageMetrics),this.setShowThreatMetrics(t,a.showThreatMetrics),this.setShowHealingMetrics(t,a.showHealingMetrics),this.setShowExperimental(t,a.showExperimental),this.setShowQuickSwap(t,a.showQuickSwap),this.setShowEPValues(t,a.showEpValues),this.setUseCustomEPValues(t,a.useCustomEpValues),this.setUseSoftCapBreakpoints(t,a.useSoftCapBreakpoints),this.setLanguage(t,a.language),this.setFaction(t,a.faction||ao.Alliance);const i=a.filters||e.defaultFilters();0==i.armorTypes.length&&(this.type==io.SimTypeIndividual?i.armorTypes=[this.raid.getActivePlayers()[0].getPlayerClass().armorTypes[0]]:i.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=e.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=e.ALL_RAIDS.slice()),this.setFilters(t,i)}))}applyDefaults(t,a,i){this.fromProto(t,mo.create({iterations:12500,phase:to,faction:ao.Alliance,showDamageMetrics:!i,showThreatMetrics:a,showHealingMetrics:i,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1,useSoftCapBreakpoints:!0}))}static defaultFilters(){return lo.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};yf.MAX_RNG_SEED=Math.pow(2,32)-1,yf.ALL_ARMOR_TYPES=_(ho).filter((e=>0!=e)),yf.ALL_WEAPON_TYPES=_(po).filter((e=>0!=e)),yf.ALL_RANGED_WEAPON_TYPES=_(uo).filter((e=>0!=e)),yf.ALL_SOURCES=_(go).filter((e=>0!=e)),yf.ALL_RAIDS=_(fo).filter((e=>0!=e));let If=yf;class bf extends Error{constructor(e){super(e),this.errorStr=e}}const xf=[];class Sf extends e{constructor(e,a,i){super(e,"sim-ui"),this.sim=a,this.cssClass=i.cssClass,this.cssScheme=i.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const s=t(r,null,t("div",{className:"sim-root"},t("div",{className:"sim-bg"}),i.noticeText?t("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},i.noticeText):null,t("div",{className:"sim-container"},t("aside",{className:"sim-sidebar"},t("div",{className:"sim-title"}),t("div",{className:"sim-sidebar-content"},t("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),t("div",{className:"sim-sidebar-results within-raid-sim-hide"}),t("div",{className:"sim-sidebar-stats"}),t("div",{className:"sim-sidebar-socials"}))),t("div",{className:"sim-content container-fluid"}))),t("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(s),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new tf(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=n.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const o=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};o(),this.sim.showDamageMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};l(),this.sim.showThreatMetricsChangeEmitter.on(l);const c=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};c(),this.sim.showHealingMetricsChangeEmitter.on(c);const d=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};d(),this.sim.showDamageMetricsChangeEmitter.on(d),this.sim.showHealingMetricsChangeEmitter.on(d),this.sim.showThreatMetricsChangeEmitter.on(d);const m=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};m(),this.sim.showExperimentalChangeEmitter.on(m),this.addKnownIssues(i);const h=this.rootElem.querySelector(".sim-title");new af(h,i.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.addNoticeForLocalSim(),this.iterationsPicker=new xn(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,a)=>{t.setIterations(e,a)}}).rootElem;const p=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new Pn(p);const u=this.rootElem.querySelector(".sim-sidebar-socials");u.appendChild(ef.buildDiscordLink()),u.appendChild(ef.buildGitHubLink()),u.appendChild(ef.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addNoticeForLocalSim(){new Qg(this.simActionsContainer)}addAction(e,i,s){const o=a();return this.simActionsContainer.appendChild(t("button",{ref:o,className:u("sim-sidebar-action-button btn btn-primary w-100",i),onclick:s},e,t("span",{className:"sim-sidebar-action-button-loading-icon"},t("i",{className:"fas fa-spinner fa-spin"})))),o.value}addActionGroup(e,i={}){const s=[],o=a(),{cssClass:n}=i;return this.simActionsContainer.appendChild(t("div",{ref:o,className:u("d-flex btn-group w-100",n),attributes:{role:"group"}},e.map((({label:e,cssClass:a,children:i,onClick:o})=>t("button",{ref:e=>s.push(e),onclick:o,className:u("sim-sidebar-action-button btn btn-primary",a)},e,i,t("span",{className:"sim-sidebar-action-button-loading-icon"},t("i",{className:"fas fa-spinner fa-spin"}))))))),{group:o.value,children:s}}addTab(e,a,i){const s=a.replace(/\s+/g,"-")+"-tab",o=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,s),this.simTabContentsContainer.appendChild(t("div",{id:s,className:u("tab-pane fade",o&&"active show")},i))}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";switch(e.simStatus.status){case Yg.Unlaunched:t="This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.";break;case Yg.Alpha:t="This sim is in ALPHA. Bugs are expected; please let us know if you find one!";break;case Yg.Beta:t="This sim is in BETA. There may still be a few bugs; please let us know if you find one!"}t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues?.forEach((e=>this.simHeader.addKnownIssue(e))),xf?.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.signalManager.abortType(Fe.All);const t=await this.sim.runRaidSim(n.nextEventID(),e);t instanceof no||t.type!=Ue.ErrorOutcomeAborted||new Nn({variant:"info",body:"Raid sim cancelled."})}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(n.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof bf))return void(e.message?new Nn({variant:"error",body:e.message}):alert(e));new Nn({variant:"error",body:"The Simulation failed. Generated an error report."});const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await h.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),a=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/cata+"+e).then((s=>{s.json().then((s=>{if(s.total_count>0)window.open(s.items[0].html_url,"_blank");else{const s=new URL(wo);s.searchParams.append("title",`Crash Report ${e}`),s.searchParams.append("assignees",""),s.searchParams.append("labels","");const o=2048-s.toString().length;let n=`Link:\n${a}\n\nRNG Seed: ${i}\n\n${t}`;a.includes("/raid/")&&(n=`${t}\nRNG Seed: ${i}\nLink:\n${a}`);let l=!1;for(;n.length>o-(l?3:0);)n=n.slice(0,n.lastIndexOf("%")),l=!0;l&&(n+="...",new vf(this.rootElem,a).open()),s.searchParams.append("body",n),window.open(s.toString(),"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let a=0,i=e.length;a<i;a++){t=(t<<5)-t+e.charCodeAt(a),t|=0}return t}}class vf extends yn{constructor(e,a){super(e,"crash",{title:"Extra Crash Information"}),this.body.appendChild(t("div",{className:"sim-crash-report"},t("h3",{className:"sim-crash-report-header"},"Please append the following complete link to the issue you just created. This will simplify debugging the issue."),t("textarea",{className:"sim-crash-report-text form-control"},a)))}}function kf(e,t){return function(e,t){Xf[e]=t}(e,t),t}const Ef=[];class Pf extends Sf{constructor(e,t,a){super(e,t.sim,{cssClass:a.cssClass,cssScheme:a.cssScheme,spec:t.getPlayerSpec(),knownIssues:a.knownIssues,simStatus:Zg[t.getSpec()]}),this.epWeightsModal=null,this.bt=null,this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=a,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null;const i=t.isClass(O.ClassMonk)?6:41;(e=>Zg[e.getSpec()].status)(this.player)!==Yg.Unlaunched?((a.itemSwapSlots||[]).length>0&&!Ef.includes(t.getSpec())&&Ef.push(t.getSpec()),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{if(!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing()))return"";const e=this.player.getGear().getMetaGem();return`Meta gem disabled (${e.name}): ${yo(e)}`}}),this.addWarning({updateOn:n.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${ts.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{const e=this.player.getGear().getJCGems(this.player.isBlacksmithing());return e.length<=3?"":`Only 3 Jewelcrafting Gems are allowed, but ${e.length} are equipped.`}}),this.addWarning({updateOn:this.player.talentsChangeEmitter,getContent:()=>{const e=Io(this.player.getTalentsString());return 0==e?"":e<i?"Unspent talent points.":e>i?"More than maximum talent points spent.":""}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>this.player.armorSpecializationArmorType&&this.player.hasArmorSpecializationBonus()?`Equip ${bo.get(this.player.armorSpecializationArmorType)} gear in each slot for the Armor Specialization (5% primary stat) effect.`:""}),this.addWarning({updateOn:n.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(y.ItemSlotMainHand)?.item.handType!=xo.HandTypeTwoHand||null==this.player.getEquippedItem(y.ItemSlotOffHand))&&this.player.getEquippedItem(y.ItemSlotOffHand)?.item.handType!=xo.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(a.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{Vn.registerSetBonusNotices(this.sim.db),this.loadSettings(),this.player.getPlayerSpec().isHealingSpec&&alert(So)})),this.addSidebarComponents(),this.addGearTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()):this.handleSimUnlaunched()}loadSettings(){const e=n.nextEventID();n.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const a=ve.fromJsonString(t,{ignoreUnknownFields:!0});this.fromProto(e,a)}catch(a){console.warn("Failed to parse saved settings: "+a)}try{const t=dm.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(a){console.warn("Failed to parse link settings: "+a)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=ve.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){this.raidSimResultsManager=vo(this),this.sim.waitForInit().then((()=>{this.epWeightsModal=(e=>{const t=new $g(e);return e.addAction("Stat Weights","ep-weights-action",(()=>{t.open()})),t})(this)})),new Sn(this.rootElem.querySelector(".sim-sidebar-stats"),this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats,this.individualConfig.overwriteDisplayStats)}handleSimUnlaunched(){this.rootElem.classList.add("sim-ui--is-unlaunched"),this.simMain?.replaceChildren(t("div",{className:"sim-ui-unlaunched-container d-flex flex-column align-items-center text-center mt-auto mb-auto ms-auto me-auto"},t("i",{className:"fas fa-ban fa-3x"}),t("p",{className:"mt-4"},"This sim is currently not supported.",t("br",null),"Want to contribute? Make sure to join our"," ",t("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank"},"Discord"),"!"),t("p",null,"You can check out our other sims ",t("a",{href:"/cata/"},"here"))))}addGearTab(){new Um(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new fm(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new Dg(this.simTabContentsContainer,this)}addTalentsTab(){new jg(this.simTabContentsContainer,this)}addRotationTab(){new Zh(this.simTabContentsContainer,this)}addDetailedResultsTab(){const e=t("div",{className:"detailed-results"});this.addTab("Results","detailed-results-tab",e),new ko(e,this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new Jl(this.rootElem,this),!0),this.simHeader.addImportLink("60U Cata",new Kl(this.rootElem,this),!0),this.simHeader.addImportLink("WoWHead",new gm(this.rootElem,this),!1,!1),this.simHeader.addImportLink("Addon",new $l(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new km(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new vm(this.rootElem,this),!0),this.simHeader.addExportLink("WoWHead",new Tm(this.rootElem,this),!1,!1),this.simHeader.addExportLink("60U Cata EP",new xm(this.rootElem,this),!1),this.simHeader.addExportLink("Pawn EP",new Pm(this.rootElem,this),!1),this.simHeader.addExportLink("CLI",new Sm(this.rootElem,this),!0)}applyDefaultRotation(e){n.freezeAllAndDo((()=>{const t=this.individualConfig.defaults.rotationType||Ye.TypeAuto;if(this.player.setAplRotation(e,Je.create({type:t})),!this.individualConfig.defaults.simpleRotation)return;const a=this.individualConfig.defaults.simpleRotation||this.player.specTypeFunctions.rotationCreate();this.player.setSimpleRotation(e,a),this.player.setSimpleCooldowns(e,Eo.create({hpPercentForDefensives:this.player.playerSpec.isTankSpec?.4:0}))}))}applyEmptyAplRotation(e){n.freezeAllAndDo((()=>{this.player.setAplRotation(e,Je.create({type:Ye.TypeAPL}))}))}applyDefaults(e){n.freezeAllAndDo((()=>{const t=this.player.getPlayerSpec().isTankSpec,a=this.player.getPlayerSpec().isHealingSpec;this.player.applySharedDefaults(e),this.player.setRace(e,this.player.getPlayerClass().races[0]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.applyDefaultRotation(e),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setGlyphs(e,this.individualConfig.defaults.talents.glyphs||Se.create()),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights),this.individualConfig.defaults.itemSwap&&this.player.itemSwapSettings.setItemSwapSettings(e,!0,this.sim.db.lookupItemSwap(this.individualConfig.defaults.itemSwap||ds.create()));const i=this.player.getDefaultEpRatios(t,a);this.player.setEpRatios(e,i),this.individualConfig.defaults.statCaps&&this.player.setStatCaps(e,this.individualConfig.defaults.statCaps),this.individualConfig.defaults.softCapBreakpoints&&this.player.setSoftCapBreakpoints(e,this.individualConfig.defaults.softCapBreakpoints),this.player.setBreakpointLimits(e,new d),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||xe.Engineering),void 0===this.individualConfig.defaults.other?.profession2?this.player.setProfession2(e,xe.Jewelcrafting):this.player.setProfession2(e,this.individualConfig.defaults.other.profession2),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.player.setDarkIntentUptime(e,this.individualConfig.defaults.other?.darkIntentUptime||100),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,a?9:0),this.sim.encounter.applyDefaults(e),this.sim.encounter.setExecuteProportion90(e,this.individualConfig.defaults.other?.highHpThreshold||.9),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,a),this.individualConfig.defaults.other?.iterationCount&&this.sim.setIterations(e,this.individualConfig.defaults.other.iterationCount),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedEPWeightsStorageKey(){return this.getStorageKey("__savedEPWeights__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return Cs.getLocalStorageKey(this.player.getPlayerSpec())+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),a=ve.create({player:this.player.toProto(!0,!1,e)});return t(ol.Miscellaneous)&&ve.mergePartial(a,{tanks:this.sim.raid.getTanks()}),t(ol.Encounter)&&ve.mergePartial(a,{encounter:this.sim.encounter.toProto()}),t(ol.External)&&ve.mergePartial(a,{partyBuffs:this.player.getParty()?.getBuffs()||ls.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(ol.UISettings)&&ve.mergePartial(a,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),statCaps:this.player.getStatCaps().toProto(),breakpointLimits:this.player.getBreakpointLimits().toProto(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),a}toLink(){return km.createLink(this)}fromProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.player.getPlayerSpec().isTankSpec,o=this.player.getPlayerSpec().isHealingSpec;n.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,a),i(ol.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),i(ol.External)){this.sim.raid.setBuffs(e,t.raidBuffs||os.create()),this.sim.raid.setDebuffs(e,t.debuffs||ns.create());const a=this.player.getParty();a&&a.setBuffs(e,t.partyBuffs||ls.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(i(ol.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||Ze.create()),i(ol.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,d.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const a=this.player.getDefaultEpRatios(s,o);if(t.epRatios){const i=new Array(a.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(i))}else this.player.setEpRatios(e,a);t.statCaps&&this.player.setStatCaps(e,d.fromProto(t.statCaps)),t.breakpointLimits&&this.player.setBreakpointLimits(e,d.fromProto(t.breakpointLimits)),t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,s,o)}}}))}hasCapForPseudoStat(e){const t=this.individualConfig.defaults.statCaps||new d,a=this.player.getStatCaps(),i=this.individualConfig.defaults.softCapBreakpoints||[];return Po(e,a.add(t),i)}hasDisplayPseudoStat(e){for(const t of this.individualConfig.displayStats)if(t.equalsPseudoStat(e))return!0;return!1}}const Cf={id:"input-delay",type:"number",label:"Input Delay",labelTooltip:"Player input delay, in milliseconds. Specifies the maximum delay on actions that cannot be spell queued, such as spell casts that are waiting on resource gains or waiting for a cooldown to expire. Also used with certain APL values (such as 'Aura Is Active With Reaction Time'). Roughly models the sum of reaction time + server latency.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,a)=>{t.setReactionTime(e,a)}},Nf={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,a)=>{t.setChannelClipDelay(e,a)}},_f={id:"dark-intent-uptime",type:"number",label:"Dark Intent Uptime",labelTooltip:"% uptime on Dark Intent on the player (Only the stacking damage component)",changedEvent:e=>n.onAny([e.buffsChangeEmitter,e.miscOptionsChangeEmitter]),getValue:e=>e.getDarkIntentUptime(),setValue:(e,t,a)=>{t.setDarkIntentUptime(e,a)},showWhen:e=>e.getBuffs().darkIntent},Tf={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,a)=>{t.setInFrontOfTarget(e,a)}},Rf={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,a)=>{t.setDistanceFromTarget(e,a)}},Df={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>nt.equals(t,e.makeUnitReference()))),setValue:(e,t,a)=>{const i=[];if(-1!=a){for(let e=0;e<a;e++)i.push(Co());i.push(t.makeUnitReference())}t.getRaid().setTanks(e,i)}},Gf={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 25% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,a)=>{const i=t.getHealingModel();i.hps=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>nt.equals(t,e.makeUnitReference())))},Of={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, default values for Healing Cadence and Cadence +/- are inferred from boss damage parameters.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceSeconds=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>nt.equals(t,e.makeUnitReference())))},Uf={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceVariation=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>nt.equals(t,e.makeUnitReference())))},Af={id:"healing-model-absorb-frac",type:"number",float:!0,label:"Absorb %",labelTooltip:"\n\t\t<p>% of each incoming heal 'tick' to model as an absorb shield rather than as a direct heal.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().absorbFrac,setValue:(e,t,a)=>{const i=t.getHealingModel();i.absorbFrac=a/100,t.setHealingModel(e,i)}},Lf={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,a)=>{const i=t.getHealingModel();i.burstWindow=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>nt.equals(t,e.makeUnitReference())))},Ff={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,a)=>{const i=t.getSimpleCooldowns();i.hpPercentForDefensives=a/100,t.setSimpleCooldowns(e,i)}},Mf={id:"inspiration-uptime",type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:"\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,a)=>{const i=t.getHealingModel();i.inspirationUptime=a/100,t.setHealingModel(e,i)}};let Vf={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function Wf(e,t){return window.getComputedStyle(t)[e]}class Bf{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:Vf.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:Vf.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:Vf.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:Vf.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:Vf.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:Vf.keep_parity,tag:void 0!==t.tag?t.tag:Vf.tag,callbacks:void 0!==t.callbacks?t.callbacks:Vf.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let a=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=a,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let a=this.generate(),i=a.rows;this.displayedRows=a.rows;let s=this.checkChanges("data",i,t),o=this.checkChanges("top",a.top_offset,t),n=this.checkChanges("bottom",a.bottom_offset,t),l=this.options.callbacks,r=[];if(s||o){if(a.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",a.top_offset))}r.push(...i),a.bottom_offset&&r.push(this.renderExtraTag("bottom-space",a.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",a.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(a.rows_above-1),l.clusterChanged&&l.clusterChanged()}else n&&(this.content_elem.lastChild.style.height=a.bottom_offset+"px")}exploreEnvironment(e,t){let a=this.options;a.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),a.tag||(a.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,a=t.item_height;t.cluster_height=0;let i=this.content_elem.children;if(e.length&&i.length){let e=i[Math.floor(i.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=Wf("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(Wf("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let a=parseInt(Wf("marginTop",e),10)||0,i=parseInt(Wf("marginBottom",e),10)||0;t.item_height+=Math.max(a,i)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,a!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let a=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),i=a+e.rows_in_cluster,s=Math.max(a*e.item_height,0),o=Math.max((t-i)*e.item_height,0),n=[],l=a;return s<1&&l++,n=this.ds.generateRows(a,i),{top_offset:s,bottom_offset:o,rows_above:l,rows:n}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,a=document.createElement(e.tag),i=document.createTextNode(e.no_data_text);return a.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(i)),a.appendChild(t||i),[a]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let a=Math.max(t.cluster_height-t.block_height,1),i=Math.floor(t.scroll_top/a),s=Math.floor(e*t.item_height/a);return Math.min(i,s)}renderExtraTag(e,t){let a=document.createElement(this.options.tag),i="clusterize-";return a.className=[i+"extra-row",i+e].join(" "),a.style.marginTop="0",a.style.marginBottom="0",t&&(a.style.height=t+"px"),a}checkChanges(e,t,a){var i=t!=a[e];return a[e]=t,i}}const zf={[E.UNSPECIFIED]:"None",[E.ALLIANCE_ONLY]:"Alliance only",[E.HORDE_ONLY]:"Horde only"};class jf extends yn{constructor(e,a,i){super(e,"filters-menu",{size:"md",title:"Filters",disposeOnClose:!1});const s=this.newSection("General"),o=t("div",{className:"ilvl-filters"});s.appendChild(o),new xn(o,a.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.minIlvl=a,t.setFilters(e,i)}}),o.appendChild(t("span",{className:"ilvl-filters-separator"},"-")),new xn(o,a.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.maxIlvl=a,t.setFilters(e,i)}}),new hh(s,a.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[E.UNSPECIFIED,E.ALLIANCE_ONLY,E.HORDE_ONLY].map((e=>({name:zf[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,a)=>{const i=t.getFilters();i.factionRestriction=a,t.setFilters(e,i)}});const n=this.newSection("Source");n.classList.add("filters-menu-section-bool-list");If.ALL_SOURCES.filter((e=>e!=go.SourceUnknown)).forEach((e=>{new Me(n,a.sim,{id:`filters-source-${e}`,label:No.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.sources.push(e):s.sources=s.sources.filter((t=>t!=e)),a.setFilters(t,s)}})}));const l=this.newSection("Raids");l.classList.add("filters-menu-section-bool-list");if(If.ALL_RAIDS.filter((e=>e!=fo.RaidUnknown)).forEach((e=>{new Me(l,a.sim,{id:`filters-raid-${e}`,label:_o.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().raids.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.raids.push(e):s.raids=s.raids.filter((t=>t!=e)),a.setFilters(t,s)}})})),aw.ARMOR_SLOTS.includes(i)){const e=a.getPlayerClass().armorTypes;if(e.length>1){const t=this.newSection("Armor Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new Me(t,a.sim,{id:`filters-armor-type-${e}`,label:bo.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.armorTypes.push(e):s.armorTypes=s.armorTypes.filter((t=>t!=e)),a.setFilters(t,s)}})}))}}else if(aw.WEAPON_SLOTS.includes(i)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");a.getPlayerClass().weaponTypes.map((e=>e.weaponType)).forEach((t=>{new Me(e,a.sim,{id:`filters-weapon-type-${t}`,label:To.get(t),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(t),setValue:(e,a,i)=>{const s=a.getFilters();i?s.weaponTypes.push(t):s.weaponTypes=s.weaponTypes.filter((e=>e!=t)),a.setFilters(e,s)}})}));const t=this.newSection("Weapon Speed");t.classList.add("filters-menu-section-number-list"),new xn(t,a.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minMhWeaponSpeed=a,t.setFilters(e,i)}}),new xn(t,a.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxMhWeaponSpeed=a,t.setFilters(e,i)}}),a.getPlayerSpec().canDualWield&&(new xn(t,a.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minOhWeaponSpeed=a,t.setFilters(e,i)}}),new xn(t,a.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxOhWeaponSpeed=a,t.setFilters(e,i)}}))}else if(i==y.ItemSlotRanged){const e=a.getPlayerClass().rangedWeaponTypes;if(e.length<=1)return;const t=this.newSection("Ranged Weapon Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new Me(t,a.sim,{id:`filter-ranged-weapon-type-${e}`,label:Ro.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.rangedWeaponTypes.push(e):s.rangedWeaponTypes=s.rangedWeaponTypes.filter((t=>t!=e)),a.setFilters(t,s)}})}));const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new xn(i,a.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minRangedWeaponSpeed=a,t.setFilters(e,i)}}),new xn(i,a.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxRangedWeaponSpeed=a,t.setFilters(e,i)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section",`${e.toLowerCase().replaceAll(" ","-")}-section`),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class Hf{constructor(e,i,s,o,l,c,d,m,h,p,u,g,f,w){this.sortBy=1,this.sortDirection=Do.DESC,this.id=e,this.label=d,this.simUI=s,this.player=c,this.itemData=h,this.socketColor=p,this.computeEP=u,this.equippedToItemFn=g,this.onItemClick=w,this.slot=o,this.gearData=m,this.currentFilters=this.player.sim.getFilters();const I=d===l,b=d===qf.Reforging?"Reforge":"Item",x=a(),S=a(),v=a(),k=a(),E=a(),P=a(),C=a(),N=a(),_=a(),T=a(),R=a(),D=![y.ItemSlotTrinket1,y.ItemSlotTrinket2].includes(o);if(this.tabContent=t("div",{id:this.id,className:"selector-modal-tab-pane tab-pane fade "+(I?"active show":"")},t("div",{className:"selector-modal-filters"},t("input",{ref:x,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),d===qf.Items&&t("button",{ref:v,className:"selector-modal-filters-button btn btn-primary"},"Filters"),t("div",{ref:E,className:"selector-modal-phase-selector"}),t("div",{ref:C,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),t("div",{ref:N,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),t("div",{ref:P,className:"sim-input selector-modal-boolean-option selector-modal-show-matching-gems"}),D&&t("div",{ref:k,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),t("button",{ref:T,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),t("div",{className:"selector-modal-list-labels"},t("span",{className:"item-label"},t("small",null,b)),d===qf.Items&&t(r,null,t("label",{className:"source-label"},t("small",null,"Source")),t("label",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},t("small",null,"ILvl"))),D&&t("span",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},t("small",null,"EP"),t("i",{className:"fa-solid fa-plus-minus fa-2xs"}),t("button",{ref:S,className:"btn btn-link p-0 ms-1"},t("i",{className:"far fa-question-circle fa-lg"}))),t("span",{className:"favorite-label"}),t("span",{ref:R,className:"compare-label hide"})),t("ul",{ref:_,className:"selector-modal-list"})),i.appendChild(this.tabContent),this.label===qf.Items&&this.bindToggleCompare(R.value),d===qf.Items&&(o===y.ItemSlotMainHand||o===y.ItemSlotOffHand&&c.getClass()===O.ClassWarrior)&&(C.value&&function(e,t){e.classList.remove("hide"),new Me(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.oneHandedWeapons=a,t.setFilters(e,i)}})}(C.value,c.sim),N.value&&function(e,t){e.classList.remove("hide"),new Me(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.twoHandedWeapons=a,t.setFilters(e,i)}})}(N.value,c.sim)),D&&(k.value&&function(e,t){new Me(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,a)=>{t.setShowEPValues(e,a)}})}(k.value,c.sim),mn(S.value,{content:Go})),P.value&&(!function(e,t){new Me(e,t,{id:"show-matching-gems-selector",extraCssClasses:["show-matching-gems-selector","input-inline","mb-0"],label:"Match Socket",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().matchingGemsOnly,setValue:(e,t,a)=>{const i=t.getFilters();i.matchingGemsOnly=a,t.setFilters(e,i)}})}(P.value,c.sim),d.startsWith("Gem")||P.value?.classList.add("hide")),E.value&&function(e,t){new hh(e,t,{id:"phase-selector",extraCssClasses:["phase-selector"],values:[{name:"Phase 1 (Tier 11)",value:1},{name:"Phase 2 (ZG/ZA)",value:2},{name:"Phase 3 (Firelands)",value:3},{name:"Phase 4 (Dragon Soul)",value:4}],changedEvent:e=>e.phaseChangeEmitter,getValue:e=>e.getPhase(),setValue:(e,t,a)=>{t.setPhase(e,a)}})}(E.value,c.sim),d===qf.Items){const e=new jf(i,c,o);v.value?.addEventListener("click",(()=>e.open()))}this.listElem=_.value,this.itemsToDisplay=[],this.scroller=new Bf({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const a=[];for(let i=e;i<t&&!(i>=this.itemsToDisplay.length);++i)a.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return a}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const G=T.value;if(G)switch(G.addEventListener("click",(e=>{f(n.nextEventID())})),d){case qf.Enchants:G.textContent="Remove Enchant";break;case qf.Reforging:G.textContent="Remove Reforge";break;case qf.RandomSuffixes:G.textContent="Remove Random Suffix";break;case qf.Gem1:case qf.Gem2:case qf.Gem3:G.textContent="Remove Gem"}this.updateSelected(),this.searchInput=x.value,this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){if(!e)return null;switch(this.label){case qf.Enchants:return e.effectId;case qf.Reforging:return e.reforge.id;case qf.Items:case qf.Gem1:case qf.Gem2:case qf.Gem3:case qf.RandomSuffixes:return e.id;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),a=this.getItemIdByItemType(t),i=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,s=this.itemData[parseFloat(t)];s.id===a?e.classList.add("active"):e.classList.remove("active");const o=e.querySelector(".selector-modal-list-item-ep-delta");if(o&&(o.textContent="",s.item)){const e=this.computeEP(s.item);i!==e&&C(o,i,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let a=0;a<this.itemData.length;++a)e[a]=a;const t=this.player.getEquippedItem(this.slot);this.label===qf.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===qf.Enchants?e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t):this.label!==qf.Gem1&&this.label!==qf.Gem2&&this.label!==qf.Gem3||(e=this.player.filterGemData(e,(e=>this.itemData[e].item),this.slot,this.socketColor)),e=e.filter((e=>{const t=this.itemData[e];if(t.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),a=e(this.searchInput.value).split(" "),i=e(t.name.toString());let s=!0;if(a.some((e=>{i.includes(e)||(s=!1)})),!s)return!1}return!0})),[y.ItemSlotTrinket1,y.ItemSlotTrinket2].includes(this.slot)?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=Do.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const a=this.sortDirection===Do.DESC?t:e,i=this.sortDirection===Do.DESC?e:t,s=this.computeEP(a)-this.computeEP(i);return Math.abs(s)<.01?a.ilvl-i.ilvl:s};if(1===this.sortBy)t=(e,t)=>{const a=this.sortDirection===Do.DESC?t:e,i=this.sortDirection===Do.DESC?e:t;return a.ilvl-i.ilvl};return e.sort(((e,a)=>{const i=this.itemData[e],s=this.itemData[a];return this.isItemFavorited(i)&&!this.isItemFavorited(s)?-1:this.isItemFavorited(s)&&!this.isItemFavorited(i)?1:t(i.item,s.item)}))}hideOrShowEPValues(){const e=this.tabContent.querySelectorAll(".ep-label"),t=this.tabContent.querySelectorAll(".selector-modal-list"),a=this.player.sim.getShowEPValues(),i=a?"":"none";for(const s of e)s.style.display=i;for(const s of t)a?s.classList.remove("hide-ep"):s.classList.add("hide-ep")}createItemElem(e){const i=e.data,s=this.computeEP(i.item),o=this.equippedToItemFn(this.gearData.getEquippedItem()),l=this.getItemIdByItemType(o),c=o?this.computeEP(o):0,d=a(),m=a(),h=a(),p=a(),u=a(),g=a(),f=a(),w=a(),I=t("li",{className:"selector-modal-list-item "+(l===i.id?"active":""),dataset:{idx:e.idx.toString()}},t("div",{className:"selector-modal-list-label-cell gap-1",ref:d},t("a",{className:"selector-modal-list-item-link",ref:h,dataset:{whtticon:"false"}},t("img",{className:"selector-modal-list-item-icon",ref:p}),t("label",{className:"selector-modal-list-item-name",ref:m},i.name,i.heroic&&Hn()))),this.label===qf.Items&&t(r,null,t("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(i.item,this.player.sim)),t("div",{className:"selector-modal-list-item-ilvl-container"},i.item.ilvl)),![y.ItemSlotTrinket1,y.ItemSlotTrinket2].includes(this.slot)&&t("div",{className:"selector-modal-list-item-ep"},t("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()),t("span",{className:"selector-modal-list-item-ep-delta",ref:e=>i.item&&c!==s&&C(e,c,s,0)})),t("div",{className:"selector-modal-list-item-favorite-container"},t("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:u},t("i",{ref:g,className:"far fa-star fa-xl"}))),t("div",{ref:f,className:"selector-modal-list-item-compare-container"},t("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:w},t("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),b=e=>{const t=this.player.sim.getFilters();let a,s;switch(this.label){case qf.Items:a="favoriteItems",s=i.id;break;case qf.Enchants:a="favoriteEnchants",s=Mn(i.item);break;case qf.Gem1:case qf.Gem2:case qf.Gem3:a="favoriteGems",s=i.id;break;case qf.RandomSuffixes:a="favoriteRandomSuffixes",s=i.id;break;case qf.Reforging:a="favoriteReforges",s=i.id;break;default:return}if(e)t[a].push(s);else{const e=t[a].indexOf(s);-1!==e&&t[a].splice(e,1)}u.value.classList.toggle("text-brand"),g.value.classList.toggle("fas"),g.value.classList.toggle("far"),I.dataset.fav=e.toString(),this.player.sim.setFilters(n.nextEventID(),t)};u.value.addEventListener("click",(()=>b("false"===I.dataset.fav)));this.isItemFavorited(i)?(u.value.classList.add("text-brand"),g.value?.classList.add("fas"),I.dataset.fav="true"):(g.value?.classList.add("far"),I.dataset.fav="false");const x=mn(u.value);var S;if(S="true"===I.dataset.fav,x.setContent(S?"Remove from favorites":"Add to favorites"),this.label===qf.Items){const e=mn(w.value);this.bindToggleCompare(f.value);const a=this.simUI instanceof Pf?this.simUI:null;if(a){const s=()=>a.bt?.hasItem(P.create({id:i.id})),o=()=>{const t=s();e.setContent(t?"Remove from Batch Sim":"Add to Batch Sim"),w.value.classList[t?"add":"remove"]("text-brand")};o(),a.bt?.itemsChangedEmitter.on((()=>{o()})),w.value.addEventListener("click",(()=>{const e=s();a.bt?.[e?"removeItem":"addItem"](P.create({id:i.id})),new Nn({delay:1e3,variant:"success",body:t(r,null,t("strong",null,i.name)," was ",t(r,null,e?"removed from the batch":"added to the batch"),".")})}))}}h.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===u.value)return!1;this.onItemClick(i)})),i.actionId.fill().then((e=>{e.setWowheadHref(h.value),p.value.src=e.iconUrl})),bn(m.value,i.quality);const v=new Vn(this.player,{itemId:i.id});return v.hasNotice&&d.value?.appendChild(v.rootElem),I}isItemFavorited(e){return this.label===qf.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===qf.Enchants?this.currentFilters.favoriteEnchants.includes(Mn(e.item)):this.label.startsWith("Gem")?this.currentFilters.favoriteGems.includes(e.id):this.label===qf.RandomSuffixes?this.currentFilters.favoriteRandomSuffixes.includes(e.id):this.label===qf.Reforging&&this.currentFilters.favoriteReforges.includes(e.id)}getSourceInfo(e,a){const i=(e,a)=>t("a",{href:e,target:"_blank",dataset:{whtticon:"false"}},t("small",null,a));if(!e.sources?.length){if(e.randomSuffixOptions.length)return i(`${h.makeItemUrl(e.id)}#dropped-by`,"World Drop");if(Oo(e)){const a=Uo(e);return a?i(h.makeItemUrl(e.id),t("span",null,a,t("br",null),"PVP")):t(r,null)}return t(r,null)}let s=e.sources[0];if("crafted"===s.source.oneofKind){const t=s.source.crafted;return t.spellId?i(h.makeSpellUrl(t.spellId),ts.get(t.profession)??"Unknown"):i(h.makeItemUrl(e.id),ts.get(t.profession)??"Unknown")}if("drop"===s.source.oneofKind){const o=s.source.drop,n=a.db.getZone(o.zoneId),l=a.db.getNpc(o.npcId);if(!n)throw new Error("No zone found for item: "+e);const r=o.category?` - ${o.category}`:"";return l?i(h.makeNpcUrl(l.id),t("span",null,n.name," (",Ao.get(o.difficulty)??"Unknown",")",t("br",null),l.name+r)):o.otherName?i(h.makeZoneUrl(n.id),t("span",null,n.name,t("br",null),o.otherName)):i(h.makeZoneUrl(n.id),n.name)}if("quest"===s.source.oneofKind&&s.source.quest.name){const a=s.source.quest;return i(h.makeQuestUrl(a.id),t("span",null,"Quest",e.factionRestriction===E.ALLIANCE_ONLY&&t("img",{src:"/cata/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),e.factionRestriction===E.HORDE_ONLY&&t("img",{src:"/cata/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),t("br",null),a.name))}if("rep"===(s=e.sources.find((e=>"rep"===e.source.oneofKind))??s).source.oneofKind){const a=e.sources.filter((e=>"rep"===e.source.oneofKind)).map((e=>"rep"===e.source.oneofKind?Lo[e.source.rep.repFactionId]:Lo[Fo.RepFactionUnknown])),o=s.source.rep,n=Mo[o.repFactionId];return i(h.makeNpcUrl(n),t(r,null,a.map((a=>t("span",null,a,e.factionRestriction===E.ALLIANCE_ONLY&&t("img",{src:"/cata/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),e.factionRestriction===E.HORDE_ONLY&&t("img",{src:"/cata/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),t("br",null)))),t("span",null,Vo[o.repLevel])))}if(Oo(e)){const a=Uo(e);return a?i(h.makeItemUrl(e.id),t("span",null,a,t("br",null),"PVP")):t(r,null)}if("soldBy"===s.source.oneofKind){const e=s.source.soldBy;return i(h.makeNpcUrl(e.npcId),t("span",null,"Sold by",t("br",null),e.npcName))}return t(r,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}}var qf=(e=>(e.Items="Items",e.RandomSuffixes="Random Suffix",e.Enchants="Enchants",e.Reforging="Reforging",e.Gem1="Gem1",e.Gem2="Gem2",e.Gem3="Gem3",e))(qf||{});class Kf extends yn{constructor(e,a,i,s,o){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=y.ItemSlotHead,this.currentTab="Items",this.disabledTabs=[],this.simUI=a,this.player=i,this.gearPicker=s,this.options={id:tt(),...o},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",t("div",null,t("h6",{className:"selector-modal-title"}),t("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(t("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(t("div",{className:"d-flex align-items-center form-text"},t("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),t("span",null,"If gear is missing, check the selected phase and your gear filters.",t("br",null),"If the problem persists, save any un-saved data, click the",t("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,a){this.titleElem.textContent=S.get(e)??"",this.setData(e,t,a),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,a){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const i=a.getEquippedItem(),s=this.player.getItems(e),o=this.player.getEnchants(e),n=i?.item?this.player.getAvailableReforgings(i.getWithRandomSuffixStats()):[];("Enchants"===t&&!o.length||"Reforging"===t&&!n.length||["Gem1","Gem2","Gem3"].includes(t)&&0===i?.numSockets(this.player.isBlacksmithing()))&&(t="Items"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Items")&&this.addTab({id:Wo(`${this.options.id}-Items`),label:"Items",gearData:a,itemData:s.map((t=>({item:t,id:t.id,actionId:h.fromItem(t),name:t.name,quality:t.quality,heroic:t.heroic,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const i=a.getEquippedItem();i?a.equipItem(e,i.withItem(t)):a.equipItem(e,new Bo(t))}}))),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{a.equipItem(e,null),this.removeTabs("Gem"),this.removeTabs("Random Suffix")}});!this.disabledTabs?.includes("Enchants")&&this.addTab({id:Wo(`${this.options.id}-Enchants`),label:"Enchants",gearData:a,itemData:o.map((e=>({item:e,id:e.effectId,actionId:e.itemId?h.fromItemId(e.itemId):h.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new d(e.stats)),ignoreEPFilter:!0,heroic:!1,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(i,a);!this.disabledTabs?.includes("Reforging")&&this.addReforgingTab(i,a);!["Gem1","Gem2","Gem3"].some((e=>this.disabledTabs?.includes(e)))&&this.addGemTabs(e,i,a),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(t("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((e=>{const i=a(),s=t("div",{className:"item-picker-icon-wrapper",dataset:{slot:e.slot}},t("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",onclick:t=>{t.preventDefault(),e.slot!=this.currentSlot&&e.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),o=()=>{e.item?(this.player.setWowheadData(e.item,i.value),e.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(i.value)}))):i.value.style.backgroundImage=`url('${jn(e.slot)}')`};return o(),e.onUpdate((()=>o())),mn(i.value,{content:`Edit ${S.get(e.slot)}`,placement:"left"}),this.itemSlotTabElems.push(s),s}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=zo(this.currentSlot-1,Object.keys(y).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=zo(this.currentSlot+1,Object.keys(y).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addGemTabs(e,t,a){if(!t)return;const i=this.player.computeStatsEP(new d(t.item.socketBonus))/(t.item.gemSockets.length||1);t.curSocketColors(this.player.isBlacksmithing()).forEach(((e,t)=>{const s=qf[`Gem${t+1}`];this.addTab({id:Wo(`${this.options.id}-${s}`),label:s,gearData:a,itemData:this.player.getGems(e).map((e=>({item:e,id:e.id,actionId:h.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,heroic:!1,baseEP:this.player.computeStatsEP(new d(e.stats)),ignoreEPFilter:!0,onEquip:(e,i)=>{const s=a.getEquippedItem();s&&a.equipItem(e,s.withGem(i,t))}}))),computeEP:t=>{let a=this.player.computeGemEP(t);return jo(t,e)&&(a+=i),a},equippedToItemFn:e=>e?.gems[t],onRemove:e=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withGem(null,t))},setTabContent:i=>{const s=qn(e,null,t);i.appendChild(s),i.classList.add("selector-modal-tab-gem");const o=i.querySelector(".gem-icon"),n=I(e),l=()=>{const e=a.getEquippedItem(),i=e?.gems[t];i?(o.classList.remove("hide"),h.fromItemId(i.id).fill().then((e=>{o.setAttribute("src",e.iconUrl)}))):(o.classList.add("hide"),o.setAttribute("src",n))};a.changeEvent.on(l),this.addOnDisposeCallback((()=>a.changeEvent.off(l))),l()},socketColor:e})}))}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const a=e.item;this.addTab({id:Wo(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(a).map((e=>({item:e,id:e.id,actionId:h.fromRandomSuffix(a,e),name:e.name,quality:a.quality,phase:a.phase,heroic:!1,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,a)=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(a))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const a=t.getEquippedItem();a&&t.equipItem(e,a.withItem(a.item).withRandomSuffix(null)),this.removeTabs("Reforging")}})}addReforgingTab(e,a){if(!e||e.hasRandomSuffixOptions()&&!e.randomSuffix)return;const s=e.item;this.addTab({id:Wo(`${this.options.id}-Reforging`),label:"Reforging",gearData:a,itemData:this.player.getAvailableReforgings(e).map((e=>({item:e,id:e.id,actionId:h.fromReforge(s,e.reforge),name:t("div",null,t("span",{className:"reforge-value negative"},e.fromAmount," ",b.get(e.fromStat)),t("span",{className:"reforge-value positive"},"+",e.toAmount," ",b.get(e.toStat))),quality:i.ItemQualityCommon,phase:s.phase,heroic:!1,baseEP:this.player.computeReforgingEP(e),ignoreEPFilter:!0,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withReforge(t.reforge))}}))),computeEP:e=>this.player.computeReforgingEP(e),equippedToItemFn:e=>e?.getReforgeData()||null,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withItem(t.item).withRandomSuffix(t._randomSuffix))}})}addTab({id:e,label:i,gearData:s,itemData:o,computeEP:l,equippedToItemFn:r,onRemove:c,setTabContent:d,socketColor:m}){if(!o.length)return;const h=i===this.currentTab,p=a();this.tabsElem.appendChild(t("li",{className:"nav-item"},t("button",{ref:p,className:u("nav-link selector-modal-item-tab",h&&"active"),dataset:{label:i,bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":h}}))),d?d(p.value):p.value.textContent=i;const g=new Hf(e,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,i,s,o,m||Ve.GemColorUnknown,l,r,c,(e=>{const t=e;e.onEquip(n.nextEventID(),t.item);const a=Te.is(t.item),i=!!t.actionId.randomSuffixId;(a||i)&&(i||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(s.getEquippedItem(),s)),this.removeTabs("Reforging"),this.addReforgingTab(s.getEquippedItem(),s),this.removeTabs("Gem"),this.addGemTabs(this.currentSlot,s.getEquippedItem(),s))})),f=()=>{g.updateSelected()},w=()=>{g.applyFilters()},y=()=>{g.hideOrShowEPValues()};s.changeEvent.on(f),this.player.sim.phaseChangeEmitter.on(w),this.player.sim.filtersChangeEmitter.on(w),this.player.sim.showEPValuesChangeEmitter.on(y),this.addOnDisposeCallback((()=>{s.changeEvent.off(f),this.player.sim.phaseChangeEmitter.off(w),this.player.sim.filtersChangeEmitter.off(w),this.player.sim.showEPValuesChangeEmitter.off(y),g.dispose()})),p.value.addEventListener("click",(e=>{this.currentTab=i})),p.value.addEventListener("shown.bs.tab",(e=>{g.sizeRefresh()})),this.ilists.push(g)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),a=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),a.forEach((e=>e.remove()))}}class $f extends e{constructor(e,i,s,o){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=o;const n=a(),l=a();this.rootElem.prepend(t("a",{ref:n,className:"icon-picker-button",href:"#",attributes:{role:"button"}},t("div",{ref:l,className:"item-picker-sockets-container"}))),this.iconAnchor=n.value,this.socketsContainerElem=l.value;const r=new Kf(i.rootElem,i,this.player);s.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),r.openTab(this.slot,qf.Items,this.createGearData())}))})),s.itemSwapSettings.changeEmitter.on((()=>{this.update(s.itemSwapSettings.getGear().getEquippedItem(o))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${jn(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor),this.socketsContainerElem.replaceChildren(t(r,null,e.allSocketColors().map(((t,a)=>{const i=qn(t,e.gems[a],a);if(a===e.numPossibleSockets-1&&[x.ItemTypeWrist,x.ItemTypeHands].includes(e.item.type)){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}return i})))),this.iconAnchor.classList.add("active")):(this.socketsContainerElem.replaceChildren(),this.iconAnchor.classList.remove("active"))}createGearData(){return{equipItem:(e,t)=>{this.player.itemSwapSettings.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.itemSwapSettings.getItem(this.slot),changeEvent:this.player.itemSwapSettings.changeEmitter}}}class Yf{constructor(e){this.changeEmitter=new n("PlayerItemSwap"),this.enableItemSwap=!1,this.gear=new Ho({}),this.bonusStats=new d,this.player=e}setItemSwapSettings(e,t,a,i){this.enableItemSwap=t,this.gear=a,this.bonusStats=i||new d,this.changeEmitter.emit(e)}setBonusStats(e,t){this.bonusStats=t,this.changeEmitter.emit(e)}getBonusStats(){return this.bonusStats}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.changeEmitter.emit(e))}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.player.canDualWield2H()))}getItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.changeEmitter.emit(e))}toProto(){return ds.create({prepullBonusStats:this.bonusStats.toProto(),items:this.gear.asArray().map((e=>e?e.asSpec():P.create()))})}}class Jf extends e{constructor(e,i,o,l){super(e,"item-swap-picker-root"),this.itemSlots=l.itemSlots,new Me(this.rootElem,o,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.itemSwapSettings.getEnableItemSwap(),setValue(e,t,a){t.itemSwapSettings.setEnableItemSwap(e,a)},changedEvent:e=>e.itemSwapSettings.changeEmitter});const c=a(),d=a(),m=a(),h=s.newGroupContainer("icon-group");this.rootElem.appendChild(t(r,null,t("div",{ref:c,className:"input-root input-inline input-item-swap-container"},t("label",{className:"form-label"},"Item Swap"),t("button",{ref:d,className:"gear-swap-icon"},t("i",{className:"fas fa-arrows-rotate me-1"})),h),l.note&&t("p",{ref:m,className:"form-text"},l.note)));const p=()=>{o.itemSwapSettings.getEnableItemSwap()?(c.value?.classList.remove("hide"),m.value?.classList.remove("hide")):(c.value?.classList.add("hide"),m.value?.classList.add("hide"))};o.itemSwapSettings.changeEmitter.on(p),p(),d.value&&(d.value.addEventListener("click",(e=>this.swapWithGear(n.nextEventID(),o))),mn(d.value,{content:"Swap with equipped items"}));const u=t(r,null);this.itemSlots.forEach((e=>{new $f(u,i,o,e)})),h.appendChild(u)}swapWithGear(e,t){let a=t.getGear(),i=t.itemSwapSettings.getGear();this.itemSlots.forEach((e=>{const s=t.getGear().getEquippedItem(e),o=t.itemSwapSettings.getGear().getEquippedItem(e);a=a.withEquippedItem(e,o,t.canDualWield2H()),i=i.withEquippedItem(e,s,t.canDualWield2H())})),n.freezeAllAndDo((()=>{t.setGear(e,a),t.itemSwapSettings.setGear(e,i)}))}}class Zf{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:h.fromProto(e.id)}))),a=e.auras.map((e=>({data:e,id:h.fromProto(e.id)})));await Promise.all([...t,...a].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>G(e.id.name,t.id.name))),a=a.sort(((e,t)=>G(e.id.name,t.id.name)));let i=!1;return e.name!=this.name&&(this.name=e.name,i=!0),(t.length!=this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,i=!0),(a.length!=this.auras.length||a.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=a,i=!0),i}}class Qf{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let i=t;i<e.length;i++)this.metadatas.push(new Zf);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const a=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!=this.metadatas.length||a.some((e=>e))}asList(){return this.metadatas.slice()}}const Xf={};function ew(e){const t=Xf[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const tw=class e{constructor(t,a){this.name="",this.buffs=rs.create(),this.consumes=cs.create(),this.bonusStats=new d,this.gear=new qo({}),this.profession1=0,this.profession2=0,this.aplRotation=Je.create(),this.talentsString="",this.glyphs=Se.create(),this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.darkIntentUptime=100,this.healingModel=Qe.create(),this.healingEnabled=!1,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.gemEPCache=new Map,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new d,this.statCaps=new d,this.softCapBreakpoints=[],this.breakpointLimits=new d,this.currentStats=Ko.create(),this.metadata=new Zf,this.petMetadatas=new Qf,this.nameChangeEmitter=new n("PlayerName"),this.buffsChangeEmitter=new n("PlayerBuffs"),this.consumesChangeEmitter=new n("PlayerConsumes"),this.bonusStatsChangeEmitter=new n("PlayerBonusStats"),this.gearChangeEmitter=new n("PlayerGear"),this.professionChangeEmitter=new n("PlayerProfession"),this.raceChangeEmitter=new n("PlayerRace"),this.rotationChangeEmitter=new n("PlayerRotation"),this.talentsChangeEmitter=new n("PlayerTalents"),this.glyphsChangeEmitter=new n("PlayerGlyphs"),this.specOptionsChangeEmitter=new n("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new n("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new n("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new n("PlayerHealingModel"),this.epWeightsChangeEmitter=new n("PlayerEpWeights"),this.statCapsChangeEmitter=new n("StatCaps"),this.softCapBreakpointsChangeEmitter=new n("SoftCapBreakpoints"),this.breakpointLimitsChangeEmitter=new n("BreakpointLimits"),this.miscOptionsChangeEmitter=new n("PlayerMiscOptions"),this.currentStatsEmitter=new n("PlayerCurrentStats"),this.epRatiosChangeEmitter=new n("PlayerEpRatios"),this.epRefStatChangeEmitter=new n("PlayerEpRefStat"),this.sim=a,this.party=null,this.raid=null,this.playerSpec=t,this.playerClass=Cs.getPlayerClass(t),this.race=this.playerClass.races[0],this.specTypeFunctions=fe[this.getSpec()],this.specOptions=this.specTypeFunctions.optionsCreate();const i=ew(this.getSpec());this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null,this.hiddenMCDs=i.hiddenMCDs||new Array;for(let e=0;e<y.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.itemSwapSettings=new Yf(this),this.changeEmitter=n.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.glyphsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter,this.statCapsChangeEmitter,this.breakpointLimitsChangeEmitter],"PlayerChange")}getSpecIcon(){return this.playerSpec.getIcon("medium")}getPlayerSpec(){return this.playerSpec}getSpec(){return this.getPlayerSpec().specID}getPlayerClass(){return this.playerClass}getClass(){return this.playerSpec.classID}getClassColor(){return this.playerClass.hexColor}canEnableTargetDummies(){return[O.ClassDruid,O.ClassPaladin,O.ClassPriest,O.ClassShaman].includes(this.getClass())}shouldEnableTargetDummies(){if(this.getPlayerSpec().isHealingSpec)return!0;if(!this.itemSwapSettings.getEnableItemSwap())return!1;return this.itemSwapSettings.getGear().hasTrinketFromOptions([72898,77969,77204,77989])}isSpec(e){return this.getSpec()==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((e=>null!=e&&e!=this))}getItems(e){return this.sim.db.getItems(e).filter((t=>k(t,this.playerSpec,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0))}getAvailableReforgings(e){const t=e.getWithRandomSuffixStats();return this.sim.db.getAvailableReforges(t.item).map((t=>e.getReforgeData(t)))}getReforge(e){return this.sim.db.getReforgeById(e)}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>$o(e,this.playerSpec)))}getGems(e){return this.sim.db.getGems(e)}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.gemEPCache=new Map,this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let a=0;a<y.ItemSlotRanged+1;++a)this.itemEPCache[a]=new Map}getStatCaps(){return this.statCaps}setStatCaps(e,t){this.statCaps=t,this.statCapsChangeEmitter.emit(e)}getSoftCapBreakpoints(){return this.softCapBreakpoints}setSoftCapBreakpoints(e,t){this.softCapBreakpoints=t,this.softCapBreakpointsChangeEmitter.emit(e)}getBreakpointLimits(){return this.breakpointLimits}setBreakpointLimits(e,t){this.breakpointLimits=t,this.breakpointLimitsChangeEmitter.emit(e)}getDefaultEpRatios(t,a){const i=new Array(e.numEpRatios).fill(0);return a?i[1]=1:t?(i[2]=1,i[3]=1,this.getSpec()==w.SpecBloodDeathKnight&&(i[1]=1)):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,a,i,s){try{const e=await this.sim.statWeights(this,t,a,i,s);return e.error?(e.error.type==Ue.ErrorOutcomeAborted&&new Nn({variant:"info",body:"Statweight sim cancelled."}),null):e}catch(o){return console.error(o),new Nn({variant:"error",body:o?.message||"Something went wrong calculating your stat weights. Reload the page and try again."}),null}}getCurrentStats(){return Ko.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),a=await e,i=await t;return a||i}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!=xe.ProfessionUnknown))}setProfessions(e,t){n.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||xe.ProfessionUnknown),this.setProfession2(e,t[1]||xe.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(xe.Blacksmithing)}getFaction(){return Yo[this.getRace()]}getBuffs(){return rs.clone(this.buffs)}setBuffs(e,t){rs.equals(this.buffs,t)||(this.buffs=rs.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return cs.clone(this.consumes)}setConsumes(e,t){cs.equals(this.consumes,t)||(this.consumes=cs.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return this.getSpec()==w.SpecFuryWarrior&&this.getTalents().titansGrip}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getEquippedItems(){return this.gear.getEquippedItems()}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=this.currentStats.finalStats?.pseudoStats[g.PseudoStatPhysicalCritPercent]||0,t=this.currentStats.finalStats?.pseudoStats[g.PseudoStatPhysicalHitPercent]||0,a=(this.currentStats.finalStats?.stats[l.StatExpertiseRating]||0)/Jo/4,i=void 0!==this.getGear().getEquippedItem(y.ItemSlotOffHand)?.item.weaponSpeed,s=i&&this.getClass()!=O.ClassWarrior?27:8,o=this.getInFrontOfTarget()?14:0,n=6.5+o,r=Math.max(s-t,0),c=Math.max(6.5-a,0)+Math.max(o-a,0);let d=0;if(this.getSpec()===w.SpecEnhancementShaman){d=3*this.getTalents().elementalDevastation}const m=80.8-r-c-d;return{meleeCrit:e,meleeHit:t,expertise:a,suppression:4.8,glancing:24,hasOffhandWeapon:i,meleeHitCap:s,expertiseCap:n,remainingMeleeHitCap:r,remainingExpertiseCap:c,baseCritCap:m,specSpecificOffset:d,playerCritCapDelta:e-m}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}setAplRotation(e,t){Je.equals(t,this.aplRotation)||(this.aplRotation=Je.clone(t),this.rotationChangeEmitter.emit(e))}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=Zo.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return Eo.clone(this.aplRotation.simple?.cooldowns||Eo.create())}setSimpleCooldowns(e,t){Eo.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=Zo.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==Ye.TypeUnknown?Ye.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==Ye.TypeAuto&&this.autoRotationGenerator){const e=Je.clone(this.autoRotationGenerator(this));return e.type=Ye.TypeAuto,e}if(e==Ye.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=Je.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=Ye.TypeSimple,t}return this.aplRotation}getTalents(){var e,t;return null==this.talents&&(this.talents=(e=this.playerSpec,t=this.talentsString,Hl(fe[e.specID].talentsCreate(),t,zl[e.classID]))),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return us(this.getTalentsString())}getTalentTreePoints(){return gs(this.getTalentsString())}getTalentTreeIcon(){return this.playerSpec.getIcon("medium")}getGlyphs(){return Se.clone(this.glyphs)}setGlyphs(e,t){Se.equals(this.glyphs,t)||(this.glyphs=Se.clone(t),this.glyphsChangeEmitter.emit(e))}getPrimeGlyps(){return[this.glyphs.prime1,this.glyphs.prime2,this.glyphs.prime3].filter((e=>0!=e))}getMajorGlyphs(){return[this.glyphs.major1,this.glyphs.major2,this.glyphs.major3].filter((e=>0!=e))}getMinorGlyphs(){return[this.glyphs.minor1,this.glyphs.minor2,this.glyphs.minor3].filter((e=>0!=e))}getAllGlyphs(){return this.getPrimeGlyps().concat(this.getMajorGlyphs().concat(this.getMinorGlyphs()))}getClassOptions(){return this.getSpecOptions().classOptions}setClassOptions(e,t){const a=this.getSpecOptions();a.classOptions=t,this.specTypeFunctions.optionsEquals(a,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(a),this.specOptionsChangeEmitter.emit(e))}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getDarkIntentUptime(){return this.darkIntentUptime}setDarkIntentUptime(e,t){t!=this.darkIntentUptime&&(this.darkIntentUptime=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,a=t.dualWield;if(0==e.cadenceSeconds){let i=1.5*t.swingSpeed;a&&(i/=2),e.cadenceSeconds=.4,e.cadenceVariation=i-e.cadenceSeconds}0==e.hps&&(e.hps=.25*t.minBaseDamage/t.swingSpeed,a&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return Qe.clone(this.healingModel)}setHealingModel(e,t){Qe.equals(this.healingModel,t)||(this.healingModel=Qe.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeGemEP(e){if(this.gemEPCache.has(e.id))return this.gemEPCache.get(e.id);const t=this.computeStatsEP(new d(e.stats)),a=Qo(this.playerSpec,e,d.fromProto(this.currentStats.finalStats));let i=0;e.unique&&(i-=.01);const s=t+a+i;return this.gemEPCache.set(e.id,s),s}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);const t=this.computeStatsEP(new d(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new d(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeReforgingEP(e){let t=new d([]);return t=t.addStat(e.fromStat,e.fromAmount),t=t.addStat(e.toStat,e.toAmount),this.computeStatsEP(t)}computeItemEP(e,t){if(null==e)return 0;const a=this.itemEPCache[t].get(e.id);if(void 0!==a)return a;let i=new d(e.stats);if(e.weaponSpeed>0){const a=Xo(e);t==y.ItemSlotMainHand?i=i.withPseudoStat(g.PseudoStatMainHandDps,a):t==y.ItemSlotOffHand?i=i.withPseudoStat(g.PseudoStatOffHandDps,a):t==y.ItemSlotRanged&&(i=i.withPseudoStat(g.PseudoStatRangedDps,a))}let s=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e)||0)));s=Math.max(...t)*e.randPropPoints/1e4}let o=i.computeEP(this.epWeights)+s;e.unique&&(o-=.01);const n=U(e.gemSockets.map((e=>{const t=this.sim.db.getGems(e).filter((e=>en(e,this.sim.getPhase())));return t.length>0?Math.max(...t.map((e=>this.computeGemEP(e)))):0}))),l=U(e.gemSockets.map((e=>{const t=this.sim.db.getGems(e).filter((t=>en(t,this.sim.getPhase())&&jo(t,e)));return t.length>0?Math.max(...t.map((e=>this.computeGemEP(e)))):0})))+this.computeStatsEP(new d(e.socketBonus));return o+=Math.max(l,n),this.itemEPCache[t].set(e.id,o),o}async setWowheadData(e,t){const a=this.hasProfession(xe.Blacksmithing),i=e.gems.length?e.curGems(a).map((e=>e?e.id:0)):[];e.asActionId().setWowheadDataset(t,{gemIds:i,enchantId:e.enchant?.effectId,reforgeId:e.reforge?.id,setPieceIds:this.gear.asArray().filter((e=>null!=e)).map((e=>e.item.id)),hasExtraSocket:e.hasExtraSocket(a)}),t.dataset.whtticon="false"}get armorSpecializationArmorType(){return this.playerClass.armorTypes[0]}hasArmorSpecializationBonus(){return[y.ItemSlotHead,y.ItemSlotShoulder,y.ItemSlotChest,y.ItemSlotWrist,y.ItemSlotHands,y.ItemSlotWaist,y.ItemSlotLegs,y.ItemSlotFeet].some((e=>{const t=this.getEquippedItem(e)?.item;if(!t)return!1;return t.armorType!==this.armorSpecializationArmorType}))}filterItemData(t,a,i){const s=this.sim.getFilters(),o=(e,t)=>e.filter((e=>t(a(e))));0!=s.minIlvl&&(t=o(t,(e=>e.ilvl>=s.minIlvl))),0!=s.maxIlvl&&(t=o(t,(e=>e.ilvl<=s.maxIlvl))),s.factionRestriction!=E.UNSPECIFIED&&(t=o(t,(e=>e.factionRestriction==s.factionRestriction||e.factionRestriction==E.UNSPECIFIED))),s.sources.includes(go.SourceCrafting)||(t=o(t,(e=>!e.sources.some((e=>"crafted"==e.source.oneofKind))))),s.sources.includes(go.SourceQuest)||(t=o(t,(e=>!e.sources.some((e=>"quest"==e.source.oneofKind))))),s.sources.includes(go.SourceReputation)||(t=o(t,(e=>!e.sources.some((e=>"rep"==e.source.oneofKind))))),s.sources.includes(go.SourcePvp)||(t=o(t,(e=>!Oo(e))));for(const[n,l]of Object.entries(e.DIFFICULTY_SRCS)){const a=parseInt(n);if(!s.sources.includes(a)&&(t=o(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==l)))),l==tn.DifficultyRaid10H||l==tn.DifficultyRaid25H)){const a=e.HEROIC_TO_NORMAL[l];t=o(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==a&&e.source.drop.category==rn))))}}for(const[n,l]of Object.entries(e.RAID_IDS)){const e=parseInt(n);s.raids.includes(e)||(t=o(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==l)))))}return e.ARMOR_SLOTS.includes(i)?t=o(t,(e=>!!s.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(i)?t=o(t,(e=>{if(!s.weaponTypes.includes(e.weaponType))return!1;if(!s.oneHandedWeapons&&e.handType!=xo.HandTypeTwoHand)return!1;if(!s.twoHandedWeapons&&e.handType==xo.HandTypeTwoHand)return!1;const t=i==y.ItemSlotMainHand?s.minMhWeaponSpeed:s.minOhWeaponSpeed,a=i==y.ItemSlotMainHand?s.maxMhWeaponSpeed:s.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(a>0&&e.weaponSpeed>a)})):i==y.ItemSlotRanged&&(t=o(t,(e=>{if(!s.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=s.minRangedWeaponSpeed,a=s.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(a>0&&e.weaponSpeed>a)}))),t}filterEnchantData(e,t,a,i){return i?e.filter((e=>{const a=t(e);return!!an(a,i.item)})):e}filterGemData(e,t,a,i){const s=this.sim.getFilters(),o=this.hasProfession(xe.Jewelcrafting);return e.filter((e=>{const a=t(e);return!(!o&&a.requiredProfession==xe.Jewelcrafting)&&!(s.matchingGemsOnly&&!jo(a,i))}))}makeUnitReference(){return null==this.party?Co():sn(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(this.sim.db),t=this.itemSwapSettings.getGear().toDatabase(this.sim.db);return R.mergeSimDatabases(e,t)}toProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.getGear(),o=t?this.getResolvedAplRotation():on(this.aplRotation,["uuid"]);let n=Gs.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return i(ol.Gear)&&Gs.mergePartial(n,{equipment:s.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.itemSwapSettings.getEnableItemSwap(),itemSwap:this.itemSwapSettings.toProto()}),i(ol.Talents)&&Gs.mergePartial(n,{talentsString:this.getTalentsString(),glyphs:this.getGlyphs()}),i(ol.Rotation)&&Gs.mergePartial(n,{cooldowns:Eo.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:o}),i(ol.Consumes)&&Gs.mergePartial(n,{consumes:this.getConsumes()}),i(ol.Miscellaneous)&&(Gs.mergePartial(n,{name:this.getName(),race:this.getRace(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),darkIntentUptime:this.getDarkIntentUptime()}),n=nn(this.getSpec(),n,this.getSpecOptions())),i(ol.External)&&Gs.mergePartial(n,{buffs:this.getBuffs()}),n}fromProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e);n.freezeAllAndDo((()=>{i(ol.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new qo({})),this.itemSwapSettings.setItemSwapSettings(e,t.enableItemSwap,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new Ho({}),d.fromProto(t.itemSwap?.prepullBonusStats)),this.setBonusStats(e,d.fromProto(t.bonusStats||et.create()))),i(ol.Talents)&&(this.setTalentsString(e,t.talentsString),this.setGlyphs(e,t.glyphs||Se.create())),i(ol.Rotation)&&(t.rotation?.type==Ye.TypeUnknown&&(t.rotation||(t.rotation=Je.create()),t.rotation.type=Ye.TypeAuto),this.setAplRotation(e,t.rotation||Je.create())),i(ol.Consumes)&&this.setConsumes(e,t.consumes||cs.create()),i(ol.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||Qe.create()),this.setDarkIntentUptime(e,t.darkIntentUptime)),i(ol.External)&&this.setBuffs(e,t.buffs||rs.create())}))}clone(t){const a=new e(this.playerSpec,this.sim);return a.fromProto(t,this.toProto()),a}applySharedDefaults(e){n.freezeAllAndDo((()=>{this.setReactionTime(e,100),this.setInFrontOfTarget(e,this.playerSpec.isTankSpec),this.setHealingModel(e,Qe.create({burstWindow:this.playerSpec.isTankSpec?6:0})),this.setSimpleCooldowns(e,Eo.create({hpPercentForDefensives:this.playerSpec.isTankSpec?.4:0})),this.setBonusStats(e,new d)}))}getBaseMastery(){switch(this.playerSpec.specID){case w.SpecFrostMage:case w.SpecFuryWarrior:return 2;default:return 8}}getMasteryPerPointModifier(){return ln.get(this.getSpec())||0}};tw.numEpRatios=6,tw.ARMOR_SLOTS=[y.ItemSlotHead,y.ItemSlotShoulder,y.ItemSlotChest,y.ItemSlotWrist,y.ItemSlotHands,y.ItemSlotLegs,y.ItemSlotWaist,y.ItemSlotFeet],tw.WEAPON_SLOTS=[y.ItemSlotMainHand,y.ItemSlotOffHand],tw.DIFFICULTY_SRCS={[go.SourceDungeon]:tn.DifficultyNormal,[go.SourceDungeonH]:tn.DifficultyHeroic,[go.SourceRaidRF]:tn.DifficultyRaid25RF,[go.SourceRaid]:tn.DifficultyRaid25,[go.SourceRaidH]:tn.DifficultyRaid25H},tw.HEROIC_TO_NORMAL={[tn.DifficultyHeroic]:tn.DifficultyNormal,[tn.DifficultyRaid10H]:tn.DifficultyRaid10,[tn.DifficultyRaid25H]:tn.DifficultyRaid25},tw.RAID_IDS={[fo.RaidIcecrownCitadel]:4812,[fo.RaidRubySanctum]:4987,[fo.RaidBlackwingDescent]:5094,[fo.RaidTheBastionOfTwilight]:5334,[fo.RaidBaradinHold]:5600,[fo.RaidThroneOfTheFourWinds]:5638,[fo.RaidFirelands]:5723,[fo.RaidDragonSoul]:5892};let aw=tw;const iw=(e,t,a)=>{const i=D.fromJson(t);return sw(e,i,a||{})},sw=(e,t,a)=>{const i=[];return void 0!==a.talentTree&&i.push((e=>e.getTalentTree()==a.talentTree)),void 0!==a.talentTrees&&i.push((e=>(a.talentTrees||[]).includes(e.getTalentTree()))),void 0!==a.faction&&i.push((e=>e.getFaction()==a.faction)),void 0!==a.customCondition&&i.push(a.customCondition),{name:e,tooltip:a.tooltip||cn,gear:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},ow=(e,t,a)=>nw(e,t,a||{}),nw=(e,t,a)=>{const i=[];return void 0!==a?.customCondition&&i.push(a.customCondition),{name:e,epWeights:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},lw=(e,t,a)=>{const i=Vi.create({rotation:Je.fromJson(t)});return cw(e,i,a)},rw=(e,t,a,i)=>{const s=t==w.SpecBloodDeathKnight||t==w.SpecGuardianDruid||t==w.SpecProtectionPaladin||t==w.SpecProtectionWarrior,o=Vi.create({rotation:{type:Ye.TypeSimple,simple:{specRotationJson:JSON.stringify(fe[t].rotationToJson(a)),cooldowns:Eo.create({hpPercentForDefensives:s?.4:0})}}});return cw(e,o,i)},cw=(e,t,a)=>{const i=[];return null!=a?.talentTree&&i.push((e=>e.getTalentTree()==a.talentTree)),{name:e,rotation:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},dw=(e,t,a)=>{let i,s,o,n,l,r;if("string"==typeof t){const e=dm.tryParseUrlLocation(new URL(t)),a=e?.settings;a?.encounter&&Qh.updateProtoVersion(a.encounter),t=a?.encounter,i=a?.player?.healingModel,s=a?.tanks,o=a?.raidBuffs,n=a?.debuffs,l=a?.player?.buffs,r=a?.player?.consumes}return{name:e,encounter:t,tanks:s,healingModel:i,raidBuffs:o,debuffs:n,buffs:l,consumes:r,...a}},mw=(e,t)=>{const a=ds.fromJson(t);return hw(e,a)},hw=(e,t)=>({name:e,itemSwap:t}),pw=(e,{gear:t,itemSwap:a,talents:i,rotation:s,rotationType:o,epWeights:n,encounter:l,race:r})=>({name:e,itemSwap:a,gear:t,talents:i,rotation:s,rotationType:o,epWeights:n,encounter:l,race:r}),uw=(e,a,i)=>{const s=e.map((({condition:e,message:t})=>e(a)&&t)).filter((e=>!!e));s.length&&new Nn({variant:"warning",body:t(r,null,s.map((e=>t("p",null,e)))),delay:5e3*s.length,...i})};export{gp as $,Vp as A,yn as B,fp as C,Ap as D,wm as E,Gf as F,Of as G,Ff as H,Tf as I,Uf as J,Af as K,Lf as L,Op as M,Mf as N,_f as O,aw as P,uw as Q,Up as R,If as S,Df as T,Fp as U,jm as V,mw as W,Ip as X,yp as Y,dp as Z,Sp as _,ow as a,Rf as a0,Mm as a1,Vm as a2,qm as a3,rw as a4,dw as a5,Qm as a6,$p as a7,Xp as a8,Fg as a9,Gg as aa,Fm as ab,xp as ac,Np as ad,hp as ae,ah as af,wp as ag,Nf as ah,ih as ai,$m as aj,Mp as ak,vp as al,xn as am,Hg as an,ml as ao,Nn as ap,Cf as b,Pf as c,lw as d,Lp as e,up as f,ll as g,ew as h,Qh as i,lf as j,hh as k,of as l,iw as m,Cn as n,Rm as o,sh as p,_n as q,kf as r,Xh as s,oh as t,Sf as u,Jg as v,cm as w,Hm as x,Ym as y,pw as z};
